<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="32">
  <HTTPTask id="310" hostname="10.100.22.243:8081" path="/assets/app/dashboard/dashboard-manifest-10f1ed9d89cf396671bd4e3042b74253.js" url="http://10.100.22.243:8081/assets/app/dashboard/dashboard-manifest-10f1ed9d89cf396671bd4e3042b74253.js" ip="10.100.22.243" port="8081" connectionId="23" origin="Primary" frame="1" startDateTime="2020-08-31T10:21:43.032+05:30" startTime="407170578" endTime="407173515">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0Mzo4MDgx</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg1LjAuNDE4My44MyBTYWZhcmkvNTM3LjM2</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDM6ODA4MS8=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj0yNGQ0NzBkOS0yYzIxLTQ5MTQtOTZhMC04MTRkM2IyNDc2Nzk7IEF1dGhUeXBlPURhdGFiYXNl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9hc3NldHMvYXBwL2Rhc2hib2FyZC9kYXNoYm9hcmQtbWFuaWZlc3QtMTBmMWVkOWQ4OWNmMzk2NjcxYmQ0ZTMwNDJiNzQyNTMuanMgSFRUUC8xLjENCkhvc3Q6IDEwLjEwMC4yMi4yNDM6ODA4MQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg1LjAuNDE4My44MyBTYWZhcmkvNTM3LjM2DQpBY2NlcHQ6ICovKg0KUmVmZXJlcjogaHR0cDovLzEwLjEwMC4yMi4yNDM6ODA4MS8NCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZQ0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUyxlbjtxPTAuOQ0KQ29va2llOiBTRVNTSU9OPTI0ZDQ3MGQ5LTJjMjEtNDkxNC05NmEwLTgxNGQzYjI0NzY3OTsgQXV0aFR5cGU9RGF0YWJhc2UNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MjRkNDcwZDktMmMyMS00OTE0LTk2YTAtODE0ZDNiMjQ3Njc5</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="AuthType" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RGF0YWJhc2U=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>99136</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="X-Frame-Options" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>REVOWQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U2F0LCAyOSBBdWcgMjAyMCAxMjoyNzoxNCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ImFwcC9kYXNoYm9hcmQvZGFzaGJvYXJkLW1hbmlmZXN0LTEwZjFlZDlkODljZjM5NjY3MWJkNGUzMDQyYjc0MjUzLmpzIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PXV0Zi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>OTkxMzY=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAzMSBBdWcgMjAyMCAwNDo0NTowMyBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KWC1GcmFtZS1PcHRpb25zOiBERU5ZDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDI5IEF1ZyAyMDIwIDEyOjI3OjE0IEdNVA0KRVRhZzogImFwcC9kYXNoYm9hcmQvZGFzaGJvYXJkLW1hbmlmZXN0LTEwZjFlZDlkODljZjM5NjY3MWJkNGUzMDQyYjc0MjUzLmpzIg0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpDYWNoZS1Db250cm9sOiBwdWJsaWMsIG1heC1hZ2U9MzE1MzYwMDANCkNvbnRlbnQtRW5jb2Rpbmc6IGd6aXANCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PXV0Zi04DQpDb250ZW50LUxlbmd0aDogOTkxMzYNCkRhdGU6IE1vbiwgMzEgQXVnIDIwMjAgMDQ6NDU6MDMgR01UDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyoqDQogKiBncmlkc3RhY2suanMgMC4zLjAtZGV2DQogKiBodHRwOi8vdHJvb2xlZS5naXRodWIuaW8vZ3JpZHN0YWNrLmpzLw0KICogKGMpIDIwMTQtMjAxNiBQYXZlbCBSZXpuaWtvdiwgRHlsYW4gV2Vpc3MNCiAqIGdyaWRzdGFjay5qcyBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCiAqIEBwcmVzZXJ2ZQ0KKi8NCiFmdW5jdGlvbihhKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kKWRlZmluZShbImpxdWVyeSIsImxvZGFzaCJdLGEpO2Vsc2UgaWYoInVuZGVmaW5lZCIhPXR5cGVvZiBleHBvcnRzKXt0cnl7alF1ZXJ5PXJlcXVpcmUoImpxdWVyeSIpfWNhdGNoKGEpe310cnl7Xz1yZXF1aXJlKCJsb2Rhc2giKX1jYXRjaChhKXt9YShqUXVlcnksXyl9ZWxzZSBhKGpRdWVyeSxfKX0oZnVuY3Rpb24oYSxiKXsNCi8vIGpzY3M6ZW5hYmxlIHJlcXVpcmVDYW1lbENhc2VPclVwcGVyQ2FzZUlkZW50aWZpZXJzDQovKioNCiAgICAqIEBjbGFzcyBHcmlkU3RhY2tEcmFnRHJvcFBsdWdpbg0KICAgICogQmFzZSBjbGFzcyBmb3IgZHJhZyduJ2Ryb3AgcGx1Z2luLg0KICAgICovDQpmdW5jdGlvbiBjKGEpe3RoaXMuZ3JpZD1hfXZhciBkPXdpbmRvdyxlPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1mdW5jdGlvbigpe3JldHVybiBjb25zb2xlLndhcm4oImdyaWRzdGFjay5qczogRnVuY3Rpb24gYCIrYisiYCBpcyBkZXByZWNhdGVkIGFzIG9mIHYwLjIuNSBhbmQgaGFzIGJlZW4gcmVwbGFjZWQgd2l0aCBgIitjKyJgLiBJdCB3aWxsIGJlICoqY29tcGxldGVseSoqIHJlbW92ZWQgaW4gdjEuMC4iKSxhLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07cmV0dXJuIGQucHJvdG90eXBlPWEucHJvdG90eXBlLGR9LGY9ZnVuY3Rpb24oYSxiKXtjb25zb2xlLndhcm4oImdyaWRzdGFjay5qczogT3B0aW9uIGAiK2ErImAgaXMgZGVwcmVjYXRlZCBhcyBvZiB2MC4yLjUgYW5kIGhhcyBiZWVuIHJlcGxhY2VkIHdpdGggYCIrYisiYC4gSXQgd2lsbCBiZSAqKmNvbXBsZXRlbHkqKiByZW1vdmVkIGluIHYxLjAuIil9LGc9e2lzSW50ZXJjZXB0ZWQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4hKGEueCthLndpZHRoPD1iLnh8fGIueCtiLndpZHRoPD1hLnh8fGEueSthLmhlaWdodDw9Yi55fHxiLnkrYi5oZWlnaHQ8PWEueSl9LHNvcnQ6ZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkPWR8fGIuY2hhaW4oYSkubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhLngrYS53aWR0aH0pLm1heCgpLnZhbHVlKCksYz1jIT0tMT8xOi0xLGIuc29ydEJ5KGEsZnVuY3Rpb24oYSl7cmV0dXJuIGMqKGEueCthLnkqZCl9KX0sY3JlYXRlU3R5bGVzaGVldDpmdW5jdGlvbihhKXt2YXIgYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpO3JldHVybiBiLnNldEF0dHJpYnV0ZSgidHlwZSIsInRleHQvY3NzIiksYi5zZXRBdHRyaWJ1dGUoImRhdGEtZ3Mtc3R5bGUtaWQiLGEpLGIuc3R5bGVTaGVldD9iLnN0eWxlU2hlZXQuY3NzVGV4dD0iIjpiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKSksZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5hcHBlbmRDaGlsZChiKSxiLnNoZWV0fSxyZW1vdmVTdHlsZXNoZWV0OmZ1bmN0aW9uKGIpe2EoIlNUWUxFW2RhdGEtZ3Mtc3R5bGUtaWQ9IitiKyJdIikucmVtb3ZlKCl9LGluc2VydENTU1J1bGU6ZnVuY3Rpb24oYSxiLGMsZCl7ImZ1bmN0aW9uIj09dHlwZW9mIGEuaW5zZXJ0UnVsZT9hLmluc2VydFJ1bGUoYisieyIrYysifSIsZCk6ImZ1bmN0aW9uIj09dHlwZW9mIGEuYWRkUnVsZSYmYS5hZGRSdWxlKGIsYyxkKX0sdG9Cb29sOmZ1bmN0aW9uKGEpe3JldHVybiJib29sZWFuIj09dHlwZW9mIGE/YToic3RyaW5nIj09dHlwZW9mIGE/KGE9YS50b0xvd2VyQ2FzZSgpLCEoIiI9PT1hfHwibm8iPT1hfHwiZmFsc2UiPT1hfHwiMCI9PWEpKTpCb29sZWFuKGEpfSxfY29sbGlzaW9uTm9kZUNoZWNrOmZ1bmN0aW9uKGEpe3JldHVybiBhIT10aGlzLm5vZGUmJmcuaXNJbnRlcmNlcHRlZChhLHRoaXMubm4pfSxfZGlkQ29sbGlkZTpmdW5jdGlvbihhKXtyZXR1cm4gZy5pc0ludGVyY2VwdGVkKHt4OnRoaXMubi54LHk6dGhpcy5uZXdZLHdpZHRoOnRoaXMubi53aWR0aCxoZWlnaHQ6dGhpcy5uLmhlaWdodH0sYSl9LF9pc0FkZE5vZGVJbnRlcmNlcHRlZDpmdW5jdGlvbihhKXtyZXR1cm4gZy5pc0ludGVyY2VwdGVkKHt4OnRoaXMueCx5OnRoaXMueSx3aWR0aDp0aGlzLm5vZGUud2lkdGgsaGVpZ2h0OnRoaXMubm9kZS5oZWlnaHR9LGEpfSxwYXJzZUhlaWdodDpmdW5jdGlvbihhKXt2YXIgYz1hLGQ9InB4IjtpZihjJiZiLmlzU3RyaW5nKGMpKXt2YXIgZT1jLm1hdGNoKC9eKC1bMC05XStcLlswLTldK3xbMC05XSpcLlswLTldK3wtWzAtOV0rfFswLTldKykocHh8ZW18cmVtfHZofHZ3KT8kLyk7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGhlaWdodCIpO2Q9ZVsyXXx8InB4IixjPXBhcnNlRmxvYXQoZVsxXSl9cmV0dXJue2hlaWdodDpjLHVuaXQ6ZH19fTsNCi8vIGpzY3M6ZGlzYWJsZSByZXF1aXJlQ2FtZWxDYXNlT3JVcHBlckNhc2VJZGVudGlmaWVycw0KZy5pc19pbnRlcmNlcHRlZD1lKGcuaXNJbnRlcmNlcHRlZCwiaXNfaW50ZXJjZXB0ZWQiLCJpc0ludGVyY2VwdGVkIiksZy5jcmVhdGVfc3R5bGVzaGVldD1lKGcuY3JlYXRlU3R5bGVzaGVldCwiY3JlYXRlX3N0eWxlc2hlZXQiLCJjcmVhdGVTdHlsZXNoZWV0IiksZy5yZW1vdmVfc3R5bGVzaGVldD1lKGcucmVtb3ZlU3R5bGVzaGVldCwicmVtb3ZlX3N0eWxlc2hlZXQiLCJyZW1vdmVTdHlsZXNoZWV0IiksZy5pbnNlcnRfY3NzX3J1bGU9ZShnLmluc2VydENTU1J1bGUsImluc2VydF9jc3NfcnVsZSIsImluc2VydENTU1J1bGUiKSxjLnJlZ2lzdGVyZWRQbHVnaW5zPVtdLGMucmVnaXN0ZXJQbHVnaW49ZnVuY3Rpb24oYSl7Yy5yZWdpc3RlcmVkUGx1Z2lucy5wdXNoKGEpfSxjLnByb3RvdHlwZS5yZXNpemFibGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpc30sYy5wcm90b3R5cGUuZHJhZ2dhYmxlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLmRyb3BwYWJsZT1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzfSxjLnByb3RvdHlwZS5pc0Ryb3BwYWJsZT1mdW5jdGlvbihhKXtyZXR1cm4hMX0sYy5wcm90b3R5cGUub249ZnVuY3Rpb24oYSxiLGMpe3JldHVybiB0aGlzfTt2YXIgaD0wLGk9ZnVuY3Rpb24oYSxiLGMsZCxlKXt0aGlzLndpZHRoPWEsdGhpcy5mbG9hdD1jfHwhMSx0aGlzLmhlaWdodD1kfHwwLHRoaXMubm9kZXM9ZXx8W10sdGhpcy5vbmNoYW5nZT1ifHxmdW5jdGlvbigpe30sdGhpcy5fdXBkYXRlQ291bnRlcj0wLHRoaXMuX2Zsb2F0PXRoaXMuZmxvYXQsdGhpcy5fYWRkZWROb2Rlcz1bXSx0aGlzLl9yZW1vdmVkTm9kZXM9W119O2kucHJvdG90eXBlLmJhdGNoVXBkYXRlPWZ1bmN0aW9uKCl7dGhpcy5fdXBkYXRlQ291bnRlcj0xLHRoaXMuZmxvYXQ9ITB9LGkucHJvdG90eXBlLmNvbW1pdD1mdW5jdGlvbigpezAhPT10aGlzLl91cGRhdGVDb3VudGVyJiYodGhpcy5fdXBkYXRlQ291bnRlcj0wLHRoaXMuZmxvYXQ9dGhpcy5fZmxvYXQsdGhpcy5fcGFja05vZGVzKCksdGhpcy5fbm90aWZ5KCkpfSwNCi8vIEZvciBNZXRlb3Igc3VwcG9ydDogaHR0cHM6Ly9naXRodWIuY29tL3Ryb29sZWUvZ3JpZHN0YWNrLmpzL3B1bGwvMjcyDQppLnByb3RvdHlwZS5nZXROb2RlRGF0YUJ5RE9NRWw9ZnVuY3Rpb24oYSl7cmV0dXJuIGIuZmluZCh0aGlzLm5vZGVzLGZ1bmN0aW9uKGIpe3JldHVybiBhLmdldCgwKT09PWIuZWwuZ2V0KDApfSl9LGkucHJvdG90eXBlLl9maXhDb2xsaXNpb25zPWZ1bmN0aW9uKGEpe3RoaXMuX3NvcnROb2RlcygtMSk7dmFyIGM9YSxkPUJvb2xlYW4oYi5maW5kKHRoaXMubm9kZXMsZnVuY3Rpb24oYSl7cmV0dXJuIGEubG9ja2VkfSkpO2Zvcih0aGlzLmZsb2F0fHxkfHwoYz17eDowLHk6YS55LHdpZHRoOnRoaXMud2lkdGgsaGVpZ2h0OmEuaGVpZ2h0fSk7Oyl7dmFyIGU9Yi5maW5kKHRoaXMubm9kZXMsYi5iaW5kKGcuX2NvbGxpc2lvbk5vZGVDaGVjayx7bm9kZTphLG5uOmN9KSk7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBlKXJldHVybjt0aGlzLm1vdmVOb2RlKGUsZS54LGEueSthLmhlaWdodCxlLndpZHRoLGUuaGVpZ2h0LCEwKX19LGkucHJvdG90eXBlLmlzQXJlYUVtcHR5PWZ1bmN0aW9uKGEsYyxkLGUpe3ZhciBmPXt4OmF8fDAseTpjfHwwLHdpZHRoOmR8fDEsaGVpZ2h0OmV8fDF9LGg9Yi5maW5kKHRoaXMubm9kZXMsYi5iaW5kKGZ1bmN0aW9uKGEpe3JldHVybiBnLmlzSW50ZXJjZXB0ZWQoYSxmKX0sdGhpcykpO3JldHVybiBudWxsPT09aHx8InVuZGVmaW5lZCI9PXR5cGVvZiBofSxpLnByb3RvdHlwZS5fc29ydE5vZGVzPWZ1bmN0aW9uKGEpe3RoaXMubm9kZXM9Zy5zb3J0KHRoaXMubm9kZXMsYSx0aGlzLndpZHRoKX0saS5wcm90b3R5cGUuX3BhY2tOb2Rlcz1mdW5jdGlvbigpe3RoaXMuX3NvcnROb2RlcygpLHRoaXMuZmxvYXQ/Yi5lYWNoKHRoaXMubm9kZXMsYi5iaW5kKGZ1bmN0aW9uKGEsYyl7aWYoIWEuX3VwZGF0aW5nJiYidW5kZWZpbmVkIiE9dHlwZW9mIGEuX29yaWdZJiZhLnkhPWEuX29yaWdZKWZvcih2YXIgZD1hLnk7ZD49YS5fb3JpZ1k7KXt2YXIgZT1iLmNoYWluKHRoaXMubm9kZXMpLmZpbmQoYi5iaW5kKGcuX2RpZENvbGxpZGUse246YSxuZXdZOmR9KSkudmFsdWUoKTtlfHwoYS5fZGlydHk9ITAsYS55PWQpLC0tZH19LHRoaXMpKTpiLmVhY2godGhpcy5ub2RlcyxiLmJpbmQoZnVuY3Rpb24oYSxjKXtpZighYS5sb2NrZWQpZm9yKDthLnk+MDspe3ZhciBkPWEueS0xLGU9MD09PWM7aWYoYz4wKXt2YXIgZj1iLmNoYWluKHRoaXMubm9kZXMpLnRha2UoYykuZmluZChiLmJpbmQoZy5fZGlkQ29sbGlkZSx7bjphLG5ld1k6ZH0pKS52YWx1ZSgpO2U9InVuZGVmaW5lZCI9PXR5cGVvZiBmfWlmKCFlKWJyZWFrO2EuX2RpcnR5PWEueSE9ZCxhLnk9ZH19LHRoaXMpKX0saS5wcm90b3R5cGUuX3ByZXBhcmVOb2RlPWZ1bmN0aW9uKGEsYyl7cmV0dXJuIGE9Yi5kZWZhdWx0cyhhfHx7fSx7d2lkdGg6MSxoZWlnaHQ6MSx4OjAseTowfSksYS54PXBhcnNlSW50KCIiK2EueCksYS55PXBhcnNlSW50KCIiK2EueSksYS53aWR0aD1wYXJzZUludCgiIithLndpZHRoKSxhLmhlaWdodD1wYXJzZUludCgiIithLmhlaWdodCksYS5hdXRvUG9zaXRpb249YS5hdXRvUG9zaXRpb258fCExLGEubm9SZXNpemU9YS5ub1Jlc2l6ZXx8ITEsYS5ub01vdmU9YS5ub01vdmV8fCExLGEud2lkdGg+dGhpcy53aWR0aD9hLndpZHRoPXRoaXMud2lkdGg6YS53aWR0aDwxJiYoYS53aWR0aD0xKSxhLmhlaWdodDwxJiYoYS5oZWlnaHQ9MSksYS54PDAmJihhLng9MCksYS54K2Eud2lkdGg+dGhpcy53aWR0aCYmKGM/YS53aWR0aD10aGlzLndpZHRoLWEueDphLng9dGhpcy53aWR0aC1hLndpZHRoKSxhLnk8MCYmKGEueT0wKSxhfSxpLnByb3RvdHlwZS5fbm90aWZ5PWZ1bmN0aW9uKCl7dmFyIGE9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO2lmKGFbMF09InVuZGVmaW5lZCI9PXR5cGVvZiBhWzBdP1tdOlthWzBdXSxhWzFdPSJ1bmRlZmluZWQiPT10eXBlb2YgYVsxXXx8YVsxXSwhdGhpcy5fdXBkYXRlQ291bnRlcil7dmFyIGI9YVswXS5jb25jYXQodGhpcy5nZXREaXJ0eU5vZGVzKCkpO3RoaXMub25jaGFuZ2UoYixhWzFdKX19LGkucHJvdG90eXBlLmNsZWFuTm9kZXM9ZnVuY3Rpb24oKXt0aGlzLl91cGRhdGVDb3VudGVyfHxiLmVhY2godGhpcy5ub2RlcyxmdW5jdGlvbihhKXthLl9kaXJ0eT0hMX0pfSxpLnByb3RvdHlwZS5nZXREaXJ0eU5vZGVzPWZ1bmN0aW9uKCl7cmV0dXJuIGIuZmlsdGVyKHRoaXMubm9kZXMsZnVuY3Rpb24oYSl7cmV0dXJuIGEuX2RpcnR5fSl9LGkucHJvdG90eXBlLmFkZE5vZGU9ZnVuY3Rpb24oYSxjKXtpZihhPXRoaXMuX3ByZXBhcmVOb2RlKGEpLCJ1bmRlZmluZWQiIT10eXBlb2YgYS5tYXhXaWR0aCYmKGEud2lkdGg9TWF0aC5taW4oYS53aWR0aCxhLm1heFdpZHRoKSksInVuZGVmaW5lZCIhPXR5cGVvZiBhLm1heEhlaWdodCYmKGEuaGVpZ2h0PU1hdGgubWluKGEuaGVpZ2h0LGEubWF4SGVpZ2h0KSksInVuZGVmaW5lZCIhPXR5cGVvZiBhLm1pbldpZHRoJiYoYS53aWR0aD1NYXRoLm1heChhLndpZHRoLGEubWluV2lkdGgpKSwidW5kZWZpbmVkIiE9dHlwZW9mIGEubWluSGVpZ2h0JiYoYS5oZWlnaHQ9TWF0aC5tYXgoYS5oZWlnaHQsYS5taW5IZWlnaHQpKSxhLl9pZD0rK2gsYS5fZGlydHk9ITAsYS5hdXRvUG9zaXRpb24pe3RoaXMuX3NvcnROb2RlcygpO2Zvcih2YXIgZD0wOzsrK2Qpe3ZhciBlPWQldGhpcy53aWR0aCxmPU1hdGguZmxvb3IoZC90aGlzLndpZHRoKTtpZighKGUrYS53aWR0aD50aGlzLndpZHRofHxiLmZpbmQodGhpcy5ub2RlcyxiLmJpbmQoZy5faXNBZGROb2RlSW50ZXJjZXB0ZWQse3g6ZSx5OmYsbm9kZTphfSkpKSl7YS54PWUsYS55PWY7YnJlYWt9fX1yZXR1cm4gdGhpcy5ub2Rlcy5wdXNoKGEpLCJ1bmRlZmluZWQiIT10eXBlb2YgYyYmYyYmdGhpcy5fYWRkZWROb2Rlcy5wdXNoKGIuY2xvbmUoYSkpLHRoaXMuX2ZpeENvbGxpc2lvbnMoYSksdGhpcy5fcGFja05vZGVzKCksdGhpcy5fbm90aWZ5KCksYX0saS5wcm90b3R5cGUucmVtb3ZlTm9kZT1mdW5jdGlvbihhLGMpe2M9InVuZGVmaW5lZCI9PXR5cGVvZiBjfHxjLHRoaXMuX3JlbW92ZWROb2Rlcy5wdXNoKGIuY2xvbmUoYSkpLGEuX2lkPW51bGwsdGhpcy5ub2Rlcz1iLndpdGhvdXQodGhpcy5ub2RlcyxhKSx0aGlzLl9wYWNrTm9kZXMoKSx0aGlzLl9ub3RpZnkoYSxjKX0saS5wcm90b3R5cGUuY2FuTW92ZU5vZGU9ZnVuY3Rpb24oYyxkLGUsZixnKXtpZighdGhpcy5pc05vZGVDaGFuZ2VkUG9zaXRpb24oYyxkLGUsZixnKSlyZXR1cm4hMTt2YXIgaD1Cb29sZWFuKGIuZmluZCh0aGlzLm5vZGVzLGZ1bmN0aW9uKGEpe3JldHVybiBhLmxvY2tlZH0pKTtpZighdGhpcy5oZWlnaHQmJiFoKXJldHVybiEwO3ZhciBqLGs9bmV3IGkodGhpcy53aWR0aCxudWxsLHRoaXMuZmxvYXQsMCxiLm1hcCh0aGlzLm5vZGVzLGZ1bmN0aW9uKGIpe3JldHVybiBiPT1jP2o9YS5leHRlbmQoe30sYik6YS5leHRlbmQoe30sYil9KSk7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBqKXJldHVybiEwO2subW92ZU5vZGUoaixkLGUsZixnKTt2YXIgbD0hMDtyZXR1cm4gaCYmKGwmPSFCb29sZWFuKGIuZmluZChrLm5vZGVzLGZ1bmN0aW9uKGEpe3JldHVybiBhIT1qJiZCb29sZWFuKGEubG9ja2VkKSYmQm9vbGVhbihhLl9kaXJ0eSl9KSkpLHRoaXMuaGVpZ2h0JiYobCY9ay5nZXRHcmlkSGVpZ2h0KCk8PXRoaXMuaGVpZ2h0KSxsfSxpLnByb3RvdHlwZS5jYW5CZVBsYWNlZFdpdGhSZXNwZWN0VG9IZWlnaHQ9ZnVuY3Rpb24oYyl7aWYoIXRoaXMuaGVpZ2h0KXJldHVybiEwO3ZhciBkPW5ldyBpKHRoaXMud2lkdGgsbnVsbCx0aGlzLmZsb2F0LDAsYi5tYXAodGhpcy5ub2RlcyxmdW5jdGlvbihiKXtyZXR1cm4gYS5leHRlbmQoe30sYil9KSk7cmV0dXJuIGQuYWRkTm9kZShjKSxkLmdldEdyaWRIZWlnaHQoKTw9dGhpcy5oZWlnaHR9LGkucHJvdG90eXBlLmlzTm9kZUNoYW5nZWRQb3NpdGlvbj1mdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiJudW1iZXIiIT10eXBlb2YgYiYmKGI9YS54KSwibnVtYmVyIiE9dHlwZW9mIGMmJihjPWEueSksIm51bWJlciIhPXR5cGVvZiBkJiYoZD1hLndpZHRoKSwibnVtYmVyIiE9dHlwZW9mIGUmJihlPWEuaGVpZ2h0KSwidW5kZWZpbmVkIiE9dHlwZW9mIGEubWF4V2lkdGgmJihkPU1hdGgubWluKGQsYS5tYXhXaWR0aCkpLCJ1bmRlZmluZWQiIT10eXBlb2YgYS5tYXhIZWlnaHQmJihlPU1hdGgubWluKGUsYS5tYXhIZWlnaHQpKSwidW5kZWZpbmVkIiE9dHlwZW9mIGEubWluV2lkdGgmJihkPU1hdGgubWF4KGQsYS5taW5XaWR0aCkpLCJ1bmRlZmluZWQiIT10eXBlb2YgYS5taW5IZWlnaHQmJihlPU1hdGgubWF4KGUsYS5taW5IZWlnaHQpKSxhLnghPWJ8fGEueSE9Y3x8YS53aWR0aCE9ZHx8YS5oZWlnaHQhPWV9LGkucHJvdG90eXBlLm1vdmVOb2RlPWZ1bmN0aW9uKGEsYixjLGQsZSxmKXtpZighdGhpcy5pc05vZGVDaGFuZ2VkUG9zaXRpb24oYSxiLGMsZCxlKSlyZXR1cm4gYTtpZigibnVtYmVyIiE9dHlwZW9mIGImJihiPWEueCksIm51bWJlciIhPXR5cGVvZiBjJiYoYz1hLnkpLCJudW1iZXIiIT10eXBlb2YgZCYmKGQ9YS53aWR0aCksIm51bWJlciIhPXR5cGVvZiBlJiYoZT1hLmhlaWdodCksInVuZGVmaW5lZCIhPXR5cGVvZiBhLm1heFdpZHRoJiYoZD1NYXRoLm1pbihkLGEubWF4V2lkdGgpKSwidW5kZWZpbmVkIiE9dHlwZW9mIGEubWF4SGVpZ2h0JiYoZT1NYXRoLm1pbihlLGEubWF4SGVpZ2h0KSksInVuZGVmaW5lZCIhPXR5cGVvZiBhLm1pbldpZHRoJiYoZD1NYXRoLm1heChkLGEubWluV2lkdGgpKSwidW5kZWZpbmVkIiE9dHlwZW9mIGEubWluSGVpZ2h0JiYoZT1NYXRoLm1heChlLGEubWluSGVpZ2h0KSksYS54PT1iJiZhLnk9PWMmJmEud2lkdGg9PWQmJmEuaGVpZ2h0PT1lKXJldHVybiBhO3ZhciBnPWEud2lkdGghPWQ7cmV0dXJuIGEuX2RpcnR5PSEwLGEueD1iLGEueT1jLGEud2lkdGg9ZCxhLmhlaWdodD1lLGEubGFzdFRyaWVkWD1iLGEubGFzdFRyaWVkWT1jLGEubGFzdFRyaWVkV2lkdGg9ZCxhLmxhc3RUcmllZEhlaWdodD1lLGE9dGhpcy5fcHJlcGFyZU5vZGUoYSxnKSx0aGlzLl9maXhDb2xsaXNpb25zKGEpLGZ8fCh0aGlzLl9wYWNrTm9kZXMoKSx0aGlzLl9ub3RpZnkoKSksYX0saS5wcm90b3R5cGUuZ2V0R3JpZEhlaWdodD1mdW5jdGlvbigpe3JldHVybiBiLnJlZHVjZSh0aGlzLm5vZGVzLGZ1bmN0aW9uKGEsYil7cmV0dXJuIE1hdGgubWF4KGEsYi55K2IuaGVpZ2h0KX0sMCl9LGkucHJvdG90eXBlLmJlZ2luVXBkYXRlPWZ1bmN0aW9uKGEpe2IuZWFjaCh0aGlzLm5vZGVzLGZ1bmN0aW9uKGEpe2EuX29yaWdZPWEueX0pLGEuX3VwZGF0aW5nPSEwfSxpLnByb3RvdHlwZS5lbmRVcGRhdGU9ZnVuY3Rpb24oKXtiLmVhY2godGhpcy5ub2RlcyxmdW5jdGlvbihhKXthLl9vcmlnWT1hLnl9KTt2YXIgYT1iLmZpbmQodGhpcy5ub2RlcyxmdW5jdGlvbihhKXtyZXR1cm4gYS5fdXBkYXRpbmd9KTthJiYoYS5fdXBkYXRpbmc9ITEpfTt2YXIgaj1mdW5jdGlvbihkLGUpe3ZhciBnLGgsaj10aGlzO2U9ZXx8e30sdGhpcy5jb250YWluZXI9YShkKSwNCi8vIGpzY3M6ZGlzYWJsZSByZXF1aXJlQ2FtZWxDYXNlT3JVcHBlckNhc2VJZGVudGlmaWVycw0KInVuZGVmaW5lZCIhPXR5cGVvZiBlLmhhbmRsZV9jbGFzcyYmKGUuaGFuZGxlQ2xhc3M9ZS5oYW5kbGVfY2xhc3MsZigiaGFuZGxlX2NsYXNzIiwiaGFuZGxlQ2xhc3MiKSksInVuZGVmaW5lZCIhPXR5cGVvZiBlLml0ZW1fY2xhc3MmJihlLml0ZW1DbGFzcz1lLml0ZW1fY2xhc3MsZigiaXRlbV9jbGFzcyIsIml0ZW1DbGFzcyIpKSwidW5kZWZpbmVkIiE9dHlwZW9mIGUucGxhY2Vob2xkZXJfY2xhc3MmJihlLnBsYWNlaG9sZGVyQ2xhc3M9ZS5wbGFjZWhvbGRlcl9jbGFzcyxmKCJwbGFjZWhvbGRlcl9jbGFzcyIsInBsYWNlaG9sZGVyQ2xhc3MiKSksInVuZGVmaW5lZCIhPXR5cGVvZiBlLnBsYWNlaG9sZGVyX3RleHQmJihlLnBsYWNlaG9sZGVyVGV4dD1lLnBsYWNlaG9sZGVyX3RleHQsZigicGxhY2Vob2xkZXJfdGV4dCIsInBsYWNlaG9sZGVyVGV4dCIpKSwidW5kZWZpbmVkIiE9dHlwZW9mIGUuY2VsbF9oZWlnaHQmJihlLmNlbGxIZWlnaHQ9ZS5jZWxsX2hlaWdodCxmKCJjZWxsX2hlaWdodCIsImNlbGxIZWlnaHQiKSksInVuZGVmaW5lZCIhPXR5cGVvZiBlLnZlcnRpY2FsX21hcmdpbiYmKGUudmVydGljYWxNYXJnaW49ZS52ZXJ0aWNhbF9tYXJnaW4sZigidmVydGljYWxfbWFyZ2luIiwidmVydGljYWxNYXJnaW4iKSksInVuZGVmaW5lZCIhPXR5cGVvZiBlLm1pbl93aWR0aCYmKGUubWluV2lkdGg9ZS5taW5fd2lkdGgsZigibWluX3dpZHRoIiwibWluV2lkdGgiKSksInVuZGVmaW5lZCIhPXR5cGVvZiBlLnN0YXRpY19ncmlkJiYoZS5zdGF0aWNHcmlkPWUuc3RhdGljX2dyaWQsZigic3RhdGljX2dyaWQiLCJzdGF0aWNHcmlkIikpLCJ1bmRlZmluZWQiIT10eXBlb2YgZS5pc19uZXN0ZWQmJihlLmlzTmVzdGVkPWUuaXNfbmVzdGVkLGYoImlzX25lc3RlZCIsImlzTmVzdGVkIikpLCJ1bmRlZmluZWQiIT10eXBlb2YgZS5hbHdheXNfc2hvd19yZXNpemVfaGFuZGxlJiYoZS5hbHdheXNTaG93UmVzaXplSGFuZGxlPWUuYWx3YXlzX3Nob3dfcmVzaXplX2hhbmRsZSxmKCJhbHdheXNfc2hvd19yZXNpemVfaGFuZGxlIiwiYWx3YXlzU2hvd1Jlc2l6ZUhhbmRsZSIpKSwNCi8vIGpzY3M6ZW5hYmxlIHJlcXVpcmVDYW1lbENhc2VPclVwcGVyQ2FzZUlkZW50aWZpZXJzDQplLml0ZW1DbGFzcz1lLml0ZW1DbGFzc3x8ImdyaWQtc3RhY2staXRlbSI7dmFyIGs9dGhpcy5jb250YWluZXIuY2xvc2VzdCgiLiIrZS5pdGVtQ2xhc3MpLmxlbmd0aD4wO2lmKHRoaXMub3B0cz1iLmRlZmF1bHRzKGV8fHt9LHt3aWR0aDpwYXJzZUludCh0aGlzLmNvbnRhaW5lci5hdHRyKCJkYXRhLWdzLXdpZHRoIikpfHwxMixoZWlnaHQ6cGFyc2VJbnQodGhpcy5jb250YWluZXIuYXR0cigiZGF0YS1ncy1oZWlnaHQiKSl8fDAsaXRlbUNsYXNzOiJncmlkLXN0YWNrLWl0ZW0iLHBsYWNlaG9sZGVyQ2xhc3M6ImdyaWQtc3RhY2stcGxhY2Vob2xkZXIiLHBsYWNlaG9sZGVyVGV4dDoiIixoYW5kbGU6Ii5ncmlkLXN0YWNrLWl0ZW0tY29udGVudCIsaGFuZGxlQ2xhc3M6bnVsbCxjZWxsSGVpZ2h0OjYwLHZlcnRpY2FsTWFyZ2luOjIwLGF1dG86ITAsbWluV2lkdGg6NzY4LGZsb2F0OiExLHN0YXRpY0dyaWQ6ITEsX2NsYXNzOiJncmlkLXN0YWNrLWluc3RhbmNlLSIrKDFlNCpNYXRoLnJhbmRvbSgpKS50b0ZpeGVkKDApLGFuaW1hdGU6Qm9vbGVhbih0aGlzLmNvbnRhaW5lci5hdHRyKCJkYXRhLWdzLWFuaW1hdGUiKSl8fCExLGFsd2F5c1Nob3dSZXNpemVIYW5kbGU6ZS5hbHdheXNTaG93UmVzaXplSGFuZGxlfHwhMSxyZXNpemFibGU6Yi5kZWZhdWx0cyhlLnJlc2l6YWJsZXx8e30se2F1dG9IaWRlOiFlLmFsd2F5c1Nob3dSZXNpemVIYW5kbGUsaGFuZGxlczoic2UifSksZHJhZ2dhYmxlOmIuZGVmYXVsdHMoZS5kcmFnZ2FibGV8fHt9LHtoYW5kbGU6KGUuaGFuZGxlQ2xhc3M/Ii4iK2UuaGFuZGxlQ2xhc3M6ZS5oYW5kbGU/ZS5oYW5kbGU6IiIpfHwiLmdyaWQtc3RhY2staXRlbS1jb250ZW50IixzY3JvbGw6ITEsYXBwZW5kVG86ImJvZHkifSksZGlzYWJsZURyYWc6ZS5kaXNhYmxlRHJhZ3x8ITEsZGlzYWJsZVJlc2l6ZTplLmRpc2FibGVSZXNpemV8fCExLHJ0bDoiYXV0byIscmVtb3ZhYmxlOiExLHJlbW92ZVRpbWVvdXQ6MmUzLHZlcnRpY2FsTWFyZ2luVW5pdDoicHgiLGNlbGxIZWlnaHRVbml0OiJweCIsb25lQ29sdW1uTW9kZUNsYXNzOmUub25lQ29sdW1uTW9kZUNsYXNzfHwiZ3JpZC1zdGFjay1vbmUtY29sdW1uLW1vZGUiLGRkUGx1Z2luOm51bGx9KSx0aGlzLm9wdHMuZGRQbHVnaW49PT0hMT90aGlzLm9wdHMuZGRQbHVnaW49YzpudWxsPT09dGhpcy5vcHRzLmRkUGx1Z2luJiYodGhpcy5vcHRzLmRkUGx1Z2luPWIuZmlyc3QoYy5yZWdpc3RlcmVkUGx1Z2lucyl8fGMpLHRoaXMuZGQ9bmV3IHRoaXMub3B0cy5kZFBsdWdpbih0aGlzKSwiYXV0byI9PT10aGlzLm9wdHMucnRsJiYodGhpcy5vcHRzLnJ0bD0icnRsIj09PXRoaXMuY29udGFpbmVyLmNzcygiZGlyZWN0aW9uIikpLHRoaXMub3B0cy5ydGwmJnRoaXMuY29udGFpbmVyLmFkZENsYXNzKCJncmlkLXN0YWNrLXJ0bCIpLHRoaXMub3B0cy5pc05lc3RlZD1rLGg9ImF1dG8iPT09dGhpcy5vcHRzLmNlbGxIZWlnaHQsaD9qLmNlbGxIZWlnaHQoai5jZWxsV2lkdGgoKSwhMCk6dGhpcy5jZWxsSGVpZ2h0KHRoaXMub3B0cy5jZWxsSGVpZ2h0LCEwKSx0aGlzLnZlcnRpY2FsTWFyZ2luKHRoaXMub3B0cy52ZXJ0aWNhbE1hcmdpbiwhMCksdGhpcy5jb250YWluZXIuYWRkQ2xhc3ModGhpcy5vcHRzLl9jbGFzcyksdGhpcy5fc2V0U3RhdGljQ2xhc3MoKSxrJiZ0aGlzLmNvbnRhaW5lci5hZGRDbGFzcygiZ3JpZC1zdGFjay1uZXN0ZWQiKSx0aGlzLl9pbml0U3R5bGVzKCksdGhpcy5ncmlkPW5ldyBpKHRoaXMub3B0cy53aWR0aCxmdW5jdGlvbihhLGMpe2M9InVuZGVmaW5lZCI9PXR5cGVvZiBjfHxjO3ZhciBkPTA7Yi5lYWNoKGEsZnVuY3Rpb24oYSl7YyYmbnVsbD09PWEuX2lkP2EuZWwmJmEuZWwucmVtb3ZlKCk6KGEuZWwuYXR0cigiZGF0YS1ncy14IixhLngpLmF0dHIoImRhdGEtZ3MteSIsYS55KS5hdHRyKCJkYXRhLWdzLXdpZHRoIixhLndpZHRoKS5hdHRyKCJkYXRhLWdzLWhlaWdodCIsYS5oZWlnaHQpLGQ9TWF0aC5tYXgoZCxhLnkrYS5oZWlnaHQpKX0pLGouX3VwZGF0ZVN0eWxlcyhkKzEwKX0sdGhpcy5vcHRzLmZsb2F0LHRoaXMub3B0cy5oZWlnaHQpLHRoaXMub3B0cy5hdXRvKXt2YXIgbD1bXSxtPXRoaXM7dGhpcy5jb250YWluZXIuY2hpbGRyZW4oIi4iK3RoaXMub3B0cy5pdGVtQ2xhc3MrIjpub3QoLiIrdGhpcy5vcHRzLnBsYWNlaG9sZGVyQ2xhc3MrIikiKS5lYWNoKGZ1bmN0aW9uKGIsYyl7Yz1hKGMpLGwucHVzaCh7ZWw6YyxpOnBhcnNlSW50KGMuYXR0cigiZGF0YS1ncy14IikpK3BhcnNlSW50KGMuYXR0cigiZGF0YS1ncy15IikpKm0ub3B0cy53aWR0aH0pfSksYi5jaGFpbihsKS5zb3J0QnkoZnVuY3Rpb24oYSl7cmV0dXJuIGEuaX0pLmVhY2goZnVuY3Rpb24oYSl7ai5fcHJlcGFyZUVsZW1lbnQoYS5lbCl9KS52YWx1ZSgpfWlmKHRoaXMuc2V0QW5pbWF0aW9uKHRoaXMub3B0cy5hbmltYXRlKSx0aGlzLnBsYWNlaG9sZGVyPWEoJzxkaXYgY2xhc3M9IicrdGhpcy5vcHRzLnBsYWNlaG9sZGVyQ2xhc3MrIiAiK3RoaXMub3B0cy5pdGVtQ2xhc3MrJyI+PGRpdiBjbGFzcz0icGxhY2Vob2xkZXItY29udGVudCI+Jyt0aGlzLm9wdHMucGxhY2Vob2xkZXJUZXh0KyI8L2Rpdj48L2Rpdj4iKS5oaWRlKCksdGhpcy5fdXBkYXRlQ29udGFpbmVySGVpZ2h0KCksdGhpcy5fdXBkYXRlSGVpZ2h0c09uUmVzaXplPWIudGhyb3R0bGUoZnVuY3Rpb24oKXtqLmNlbGxIZWlnaHQoai5jZWxsV2lkdGgoKSwhMSl9LDEwMCksdGhpcy5vblJlc2l6ZUhhbmRsZXI9ZnVuY3Rpb24oKXtpZihoJiZqLl91cGRhdGVIZWlnaHRzT25SZXNpemUoKSxqLl9pc09uZUNvbHVtbk1vZGUoKSl7aWYoZylyZXR1cm47ai5jb250YWluZXIuYWRkQ2xhc3Moai5vcHRzLm9uZUNvbHVtbk1vZGVDbGFzcyksZz0hMCxqLmdyaWQuX3NvcnROb2RlcygpLGIuZWFjaChqLmdyaWQubm9kZXMsZnVuY3Rpb24oYSl7ai5jb250YWluZXIuYXBwZW5kKGEuZWwpLGoub3B0cy5zdGF0aWNHcmlkfHwoKGEubm9Nb3ZlfHxqLm9wdHMuZGlzYWJsZURyYWcpJiZqLmRkLmRyYWdnYWJsZShhLmVsLCJkaXNhYmxlIiksKGEubm9SZXNpemV8fGoub3B0cy5kaXNhYmxlUmVzaXplKSYmai5kZC5yZXNpemFibGUoYS5lbCwiZGlzYWJsZSIpLGEuZWwudHJpZ2dlcigicmVzaXplIikpfSl9ZWxzZXtpZighZylyZXR1cm47aWYoai5jb250YWluZXIucmVtb3ZlQ2xhc3Moai5vcHRzLm9uZUNvbHVtbk1vZGVDbGFzcyksZz0hMSxqLm9wdHMuc3RhdGljR3JpZClyZXR1cm47Yi5lYWNoKGouZ3JpZC5ub2RlcyxmdW5jdGlvbihhKXthLm5vTW92ZXx8ai5vcHRzLmRpc2FibGVEcmFnfHxqLmRkLmRyYWdnYWJsZShhLmVsLCJlbmFibGUiKSxhLm5vUmVzaXplfHxqLm9wdHMuZGlzYWJsZVJlc2l6ZXx8ai5kZC5yZXNpemFibGUoYS5lbCwiZW5hYmxlIiksYS5lbC50cmlnZ2VyKCJyZXNpemUiKX0pfX0sYSh3aW5kb3cpLnJlc2l6ZSh0aGlzLm9uUmVzaXplSGFuZGxlciksdGhpcy5vblJlc2l6ZUhhbmRsZXIoKSwhai5vcHRzLnN0YXRpY0dyaWQmJiJzdHJpbmciPT10eXBlb2Ygai5vcHRzLnJlbW92YWJsZSl7dmFyIG49YShqLm9wdHMucmVtb3ZhYmxlKTt0aGlzLmRkLmlzRHJvcHBhYmxlKG4pfHx0aGlzLmRkLmRyb3BwYWJsZShuLHthY2NlcHQ6Ii4iK2oub3B0cy5pdGVtQ2xhc3N9KSx0aGlzLmRkLm9uKG4sImRyb3BvdmVyIixmdW5jdGlvbihiLGMpe3ZhciBkPWEoYy5kcmFnZ2FibGUpLGU9ZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKTtlLl9ncmlkPT09aiYmai5fc2V0dXBSZW1vdmluZ1RpbWVvdXQoZCl9KS5vbihuLCJkcm9wb3V0IixmdW5jdGlvbihiLGMpe3ZhciBkPWEoYy5kcmFnZ2FibGUpLGU9ZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKTtlLl9ncmlkPT09aiYmai5fY2xlYXJSZW1vdmluZ1RpbWVvdXQoZCl9KX1pZighai5vcHRzLnN0YXRpY0dyaWQmJmoub3B0cy5hY2NlcHRXaWRnZXRzKXt2YXIgbz1udWxsLHA9ZnVuY3Rpb24oYSxiKXt2YXIgYz1vLGQ9Yy5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKSxlPWouZ2V0Q2VsbEZyb21QaXhlbChiLm9mZnNldCwhMCksZj1NYXRoLm1heCgwLGUueCksZz1NYXRoLm1heCgwLGUueSk7aWYoZC5fYWRkZWQpe2lmKCFqLmdyaWQuY2FuTW92ZU5vZGUoZCxmLGcpKXJldHVybjtqLmdyaWQubW92ZU5vZGUoZCxmLGcpLGouX3VwZGF0ZUNvbnRhaW5lckhlaWdodCgpfWVsc2UgZC5fYWRkZWQ9ITAsZC5lbD1jLGQueD1mLGQueT1nLGouZ3JpZC5jbGVhbk5vZGVzKCksai5ncmlkLmJlZ2luVXBkYXRlKGQpLGouZ3JpZC5hZGROb2RlKGQpLGouY29udGFpbmVyLmFwcGVuZChqLnBsYWNlaG9sZGVyKSxqLnBsYWNlaG9sZGVyLmF0dHIoImRhdGEtZ3MteCIsZC54KS5hdHRyKCJkYXRhLWdzLXkiLGQueSkuYXR0cigiZGF0YS1ncy13aWR0aCIsZC53aWR0aCkuYXR0cigiZGF0YS1ncy1oZWlnaHQiLGQuaGVpZ2h0KS5zaG93KCksZC5lbD1qLnBsYWNlaG9sZGVyLGQuX2JlZm9yZURyYWdYPWQueCxkLl9iZWZvcmVEcmFnWT1kLnksai5fdXBkYXRlQ29udGFpbmVySGVpZ2h0KCl9O3RoaXMuZGQuZHJvcHBhYmxlKGouY29udGFpbmVyLHthY2NlcHQ6ZnVuY3Rpb24oYil7Yj1hKGIpO3ZhciBjPWIuZGF0YSgiX2dyaWRzdGFja19ub2RlIik7cmV0dXJuKCFjfHxjLl9ncmlkIT09aikmJmIuaXMoai5vcHRzLmFjY2VwdFdpZGdldHM9PT0hMD8iLmdyaWQtc3RhY2staXRlbSI6ai5vcHRzLmFjY2VwdFdpZGdldHMpfX0pLm9uKGouY29udGFpbmVyLCJkcm9wb3ZlciIsZnVuY3Rpb24oYixjKXt2YXIgZD0oai5jb250YWluZXIub2Zmc2V0KCksYShjLmRyYWdnYWJsZSkpLGU9ai5jZWxsV2lkdGgoKSxmPWouY2VsbEhlaWdodCgpLGc9ZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKSxoPWc/Zy53aWR0aDpNYXRoLmNlaWwoZC5vdXRlcldpZHRoKCkvZSksaT1nP2cuaGVpZ2h0Ok1hdGguY2VpbChkLm91dGVySGVpZ2h0KCkvZik7bz1kO3ZhciBrPWouZ3JpZC5fcHJlcGFyZU5vZGUoe3dpZHRoOmgsaGVpZ2h0OmksX2FkZGVkOiExLF90ZW1wb3Jhcnk6ITB9KTtkLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIsayksZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGVfb3JpZyIsZyksZC5vbigiZHJhZyIscCl9KS5vbihqLmNvbnRhaW5lciwiZHJvcG91dCIsZnVuY3Rpb24oYixjKXt2YXIgZD1hKGMuZHJhZ2dhYmxlKTtkLnVuYmluZCgiZHJhZyIscCk7dmFyIGU9ZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKTtlLmVsPW51bGwsai5ncmlkLnJlbW92ZU5vZGUoZSksai5wbGFjZWhvbGRlci5kZXRhY2goKSxqLl91cGRhdGVDb250YWluZXJIZWlnaHQoKSxkLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIsZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGVfb3JpZyIpKX0pLm9uKGouY29udGFpbmVyLCJkcm9wIixmdW5jdGlvbihiLGMpe2oucGxhY2Vob2xkZXIuZGV0YWNoKCk7dmFyIGQ9YShjLmRyYWdnYWJsZSkuZGF0YSgiX2dyaWRzdGFja19ub2RlIik7ZC5fZ3JpZD1qO3ZhciBlPWEoYy5kcmFnZ2FibGUpLmNsb25lKCExKTtlLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIsZCksYShjLmRyYWdnYWJsZSkucmVtb3ZlKCksZC5lbD1lLGoucGxhY2Vob2xkZXIuaGlkZSgpLGUuYXR0cigiZGF0YS1ncy14IixkLngpLmF0dHIoImRhdGEtZ3MteSIsZC55KS5hdHRyKCJkYXRhLWdzLXdpZHRoIixkLndpZHRoKS5hdHRyKCJkYXRhLWdzLWhlaWdodCIsZC5oZWlnaHQpLmFkZENsYXNzKGoub3B0cy5pdGVtQ2xhc3MpLnJlbW92ZUF0dHIoInN0eWxlIikuZW5hYmxlU2VsZWN0aW9uKCkucmVtb3ZlRGF0YSgiZHJhZ2dhYmxlIikucmVtb3ZlQ2xhc3MoInVpLWRyYWdnYWJsZSB1aS1kcmFnZ2FibGUtZHJhZ2dpbmcgdWktZHJhZ2dhYmxlLWRpc2FibGVkIikudW5iaW5kKCJkcmFnIixwKSxqLmNvbnRhaW5lci5hcHBlbmQoZSksai5fcHJlcGFyZUVsZW1lbnRzQnlOb2RlKGUsZCksai5fdXBkYXRlQ29udGFpbmVySGVpZ2h0KCksai5fdHJpZ2dlckNoYW5nZUV2ZW50KCksai5ncmlkLmVuZFVwZGF0ZSgpfSl9fTsNCi8vIGpzY3M6ZGlzYWJsZSByZXF1aXJlQ2FtZWxDYXNlT3JVcHBlckNhc2VJZGVudGlmaWVycw0KLy8ganNjczplbmFibGUgcmVxdWlyZUNhbWVsQ2FzZU9yVXBwZXJDYXNlSWRlbnRpZmllcnMNCnJldHVybiBqLnByb3RvdHlwZS5fdHJpZ2dlckNoYW5nZUV2ZW50PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZ3JpZC5nZXREaXJ0eU5vZGVzKCksYz0hMSxkPVtdO2ImJmIubGVuZ3RoJiYoZC5wdXNoKGIpLGM9ITApLChjfHxhPT09ITApJiZ0aGlzLmNvbnRhaW5lci50cmlnZ2VyKCJjaGFuZ2UiLGQpfSxqLnByb3RvdHlwZS5fdHJpZ2dlckFkZEV2ZW50PWZ1bmN0aW9uKCl7dGhpcy5ncmlkLl9hZGRlZE5vZGVzJiZ0aGlzLmdyaWQuX2FkZGVkTm9kZXMubGVuZ3RoPjAmJih0aGlzLmNvbnRhaW5lci50cmlnZ2VyKCJhZGRlZCIsW2IubWFwKHRoaXMuZ3JpZC5fYWRkZWROb2RlcyxiLmNsb25lKV0pLHRoaXMuZ3JpZC5fYWRkZWROb2Rlcz1bXSl9LGoucHJvdG90eXBlLl90cmlnZ2VyUmVtb3ZlRXZlbnQ9ZnVuY3Rpb24oKXt0aGlzLmdyaWQuX3JlbW92ZWROb2RlcyYmdGhpcy5ncmlkLl9yZW1vdmVkTm9kZXMubGVuZ3RoPjAmJih0aGlzLmNvbnRhaW5lci50cmlnZ2VyKCJyZW1vdmVkIixbYi5tYXAodGhpcy5ncmlkLl9yZW1vdmVkTm9kZXMsYi5jbG9uZSldKSx0aGlzLmdyaWQuX3JlbW92ZWROb2Rlcz1bXSl9LGoucHJvdG90eXBlLl9pbml0U3R5bGVzPWZ1bmN0aW9uKCl7dGhpcy5fc3R5bGVzSWQmJmcucmVtb3ZlU3R5bGVzaGVldCh0aGlzLl9zdHlsZXNJZCksdGhpcy5fc3R5bGVzSWQ9ImdyaWRzdGFjay1zdHlsZS0iKygxZTUqTWF0aC5yYW5kb20oKSkudG9GaXhlZCgpLHRoaXMuX3N0eWxlcz1nLmNyZWF0ZVN0eWxlc2hlZXQodGhpcy5fc3R5bGVzSWQpLG51bGwhPT10aGlzLl9zdHlsZXMmJih0aGlzLl9zdHlsZXMuX21heD0wKX0sai5wcm90b3R5cGUuX3VwZGF0ZVN0eWxlcz1mdW5jdGlvbihhKXtpZihudWxsIT09dGhpcy5fc3R5bGVzJiYidW5kZWZpbmVkIiE9dHlwZW9mIHRoaXMuX3N0eWxlcyl7dmFyIGIsYz0iLiIrdGhpcy5vcHRzLl9jbGFzcysiIC4iK3RoaXMub3B0cy5pdGVtQ2xhc3MsZD10aGlzO2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgYSYmKGE9dGhpcy5fc3R5bGVzLl9tYXgsdGhpcy5faW5pdFN0eWxlcygpLHRoaXMuX3VwZGF0ZUNvbnRhaW5lckhlaWdodCgpKSx0aGlzLm9wdHMuY2VsbEhlaWdodCYmISgwIT09dGhpcy5fc3R5bGVzLl9tYXgmJmE8PXRoaXMuX3N0eWxlcy5fbWF4KSYmKGI9dGhpcy5vcHRzLnZlcnRpY2FsTWFyZ2luJiZ0aGlzLm9wdHMuY2VsbEhlaWdodFVuaXQhPT10aGlzLm9wdHMudmVydGljYWxNYXJnaW5Vbml0P2Z1bmN0aW9uKGEsYil7cmV0dXJuIGEmJmI/ImNhbGMoIisoZC5vcHRzLmNlbGxIZWlnaHQqYStkLm9wdHMuY2VsbEhlaWdodFVuaXQpKyIgKyAiKyhkLm9wdHMudmVydGljYWxNYXJnaW4qYitkLm9wdHMudmVydGljYWxNYXJnaW5Vbml0KSsiKSI6ZC5vcHRzLmNlbGxIZWlnaHQqYStkLm9wdHMudmVydGljYWxNYXJnaW4qYitkLm9wdHMuY2VsbEhlaWdodFVuaXR9OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGQub3B0cy5jZWxsSGVpZ2h0KmErZC5vcHRzLnZlcnRpY2FsTWFyZ2luKmIrZC5vcHRzLmNlbGxIZWlnaHRVbml0fSwwPT09dGhpcy5fc3R5bGVzLl9tYXgmJmcuaW5zZXJ0Q1NTUnVsZSh0aGlzLl9zdHlsZXMsYywibWluLWhlaWdodDogIitiKDEsMCkrIjsiLDApLGE+dGhpcy5fc3R5bGVzLl9tYXgpKXtmb3IodmFyIGU9dGhpcy5fc3R5bGVzLl9tYXg7ZTxhOysrZSlnLmluc2VydENTU1J1bGUodGhpcy5fc3R5bGVzLGMrJ1tkYXRhLWdzLWhlaWdodD0iJysoZSsxKSsnIl0nLCJoZWlnaHQ6ICIrYihlKzEsZSkrIjsiLGUpLGcuaW5zZXJ0Q1NTUnVsZSh0aGlzLl9zdHlsZXMsYysnW2RhdGEtZ3MtbWluLWhlaWdodD0iJysoZSsxKSsnIl0nLCJtaW4taGVpZ2h0OiAiK2IoZSsxLGUpKyI7IixlKSxnLmluc2VydENTU1J1bGUodGhpcy5fc3R5bGVzLGMrJ1tkYXRhLWdzLW1heC1oZWlnaHQ9IicrKGUrMSkrJyJdJywibWF4LWhlaWdodDogIitiKGUrMSxlKSsiOyIsZSksZy5pbnNlcnRDU1NSdWxlKHRoaXMuX3N0eWxlcyxjKydbZGF0YS1ncy15PSInK2UrJyJdJywidG9wOiAiK2IoZSxlKSsiOyIsZSk7dGhpcy5fc3R5bGVzLl9tYXg9YX19fSxqLnByb3RvdHlwZS5fdXBkYXRlQ29udGFpbmVySGVpZ2h0PWZ1bmN0aW9uKCl7aWYoIXRoaXMuZ3JpZC5fdXBkYXRlQ291bnRlcil7dmFyIGE9dGhpcy5ncmlkLmdldEdyaWRIZWlnaHQoKTt0aGlzLmNvbnRhaW5lci5hdHRyKCJkYXRhLWdzLWN1cnJlbnQtaGVpZ2h0IixhKSx0aGlzLm9wdHMuY2VsbEhlaWdodCYmKHRoaXMub3B0cy52ZXJ0aWNhbE1hcmdpbj90aGlzLm9wdHMuY2VsbEhlaWdodFVuaXQ9PT10aGlzLm9wdHMudmVydGljYWxNYXJnaW5Vbml0P3RoaXMuY29udGFpbmVyLmNzcygiaGVpZ2h0IixhKih0aGlzLm9wdHMuY2VsbEhlaWdodCt0aGlzLm9wdHMudmVydGljYWxNYXJnaW4pLXRoaXMub3B0cy52ZXJ0aWNhbE1hcmdpbit0aGlzLm9wdHMuY2VsbEhlaWdodFVuaXQpOnRoaXMuY29udGFpbmVyLmNzcygiaGVpZ2h0IiwiY2FsYygiKyhhKnRoaXMub3B0cy5jZWxsSGVpZ2h0K3RoaXMub3B0cy5jZWxsSGVpZ2h0VW5pdCkrIiArICIrKGEqKHRoaXMub3B0cy52ZXJ0aWNhbE1hcmdpbi0xKSt0aGlzLm9wdHMudmVydGljYWxNYXJnaW5Vbml0KSsiKSIpOnRoaXMuY29udGFpbmVyLmNzcygiaGVpZ2h0IixhKnRoaXMub3B0cy5jZWxsSGVpZ2h0K3RoaXMub3B0cy5jZWxsSGVpZ2h0VW5pdCkpfX0sai5wcm90b3R5cGUuX2lzT25lQ29sdW1uTW9kZT1mdW5jdGlvbigpe3JldHVybih3aW5kb3cuaW5uZXJXaWR0aHx8ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRofHxkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoKTw9dGhpcy5vcHRzLm1pbldpZHRofSxqLnByb3RvdHlwZS5fc2V0dXBSZW1vdmluZ1RpbWVvdXQ9ZnVuY3Rpb24oYil7dmFyIGM9dGhpcyxkPWEoYikuZGF0YSgiX2dyaWRzdGFja19ub2RlIik7IWQuX3JlbW92ZVRpbWVvdXQmJmMub3B0cy5yZW1vdmFibGUmJihkLl9yZW1vdmVUaW1lb3V0PXNldFRpbWVvdXQoZnVuY3Rpb24oKXtiLmFkZENsYXNzKCJncmlkLXN0YWNrLWl0ZW0tcmVtb3ZpbmciKSxkLl9pc0Fib3V0VG9SZW1vdmU9ITB9LGMub3B0cy5yZW1vdmVUaW1lb3V0KSl9LGoucHJvdG90eXBlLl9jbGVhclJlbW92aW5nVGltZW91dD1mdW5jdGlvbihiKXt2YXIgYz1hKGIpLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIpO2MuX3JlbW92ZVRpbWVvdXQmJihjbGVhclRpbWVvdXQoYy5fcmVtb3ZlVGltZW91dCksYy5fcmVtb3ZlVGltZW91dD1udWxsLGIucmVtb3ZlQ2xhc3MoImdyaWQtc3RhY2staXRlbS1yZW1vdmluZyIpLGMuX2lzQWJvdXRUb1JlbW92ZT0hMSl9LGoucHJvdG90eXBlLl9wcmVwYXJlRWxlbWVudHNCeU5vZGU9ZnVuY3Rpb24oYixjKXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGEudWkpe3ZhciBkLGUsZj10aGlzLGc9ZnVuY3Rpb24oYSxnKXt2YXIgaCxpLGo9TWF0aC5yb3VuZChnLnBvc2l0aW9uLmxlZnQvZCksaz1NYXRoLmZsb29yKChnLnBvc2l0aW9uLnRvcCtlLzIpL2UpO2lmKCJkcmFnIiE9YS50eXBlJiYoaD1NYXRoLnJvdW5kKGcuc2l6ZS53aWR0aC9kKSxpPU1hdGgucm91bmQoZy5zaXplLmhlaWdodC9lKSksImRyYWciPT1hLnR5cGUpajwwfHxqPj1mLmdyaWQud2lkdGh8fGs8MD8oZi5vcHRzLnJlbW92YWJsZT09PSEwJiZmLl9zZXR1cFJlbW92aW5nVGltZW91dChiKSxqPWMuX2JlZm9yZURyYWdYLGs9Yy5fYmVmb3JlRHJhZ1ksZi5wbGFjZWhvbGRlci5kZXRhY2goKSxmLnBsYWNlaG9sZGVyLmhpZGUoKSxmLmdyaWQucmVtb3ZlTm9kZShjKSxmLl91cGRhdGVDb250YWluZXJIZWlnaHQoKSxjLl90ZW1wb3JhcnlSZW1vdmVkPSEwKTooZi5fY2xlYXJSZW1vdmluZ1RpbWVvdXQoYiksYy5fdGVtcG9yYXJ5UmVtb3ZlZCYmKGYuZ3JpZC5hZGROb2RlKGMpLGYucGxhY2Vob2xkZXIuYXR0cigiZGF0YS1ncy14IixqKS5hdHRyKCJkYXRhLWdzLXkiLGspLmF0dHIoImRhdGEtZ3Mtd2lkdGgiLGgpLmF0dHIoImRhdGEtZ3MtaGVpZ2h0IixpKS5zaG93KCksZi5jb250YWluZXIuYXBwZW5kKGYucGxhY2Vob2xkZXIpLGMuZWw9Zi5wbGFjZWhvbGRlcixjLl90ZW1wb3JhcnlSZW1vdmVkPSExKSk7ZWxzZSBpZigicmVzaXplIj09YS50eXBlJiZqPDApcmV0dXJuOw0KLy8gd2lkdGggYW5kIGhlaWdodCBhcmUgdW5kZWZpbmVkIGlmIG5vdCByZXNpemluZw0KdmFyIGw9InVuZGVmaW5lZCIhPXR5cGVvZiBoP2g6Yy5sYXN0VHJpZWRXaWR0aCxtPSJ1bmRlZmluZWQiIT10eXBlb2YgaT9pOmMubGFzdFRyaWVkSGVpZ2h0OyFmLmdyaWQuY2FuTW92ZU5vZGUoYyxqLGssaCxpKXx8Yy5sYXN0VHJpZWRYPT09aiYmYy5sYXN0VHJpZWRZPT09ayYmYy5sYXN0VHJpZWRXaWR0aD09PWwmJmMubGFzdFRyaWVkSGVpZ2h0PT09bXx8KGMubGFzdFRyaWVkWD1qLGMubGFzdFRyaWVkWT1rLGMubGFzdFRyaWVkV2lkdGg9aCxjLmxhc3RUcmllZEhlaWdodD1pLGYuZ3JpZC5tb3ZlTm9kZShjLGosayxoLGkpLGYuX3VwZGF0ZUNvbnRhaW5lckhlaWdodCgpKX0saD1mdW5jdGlvbihnLGgpe2YuY29udGFpbmVyLmFwcGVuZChmLnBsYWNlaG9sZGVyKTt2YXIgaT1hKHRoaXMpO2YuZ3JpZC5jbGVhbk5vZGVzKCksZi5ncmlkLmJlZ2luVXBkYXRlKGMpLGQ9Zi5jZWxsV2lkdGgoKTt2YXIgaj1NYXRoLmNlaWwoaS5vdXRlckhlaWdodCgpL2kuYXR0cigiZGF0YS1ncy1oZWlnaHQiKSk7ZT1mLmNvbnRhaW5lci5oZWlnaHQoKS9wYXJzZUludChmLmNvbnRhaW5lci5hdHRyKCJkYXRhLWdzLWN1cnJlbnQtaGVpZ2h0IikpLGYucGxhY2Vob2xkZXIuYXR0cigiZGF0YS1ncy14IixpLmF0dHIoImRhdGEtZ3MteCIpKS5hdHRyKCJkYXRhLWdzLXkiLGkuYXR0cigiZGF0YS1ncy15IikpLmF0dHIoImRhdGEtZ3Mtd2lkdGgiLGkuYXR0cigiZGF0YS1ncy13aWR0aCIpKS5hdHRyKCJkYXRhLWdzLWhlaWdodCIsaS5hdHRyKCJkYXRhLWdzLWhlaWdodCIpKS5zaG93KCksYy5lbD1mLnBsYWNlaG9sZGVyLGMuX2JlZm9yZURyYWdYPWMueCxjLl9iZWZvcmVEcmFnWT1jLnksZi5kZC5yZXNpemFibGUoYiwib3B0aW9uIiwibWluV2lkdGgiLGQqKGMubWluV2lkdGh8fDEpKSxmLmRkLnJlc2l6YWJsZShiLCJvcHRpb24iLCJtaW5IZWlnaHQiLGoqKGMubWluSGVpZ2h0fHwxKSksInJlc2l6ZXN0YXJ0Ij09Zy50eXBlJiZpLmZpbmQoIi5ncmlkLXN0YWNrLWl0ZW0iKS50cmlnZ2VyKCJyZXNpemVzdGFydCIpfSxpPWZ1bmN0aW9uKGQsZSl7dmFyIGc9YSh0aGlzKTtpZihnLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIpKXt2YXIgaD0hMTtmLnBsYWNlaG9sZGVyLmRldGFjaCgpLGMuZWw9ZyxmLnBsYWNlaG9sZGVyLmhpZGUoKSxjLl9pc0Fib3V0VG9SZW1vdmU/KGg9ITAsYi5yZW1vdmVEYXRhKCJfZ3JpZHN0YWNrX25vZGUiKSxiLnJlbW92ZSgpKTooZi5fY2xlYXJSZW1vdmluZ1RpbWVvdXQoYiksYy5fdGVtcG9yYXJ5UmVtb3ZlZD8oZy5hdHRyKCJkYXRhLWdzLXgiLGMuX2JlZm9yZURyYWdYKS5hdHRyKCJkYXRhLWdzLXkiLGMuX2JlZm9yZURyYWdZKS5hdHRyKCJkYXRhLWdzLXdpZHRoIixjLndpZHRoKS5hdHRyKCJkYXRhLWdzLWhlaWdodCIsYy5oZWlnaHQpLnJlbW92ZUF0dHIoInN0eWxlIiksYy54PWMuX2JlZm9yZURyYWdYLGMueT1jLl9iZWZvcmVEcmFnWSxmLmdyaWQuYWRkTm9kZShjKSk6Zy5hdHRyKCJkYXRhLWdzLXgiLGMueCkuYXR0cigiZGF0YS1ncy15IixjLnkpLmF0dHIoImRhdGEtZ3Mtd2lkdGgiLGMud2lkdGgpLmF0dHIoImRhdGEtZ3MtaGVpZ2h0IixjLmhlaWdodCkucmVtb3ZlQXR0cigic3R5bGUiKSksZi5fdXBkYXRlQ29udGFpbmVySGVpZ2h0KCksZi5fdHJpZ2dlckNoYW5nZUV2ZW50KGgpLGYuZ3JpZC5lbmRVcGRhdGUoKTt2YXIgaT1nLmZpbmQoIi5ncmlkLXN0YWNrIik7aS5sZW5ndGgmJiJyZXNpemVzdG9wIj09ZC50eXBlJiYoaS5lYWNoKGZ1bmN0aW9uKGIsYyl7YShjKS5kYXRhKCJncmlkc3RhY2siKS5vblJlc2l6ZUhhbmRsZXIoKX0pLGcuZmluZCgiLmdyaWQtc3RhY2staXRlbSIpLnRyaWdnZXIoInJlc2l6ZXN0b3AiKSl9fTt0aGlzLmRkLmRyYWdnYWJsZShiLHtzdGFydDpoLHN0b3A6aSxkcmFnOmd9KS5yZXNpemFibGUoYix7c3RhcnQ6aCxzdG9wOmkscmVzaXplOmd9KSwoYy5ub01vdmV8fHRoaXMuX2lzT25lQ29sdW1uTW9kZSgpfHx0aGlzLm9wdHMuZGlzYWJsZURyYWcpJiZ0aGlzLmRkLmRyYWdnYWJsZShiLCJkaXNhYmxlIiksKGMubm9SZXNpemV8fHRoaXMuX2lzT25lQ29sdW1uTW9kZSgpfHx0aGlzLm9wdHMuZGlzYWJsZVJlc2l6ZSkmJnRoaXMuZGQucmVzaXphYmxlKGIsImRpc2FibGUiKSxiLmF0dHIoImRhdGEtZ3MtbG9ja2VkIixjLmxvY2tlZD8ieWVzIjpudWxsKX19LGoucHJvdG90eXBlLl9wcmVwYXJlRWxlbWVudD1mdW5jdGlvbihiLGMpe2M9InVuZGVmaW5lZCIhPXR5cGVvZiBjJiZjO3ZhciBkPXRoaXM7Yj1hKGIpLGIuYWRkQ2xhc3ModGhpcy5vcHRzLml0ZW1DbGFzcyk7dmFyIGU9ZC5ncmlkLmFkZE5vZGUoe3g6Yi5hdHRyKCJkYXRhLWdzLXgiKSx5OmIuYXR0cigiZGF0YS1ncy15Iiksd2lkdGg6Yi5hdHRyKCJkYXRhLWdzLXdpZHRoIiksaGVpZ2h0OmIuYXR0cigiZGF0YS1ncy1oZWlnaHQiKSxtYXhXaWR0aDpiLmF0dHIoImRhdGEtZ3MtbWF4LXdpZHRoIiksbWluV2lkdGg6Yi5hdHRyKCJkYXRhLWdzLW1pbi13aWR0aCIpLG1heEhlaWdodDpiLmF0dHIoImRhdGEtZ3MtbWF4LWhlaWdodCIpLG1pbkhlaWdodDpiLmF0dHIoImRhdGEtZ3MtbWluLWhlaWdodCIpLGF1dG9Qb3NpdGlvbjpnLnRvQm9vbChiLmF0dHIoImRhdGEtZ3MtYXV0by1wb3NpdGlvbiIpKSxub1Jlc2l6ZTpnLnRvQm9vbChiLmF0dHIoImRhdGEtZ3Mtbm8tcmVzaXplIikpLG5vTW92ZTpnLnRvQm9vbChiLmF0dHIoImRhdGEtZ3Mtbm8tbW92ZSIpKSxsb2NrZWQ6Zy50b0Jvb2woYi5hdHRyKCJkYXRhLWdzLWxvY2tlZCIpKSxlbDpiLGlkOmIuYXR0cigiZGF0YS1ncy1pZCIpLF9ncmlkOmR9LGMpO2IuZGF0YSgiX2dyaWRzdGFja19ub2RlIixlKSx0aGlzLl9wcmVwYXJlRWxlbWVudHNCeU5vZGUoYixlKX0sai5wcm90b3R5cGUuc2V0QW5pbWF0aW9uPWZ1bmN0aW9uKGEpe2E/dGhpcy5jb250YWluZXIuYWRkQ2xhc3MoImdyaWQtc3RhY2stYW5pbWF0ZSIpOnRoaXMuY29udGFpbmVyLnJlbW92ZUNsYXNzKCJncmlkLXN0YWNrLWFuaW1hdGUiKX0sai5wcm90b3R5cGUuYWRkV2lkZ2V0PWZ1bmN0aW9uKGIsYyxkLGUsZixnLGgsaSxqLGssbCl7cmV0dXJuIGI9YShiKSwidW5kZWZpbmVkIiE9dHlwZW9mIGMmJmIuYXR0cigiZGF0YS1ncy14IixjKSwidW5kZWZpbmVkIiE9dHlwZW9mIGQmJmIuYXR0cigiZGF0YS1ncy15IixkKSwidW5kZWZpbmVkIiE9dHlwZW9mIGUmJmIuYXR0cigiZGF0YS1ncy13aWR0aCIsZSksInVuZGVmaW5lZCIhPXR5cGVvZiBmJiZiLmF0dHIoImRhdGEtZ3MtaGVpZ2h0IixmKSwidW5kZWZpbmVkIiE9dHlwZW9mIGcmJmIuYXR0cigiZGF0YS1ncy1hdXRvLXBvc2l0aW9uIixnPyJ5ZXMiOm51bGwpLCJ1bmRlZmluZWQiIT10eXBlb2YgaCYmYi5hdHRyKCJkYXRhLWdzLW1pbi13aWR0aCIsaCksInVuZGVmaW5lZCIhPXR5cGVvZiBpJiZiLmF0dHIoImRhdGEtZ3MtbWF4LXdpZHRoIixpKSwidW5kZWZpbmVkIiE9dHlwZW9mIGomJmIuYXR0cigiZGF0YS1ncy1taW4taGVpZ2h0IixqKSwidW5kZWZpbmVkIiE9dHlwZW9mIGsmJmIuYXR0cigiZGF0YS1ncy1tYXgtaGVpZ2h0IixrKSwidW5kZWZpbmVkIiE9dHlwZW9mIGwmJmIuYXR0cigiZGF0YS1ncy1pZCIsbCksdGhpcy5jb250YWluZXIuYXBwZW5kKGIpLHRoaXMuX3ByZXBhcmVFbGVtZW50KGIsITApLHRoaXMuX3RyaWdnZXJBZGRFdmVudCgpLHRoaXMuX3VwZGF0ZUNvbnRhaW5lckhlaWdodCgpLHRoaXMuX3RyaWdnZXJDaGFuZ2VFdmVudCghMCksYn0sai5wcm90b3R5cGUubWFrZVdpZGdldD1mdW5jdGlvbihiKXtyZXR1cm4gYj1hKGIpLHRoaXMuX3ByZXBhcmVFbGVtZW50KGIsITApLHRoaXMuX3RyaWdnZXJBZGRFdmVudCgpLHRoaXMuX3VwZGF0ZUNvbnRhaW5lckhlaWdodCgpLHRoaXMuX3RyaWdnZXJDaGFuZ2VFdmVudCghMCksYn0sai5wcm90b3R5cGUud2lsbEl0Rml0PWZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9e3g6YSx5OmIsd2lkdGg6YyxoZWlnaHQ6ZCxhdXRvUG9zaXRpb246ZX07cmV0dXJuIHRoaXMuZ3JpZC5jYW5CZVBsYWNlZFdpdGhSZXNwZWN0VG9IZWlnaHQoZil9LGoucHJvdG90eXBlLnJlbW92ZVdpZGdldD1mdW5jdGlvbihiLGMpe2M9InVuZGVmaW5lZCI9PXR5cGVvZiBjfHxjLGI9YShiKTt2YXIgZD1iLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIpOw0KLy8gRm9yIE1ldGVvciBzdXBwb3J0OiBodHRwczovL2dpdGh1Yi5jb20vdHJvb2xlZS9ncmlkc3RhY2suanMvcHVsbC8yNzINCmR8fChkPXRoaXMuZ3JpZC5nZXROb2RlRGF0YUJ5RE9NRWwoYikpLHRoaXMuZ3JpZC5yZW1vdmVOb2RlKGQsYyksYi5yZW1vdmVEYXRhKCJfZ3JpZHN0YWNrX25vZGUiKSx0aGlzLl91cGRhdGVDb250YWluZXJIZWlnaHQoKSxjJiZiLnJlbW92ZSgpLHRoaXMuX3RyaWdnZXJDaGFuZ2VFdmVudCghMCksdGhpcy5fdHJpZ2dlclJlbW92ZUV2ZW50KCl9LGoucHJvdG90eXBlLnJlbW92ZUFsbD1mdW5jdGlvbihhKXtiLmVhY2godGhpcy5ncmlkLm5vZGVzLGIuYmluZChmdW5jdGlvbihiKXt0aGlzLnJlbW92ZVdpZGdldChiLmVsLGEpfSx0aGlzKSksdGhpcy5ncmlkLm5vZGVzPVtdLHRoaXMuX3VwZGF0ZUNvbnRhaW5lckhlaWdodCgpfSxqLnByb3RvdHlwZS5kZXN0cm95PWZ1bmN0aW9uKGIpe2Eod2luZG93KS5vZmYoInJlc2l6ZSIsdGhpcy5vblJlc2l6ZUhhbmRsZXIpLHRoaXMuZGlzYWJsZSgpLCJ1bmRlZmluZWQiPT10eXBlb2YgYnx8Yj90aGlzLmNvbnRhaW5lci5yZW1vdmUoKToodGhpcy5yZW1vdmVBbGwoITEpLHRoaXMuY29udGFpbmVyLnJlbW92ZURhdGEoImdyaWRzdGFjayIpKSxnLnJlbW92ZVN0eWxlc2hlZXQodGhpcy5fc3R5bGVzSWQpLHRoaXMuZ3JpZCYmKHRoaXMuZ3JpZD1udWxsKX0sai5wcm90b3R5cGUucmVzaXphYmxlPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcztyZXR1cm4gYj1hKGIpLGIuZWFjaChmdW5jdGlvbihiLGUpe2U9YShlKTt2YXIgZj1lLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIpOyJ1bmRlZmluZWQiIT10eXBlb2YgZiYmbnVsbCE9PWYmJiJ1bmRlZmluZWQiIT10eXBlb2YgYS51aSYmKGYubm9SZXNpemU9IWMsZi5ub1Jlc2l6ZXx8ZC5faXNPbmVDb2x1bW5Nb2RlKCk/ZC5kZC5yZXNpemFibGUoZSwiZGlzYWJsZSIpOmQuZGQucmVzaXphYmxlKGUsImVuYWJsZSIpKX0pLHRoaXN9LGoucHJvdG90eXBlLm1vdmFibGU9ZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzO3JldHVybiBiPWEoYiksYi5lYWNoKGZ1bmN0aW9uKGIsZSl7ZT1hKGUpO3ZhciBmPWUuZGF0YSgiX2dyaWRzdGFja19ub2RlIik7InVuZGVmaW5lZCIhPXR5cGVvZiBmJiZudWxsIT09ZiYmInVuZGVmaW5lZCIhPXR5cGVvZiBhLnVpJiYoZi5ub01vdmU9IWMsZi5ub01vdmV8fGQuX2lzT25lQ29sdW1uTW9kZSgpPyhkLmRkLmRyYWdnYWJsZShlLCJkaXNhYmxlIiksZS5yZW1vdmVDbGFzcygidWktZHJhZ2dhYmxlLWhhbmRsZSIpKTooZC5kZC5kcmFnZ2FibGUoZSwiZW5hYmxlIiksZS5hZGRDbGFzcygidWktZHJhZ2dhYmxlLWhhbmRsZSIpKSl9KSx0aGlzfSxqLnByb3RvdHlwZS5lbmFibGVNb3ZlPWZ1bmN0aW9uKGEsYil7dGhpcy5tb3ZhYmxlKHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKCIuIit0aGlzLm9wdHMuaXRlbUNsYXNzKSxhKSxiJiYodGhpcy5vcHRzLmRpc2FibGVEcmFnPSFhKX0sai5wcm90b3R5cGUuZW5hYmxlUmVzaXplPWZ1bmN0aW9uKGEsYil7dGhpcy5yZXNpemFibGUodGhpcy5jb250YWluZXIuY2hpbGRyZW4oIi4iK3RoaXMub3B0cy5pdGVtQ2xhc3MpLGEpLGImJih0aGlzLm9wdHMuZGlzYWJsZVJlc2l6ZT0hYSl9LGoucHJvdG90eXBlLmRpc2FibGU9ZnVuY3Rpb24oKXt0aGlzLm1vdmFibGUodGhpcy5jb250YWluZXIuY2hpbGRyZW4oIi4iK3RoaXMub3B0cy5pdGVtQ2xhc3MpLCExKSx0aGlzLnJlc2l6YWJsZSh0aGlzLmNvbnRhaW5lci5jaGlsZHJlbigiLiIrdGhpcy5vcHRzLml0ZW1DbGFzcyksITEpLHRoaXMuY29udGFpbmVyLnRyaWdnZXIoImRpc2FibGUiKX0sai5wcm90b3R5cGUuZW5hYmxlPWZ1bmN0aW9uKCl7dGhpcy5tb3ZhYmxlKHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKCIuIit0aGlzLm9wdHMuaXRlbUNsYXNzKSwhMCksdGhpcy5yZXNpemFibGUodGhpcy5jb250YWluZXIuY2hpbGRyZW4oIi4iK3RoaXMub3B0cy5pdGVtQ2xhc3MpLCEwKSx0aGlzLmNvbnRhaW5lci50cmlnZ2VyKCJlbmFibGUiKX0sai5wcm90b3R5cGUubG9ja2VkPWZ1bmN0aW9uKGIsYyl7cmV0dXJuIGI9YShiKSxiLmVhY2goZnVuY3Rpb24oYixkKXtkPWEoZCk7dmFyIGU9ZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKTsidW5kZWZpbmVkIiE9dHlwZW9mIGUmJm51bGwhPT1lJiYoZS5sb2NrZWQ9Y3x8ITEsZC5hdHRyKCJkYXRhLWdzLWxvY2tlZCIsZS5sb2NrZWQ/InllcyI6bnVsbCkpfSksdGhpc30sai5wcm90b3R5cGUubWF4SGVpZ2h0PWZ1bmN0aW9uKGIsYyl7cmV0dXJuIGI9YShiKSxiLmVhY2goZnVuY3Rpb24oYixkKXtkPWEoZCk7dmFyIGU9ZC5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKTsidW5kZWZpbmVkIiE9dHlwZW9mIGUmJm51bGwhPT1lJiYoaXNOYU4oYyl8fChlLm1heEhlaWdodD1jfHwhMSxkLmF0dHIoImRhdGEtZ3MtbWF4LWhlaWdodCIsYykpKX0pLHRoaXN9LGoucHJvdG90eXBlLm1pbkhlaWdodD1mdW5jdGlvbihiLGMpe3JldHVybiBiPWEoYiksYi5lYWNoKGZ1bmN0aW9uKGIsZCl7ZD1hKGQpO3ZhciBlPWQuZGF0YSgiX2dyaWRzdGFja19ub2RlIik7InVuZGVmaW5lZCIhPXR5cGVvZiBlJiZudWxsIT09ZSYmKGlzTmFOKGMpfHwoZS5taW5IZWlnaHQ9Y3x8ITEsZC5hdHRyKCJkYXRhLWdzLW1pbi1oZWlnaHQiLGMpKSl9KSx0aGlzfSxqLnByb3RvdHlwZS5tYXhXaWR0aD1mdW5jdGlvbihiLGMpe3JldHVybiBiPWEoYiksYi5lYWNoKGZ1bmN0aW9uKGIsZCl7ZD1hKGQpO3ZhciBlPWQuZGF0YSgiX2dyaWRzdGFja19ub2RlIik7InVuZGVmaW5lZCIhPXR5cGVvZiBlJiZudWxsIT09ZSYmKGlzTmFOKGMpfHwoZS5tYXhXaWR0aD1jfHwhMSxkLmF0dHIoImRhdGEtZ3MtbWF4LXdpZHRoIixjKSkpfSksdGhpc30sai5wcm90b3R5cGUubWluV2lkdGg9ZnVuY3Rpb24oYixjKXtyZXR1cm4gYj1hKGIpLGIuZWFjaChmdW5jdGlvbihiLGQpe2Q9YShkKTt2YXIgZT1kLmRhdGEoIl9ncmlkc3RhY2tfbm9kZSIpOyJ1bmRlZmluZWQiIT10eXBlb2YgZSYmbnVsbCE9PWUmJihpc05hTihjKXx8KGUubWluV2lkdGg9Y3x8ITEsZC5hdHRyKCJkYXRhLWdzLW1pbi13aWR0aCIsYykpKX0pLHRoaXN9LGoucHJvdG90eXBlLl91cGRhdGVFbGVtZW50PWZ1bmN0aW9uKGIsYyl7Yj1hKGIpLmZpcnN0KCk7dmFyIGQ9Yi5kYXRhKCJfZ3JpZHN0YWNrX25vZGUiKTtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGQmJm51bGwhPT1kKXt2YXIgZT10aGlzO2UuZ3JpZC5jbGVhbk5vZGVzKCksZS5ncmlkLmJlZ2luVXBkYXRlKGQpLGMuY2FsbCh0aGlzLGIsZCksZS5fdXBkYXRlQ29udGFpbmVySGVpZ2h0KCksZS5fdHJpZ2dlckNoYW5nZUV2ZW50KCksZS5ncmlkLmVuZFVwZGF0ZSgpfX0sai5wcm90b3R5cGUucmVzaXplPWZ1bmN0aW9uKGEsYixjKXt0aGlzLl91cGRhdGVFbGVtZW50KGEsZnVuY3Rpb24oYSxkKXtiPW51bGwhPT1iJiYidW5kZWZpbmVkIiE9dHlwZW9mIGI/YjpkLndpZHRoLGM9bnVsbCE9PWMmJiJ1bmRlZmluZWQiIT10eXBlb2YgYz9jOmQuaGVpZ2h0LHRoaXMuZ3JpZC5tb3ZlTm9kZShkLGQueCxkLnksYixjKX0pfSxqLnByb3RvdHlwZS5tb3ZlPWZ1bmN0aW9uKGEsYixjKXt0aGlzLl91cGRhdGVFbGVtZW50KGEsZnVuY3Rpb24oYSxkKXtiPW51bGwhPT1iJiYidW5kZWZpbmVkIiE9dHlwZW9mIGI/YjpkLngsYz1udWxsIT09YyYmInVuZGVmaW5lZCIhPXR5cGVvZiBjP2M6ZC55LHRoaXMuZ3JpZC5tb3ZlTm9kZShkLGIsYyxkLndpZHRoLGQuaGVpZ2h0KX0pfSxqLnByb3RvdHlwZS51cGRhdGU9ZnVuY3Rpb24oYSxiLGMsZCxlKXt0aGlzLl91cGRhdGVFbGVtZW50KGEsZnVuY3Rpb24oYSxmKXtiPW51bGwhPT1iJiYidW5kZWZpbmVkIiE9dHlwZW9mIGI/YjpmLngsYz1udWxsIT09YyYmInVuZGVmaW5lZCIhPXR5cGVvZiBjP2M6Zi55LGQ9bnVsbCE9PWQmJiJ1bmRlZmluZWQiIT10eXBlb2YgZD9kOmYud2lkdGgsZT1udWxsIT09ZSYmInVuZGVmaW5lZCIhPXR5cGVvZiBlP2U6Zi5oZWlnaHQsdGhpcy5ncmlkLm1vdmVOb2RlKGYsYixjLGQsZSl9KX0sai5wcm90b3R5cGUudmVydGljYWxNYXJnaW49ZnVuY3Rpb24oYSxiKXtpZigidW5kZWZpbmVkIj09dHlwZW9mIGEpcmV0dXJuIHRoaXMub3B0cy52ZXJ0aWNhbE1hcmdpbjt2YXIgYz1nLnBhcnNlSGVpZ2h0KGEpO3RoaXMub3B0cy52ZXJ0aWNhbE1hcmdpblVuaXQ9PT1jLnVuaXQmJnRoaXMub3B0cy5oZWlnaHQ9PT1jLmhlaWdodHx8KHRoaXMub3B0cy52ZXJ0aWNhbE1hcmdpblVuaXQ9Yy51bml0LHRoaXMub3B0cy52ZXJ0aWNhbE1hcmdpbj1jLmhlaWdodCxifHx0aGlzLl91cGRhdGVTdHlsZXMoKSl9LGoucHJvdG90eXBlLmNlbGxIZWlnaHQ9ZnVuY3Rpb24oYSxiKXtpZigidW5kZWZpbmVkIj09dHlwZW9mIGEpe2lmKHRoaXMub3B0cy5jZWxsSGVpZ2h0KXJldHVybiB0aGlzLm9wdHMuY2VsbEhlaWdodDt2YXIgYz10aGlzLmNvbnRhaW5lci5jaGlsZHJlbigiLiIrdGhpcy5vcHRzLml0ZW1DbGFzcykuZmlyc3QoKTtyZXR1cm4gTWF0aC5jZWlsKGMub3V0ZXJIZWlnaHQoKS9jLmF0dHIoImRhdGEtZ3MtaGVpZ2h0IikpfXZhciBkPWcucGFyc2VIZWlnaHQoYSk7dGhpcy5vcHRzLmNlbGxIZWlnaHRVbml0PT09ZC5oZWlnaHRVbml0JiZ0aGlzLm9wdHMuaGVpZ2h0PT09ZC5oZWlnaHR8fCh0aGlzLm9wdHMuY2VsbEhlaWdodFVuaXQ9ZC51bml0LHRoaXMub3B0cy5jZWxsSGVpZ2h0PWQuaGVpZ2h0LGJ8fHRoaXMuX3VwZGF0ZVN0eWxlcygpKX0sai5wcm90b3R5cGUuY2VsbFdpZHRoPWZ1bmN0aW9uKCl7cmV0dXJuIE1hdGgucm91bmQodGhpcy5jb250YWluZXIub3V0ZXJXaWR0aCgpL3RoaXMub3B0cy53aWR0aCl9LGoucHJvdG90eXBlLmdldENlbGxGcm9tUGl4ZWw9ZnVuY3Rpb24oYSxiKXt2YXIgYz0idW5kZWZpbmVkIiE9dHlwZW9mIGImJmI/dGhpcy5jb250YWluZXIub2Zmc2V0KCk6dGhpcy5jb250YWluZXIucG9zaXRpb24oKSxkPWEubGVmdC1jLmxlZnQsZT1hLnRvcC1jLnRvcCxmPU1hdGguZmxvb3IodGhpcy5jb250YWluZXIud2lkdGgoKS90aGlzLm9wdHMud2lkdGgpLGc9TWF0aC5mbG9vcih0aGlzLmNvbnRhaW5lci5oZWlnaHQoKS9wYXJzZUludCh0aGlzLmNvbnRhaW5lci5hdHRyKCJkYXRhLWdzLWN1cnJlbnQtaGVpZ2h0IikpKTtyZXR1cm57eDpNYXRoLmZsb29yKGQvZikseTpNYXRoLmZsb29yKGUvZyl9fSxqLnByb3RvdHlwZS5iYXRjaFVwZGF0ZT1mdW5jdGlvbigpe3RoaXMuZ3JpZC5iYXRjaFVwZGF0ZSgpfSxqLnByb3RvdHlwZS5jb21taXQ9ZnVuY3Rpb24oKXt0aGlzLmdyaWQuY29tbWl0KCksdGhpcy5fdXBkYXRlQ29udGFpbmVySGVpZ2h0KCl9LGoucHJvdG90eXBlLmlzQXJlYUVtcHR5PWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLmdyaWQuaXNBcmVhRW1wdHkoYSxiLGMsZCl9LGoucHJvdG90eXBlLnNldFN0YXRpYz1mdW5jdGlvbihhKXt0aGlzLm9wdHMuc3RhdGljR3JpZD1hPT09ITAsdGhpcy5lbmFibGVNb3ZlKCFhKSx0aGlzLmVuYWJsZVJlc2l6ZSghYSksdGhpcy5fc2V0U3RhdGljQ2xhc3MoKX0sai5wcm90b3R5cGUuX3NldFN0YXRpY0NsYXNzPWZ1bmN0aW9uKCl7dmFyIGE9ImdyaWQtc3RhY2stc3RhdGljIjt0aGlzLm9wdHMuc3RhdGljR3JpZD09PSEwP3RoaXMuY29udGFpbmVyLmFkZENsYXNzKGEpOnRoaXMuY29udGFpbmVyLnJlbW92ZUNsYXNzKGEpfSxqLnByb3RvdHlwZS5fdXBkYXRlTm9kZVdpZHRocz1mdW5jdGlvbihhLGIpe3RoaXMuZ3JpZC5fc29ydE5vZGVzKCksdGhpcy5ncmlkLmJhdGNoVXBkYXRlKCk7Zm9yKHZhciBjPXt9LGQ9MDtkPHRoaXMuZ3JpZC5ub2Rlcy5sZW5ndGg7ZCsrKWM9dGhpcy5ncmlkLm5vZGVzW2RdLHRoaXMudXBkYXRlKGMuZWwsTWF0aC5yb3VuZChjLngqYi9hKSx2b2lkIDAsTWF0aC5yb3VuZChjLndpZHRoKmIvYSksdm9pZCAwKTt0aGlzLmdyaWQuY29tbWl0KCl9LGoucHJvdG90eXBlLnNldEdyaWRXaWR0aD1mdW5jdGlvbihhLGIpe3RoaXMuY29udGFpbmVyLnJlbW92ZUNsYXNzKCJncmlkLXN0YWNrLSIrdGhpcy5vcHRzLndpZHRoKSxiIT09ITAmJnRoaXMuX3VwZGF0ZU5vZGVXaWR0aHModGhpcy5vcHRzLndpZHRoLGEpLHRoaXMub3B0cy53aWR0aD1hLHRoaXMuZ3JpZC53aWR0aD1hLHRoaXMuY29udGFpbmVyLmFkZENsYXNzKCJncmlkLXN0YWNrLSIrYSl9LGkucHJvdG90eXBlLmJhdGNoX3VwZGF0ZT1lKGkucHJvdG90eXBlLmJhdGNoVXBkYXRlKSxpLnByb3RvdHlwZS5fZml4X2NvbGxpc2lvbnM9ZShpLnByb3RvdHlwZS5fZml4Q29sbGlzaW9ucywiX2ZpeF9jb2xsaXNpb25zIiwiX2ZpeENvbGxpc2lvbnMiKSxpLnByb3RvdHlwZS5pc19hcmVhX2VtcHR5PWUoaS5wcm90b3R5cGUuaXNBcmVhRW1wdHksImlzX2FyZWFfZW1wdHkiLCJpc0FyZWFFbXB0eSIpLGkucHJvdG90eXBlLl9zb3J0X25vZGVzPWUoaS5wcm90b3R5cGUuX3NvcnROb2RlcywiX3NvcnRfbm9kZXMiLCJfc29ydE5vZGVzIiksaS5wcm90b3R5cGUuX3BhY2tfbm9kZXM9ZShpLnByb3RvdHlwZS5fcGFja05vZGVzLCJfcGFja19ub2RlcyIsIl9wYWNrTm9kZXMiKSxpLnByb3RvdHlwZS5fcHJlcGFyZV9ub2RlPWUoaS5wcm90b3R5cGUuX3ByZXBhcmVOb2RlLCJfcHJlcGFyZV9ub2RlIiwiX3ByZXBhcmVOb2RlIiksaS5wcm90b3R5cGUuY2xlYW5fbm9kZXM9ZShpLnByb3RvdHlwZS5jbGVhbk5vZGVzLCJjbGVhbl9ub2RlcyIsImNsZWFuTm9kZXMiKSxpLnByb3RvdHlwZS5nZXRfZGlydHlfbm9kZXM9ZShpLnByb3RvdHlwZS5nZXREaXJ0eU5vZGVzLCJnZXRfZGlydHlfbm9kZXMiLCJnZXREaXJ0eU5vZGVzIiksaS5wcm90b3R5cGUuYWRkX25vZGU9ZShpLnByb3RvdHlwZS5hZGROb2RlLCJhZGRfbm9kZSIsImFkZE5vZGUsICIpLGkucHJvdG90eXBlLnJlbW92ZV9ub2RlPWUoaS5wcm90b3R5cGUucmVtb3ZlTm9kZSwicmVtb3ZlX25vZGUiLCJyZW1vdmVOb2RlIiksaS5wcm90b3R5cGUuY2FuX21vdmVfbm9kZT1lKGkucHJvdG90eXBlLmNhbk1vdmVOb2RlLCJjYW5fbW92ZV9ub2RlIiwiY2FuTW92ZU5vZGUiKSxpLnByb3RvdHlwZS5tb3ZlX25vZGU9ZShpLnByb3RvdHlwZS5tb3ZlTm9kZSwibW92ZV9ub2RlIiwibW92ZU5vZGUiKSxpLnByb3RvdHlwZS5nZXRfZ3JpZF9oZWlnaHQ9ZShpLnByb3RvdHlwZS5nZXRHcmlkSGVpZ2h0LCJnZXRfZ3JpZF9oZWlnaHQiLCJnZXRHcmlkSGVpZ2h0IiksaS5wcm90b3R5cGUuYmVnaW5fdXBkYXRlPWUoaS5wcm90b3R5cGUuYmVnaW5VcGRhdGUsImJlZ2luX3VwZGF0ZSIsImJlZ2luVXBkYXRlIiksaS5wcm90b3R5cGUuZW5kX3VwZGF0ZT1lKGkucHJvdG90eXBlLmVuZFVwZGF0ZSwiZW5kX3VwZGF0ZSIsImVuZFVwZGF0ZSIpLGkucHJvdG90eXBlLmNhbl9iZV9wbGFjZWRfd2l0aF9yZXNwZWN0X3RvX2hlaWdodD1lKGkucHJvdG90eXBlLmNhbkJlUGxhY2VkV2l0aFJlc3BlY3RUb0hlaWdodCwiY2FuX2JlX3BsYWNlZF93aXRoX3Jlc3BlY3RfdG9faGVpZ2h0IiwiY2FuQmVQbGFjZWRXaXRoUmVzcGVjdFRvSGVpZ2h0Iiksai5wcm90b3R5cGUuX3RyaWdnZXJfY2hhbmdlX2V2ZW50PWUoai5wcm90b3R5cGUuX3RyaWdnZXJDaGFuZ2VFdmVudCwiX3RyaWdnZXJfY2hhbmdlX2V2ZW50IiwiX3RyaWdnZXJDaGFuZ2VFdmVudCIpLGoucHJvdG90eXBlLl9pbml0X3N0eWxlcz1lKGoucHJvdG90eXBlLl9pbml0U3R5bGVzLCJfaW5pdF9zdHlsZXMiLCJfaW5pdFN0eWxlcyIpLGoucHJvdG90eXBlLl91cGRhdGVfc3R5bGVzPWUoai5wcm90b3R5cGUuX3VwZGF0ZVN0eWxlcywiX3VwZGF0ZV9zdHlsZXMiLCJfdXBkYXRlU3R5bGVzIiksai5wcm90b3R5cGUuX3VwZGF0ZV9jb250YWluZXJfaGVpZ2h0PWUoai5wcm90b3R5cGUuX3VwZGF0ZUNvbnRhaW5lckhlaWdodCwiX3VwZGF0ZV9jb250YWluZXJfaGVpZ2h0IiwiX3VwZGF0ZUNvbnRhaW5lckhlaWdodCIpLGoucHJvdG90eXBlLl9pc19vbmVfY29sdW1uX21vZGU9ZShqLnByb3RvdHlwZS5faXNPbmVDb2x1bW5Nb2RlLCJfaXNfb25lX2NvbHVtbl9tb2RlIiwiX2lzT25lQ29sdW1uTW9kZSIpLGoucHJvdG90eXBlLl9wcmVwYXJlX2VsZW1lbnQ9ZShqLnByb3RvdHlwZS5fcHJlcGFyZUVsZW1lbnQsIl9wcmVwYXJlX2VsZW1lbnQiLCJfcHJlcGFyZUVsZW1lbnQiKSxqLnByb3RvdHlwZS5zZXRfYW5pbWF0aW9uPWUoai5wcm90b3R5cGUuc2V0QW5pbWF0aW9uLCJzZXRfYW5pbWF0aW9uIiwic2V0QW5pbWF0aW9uIiksai5wcm90b3R5cGUuYWRkX3dpZGdldD1lKGoucHJvdG90eXBlLmFkZFdpZGdldCwiYWRkX3dpZGdldCIsImFkZFdpZGdldCIpLGoucHJvdG90eXBlLm1ha2Vfd2lkZ2V0PWUoai5wcm90b3R5cGUubWFrZVdpZGdldCwibWFrZV93aWRnZXQiLCJtYWtlV2lkZ2V0Iiksai5wcm90b3R5cGUud2lsbF9pdF9maXQ9ZShqLnByb3RvdHlwZS53aWxsSXRGaXQsIndpbGxfaXRfZml0Iiwid2lsbEl0Rml0Iiksai5wcm90b3R5cGUucmVtb3ZlX3dpZGdldD1lKGoucHJvdG90eXBlLnJlbW92ZVdpZGdldCwicmVtb3ZlX3dpZGdldCIsInJlbW92ZVdpZGdldCIpLGoucHJvdG90eXBlLnJlbW92ZV9hbGw9ZShqLnByb3RvdHlwZS5yZW1vdmVBbGwsInJlbW92ZV9hbGwiLCJyZW1vdmVBbGwiKSxqLnByb3RvdHlwZS5taW5faGVpZ2h0PWUoai5wcm90b3R5cGUubWluSGVpZ2h0LCJtaW5faGVpZ2h0IiwibWluSGVpZ2h0Iiksai5wcm90b3R5cGUubWluX3dpZHRoPWUoai5wcm90b3R5cGUubWluV2lkdGgsIm1pbl93aWR0aCIsIm1pbldpZHRoIiksai5wcm90b3R5cGUuX3VwZGF0ZV9lbGVtZW50PWUoai5wcm90b3R5cGUuX3VwZGF0ZUVsZW1lbnQsIl91cGRhdGVfZWxlbWVudCIsIl91cGRhdGVFbGVtZW50Iiksai5wcm90b3R5cGUuY2VsbF9oZWlnaHQ9ZShqLnByb3RvdHlwZS5jZWxsSGVpZ2h0LCJjZWxsX2hlaWdodCIsImNlbGxIZWlnaHQiKSxqLnByb3RvdHlwZS5jZWxsX3dpZHRoPWUoai5wcm90b3R5cGUuY2VsbFdpZHRoLCJjZWxsX3dpZHRoIiwiY2VsbFdpZHRoIiksai5wcm90b3R5cGUuZ2V0X2NlbGxfZnJvbV9waXhlbD1lKGoucHJvdG90eXBlLmdldENlbGxGcm9tUGl4ZWwsImdldF9jZWxsX2Zyb21fcGl4ZWwiLCJnZXRDZWxsRnJvbVBpeGVsIiksai5wcm90b3R5cGUuYmF0Y2hfdXBkYXRlPWUoai5wcm90b3R5cGUuYmF0Y2hVcGRhdGUsImJhdGNoX3VwZGF0ZSIsImJhdGNoVXBkYXRlIiksai5wcm90b3R5cGUuaXNfYXJlYV9lbXB0eT1lKGoucHJvdG90eXBlLmlzQXJlYUVtcHR5LCJpc19hcmVhX2VtcHR5IiwiaXNBcmVhRW1wdHkiKSxqLnByb3RvdHlwZS5zZXRfc3RhdGljPWUoai5wcm90b3R5cGUuc2V0U3RhdGljLCJzZXRfc3RhdGljIiwic2V0U3RhdGljIiksai5wcm90b3R5cGUuX3NldF9zdGF0aWNfY2xhc3M9ZShqLnByb3RvdHlwZS5fc2V0U3RhdGljQ2xhc3MsIl9zZXRfc3RhdGljX2NsYXNzIiwiX3NldFN0YXRpY0NsYXNzIiksZC5HcmlkU3RhY2tVST1qLGQuR3JpZFN0YWNrVUkuVXRpbHM9ZyxkLkdyaWRTdGFja1VJLkVuZ2luZT1pLGQuR3JpZFN0YWNrVUkuR3JpZFN0YWNrRHJhZ0Ryb3BQbHVnaW49YyxhLmZuLmdyaWRzdGFjaz1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKTtjLmRhdGEoImdyaWRzdGFjayIpfHxjLmRhdGEoImdyaWRzdGFjayIsbmV3IGoodGhpcyxiKSl9KX0sZC5HcmlkU3RhY2tVSX0pOw0KLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z3JpZHN0YWNrLm1pbi5tYXAKLyoqDQogKiBncmlkc3RhY2suanMgMC4zLjAtZGV2DQogKiBodHRwOi8vdHJvb2xlZS5naXRodWIuaW8vZ3JpZHN0YWNrLmpzLw0KICogKGMpIDIwMTQtMjAxNiBQYXZlbCBSZXpuaWtvdiwgRHlsYW4gV2Vpc3MNCiAqIGdyaWRzdGFjay5qcyBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4NCiAqIEBwcmVzZXJ2ZQ0KKi8NCiFmdW5jdGlvbihhKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kKWRlZmluZShbImpxdWVyeSIsImxvZGFzaCIsImdyaWRzdGFjayIsImpxdWVyeS11aS9kYXRhIiwianF1ZXJ5LXVpL2Rpc2FibGUtc2VsZWN0aW9uIiwianF1ZXJ5LXVpL2ZvY3VzYWJsZSIsImpxdWVyeS11aS9mb3JtIiwianF1ZXJ5LXVpL2llIiwianF1ZXJ5LXVpL2tleWNvZGUiLCJqcXVlcnktdWkvbGFiZWxzIiwianF1ZXJ5LXVpL2pxdWVyeS0xLTciLCJqcXVlcnktdWkvcGx1Z2luIiwianF1ZXJ5LXVpL3NhZmUtYWN0aXZlLWVsZW1lbnQiLCJqcXVlcnktdWkvc2FmZS1ibHVyIiwianF1ZXJ5LXVpL3Njcm9sbC1wYXJlbnQiLCJqcXVlcnktdWkvdGFiYmFibGUiLCJqcXVlcnktdWkvdW5pcXVlLWlkIiwianF1ZXJ5LXVpL3ZlcnNpb24iLCJqcXVlcnktdWkvd2lkZ2V0IiwianF1ZXJ5LXVpL3dpZGdldHMvbW91c2UiLCJqcXVlcnktdWkvd2lkZ2V0cy9kcmFnZ2FibGUiLCJqcXVlcnktdWkvd2lkZ2V0cy9kcm9wcGFibGUiLCJqcXVlcnktdWkvd2lkZ2V0cy9yZXNpemFibGUiXSxhKTtlbHNlIGlmKCJ1bmRlZmluZWQiIT10eXBlb2YgZXhwb3J0cyl7dHJ5e2pRdWVyeT1yZXF1aXJlKCJqcXVlcnkiKX1jYXRjaChhKXt9dHJ5e189cmVxdWlyZSgibG9kYXNoIil9Y2F0Y2goYSl7fXRyeXtHcmlkU3RhY2tVST1yZXF1aXJlKCJncmlkc3RhY2siKX1jYXRjaChhKXt9YShqUXVlcnksXyxHcmlkU3RhY2tVSSl9ZWxzZSBhKGpRdWVyeSxfLEdyaWRTdGFja1VJKX0oZnVuY3Rpb24oYSxiLGMpey8qKg0KICAgICogQGNsYXNzIEpRdWVyeVVJR3JpZFN0YWNrRHJhZ0Ryb3BQbHVnaW4NCiAgICAqIGpRdWVyeSBVSSBpbXBsZW1lbnRhdGlvbiBvZiBkcmFnJ24nZHJvcCBncmlkc3RhY2sgcGx1Z2luLg0KICAgICovDQpmdW5jdGlvbiBkKGEpe2MuR3JpZFN0YWNrRHJhZ0Ryb3BQbHVnaW4uY2FsbCh0aGlzLGEpfXdpbmRvdztyZXR1cm4gYy5HcmlkU3RhY2tEcmFnRHJvcFBsdWdpbi5yZWdpc3RlclBsdWdpbihkKSxkLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGMuR3JpZFN0YWNrRHJhZ0Ryb3BQbHVnaW4ucHJvdG90eXBlKSxkLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1kLGQucHJvdG90eXBlLnJlc2l6YWJsZT1mdW5jdGlvbihjLGQpe2lmKGM9YShjKSwiZGlzYWJsZSI9PT1kfHwiZW5hYmxlIj09PWQpYy5yZXNpemFibGUoZCk7ZWxzZSBpZigib3B0aW9uIj09PWQpe3ZhciBlPWFyZ3VtZW50c1syXSxmPWFyZ3VtZW50c1szXTtjLnJlc2l6YWJsZShkLGUsZil9ZWxzZSBjLnJlc2l6YWJsZShiLmV4dGVuZCh7fSx0aGlzLmdyaWQub3B0cy5yZXNpemFibGUse3N0YXJ0OmQuc3RhcnR8fGZ1bmN0aW9uKCl7fSxzdG9wOmQuc3RvcHx8ZnVuY3Rpb24oKXt9LHJlc2l6ZTpkLnJlc2l6ZXx8ZnVuY3Rpb24oKXt9fSkpO3JldHVybiB0aGlzfSxkLnByb3RvdHlwZS5kcmFnZ2FibGU9ZnVuY3Rpb24oYyxkKXtyZXR1cm4gYz1hKGMpLCJkaXNhYmxlIj09PWR8fCJlbmFibGUiPT09ZD9jLmRyYWdnYWJsZShkKTpjLmRyYWdnYWJsZShiLmV4dGVuZCh7fSx0aGlzLmdyaWQub3B0cy5kcmFnZ2FibGUse2NvbnRhaW5tZW50OnRoaXMuZ3JpZC5vcHRzLmlzTmVzdGVkP3RoaXMuZ3JpZC5jb250YWluZXIucGFyZW50KCk6bnVsbCxzdGFydDpkLnN0YXJ0fHxmdW5jdGlvbigpe30sc3RvcDpkLnN0b3B8fGZ1bmN0aW9uKCl7fSxkcmFnOmQuZHJhZ3x8ZnVuY3Rpb24oKXt9fSkpLHRoaXN9LGQucHJvdG90eXBlLmRyb3BwYWJsZT1mdW5jdGlvbihiLGMpe3JldHVybiBiPWEoYiksImRpc2FibGUiPT09Y3x8ImVuYWJsZSI9PT1jP2IuZHJvcHBhYmxlKGMpOmIuZHJvcHBhYmxlKHthY2NlcHQ6Yy5hY2NlcHR9KSx0aGlzfSxkLnByb3RvdHlwZS5pc0Ryb3BwYWJsZT1mdW5jdGlvbihiLGMpe3JldHVybiBiPWEoYiksQm9vbGVhbihiLmRhdGEoImRyb3BwYWJsZSIpKX0sZC5wcm90b3R5cGUub249ZnVuY3Rpb24oYixjLGQpe3JldHVybiBhKGIpLm9uKGMsZCksdGhpc30sZH0pOw0KLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z3JpZHN0YWNrLm1pbi5tYXAKLyohDQoqIGpxdWVyeS5jb3VudGVydXAuanMgMS4wDQoqDQoqIENvcHlyaWdodCAyMDEzLCBCZW5qYW1pbiBJbnRhbCBodHRwOi8vZ2FtYml0LnBoIEBiZmludGFsDQoqIFJlbGVhc2VkIHVuZGVyIHRoZSBHUEwgdjIgTGljZW5zZQ0KKg0KKiBEYXRlOiBOb3YgMjYsIDIwMTMNCiovKGZ1bmN0aW9uKGUpeyJ1c2Ugc3RyaWN0IjtlLmZuLmNvdW50ZXJVcD1mdW5jdGlvbih0KXt2YXIgbj1lLmV4dGVuZCh7dGltZTo0MDAsZGVsYXk6MTB9LHQpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgdD1lKHRoaXMpLHI9bixpPWZ1bmN0aW9uKCl7dmFyIGU9W10sbj1yLnRpbWUvci5kZWxheSxpPXQudGV4dCgpLHM9L1swLTldKyxbMC05XSsvLnRlc3QoaSk7aT1pLnJlcGxhY2UoLywvZywiIik7dmFyIG89L15bMC05XSskLy50ZXN0KGkpLHU9L15bMC05XStcLlswLTldKyQvLnRlc3QoaSksYT11PyhpLnNwbGl0KCIuIilbMV18fFtdKS5sZW5ndGg6MDtmb3IodmFyIGY9bjtmPj0xO2YtLSl7dmFyIGw9cGFyc2VJbnQoaS9uKmYpO3UmJihsPXBhcnNlRmxvYXQoaS9uKmYpLnRvRml4ZWQoYSkpO2lmKHMpd2hpbGUoLyhcZCspKFxkezN9KS8udGVzdChsLnRvU3RyaW5nKCkpKWw9bC50b1N0cmluZygpLnJlcGxhY2UoLyhcZCspKFxkezN9KS8sIiQxLCQyIik7ZS51bnNoaWZ0KGwpfXQuZGF0YSgiY291bnRlcnVwLW51bXMiLGUpO3QudGV4dCgiMCIpO3ZhciBjPWZ1bmN0aW9uKCl7dC50ZXh0KHQuZGF0YSgiY291bnRlcnVwLW51bXMiKS5zaGlmdCgpKTtpZih0LmRhdGEoImNvdW50ZXJ1cC1udW1zIikubGVuZ3RoKXNldFRpbWVvdXQodC5kYXRhKCJjb3VudGVydXAtZnVuYyIpLHIuZGVsYXkpO2Vsc2V7ZGVsZXRlIHQuZGF0YSgiY291bnRlcnVwLW51bXMiKTt0LmRhdGEoImNvdW50ZXJ1cC1udW1zIixudWxsKTt0LmRhdGEoImNvdW50ZXJ1cC1mdW5jIixudWxsKX19O3QuZGF0YSgiY291bnRlcnVwLWZ1bmMiLGMpO3NldFRpbWVvdXQodC5kYXRhKCJjb3VudGVydXAtZnVuYyIpLHIuZGVsYXkpfTt0LndheXBvaW50KGkse29mZnNldDoiMTAwJSIsdHJpZ2dlck9uY2U6ITB9KX0pfX0pKGpRdWVyeSk7CnZhciBwdmkgID0gcHZpIHx8IHt9OwoKcHZpLmRhc2hib2FyZCA9IChmdW5jdGlvbiAoKSB7CgogICAgdmFyIGdyaWRzdGFja09wdGlvbnMgPSB7CiAgICAgICAgd2lkdGg6IDEyLAogICAgICAgIHJlc2l6YWJsZToge2F1dG9IaWRlOiB0cnVlLCBoYW5kbGVzOiAnYWxsJ30sCiAgICAgICAgdmVydGljYWxNYXJnaW46IDEwLAogICAgICAgIGFuaW1hdGU6IHRydWUsCiAgICAgICAgZHJhZ2dhYmxlOiB7CiAgICAgICAgICAgIGhhbmRsZTogJy5wdi1zZWMtaGVhZGluZycsCiAgICAgICAgICAgIHNjcm9sbDogdHJ1ZQogICAgICAgIH0KICAgIH07CgogICAgdmFyIHNhdmVXaWRnZXRzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlcmlhbGl6ZWREYXRhID0gXy5tYXAoJCgnLmdyaWQtc3RhY2sgPiAuZ3JpZC1zdGFjay1pdGVtOnZpc2libGUnKSwgZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIHZhciBub2RlID0gJChlbCkuZGF0YSgnX2dyaWRzdGFja19ub2RlJyk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogbm9kZS5pZCwKICAgICAgICAgICAgICAgIHg6IG5vZGUueCwKICAgICAgICAgICAgICAgIHk6IG5vZGUueSwKICAgICAgICAgICAgICAgIHdpZHRoOiBub2RlLndpZHRoLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBub2RlLmhlaWdodAogICAgICAgICAgICB9OwogICAgICAgIH0sIHRoaXMpOwoKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgIHVybDogQ09ORklHVVJBVElPTi51cGRhdGVXaWRnZXRzVXJsLAogICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICBpdGVtczogSlNPTi5zdHJpbmdpZnkoc2VyaWFsaXplZERhdGEsIG51bGwsICcgICAgJykKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgZGFzaGJvYXJkRXZlbnRCaW5kaW5nID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAvL3JlbW92ZSB3aWRnZXQgZXZlbnQgYmluZGluZwogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsJy5yZW1vdmUtd2lkZ2V0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZWxlbWVudFNlbGVjdG9yID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIHdpZGdldCA9IGVsZW1lbnRTZWxlY3Rvci5jbG9zZXN0KCIuZ3JpZC1zdGFjay1pdGVtIik7CiAgICAgICAgICAgIHZhciB1cmwgPSBlbGVtZW50U2VsZWN0b3IuZGF0YSgidXJsIik7CiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBlbGVtZW50U2VsZWN0b3IuZGF0YSgicGFyYW1zIik7CiAgICAgICAgICAgIHZhciB3aWRnZXRJZCA9IGVsZW1lbnRTZWxlY3Rvci5kYXRhKCJ3aWRnZXRpZCIpOwogICAgICAgICAgICBpZiAoQ09ORklHVVJBVElPTlt1cmxdKSB7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICB1cmw6IENPTkZJR1VSQVRJT05bdXJsXSwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtcywKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ3JpZCA9ICQoJy5ncmlkLXN0YWNrJykuZGF0YSgnZ3JpZHN0YWNrJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWQucmVtb3ZlV2lkZ2V0KHdpZGdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoIi5yeC13aWRnZXQtbWVudS1jb250ZW50IGxpW2RhdGEtd2lkZ2V0aWQ9IiArIHdpZGdldElkICsgIl0iKS5maW5kKCJpbnB1dFt0eXBlPSdjaGVja2JveCddIikucmVtb3ZlQXR0cignY2hlY2tlZCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vZXZlbnQgYmluZGluZyBmb3Igd2lkZ2V0IGxpc3QgZHJvcGRvd24KICAgICAgICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCAiLnJ4LXdpZGdldC1tZW51LWNvbnRlbnQgbGkiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBlbGVtZW50U2VsZWN0b3IgPSAkKHRoaXMpOwogICAgICAgICAgICB2YXIgdXJsID0gZWxlbWVudFNlbGVjdG9yLmRhdGEoInVybCIpOwogICAgICAgICAgICB2YXIgcGFyYW1zID0gZWxlbWVudFNlbGVjdG9yLmRhdGEoInBhcmFtcyIpOwogICAgICAgICAgICBpZiAoQ09ORklHVVJBVElPTlt1cmxdKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IENPTkZJR1VSQVRJT05bdXJsXSArICI/IiArICQucGFyYW0ocGFyYW1zKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvL2V2ZW50IGJpbmRpbmcgZm9yIGRhc2hib2FyZCByZXNldCBidXR0b24KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAiI3Jlc2V0QnV0dG9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5kYXRhKCJ1cmwiKTsKICAgICAgICAgICAgcHZpLnV0aWwuc2hvd1dhcm5pbmcoZ2V0TWVzc2FnZSgid2lkZ2V0X3JlZnJlc2hfbWVzc2FnZSIpLCAiQ2FuY2VsIiwgIk9rIiwgZnVuY3Rpb24geWVzKCkgewogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBDT05GSUdVUkFUSU9OW3VybF07CiAgICAgICAgICAgIH0pCiAgICAgICAgfSk7CgogICAgICAgICQoJy5ncmlkLXN0YWNrJykuZ3JpZHN0YWNrKGdyaWRzdGFja09wdGlvbnMpOwoKICAgICAgICAkKGRvY3VtZW50KS5vbignY2hhbmdlJywnLmdyaWQtc3RhY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHNhdmVXaWRnZXRzKCk7CiAgICAgICAgfSk7CgogICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgnLmNvdW50ZXInKS5jb3VudGVyVXAoewogICAgICAgICAgICAgICAgZGVsYXk6IDEwMCwKICAgICAgICAgICAgICAgIHRpbWU6IDEyMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgfTsKCiAgICB2YXIgbG9hZERhdGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiBwdmlfdXJscy5wZXJzb25hbF9zdGF0c191cmwsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogJ0dFVCcsCiAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLnNob3dQVkxvYWRlcigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgdmFyIHBlcnNvbmFsU3RhdHMgPSBkYXRhLnJlc3VsdC5wZXJzb25hbFN0YXRzOwogICAgICAgICAgICAgICAgdmFyIGRhdGFMZW5ndGggPSBwZXJzb25hbFN0YXRzLmxlbmd0aDsKICAgICAgICAgICAgICAgIHZhciBwZXJzb25hbFN0YXRlQ291bnRhaW5lciA9ICQoIi5wdi13aWRnZXQtcGVyc29uYWwtc3RhdHMiKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBlcnNvbmFsU3RhdCA9IHBlcnNvbmFsU3RhdHNbaV07CiAgICAgICAgICAgICAgICAgICAgcGVyc29uYWxTdGF0ZUNvdW50YWluZXIuZmluZCgiLiIgKyBwZXJzb25hbFN0YXQuZWxlbWVudE5hbWUpLnRleHQocGVyc29uYWxTdGF0LmNvdW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLmhpZGVQVkxvYWRlcigpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGRhc2hib2FyZEV2ZW50QmluZGluZygpOwogICAgICAgIHB2aS51dGlsLmJpbmREYXRlUGlja2VycygpOwogICAgICAgIHB2aS51dGlsLmJpbmRGaWxlVXBsb2FkZXJFdmVudCgpOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIGluaXQ6IGluaXQsCiAgICAgICAgbG9hZERhdGE6IGxvYWREYXRhCiAgICB9Cgp9KSgpOwoKcHZpLmRhc2hib2FyZC5pbml0KCk7Ci8vIFRoaXMgaXMgYSBtYW5pZmVzdCBmaWxlIHRoYXQnbGwgYmUgY29tcGlsZWQgaW50byBsaXN0LW1hbmlmZXN0LmpzLgovLwovLyBBbnkgSmF2YVNjcmlwdCBmaWxlIHdpdGhpbiB0aGlzIGRpcmVjdG9yeSBjYW4gYmUgcmVmZXJlbmNlZCBoZXJlIHVzaW5nIGEgcmVsYXRpdmUgcGF0aC4KLy8KLy8gWW91J3JlIGZyZWUgdG8gYWRkIGFwcGxpY2F0aW9uLXdpZGUgSmF2YVNjcmlwdCB0byB0aGlzIGZpbGUsIGJ1dCBpdCdzIGdlbmVyYWxseSBiZXR0ZXIKLy8gdG8gY3JlYXRlIHNlcGFyYXRlIEphdmFTY3JpcHQgZmlsZXMgYXMgbmVlZGVkLgovLwovLz0gcmVxdWlyZV9zZWxmCi8vPSByZXF1aXJlIGdyaWQKLy89IHJlcXVpcmUgdmVuZG9yVWkvZGF0YXRhYmxlcy9kYXRhdGFibGUuY29sc1Jlb3JkZXIubWluCi8vPSByZXF1aXJlIHZlbmRvclVpL2RhdGF0YWJsZXMvZGF0YVRhYmxlcy5yb3dHcm91cC5taW4KLy89IHJlcXVpcmUgYXBwL2xpc3QvbGlzdC1mb3JtLXN0YXRlLXNhdmUKLy89IHJlcXVpcmUgYXBwL2xpc3QvcmVwb3J0LWRpc3RyaWJ1dGlvbi1sb2cKLy89IHJlcXVpcmUgYXBwL2xpc3QvbGlzdAovLz0gcmVxdWlyZSBhcHAvbGlzdC9zcGVlY2gtcmVjb2ctc2VhcmNoCgovKnRvZG8gcmVmYWN0b3IgYmVsb3cgY29kZSovCnRhc2tBY3Rpb24uY29tbW9uTWV0aG9kLmluaXQoZnVuY3Rpb24oKXt9LHB2dWkuY29tbW9uLnNob3dQVkxvYWRlcixwdnVpLmNvbW1vbi5oaWRlUFZMb2FkZXIscHZpLnV0aWwuc2hvd0Zsb2F0aW5nTm90aWZpY2F0aW9uLnN1Y2Nlc3NNZXNzYWdlLHB2aS51dGlsLnNob3dGbG9hdGluZ05vdGlmaWNhdGlvbi5lcnJvck1lc3NhZ2UscHZpLnV0aWwuc2hvd1dhcm5pbmcpOwoKZm9sbG93VXBRdWVyeS5jb21tb25NZXRob2QuaW5pdChmdW5jdGlvbigpe30scHZ1aS5jb21tb24uc2hvd1BWTG9hZGVyLHB2dWkuY29tbW9uLmhpZGVQVkxvYWRlcixwdmkudXRpbC5zaG93RmxvYXRpbmdOb3RpZmljYXRpb24uc3VjY2Vzc01lc3NhZ2UscHZpLnV0aWwuc2hvd0Zsb2F0aW5nTm90aWZpY2F0aW9uLmVycm9yTWVzc2FnZSxwdmkudXRpbC5zaG93V2FybmluZyk7Ci8qIQ0KIERhdGFUYWJsZXMgMS4xMC4xNg0KIMKpMjAwOC0yMDE3IFNwcnlNZWRpYSBMdGQgLSBkYXRhdGFibGVzLm5ldC9saWNlbnNlDQoqLw0KKGZ1bmN0aW9uKGgpeyJmdW5jdGlvbiI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbImpxdWVyeSJdLGZ1bmN0aW9uKEUpe3JldHVybiBoKEUsd2luZG93LGRvY3VtZW50KX0pOiJvYmplY3QiPT09dHlwZW9mIGV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9ZnVuY3Rpb24oRSxHKXtFfHwoRT13aW5kb3cpO0d8fChHPSJ1bmRlZmluZWQiIT09dHlwZW9mIHdpbmRvdz9yZXF1aXJlKCJqcXVlcnkiKTpyZXF1aXJlKCJqcXVlcnkiKShFKSk7cmV0dXJuIGgoRyxFLEUuZG9jdW1lbnQpfTpoKGpRdWVyeSx3aW5kb3csZG9jdW1lbnQpfSkoZnVuY3Rpb24oaCxFLEcsayl7ZnVuY3Rpb24gWChhKXt2YXIgYixjLGQ9e307aC5lYWNoKGEsZnVuY3Rpb24oZSl7aWYoKGI9ZS5tYXRjaCgvXihbXkEtWl0rPykoW0EtWl0pLykpJiYtMSE9PSJhIGFhIGFpIGFvIGFzIGIgZm4gaSBtIG8gcyAiLmluZGV4T2YoYlsxXSsiICIpKWM9ZS5yZXBsYWNlKGJbMF0sYlsyXS50b0xvd2VyQ2FzZSgpKSwNCiAgICBkW2NdPWUsIm8iPT09YlsxXSYmWChhW2VdKX0pO2EuX2h1bmdhcmlhbk1hcD1kfWZ1bmN0aW9uIEkoYSxiLGMpe2EuX2h1bmdhcmlhbk1hcHx8WChhKTt2YXIgZDtoLmVhY2goYixmdW5jdGlvbihlKXtkPWEuX2h1bmdhcmlhbk1hcFtlXTtpZihkIT09ayYmKGN8fGJbZF09PT1rKSkibyI9PT1kLmNoYXJBdCgwKT8oYltkXXx8KGJbZF09e30pLGguZXh0ZW5kKCEwLGJbZF0sYltlXSksSShhW2RdLGJbZF0sYykpOmJbZF09YltlXX0pfWZ1bmN0aW9uIENhKGEpe3ZhciBiPW0uZGVmYXVsdHMub0xhbmd1YWdlLGM9YS5zWmVyb1JlY29yZHM7IWEuc0VtcHR5VGFibGUmJihjJiYiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUiPT09Yi5zRW1wdHlUYWJsZSkmJkYoYSxhLCJzWmVyb1JlY29yZHMiLCJzRW1wdHlUYWJsZSIpOyFhLnNMb2FkaW5nUmVjb3JkcyYmKGMmJiJMb2FkaW5nLi4uIj09PWIuc0xvYWRpbmdSZWNvcmRzKSYmRihhLGEsInNaZXJvUmVjb3JkcyIsInNMb2FkaW5nUmVjb3JkcyIpOw0KICAgIGEuc0luZm9UaG91c2FuZHMmJihhLnNUaG91c2FuZHM9YS5zSW5mb1Rob3VzYW5kcyk7KGE9YS5zRGVjaW1hbCkmJmNiKGEpfWZ1bmN0aW9uIGRiKGEpe0EoYSwib3JkZXJpbmciLCJiU29ydCIpO0EoYSwib3JkZXJNdWx0aSIsImJTb3J0TXVsdGkiKTtBKGEsIm9yZGVyQ2xhc3NlcyIsImJTb3J0Q2xhc3NlcyIpO0EoYSwib3JkZXJDZWxsc1RvcCIsImJTb3J0Q2VsbHNUb3AiKTtBKGEsIm9yZGVyIiwiYWFTb3J0aW5nIik7QShhLCJvcmRlckZpeGVkIiwiYWFTb3J0aW5nRml4ZWQiKTtBKGEsInBhZ2luZyIsImJQYWdpbmF0ZSIpO0EoYSwicGFnaW5nVHlwZSIsInNQYWdpbmF0aW9uVHlwZSIpO0EoYSwicGFnZUxlbmd0aCIsImlEaXNwbGF5TGVuZ3RoIik7QShhLCJzZWFyY2hpbmciLCJiRmlsdGVyIik7ImJvb2xlYW4iPT09dHlwZW9mIGEuc1Njcm9sbFgmJihhLnNTY3JvbGxYPWEuc1Njcm9sbFg/IjEwMCUiOiIiKTsiYm9vbGVhbiI9PT10eXBlb2YgYS5zY3JvbGxYJiYoYS5zY3JvbGxYPQ0KICAgIGEuc2Nyb2xsWD8iMTAwJSI6IiIpO2lmKGE9YS5hb1NlYXJjaENvbHMpZm9yKHZhciBiPTAsYz1hLmxlbmd0aDtiPGM7YisrKWFbYl0mJkkobS5tb2RlbHMub1NlYXJjaCxhW2JdKX1mdW5jdGlvbiBlYihhKXtBKGEsIm9yZGVyYWJsZSIsImJTb3J0YWJsZSIpO0EoYSwib3JkZXJEYXRhIiwiYURhdGFTb3J0Iik7QShhLCJvcmRlclNlcXVlbmNlIiwiYXNTb3J0aW5nIik7QShhLCJvcmRlckRhdGFUeXBlIiwic29ydERhdGFUeXBlIik7dmFyIGI9YS5hRGF0YVNvcnQ7Im51bWJlciI9PT10eXBlb2YgYiYmIWguaXNBcnJheShiKSYmKGEuYURhdGFTb3J0PVtiXSl9ZnVuY3Rpb24gZmIoYSl7aWYoIW0uX19icm93c2VyKXt2YXIgYj17fTttLl9fYnJvd3Nlcj1iO3ZhciBjPWgoIjxkaXYvPiIpLmNzcyh7cG9zaXRpb246ImZpeGVkIix0b3A6MCxsZWZ0Oi0xKmgoRSkuc2Nyb2xsTGVmdCgpLGhlaWdodDoxLHdpZHRoOjEsb3ZlcmZsb3c6ImhpZGRlbiJ9KS5hcHBlbmQoaCgiPGRpdi8+IikuY3NzKHtwb3NpdGlvbjoiYWJzb2x1dGUiLA0KICAgIHRvcDoxLGxlZnQ6MSx3aWR0aDoxMDAsb3ZlcmZsb3c6InNjcm9sbCJ9KS5hcHBlbmQoaCgiPGRpdi8+IikuY3NzKHt3aWR0aDoiMTAwJSIsaGVpZ2h0OjEwfSkpKS5hcHBlbmRUbygiYm9keSIpLGQ9Yy5jaGlsZHJlbigpLGU9ZC5jaGlsZHJlbigpO2IuYmFyV2lkdGg9ZFswXS5vZmZzZXRXaWR0aC1kWzBdLmNsaWVudFdpZHRoO2IuYlNjcm9sbE92ZXJzaXplPTEwMD09PWVbMF0ub2Zmc2V0V2lkdGgmJjEwMCE9PWRbMF0uY2xpZW50V2lkdGg7Yi5iU2Nyb2xsYmFyTGVmdD0xIT09TWF0aC5yb3VuZChlLm9mZnNldCgpLmxlZnQpO2IuYkJvdW5kaW5nPWNbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg/ITA6ITE7Yy5yZW1vdmUoKX1oLmV4dGVuZChhLm9Ccm93c2VyLG0uX19icm93c2VyKTthLm9TY3JvbGwuaUJhcldpZHRoPW0uX19icm93c2VyLmJhcldpZHRofWZ1bmN0aW9uIGdiKGEsYixjLGQsZSxmKXt2YXIgZyxqPSExO2MhPT1rJiYoZz1jLGo9ITApO2Zvcig7ZCE9PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZTspYS5oYXNPd25Qcm9wZXJ0eShkKSYmKGc9aj9iKGcsYVtkXSxkLGEpOmFbZF0saj0hMCxkKz1mKTtyZXR1cm4gZ31mdW5jdGlvbiBEYShhLGIpe3ZhciBjPW0uZGVmYXVsdHMuY29sdW1uLGQ9YS5hb0NvbHVtbnMubGVuZ3RoLGM9aC5leHRlbmQoe30sbS5tb2RlbHMub0NvbHVtbixjLHtuVGg6Yj9iOkcuY3JlYXRlRWxlbWVudCgidGgiKSxzVGl0bGU6Yy5zVGl0bGU/Yy5zVGl0bGU6Yj9iLmlubmVySFRNTDoiIixhRGF0YVNvcnQ6Yy5hRGF0YVNvcnQ/Yy5hRGF0YVNvcnQ6W2RdLG1EYXRhOmMubURhdGE/Yy5tRGF0YTpkLGlkeDpkfSk7YS5hb0NvbHVtbnMucHVzaChjKTtjPWEuYW9QcmVTZWFyY2hDb2xzO2NbZF09aC5leHRlbmQoe30sbS5tb2RlbHMub1NlYXJjaCxjW2RdKTtqYShhLGQsaChiKS5kYXRhKCkpfWZ1bmN0aW9uIGphKGEsYixjKXt2YXIgYj1hLmFvQ29sdW1uc1tiXSxkPWEub0NsYXNzZXMsZT1oKGIublRoKTtpZighYi5zV2lkdGhPcmlnKXtiLnNXaWR0aE9yaWc9DQogICAgZS5hdHRyKCJ3aWR0aCIpfHxudWxsO3ZhciBmPShlLmF0dHIoInN0eWxlIil8fCIiKS5tYXRjaCgvd2lkdGg6XHMqKFxkK1tweGVtJV0rKS8pO2YmJihiLnNXaWR0aE9yaWc9ZlsxXSl9YyE9PWsmJm51bGwhPT1jJiYoZWIoYyksSShtLmRlZmF1bHRzLmNvbHVtbixjKSxjLm1EYXRhUHJvcCE9PWsmJiFjLm1EYXRhJiYoYy5tRGF0YT1jLm1EYXRhUHJvcCksYy5zVHlwZSYmKGIuX3NNYW51YWxUeXBlPWMuc1R5cGUpLGMuY2xhc3NOYW1lJiYhYy5zQ2xhc3MmJihjLnNDbGFzcz1jLmNsYXNzTmFtZSksYy5zQ2xhc3MmJmUuYWRkQ2xhc3MoYy5zQ2xhc3MpLGguZXh0ZW5kKGIsYyksRihiLGMsInNXaWR0aCIsInNXaWR0aE9yaWciKSxjLmlEYXRhU29ydCE9PWsmJihiLmFEYXRhU29ydD1bYy5pRGF0YVNvcnRdKSxGKGIsYywiYURhdGFTb3J0IikpO3ZhciBnPWIubURhdGEsaj1RKGcpLGk9Yi5tUmVuZGVyP1EoYi5tUmVuZGVyKTpudWxsLGM9ZnVuY3Rpb24oYSl7cmV0dXJuInN0cmluZyI9PT0NCiAgICB0eXBlb2YgYSYmLTEhPT1hLmluZGV4T2YoIkAiKX07Yi5fYkF0dHJTcmM9aC5pc1BsYWluT2JqZWN0KGcpJiYoYyhnLnNvcnQpfHxjKGcudHlwZSl8fGMoZy5maWx0ZXIpKTtiLl9zZXR0ZXI9bnVsbDtiLmZuR2V0RGF0YT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9aihhLGIsayxjKTtyZXR1cm4gaSYmYj9pKGQsYixhLGMpOmR9O2IuZm5TZXREYXRhPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gUihnKShhLGIsYyl9OyJudW1iZXIiIT09dHlwZW9mIGcmJihhLl9yb3dSZWFkT2JqZWN0PSEwKTthLm9GZWF0dXJlcy5iU29ydHx8KGIuYlNvcnRhYmxlPSExLGUuYWRkQ2xhc3MoZC5zU29ydGFibGVOb25lKSk7YT0tMSE9PWguaW5BcnJheSgiYXNjIixiLmFzU29ydGluZyk7Yz0tMSE9PWguaW5BcnJheSgiZGVzYyIsYi5hc1NvcnRpbmcpOyFiLmJTb3J0YWJsZXx8IWEmJiFjPyhiLnNTb3J0aW5nQ2xhc3M9ZC5zU29ydGFibGVOb25lLGIuc1NvcnRpbmdDbGFzc0pVST0iIik6YSYmIWM/KGIuc1NvcnRpbmdDbGFzcz0NCiAgICBkLnNTb3J0YWJsZUFzYyxiLnNTb3J0aW5nQ2xhc3NKVUk9ZC5zU29ydEpVSUFzY0FsbG93ZWQpOiFhJiZjPyhiLnNTb3J0aW5nQ2xhc3M9ZC5zU29ydGFibGVEZXNjLGIuc1NvcnRpbmdDbGFzc0pVST1kLnNTb3J0SlVJRGVzY0FsbG93ZWQpOihiLnNTb3J0aW5nQ2xhc3M9ZC5zU29ydGFibGUsYi5zU29ydGluZ0NsYXNzSlVJPWQuc1NvcnRKVUkpfWZ1bmN0aW9uIFkoYSl7aWYoITEhPT1hLm9GZWF0dXJlcy5iQXV0b1dpZHRoKXt2YXIgYj1hLmFvQ29sdW1ucztFYShhKTtmb3IodmFyIGM9MCxkPWIubGVuZ3RoO2M8ZDtjKyspYltjXS5uVGguc3R5bGUud2lkdGg9YltjXS5zV2lkdGh9Yj1hLm9TY3JvbGw7KCIiIT09Yi5zWXx8IiIhPT1iLnNYKSYma2EoYSk7cihhLG51bGwsImNvbHVtbi1zaXppbmciLFthXSl9ZnVuY3Rpb24gWihhLGIpe3ZhciBjPWxhKGEsImJWaXNpYmxlIik7cmV0dXJuIm51bWJlciI9PT10eXBlb2YgY1tiXT9jW2JdOm51bGx9ZnVuY3Rpb24gJChhLGIpe3ZhciBjPQ0KICAgIGxhKGEsImJWaXNpYmxlIiksYz1oLmluQXJyYXkoYixjKTtyZXR1cm4tMSE9PWM/YzpudWxsfWZ1bmN0aW9uIGFhKGEpe3ZhciBiPTA7aC5lYWNoKGEuYW9Db2x1bW5zLGZ1bmN0aW9uKGEsZCl7ZC5iVmlzaWJsZSYmIm5vbmUiIT09aChkLm5UaCkuY3NzKCJkaXNwbGF5IikmJmIrK30pO3JldHVybiBifWZ1bmN0aW9uIGxhKGEsYil7dmFyIGM9W107aC5tYXAoYS5hb0NvbHVtbnMsZnVuY3Rpb24oYSxlKXthW2JdJiZjLnB1c2goZSl9KTtyZXR1cm4gY31mdW5jdGlvbiBGYShhKXt2YXIgYj1hLmFvQ29sdW1ucyxjPWEuYW9EYXRhLGQ9bS5leHQudHlwZS5kZXRlY3QsZSxmLGcsaixpLGgsbCxxLHQ7ZT0wO2ZvcihmPWIubGVuZ3RoO2U8ZjtlKyspaWYobD1iW2VdLHQ9W10sIWwuc1R5cGUmJmwuX3NNYW51YWxUeXBlKWwuc1R5cGU9bC5fc01hbnVhbFR5cGU7ZWxzZSBpZighbC5zVHlwZSl7Zz0wO2ZvcihqPWQubGVuZ3RoO2c8ajtnKyspe2k9MDtmb3IoaD1jLmxlbmd0aDtpPGg7aSsrKXt0W2ldPT09DQprJiYodFtpXT1CKGEsaSxlLCJ0eXBlIikpO3E9ZFtnXSh0W2ldLGEpO2lmKCFxJiZnIT09ZC5sZW5ndGgtMSlicmVhaztpZigiaHRtbCI9PT1xKWJyZWFrfWlmKHEpe2wuc1R5cGU9cTticmVha319bC5zVHlwZXx8KGwuc1R5cGU9InN0cmluZyIpfX1mdW5jdGlvbiBoYihhLGIsYyxkKXt2YXIgZSxmLGcsaixpLG4sbD1hLmFvQ29sdW1ucztpZihiKWZvcihlPWIubGVuZ3RoLTE7MDw9ZTtlLS0pe249YltlXTt2YXIgcT1uLnRhcmdldHMhPT1rP24udGFyZ2V0czpuLmFUYXJnZXRzO2guaXNBcnJheShxKXx8KHE9W3FdKTtmPTA7Zm9yKGc9cS5sZW5ndGg7ZjxnO2YrKylpZigibnVtYmVyIj09PXR5cGVvZiBxW2ZdJiYwPD1xW2ZdKXtmb3IoO2wubGVuZ3RoPD1xW2ZdOylEYShhKTtkKHFbZl0sbil9ZWxzZSBpZigibnVtYmVyIj09PXR5cGVvZiBxW2ZdJiYwPnFbZl0pZChsLmxlbmd0aCtxW2ZdLG4pO2Vsc2UgaWYoInN0cmluZyI9PT10eXBlb2YgcVtmXSl7aj0wO2ZvcihpPWwubGVuZ3RoO2o8DQppO2orKykoIl9hbGwiPT1xW2ZdfHxoKGxbal0ublRoKS5oYXNDbGFzcyhxW2ZdKSkmJmQoaixuKX19aWYoYyl7ZT0wO2ZvcihhPWMubGVuZ3RoO2U8YTtlKyspZChlLGNbZV0pfX1mdW5jdGlvbiBNKGEsYixjLGQpe3ZhciBlPWEuYW9EYXRhLmxlbmd0aCxmPWguZXh0ZW5kKCEwLHt9LG0ubW9kZWxzLm9Sb3cse3NyYzpjPyJkb20iOiJkYXRhIixpZHg6ZX0pO2YuX2FEYXRhPWI7YS5hb0RhdGEucHVzaChmKTtmb3IodmFyIGc9YS5hb0NvbHVtbnMsaj0wLGk9Zy5sZW5ndGg7ajxpO2orKylnW2pdLnNUeXBlPW51bGw7YS5haURpc3BsYXlNYXN0ZXIucHVzaChlKTtiPWEucm93SWRGbihiKTtiIT09ayYmKGEuYUlkc1tiXT1mKTsoY3x8IWEub0ZlYXR1cmVzLmJEZWZlclJlbmRlcikmJkdhKGEsZSxjLGQpO3JldHVybiBlfWZ1bmN0aW9uIG1hKGEsYil7dmFyIGM7YiBpbnN0YW5jZW9mIGh8fChiPWgoYikpO3JldHVybiBiLm1hcChmdW5jdGlvbihiLGUpe2M9SGEoYSxlKTtyZXR1cm4gTShhLA0KICAgIGMuZGF0YSxlLGMuY2VsbHMpfSl9ZnVuY3Rpb24gQihhLGIsYyxkKXt2YXIgZT1hLmlEcmF3LGY9YS5hb0NvbHVtbnNbY10sZz1hLmFvRGF0YVtiXS5fYURhdGEsaj1mLnNEZWZhdWx0Q29udGVudCxpPWYuZm5HZXREYXRhKGcsZCx7c2V0dGluZ3M6YSxyb3c6Yixjb2w6Y30pO2lmKGk9PT1rKXJldHVybiBhLmlEcmF3RXJyb3IhPWUmJm51bGw9PT1qJiYoSihhLDAsIlJlcXVlc3RlZCB1bmtub3duIHBhcmFtZXRlciAiKygiZnVuY3Rpb24iPT10eXBlb2YgZi5tRGF0YT8ie2Z1bmN0aW9ufSI6IiciK2YubURhdGErIiciKSsiIGZvciByb3cgIitiKyIsIGNvbHVtbiAiK2MsNCksYS5pRHJhd0Vycm9yPWUpLGo7aWYoKGk9PT1nfHxudWxsPT09aSkmJm51bGwhPT1qJiZkIT09aylpPWo7ZWxzZSBpZigiZnVuY3Rpb24iPT09dHlwZW9mIGkpcmV0dXJuIGkuY2FsbChnKTtyZXR1cm4gbnVsbD09PWkmJiJkaXNwbGF5Ij09ZD8iIjppfWZ1bmN0aW9uIGliKGEsYixjLGQpe2EuYW9Db2x1bW5zW2NdLmZuU2V0RGF0YShhLmFvRGF0YVtiXS5fYURhdGEsDQogICAgZCx7c2V0dGluZ3M6YSxyb3c6Yixjb2w6Y30pfWZ1bmN0aW9uIElhKGEpe3JldHVybiBoLm1hcChhLm1hdGNoKC8oXFwufFteXC5dKSsvZyl8fFsiIl0sZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvXFxcLi9nLCIuIil9KX1mdW5jdGlvbiBRKGEpe2lmKGguaXNQbGFpbk9iamVjdChhKSl7dmFyIGI9e307aC5lYWNoKGEsZnVuY3Rpb24oYSxjKXtjJiYoYlthXT1RKGMpKX0pO3JldHVybiBmdW5jdGlvbihhLGMsZixnKXt2YXIgaj1iW2NdfHxiLl87cmV0dXJuIGohPT1rP2ooYSxjLGYsZyk6YX19aWYobnVsbD09PWEpcmV0dXJuIGZ1bmN0aW9uKGEpe3JldHVybiBhfTtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGEpcmV0dXJuIGZ1bmN0aW9uKGIsYyxmLGcpe3JldHVybiBhKGIsYyxmLGcpfTtpZigic3RyaW5nIj09PXR5cGVvZiBhJiYoLTEhPT1hLmluZGV4T2YoIi4iKXx8LTEhPT1hLmluZGV4T2YoIlsiKXx8LTEhPT1hLmluZGV4T2YoIigiKSkpe3ZhciBjPWZ1bmN0aW9uKGEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIsZil7dmFyIGcsajtpZigiIiE9PWYpe2o9SWEoZik7Zm9yKHZhciBpPTAsbj1qLmxlbmd0aDtpPG47aSsrKXtmPWpbaV0ubWF0Y2goYmEpO2c9altpXS5tYXRjaChVKTtpZihmKXtqW2ldPWpbaV0ucmVwbGFjZShiYSwiIik7IiIhPT1qW2ldJiYoYT1hW2pbaV1dKTtnPVtdO2ouc3BsaWNlKDAsaSsxKTtqPWouam9pbigiLiIpO2lmKGguaXNBcnJheShhKSl7aT0wO2ZvcihuPWEubGVuZ3RoO2k8bjtpKyspZy5wdXNoKGMoYVtpXSxiLGopKX1hPWZbMF0uc3Vic3RyaW5nKDEsZlswXS5sZW5ndGgtMSk7YT0iIj09PWE/ZzpnLmpvaW4oYSk7YnJlYWt9ZWxzZSBpZihnKXtqW2ldPWpbaV0ucmVwbGFjZShVLCIiKTthPWFbaltpXV0oKTtjb250aW51ZX1pZihudWxsPT09YXx8YVtqW2ldXT09PWspcmV0dXJuIGs7YT1hW2pbaV1dfX1yZXR1cm4gYX07cmV0dXJuIGZ1bmN0aW9uKGIsZSl7cmV0dXJuIGMoYixlLGEpfX1yZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuIGJbYV19fWZ1bmN0aW9uIFIoYSl7aWYoaC5pc1BsYWluT2JqZWN0KGEpKXJldHVybiBSKGEuXyk7DQogICAgaWYobnVsbD09PWEpcmV0dXJuIGZ1bmN0aW9uKCl7fTtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGEpcmV0dXJuIGZ1bmN0aW9uKGIsZCxlKXthKGIsInNldCIsZCxlKX07aWYoInN0cmluZyI9PT10eXBlb2YgYSYmKC0xIT09YS5pbmRleE9mKCIuIil8fC0xIT09YS5pbmRleE9mKCJbIil8fC0xIT09YS5pbmRleE9mKCIoIikpKXt2YXIgYj1mdW5jdGlvbihhLGQsZSl7dmFyIGU9SWEoZSksZjtmPWVbZS5sZW5ndGgtMV07Zm9yKHZhciBnLGosaT0wLG49ZS5sZW5ndGgtMTtpPG47aSsrKXtnPWVbaV0ubWF0Y2goYmEpO2o9ZVtpXS5tYXRjaChVKTtpZihnKXtlW2ldPWVbaV0ucmVwbGFjZShiYSwiIik7YVtlW2ldXT1bXTtmPWUuc2xpY2UoKTtmLnNwbGljZSgwLGkrMSk7Zz1mLmpvaW4oIi4iKTtpZihoLmlzQXJyYXkoZCkpe2o9MDtmb3Iobj1kLmxlbmd0aDtqPG47aisrKWY9e30sYihmLGRbal0sZyksYVtlW2ldXS5wdXNoKGYpfWVsc2UgYVtlW2ldXT1kO3JldHVybn1qJiYoZVtpXT1lW2ldLnJlcGxhY2UoVSwNCiAgICAgICAgIiIpLGE9YVtlW2ldXShkKSk7aWYobnVsbD09PWFbZVtpXV18fGFbZVtpXV09PT1rKWFbZVtpXV09e307YT1hW2VbaV1dfWlmKGYubWF0Y2goVSkpYVtmLnJlcGxhY2UoVSwiIildKGQpO2Vsc2UgYVtmLnJlcGxhY2UoYmEsIiIpXT1kfTtyZXR1cm4gZnVuY3Rpb24oYyxkKXtyZXR1cm4gYihjLGQsYSl9fXJldHVybiBmdW5jdGlvbihiLGQpe2JbYV09ZH19ZnVuY3Rpb24gSmEoYSl7cmV0dXJuIEQoYS5hb0RhdGEsIl9hRGF0YSIpfWZ1bmN0aW9uIG5hKGEpe2EuYW9EYXRhLmxlbmd0aD0wO2EuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aD0wO2EuYWlEaXNwbGF5Lmxlbmd0aD0wO2EuYUlkcz17fX1mdW5jdGlvbiBvYShhLGIsYyl7Zm9yKHZhciBkPS0xLGU9MCxmPWEubGVuZ3RoO2U8ZjtlKyspYVtlXT09Yj9kPWU6YVtlXT5iJiZhW2VdLS07IC0xIT1kJiZjPT09ayYmYS5zcGxpY2UoZCwxKX1mdW5jdGlvbiBjYShhLGIsYyxkKXt2YXIgZT1hLmFvRGF0YVtiXSxmLGc9ZnVuY3Rpb24oYyxkKXtmb3IoO2MuY2hpbGROb2Rlcy5sZW5ndGg7KWMucmVtb3ZlQ2hpbGQoYy5maXJzdENoaWxkKTsNCiAgICBjLmlubmVySFRNTD1CKGEsYixkLCJkaXNwbGF5Iil9O2lmKCJkb20iPT09Y3x8KCFjfHwiYXV0byI9PT1jKSYmImRvbSI9PT1lLnNyYyllLl9hRGF0YT1IYShhLGUsZCxkPT09az9rOmUuX2FEYXRhKS5kYXRhO2Vsc2V7dmFyIGo9ZS5hbkNlbGxzO2lmKGopaWYoZCE9PWspZyhqW2RdLGQpO2Vsc2V7Yz0wO2ZvcihmPWoubGVuZ3RoO2M8ZjtjKyspZyhqW2NdLGMpfX1lLl9hU29ydERhdGE9bnVsbDtlLl9hRmlsdGVyRGF0YT1udWxsO2c9YS5hb0NvbHVtbnM7aWYoZCE9PWspZ1tkXS5zVHlwZT1udWxsO2Vsc2V7Yz0wO2ZvcihmPWcubGVuZ3RoO2M8ZjtjKyspZ1tjXS5zVHlwZT1udWxsO0thKGEsZSl9fWZ1bmN0aW9uIEhhKGEsYixjLGQpe3ZhciBlPVtdLGY9Yi5maXJzdENoaWxkLGcsaixpPTAsbixsPWEuYW9Db2x1bW5zLHE9YS5fcm93UmVhZE9iamVjdCxkPWQhPT1rP2Q6cT97fTpbXSx0PWZ1bmN0aW9uKGEsYil7aWYoInN0cmluZyI9PT10eXBlb2YgYSl7dmFyIGM9YS5pbmRleE9mKCJAIik7DQogICAgLTEhPT1jJiYoYz1hLnN1YnN0cmluZyhjKzEpLFIoYSkoZCxiLmdldEF0dHJpYnV0ZShjKSkpfX0sbT1mdW5jdGlvbihhKXtpZihjPT09a3x8Yz09PWkpaj1sW2ldLG49aC50cmltKGEuaW5uZXJIVE1MKSxqJiZqLl9iQXR0clNyYz8oUihqLm1EYXRhLl8pKGQsbiksdChqLm1EYXRhLnNvcnQsYSksdChqLm1EYXRhLnR5cGUsYSksdChqLm1EYXRhLmZpbHRlcixhKSk6cT8oai5fc2V0dGVyfHwoai5fc2V0dGVyPVIoai5tRGF0YSkpLGouX3NldHRlcihkLG4pKTpkW2ldPW47aSsrfTtpZihmKWZvcig7Zjspe2c9Zi5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpO2lmKCJURCI9PWd8fCJUSCI9PWcpbShmKSxlLnB1c2goZik7Zj1mLm5leHRTaWJsaW5nfWVsc2V7ZT1iLmFuQ2VsbHM7Zj0wO2ZvcihnPWUubGVuZ3RoO2Y8ZztmKyspbShlW2ZdKX1pZihiPWIuZmlyc3RDaGlsZD9iOmIublRyKShiPWIuZ2V0QXR0cmlidXRlKCJpZCIpKSYmUihhLnJvd0lkKShkLGIpO3JldHVybntkYXRhOmQsY2VsbHM6ZX19DQogICAgZnVuY3Rpb24gR2EoYSxiLGMsZCl7dmFyIGU9YS5hb0RhdGFbYl0sZj1lLl9hRGF0YSxnPVtdLGosaSxuLGwscTtpZihudWxsPT09ZS5uVHIpe2o9Y3x8Ry5jcmVhdGVFbGVtZW50KCJ0ciIpO2UublRyPWo7ZS5hbkNlbGxzPWc7ai5fRFRfUm93SW5kZXg9YjtLYShhLGUpO2w9MDtmb3IocT1hLmFvQ29sdW1ucy5sZW5ndGg7bDxxO2wrKyl7bj1hLmFvQ29sdW1uc1tsXTtpPWM/ZFtsXTpHLmNyZWF0ZUVsZW1lbnQobi5zQ2VsbFR5cGUpO2kuX0RUX0NlbGxJbmRleD17cm93OmIsY29sdW1uOmx9O2cucHVzaChpKTtpZigoIWN8fG4ubVJlbmRlcnx8bi5tRGF0YSE9PWwpJiYoIWguaXNQbGFpbk9iamVjdChuLm1EYXRhKXx8bi5tRGF0YS5fIT09bCsiLmRpc3BsYXkiKSlpLmlubmVySFRNTD1CKGEsYixsLCJkaXNwbGF5Iik7bi5zQ2xhc3MmJihpLmNsYXNzTmFtZSs9IiAiK24uc0NsYXNzKTtuLmJWaXNpYmxlJiYhYz9qLmFwcGVuZENoaWxkKGkpOiFuLmJWaXNpYmxlJiZjJiZpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaSk7DQogICAgICAgIG4uZm5DcmVhdGVkQ2VsbCYmbi5mbkNyZWF0ZWRDZWxsLmNhbGwoYS5vSW5zdGFuY2UsaSxCKGEsYixsKSxmLGIsbCl9cihhLCJhb1Jvd0NyZWF0ZWRDYWxsYmFjayIsbnVsbCxbaixmLGJdKX1lLm5Uci5zZXRBdHRyaWJ1dGUoInJvbGUiLCJyb3ciKX1mdW5jdGlvbiBLYShhLGIpe3ZhciBjPWIublRyLGQ9Yi5fYURhdGE7aWYoYyl7dmFyIGU9YS5yb3dJZEZuKGQpO2UmJihjLmlkPWUpO2QuRFRfUm93Q2xhc3MmJihlPWQuRFRfUm93Q2xhc3Muc3BsaXQoIiAiKSxiLl9fcm93Yz1iLl9fcm93Yz9xYShiLl9fcm93Yy5jb25jYXQoZSkpOmUsaChjKS5yZW1vdmVDbGFzcyhiLl9fcm93Yy5qb2luKCIgIikpLmFkZENsYXNzKGQuRFRfUm93Q2xhc3MpKTtkLkRUX1Jvd0F0dHImJmgoYykuYXR0cihkLkRUX1Jvd0F0dHIpO2QuRFRfUm93RGF0YSYmaChjKS5kYXRhKGQuRFRfUm93RGF0YSl9fWZ1bmN0aW9uIGpiKGEpe3ZhciBiLGMsZCxlLGYsZz1hLm5USGVhZCxqPWEublRGb290LGk9MD09PQ0KICAgICAgICBoKCJ0aCwgdGQiLGcpLmxlbmd0aCxuPWEub0NsYXNzZXMsbD1hLmFvQ29sdW1ucztpJiYoZT1oKCI8dHIvPiIpLmFwcGVuZFRvKGcpKTtiPTA7Zm9yKGM9bC5sZW5ndGg7YjxjO2IrKylmPWxbYl0sZD1oKGYublRoKS5hZGRDbGFzcyhmLnNDbGFzcyksaSYmZC5hcHBlbmRUbyhlKSxhLm9GZWF0dXJlcy5iU29ydCYmKGQuYWRkQ2xhc3MoZi5zU29ydGluZ0NsYXNzKSwhMSE9PWYuYlNvcnRhYmxlJiYoZC5hdHRyKCJ0YWJpbmRleCIsYS5pVGFiSW5kZXgpLmF0dHIoImFyaWEtY29udHJvbHMiLGEuc1RhYmxlSWQpLExhKGEsZi5uVGgsYikpKSxmLnNUaXRsZSE9ZFswXS5pbm5lckhUTUwmJmQuaHRtbChmLnNUaXRsZSksTWEoYSwiaGVhZGVyIikoYSxkLGYsbik7aSYmZGEoYS5hb0hlYWRlcixnKTtoKGcpLmZpbmQoIj50ciIpLmF0dHIoInJvbGUiLCJyb3ciKTtoKGcpLmZpbmQoIj50cj50aCwgPnRyPnRkIikuYWRkQ2xhc3Mobi5zSGVhZGVyVEgpO2goaikuZmluZCgiPnRyPnRoLCA+dHI+dGQiKS5hZGRDbGFzcyhuLnNGb290ZXJUSCk7DQogICAgICAgIGlmKG51bGwhPT1qKXthPWEuYW9Gb290ZXJbMF07Yj0wO2ZvcihjPWEubGVuZ3RoO2I8YztiKyspZj1sW2JdLGYublRmPWFbYl0uY2VsbCxmLnNDbGFzcyYmaChmLm5UZikuYWRkQ2xhc3MoZi5zQ2xhc3MpfX1mdW5jdGlvbiBlYShhLGIsYyl7dmFyIGQsZSxmLGc9W10saj1bXSxpPWEuYW9Db2x1bW5zLmxlbmd0aCxuO2lmKGIpe2M9PT1rJiYoYz0hMSk7ZD0wO2ZvcihlPWIubGVuZ3RoO2Q8ZTtkKyspe2dbZF09YltkXS5zbGljZSgpO2dbZF0ublRyPWJbZF0ublRyO2ZvcihmPWktMTswPD1mO2YtLSkhYS5hb0NvbHVtbnNbZl0uYlZpc2libGUmJiFjJiZnW2RdLnNwbGljZShmLDEpO2oucHVzaChbXSl9ZD0wO2ZvcihlPWcubGVuZ3RoO2Q8ZTtkKyspe2lmKGE9Z1tkXS5uVHIpZm9yKDtmPWEuZmlyc3RDaGlsZDspYS5yZW1vdmVDaGlsZChmKTtmPTA7Zm9yKGI9Z1tkXS5sZW5ndGg7ZjxiO2YrKylpZihuPWk9MSxqW2RdW2ZdPT09ayl7YS5hcHBlbmRDaGlsZChnW2RdW2ZdLmNlbGwpOw0KICAgICAgICBmb3IoaltkXVtmXT0xO2dbZCtpXSE9PWsmJmdbZF1bZl0uY2VsbD09Z1tkK2ldW2ZdLmNlbGw7KWpbZCtpXVtmXT0xLGkrKztmb3IoO2dbZF1bZituXSE9PWsmJmdbZF1bZl0uY2VsbD09Z1tkXVtmK25dLmNlbGw7KXtmb3IoYz0wO2M8aTtjKyspaltkK2NdW2Yrbl09MTtuKyt9aChnW2RdW2ZdLmNlbGwpLmF0dHIoInJvd3NwYW4iLGkpLmF0dHIoImNvbHNwYW4iLG4pfX19fWZ1bmN0aW9uIE4oYSl7dmFyIGI9cihhLCJhb1ByZURyYXdDYWxsYmFjayIsInByZURyYXciLFthXSk7aWYoLTEhPT1oLmluQXJyYXkoITEsYikpQyhhLCExKTtlbHNle3ZhciBiPVtdLGM9MCxkPWEuYXNTdHJpcGVDbGFzc2VzLGU9ZC5sZW5ndGgsZj1hLm9MYW5ndWFnZSxnPWEuaUluaXREaXNwbGF5U3RhcnQsaj0ic3NwIj09eShhKSxpPWEuYWlEaXNwbGF5O2EuYkRyYXdpbmc9ITA7ZyE9PWsmJi0xIT09ZyYmKGEuX2lEaXNwbGF5U3RhcnQ9aj9nOmc+PWEuZm5SZWNvcmRzRGlzcGxheSgpPzA6ZyxhLmlJbml0RGlzcGxheVN0YXJ0PQ0KICAgICAgICAtMSk7dmFyIGc9YS5faURpc3BsYXlTdGFydCxuPWEuZm5EaXNwbGF5RW5kKCk7aWYoYS5iRGVmZXJMb2FkaW5nKWEuYkRlZmVyTG9hZGluZz0hMSxhLmlEcmF3KyssQyhhLCExKTtlbHNlIGlmKGope2lmKCFhLmJEZXN0cm95aW5nJiYha2IoYSkpcmV0dXJufWVsc2UgYS5pRHJhdysrO2lmKDAhPT1pLmxlbmd0aCl7Zj1qP2EuYW9EYXRhLmxlbmd0aDpuO2ZvcihqPWo/MDpnO2o8ZjtqKyspe3ZhciBsPWlbal0scT1hLmFvRGF0YVtsXTtudWxsPT09cS5uVHImJkdhKGEsbCk7bD1xLm5UcjtpZigwIT09ZSl7dmFyIHQ9ZFtjJWVdO3EuX3NSb3dTdHJpcGUhPXQmJihoKGwpLnJlbW92ZUNsYXNzKHEuX3NSb3dTdHJpcGUpLmFkZENsYXNzKHQpLHEuX3NSb3dTdHJpcGU9dCl9cihhLCJhb1Jvd0NhbGxiYWNrIixudWxsLFtsLHEuX2FEYXRhLGMsal0pO2IucHVzaChsKTtjKyt9fWVsc2UgYz1mLnNaZXJvUmVjb3JkcywxPT1hLmlEcmF3JiYiYWpheCI9PXkoYSk/Yz1mLnNMb2FkaW5nUmVjb3JkczoNCiAgICAgICAgZi5zRW1wdHlUYWJsZSYmMD09PWEuZm5SZWNvcmRzVG90YWwoKSYmKGM9Zi5zRW1wdHlUYWJsZSksYlswXT1oKCI8dHIvPiIseyJjbGFzcyI6ZT9kWzBdOiIifSkuYXBwZW5kKGgoIjx0ZCAvPiIse3ZhbGlnbjoidG9wIixjb2xTcGFuOmFhKGEpLCJjbGFzcyI6YS5vQ2xhc3Nlcy5zUm93RW1wdHl9KS5odG1sKGMpKVswXTtyKGEsImFvSGVhZGVyQ2FsbGJhY2siLCJoZWFkZXIiLFtoKGEublRIZWFkKS5jaGlsZHJlbigidHIiKVswXSxKYShhKSxnLG4saV0pO3IoYSwiYW9Gb290ZXJDYWxsYmFjayIsImZvb3RlciIsW2goYS5uVEZvb3QpLmNoaWxkcmVuKCJ0ciIpWzBdLEphKGEpLGcsbixpXSk7ZD1oKGEublRCb2R5KTtkLmNoaWxkcmVuKCkuZGV0YWNoKCk7ZC5hcHBlbmQoaChiKSk7cihhLCJhb0RyYXdDYWxsYmFjayIsImRyYXciLFthXSk7YS5iU29ydGVkPSExO2EuYkZpbHRlcmVkPSExO2EuYkRyYXdpbmc9ITF9fWZ1bmN0aW9uIFMoYSxiKXt2YXIgYz1hLm9GZWF0dXJlcyxkPWMuYkZpbHRlcjsNCiAgICAgICAgYy5iU29ydCYmbGIoYSk7ZD9mYShhLGEub1ByZXZpb3VzU2VhcmNoKTphLmFpRGlzcGxheT1hLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOyEwIT09YiYmKGEuX2lEaXNwbGF5U3RhcnQ9MCk7YS5fZHJhd0hvbGQ9YjtOKGEpO2EuX2RyYXdIb2xkPSExfWZ1bmN0aW9uIG1iKGEpe3ZhciBiPWEub0NsYXNzZXMsYz1oKGEublRhYmxlKSxjPWgoIjxkaXYvPiIpLmluc2VydEJlZm9yZShjKSxkPWEub0ZlYXR1cmVzLGU9aCgiPGRpdi8+Iix7aWQ6YS5zVGFibGVJZCsiX3dyYXBwZXIiLCJjbGFzcyI6Yi5zV3JhcHBlcisoYS5uVEZvb3Q/IiI6IiAiK2Iuc05vRm9vdGVyKX0pO2EubkhvbGRpbmc9Y1swXTthLm5UYWJsZVdyYXBwZXI9ZVswXTthLm5UYWJsZVJlaW5zZXJ0QmVmb3JlPWEublRhYmxlLm5leHRTaWJsaW5nO2Zvcih2YXIgZj1hLnNEb20uc3BsaXQoIiIpLGcsaixpLG4sbCxxLGs9MDtrPGYubGVuZ3RoO2srKyl7Zz1udWxsO2o9ZltrXTtpZigiPCI9PWope2k9aCgiPGRpdi8+IilbMF07DQogICAgICAgIG49ZltrKzFdO2lmKCInIj09bnx8JyInPT1uKXtsPSIiO2ZvcihxPTI7ZltrK3FdIT1uOylsKz1mW2srcV0scSsrOyJIIj09bD9sPWIuc0pVSUhlYWRlcjoiRiI9PWwmJihsPWIuc0pVSUZvb3Rlcik7LTEhPWwuaW5kZXhPZigiLiIpPyhuPWwuc3BsaXQoIi4iKSxpLmlkPW5bMF0uc3Vic3RyKDEsblswXS5sZW5ndGgtMSksaS5jbGFzc05hbWU9blsxXSk6IiMiPT1sLmNoYXJBdCgwKT9pLmlkPWwuc3Vic3RyKDEsbC5sZW5ndGgtMSk6aS5jbGFzc05hbWU9bDtrKz1xfWUuYXBwZW5kKGkpO2U9aChpKX1lbHNlIGlmKCI+Ij09aillPWUucGFyZW50KCk7ZWxzZSBpZigibCI9PWomJmQuYlBhZ2luYXRlJiZkLmJMZW5ndGhDaGFuZ2UpZz1uYihhKTtlbHNlIGlmKCJmIj09aiYmZC5iRmlsdGVyKWc9b2IoYSk7ZWxzZSBpZigiciI9PWomJmQuYlByb2Nlc3NpbmcpZz1wYihhKTtlbHNlIGlmKCJ0Ij09ailnPXFiKGEpO2Vsc2UgaWYoImkiPT1qJiZkLmJJbmZvKWc9cmIoYSk7ZWxzZSBpZigicCI9PQ0KICAgICAgICBqJiZkLmJQYWdpbmF0ZSlnPXNiKGEpO2Vsc2UgaWYoMCE9PW0uZXh0LmZlYXR1cmUubGVuZ3RoKXtpPW0uZXh0LmZlYXR1cmU7cT0wO2ZvcihuPWkubGVuZ3RoO3E8bjtxKyspaWYoaj09aVtxXS5jRmVhdHVyZSl7Zz1pW3FdLmZuSW5pdChhKTticmVha319ZyYmKGk9YS5hYW5GZWF0dXJlcyxpW2pdfHwoaVtqXT1bXSksaVtqXS5wdXNoKGcpLGUuYXBwZW5kKGcpKX1jLnJlcGxhY2VXaXRoKGUpO2EubkhvbGRpbmc9bnVsbH1mdW5jdGlvbiBkYShhLGIpe3ZhciBjPWgoYikuY2hpbGRyZW4oInRyIiksZCxlLGYsZyxqLGksbixsLHEsazthLnNwbGljZSgwLGEubGVuZ3RoKTtmPTA7Zm9yKGk9Yy5sZW5ndGg7ZjxpO2YrKylhLnB1c2goW10pO2Y9MDtmb3IoaT1jLmxlbmd0aDtmPGk7ZisrKXtkPWNbZl07Zm9yKGU9ZC5maXJzdENoaWxkO2U7KXtpZigiVEQiPT1lLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCl8fCJUSCI9PWUubm9kZU5hbWUudG9VcHBlckNhc2UoKSl7bD0xKmUuZ2V0QXR0cmlidXRlKCJjb2xzcGFuIik7DQogICAgICAgIHE9MSplLmdldEF0dHJpYnV0ZSgicm93c3BhbiIpO2w9IWx8fDA9PT1sfHwxPT09bD8xOmw7cT0hcXx8MD09PXF8fDE9PT1xPzE6cTtnPTA7Zm9yKGo9YVtmXTtqW2ddOylnKys7bj1nO2s9MT09PWw/ITA6ITE7Zm9yKGo9MDtqPGw7aisrKWZvcihnPTA7ZzxxO2crKylhW2YrZ11bbitqXT17Y2VsbDplLHVuaXF1ZTprfSxhW2YrZ10ublRyPWR9ZT1lLm5leHRTaWJsaW5nfX19ZnVuY3Rpb24gcmEoYSxiLGMpe3ZhciBkPVtdO2N8fChjPWEuYW9IZWFkZXIsYiYmKGM9W10sZGEoYyxiKSkpO2Zvcih2YXIgYj0wLGU9Yy5sZW5ndGg7YjxlO2IrKylmb3IodmFyIGY9MCxnPWNbYl0ubGVuZ3RoO2Y8ZztmKyspaWYoY1tiXVtmXS51bmlxdWUmJighZFtmXXx8IWEuYlNvcnRDZWxsc1RvcCkpZFtmXT1jW2JdW2ZdLmNlbGw7cmV0dXJuIGR9ZnVuY3Rpb24gc2EoYSxiLGMpe3IoYSwiYW9TZXJ2ZXJQYXJhbXMiLCJzZXJ2ZXJQYXJhbXMiLFtiXSk7aWYoYiYmaC5pc0FycmF5KGIpKXt2YXIgZD17fSwNCiAgICAgICAgZT0vKC4qPylcW1xdJC87aC5lYWNoKGIsZnVuY3Rpb24oYSxiKXt2YXIgYz1iLm5hbWUubWF0Y2goZSk7Yz8oYz1jWzBdLGRbY118fChkW2NdPVtdKSxkW2NdLnB1c2goYi52YWx1ZSkpOmRbYi5uYW1lXT1iLnZhbHVlfSk7Yj1kfXZhciBmLGc9YS5hamF4LGo9YS5vSW5zdGFuY2UsaT1mdW5jdGlvbihiKXtyKGEsbnVsbCwieGhyIixbYSxiLGEuanFYSFJdKTtjKGIpfTtpZihoLmlzUGxhaW5PYmplY3QoZykmJmcuZGF0YSl7Zj1nLmRhdGE7dmFyIG49aC5pc0Z1bmN0aW9uKGYpP2YoYixhKTpmLGI9aC5pc0Z1bmN0aW9uKGYpJiZuP246aC5leHRlbmQoITAsYixuKTtkZWxldGUgZy5kYXRhfW49e2RhdGE6YixzdWNjZXNzOmZ1bmN0aW9uKGIpe3ZhciBjPWIuZXJyb3J8fGIuc0Vycm9yO2MmJkooYSwwLGMpO2EuanNvbj1iO2koYil9LGRhdGFUeXBlOiJqc29uIixjYWNoZTohMSx0eXBlOmEuc1NlcnZlck1ldGhvZCxlcnJvcjpmdW5jdGlvbihiLGMpe3ZhciBkPXIoYSxudWxsLCJ4aHIiLA0KICAgICAgICBbYSxudWxsLGEuanFYSFJdKTstMT09PWguaW5BcnJheSghMCxkKSYmKCJwYXJzZXJlcnJvciI9PWM/SihhLDAsIkludmFsaWQgSlNPTiByZXNwb25zZSIsMSk6ND09PWIucmVhZHlTdGF0ZSYmSihhLDAsIkFqYXggZXJyb3IiLDcpKTtDKGEsITEpfX07YS5vQWpheERhdGE9YjtyKGEsbnVsbCwicHJlWGhyIixbYSxiXSk7YS5mblNlcnZlckRhdGE/YS5mblNlcnZlckRhdGEuY2FsbChqLGEuc0FqYXhTb3VyY2UsaC5tYXAoYixmdW5jdGlvbihhLGIpe3JldHVybntuYW1lOmIsdmFsdWU6YX19KSxpLGEpOmEuc0FqYXhTb3VyY2V8fCJzdHJpbmciPT09dHlwZW9mIGc/YS5qcVhIUj1oLmFqYXgoaC5leHRlbmQobix7dXJsOmd8fGEuc0FqYXhTb3VyY2V9KSk6aC5pc0Z1bmN0aW9uKGcpP2EuanFYSFI9Zy5jYWxsKGosYixpLGEpOihhLmpxWEhSPWguYWpheChoLmV4dGVuZChuLGcpKSxnLmRhdGE9Zil9ZnVuY3Rpb24ga2IoYSl7cmV0dXJuIGEuYkFqYXhEYXRhR2V0PyhhLmlEcmF3KyssQyhhLA0KICAgICAgICAhMCksc2EoYSx0YihhKSxmdW5jdGlvbihiKXt1YihhLGIpfSksITEpOiEwfWZ1bmN0aW9uIHRiKGEpe3ZhciBiPWEuYW9Db2x1bW5zLGM9Yi5sZW5ndGgsZD1hLm9GZWF0dXJlcyxlPWEub1ByZXZpb3VzU2VhcmNoLGY9YS5hb1ByZVNlYXJjaENvbHMsZyxqPVtdLGksbixsLGs9VihhKTtnPWEuX2lEaXNwbGF5U3RhcnQ7aT0hMSE9PWQuYlBhZ2luYXRlP2EuX2lEaXNwbGF5TGVuZ3RoOi0xO3ZhciB0PWZ1bmN0aW9uKGEsYil7ai5wdXNoKHtuYW1lOmEsdmFsdWU6Yn0pfTt0KCJzRWNobyIsYS5pRHJhdyk7dCgiaUNvbHVtbnMiLGMpO3QoInNDb2x1bW5zIixEKGIsInNOYW1lIikuam9pbigiLCIpKTt0KCJpRGlzcGxheVN0YXJ0IixnKTt0KCJpRGlzcGxheUxlbmd0aCIsaSk7dmFyIHBhPXtkcmF3OmEuaURyYXcsY29sdW1uczpbXSxvcmRlcjpbXSxzdGFydDpnLGxlbmd0aDppLHNlYXJjaDp7dmFsdWU6ZS5zU2VhcmNoLHJlZ2V4OmUuYlJlZ2V4fX07Zm9yKGc9MDtnPGM7ZysrKW49YltnXSwNCiAgICAgICAgbD1mW2ddLGk9ImZ1bmN0aW9uIj09dHlwZW9mIG4ubURhdGE/ImZ1bmN0aW9uIjpuLm1EYXRhLHBhLmNvbHVtbnMucHVzaCh7ZGF0YTppLG5hbWU6bi5zTmFtZSxzZWFyY2hhYmxlOm4uYlNlYXJjaGFibGUsb3JkZXJhYmxlOm4uYlNvcnRhYmxlLHNlYXJjaDp7dmFsdWU6bC5zU2VhcmNoLHJlZ2V4OmwuYlJlZ2V4fX0pLHQoIm1EYXRhUHJvcF8iK2csaSksZC5iRmlsdGVyJiYodCgic1NlYXJjaF8iK2csbC5zU2VhcmNoKSx0KCJiUmVnZXhfIitnLGwuYlJlZ2V4KSx0KCJiU2VhcmNoYWJsZV8iK2csbi5iU2VhcmNoYWJsZSkpLGQuYlNvcnQmJnQoImJTb3J0YWJsZV8iK2csbi5iU29ydGFibGUpO2QuYkZpbHRlciYmKHQoInNTZWFyY2giLGUuc1NlYXJjaCksdCgiYlJlZ2V4IixlLmJSZWdleCkpO2QuYlNvcnQmJihoLmVhY2goayxmdW5jdGlvbihhLGIpe3BhLm9yZGVyLnB1c2goe2NvbHVtbjpiLmNvbCxkaXI6Yi5kaXJ9KTt0KCJpU29ydENvbF8iK2EsYi5jb2wpO3QoInNTb3J0RGlyXyIrDQogICAgICAgIGEsYi5kaXIpfSksdCgiaVNvcnRpbmdDb2xzIixrLmxlbmd0aCkpO2I9bS5leHQubGVnYWN5LmFqYXg7cmV0dXJuIG51bGw9PT1iP2Euc0FqYXhTb3VyY2U/ajpwYTpiP2o6cGF9ZnVuY3Rpb24gdWIoYSxiKXt2YXIgYz10YShhLGIpLGQ9Yi5zRWNobyE9PWs/Yi5zRWNobzpiLmRyYXcsZT1iLmlUb3RhbFJlY29yZHMhPT1rP2IuaVRvdGFsUmVjb3JkczpiLnJlY29yZHNUb3RhbCxmPWIuaVRvdGFsRGlzcGxheVJlY29yZHMhPT1rP2IuaVRvdGFsRGlzcGxheVJlY29yZHM6Yi5yZWNvcmRzRmlsdGVyZWQ7aWYoZCl7aWYoMSpkPGEuaURyYXcpcmV0dXJuO2EuaURyYXc9MSpkfW5hKGEpO2EuX2lSZWNvcmRzVG90YWw9cGFyc2VJbnQoZSwxMCk7YS5faVJlY29yZHNEaXNwbGF5PXBhcnNlSW50KGYsMTApO2Q9MDtmb3IoZT1jLmxlbmd0aDtkPGU7ZCsrKU0oYSxjW2RdKTthLmFpRGlzcGxheT1hLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpO2EuYkFqYXhEYXRhR2V0PSExO04oYSk7YS5fYkluaXRDb21wbGV0ZXx8DQogICAgdWEoYSxiKTthLmJBamF4RGF0YUdldD0hMDtDKGEsITEpfWZ1bmN0aW9uIHRhKGEsYil7dmFyIGM9aC5pc1BsYWluT2JqZWN0KGEuYWpheCkmJmEuYWpheC5kYXRhU3JjIT09az9hLmFqYXguZGF0YVNyYzphLnNBamF4RGF0YVByb3A7cmV0dXJuImRhdGEiPT09Yz9iLmFhRGF0YXx8YltjXToiIiE9PWM/UShjKShiKTpifWZ1bmN0aW9uIG9iKGEpe3ZhciBiPWEub0NsYXNzZXMsYz1hLnNUYWJsZUlkLGQ9YS5vTGFuZ3VhZ2UsZT1hLm9QcmV2aW91c1NlYXJjaCxmPWEuYWFuRmVhdHVyZXMsZz0nPGlucHV0IHR5cGU9InNlYXJjaCIgY2xhc3M9IicrYi5zRmlsdGVySW5wdXQrJyIvPicsaj1kLnNTZWFyY2gsaj1qLm1hdGNoKC9fSU5QVVRfLyk/ai5yZXBsYWNlKCJfSU5QVVRfIixnKTpqK2csYj1oKCI8ZGl2Lz4iLHtpZDohZi5mP2MrIl9maWx0ZXIiOm51bGwsImNsYXNzIjpiLnNGaWx0ZXJ9KS5hcHBlbmQoaCgiPGxhYmVsLz4iKS5hcHBlbmQoaikpLGY9ZnVuY3Rpb24oKXt2YXIgYj0hdGhpcy52YWx1ZT8NCiAgICAgICAgIiI6dGhpcy52YWx1ZTtiIT1lLnNTZWFyY2gmJihmYShhLHtzU2VhcmNoOmIsYlJlZ2V4OmUuYlJlZ2V4LGJTbWFydDplLmJTbWFydCxiQ2FzZUluc2Vuc2l0aXZlOmUuYkNhc2VJbnNlbnNpdGl2ZX0pLGEuX2lEaXNwbGF5U3RhcnQ9MCxOKGEpKX0sZz1udWxsIT09YS5zZWFyY2hEZWxheT9hLnNlYXJjaERlbGF5OiJzc3AiPT09eShhKT80MDA6MCxpPWgoImlucHV0IixiKS52YWwoZS5zU2VhcmNoKS5hdHRyKCJwbGFjZWhvbGRlciIsZC5zU2VhcmNoUGxhY2Vob2xkZXIpLm9uKCJrZXl1cC5EVCBzZWFyY2guRFQgaW5wdXQuRFQgcGFzdGUuRFQgY3V0LkRUIixnP05hKGYsZyk6Zikub24oImtleXByZXNzLkRUIixmdW5jdGlvbihhKXtpZigxMz09YS5rZXlDb2RlKXJldHVybiExfSkuYXR0cigiYXJpYS1jb250cm9scyIsYyk7aChhLm5UYWJsZSkub24oInNlYXJjaC5kdC5EVCIsZnVuY3Rpb24oYixjKXtpZihhPT09Yyl0cnl7aVswXSE9PUcuYWN0aXZlRWxlbWVudCYmaS52YWwoZS5zU2VhcmNoKX1jYXRjaChkKXt9fSk7DQogICAgICAgIHJldHVybiBiWzBdfWZ1bmN0aW9uIGZhKGEsYixjKXt2YXIgZD1hLm9QcmV2aW91c1NlYXJjaCxlPWEuYW9QcmVTZWFyY2hDb2xzLGY9ZnVuY3Rpb24oYSl7ZC5zU2VhcmNoPWEuc1NlYXJjaDtkLmJSZWdleD1hLmJSZWdleDtkLmJTbWFydD1hLmJTbWFydDtkLmJDYXNlSW5zZW5zaXRpdmU9YS5iQ2FzZUluc2Vuc2l0aXZlfTtGYShhKTtpZigic3NwIiE9eShhKSl7dmIoYSxiLnNTZWFyY2gsYyxiLmJFc2NhcGVSZWdleCE9PWs/IWIuYkVzY2FwZVJlZ2V4OmIuYlJlZ2V4LGIuYlNtYXJ0LGIuYkNhc2VJbnNlbnNpdGl2ZSk7ZihiKTtmb3IoYj0wO2I8ZS5sZW5ndGg7YisrKXdiKGEsZVtiXS5zU2VhcmNoLGIsZVtiXS5iRXNjYXBlUmVnZXghPT1rPyFlW2JdLmJFc2NhcGVSZWdleDplW2JdLmJSZWdleCxlW2JdLmJTbWFydCxlW2JdLmJDYXNlSW5zZW5zaXRpdmUpO3hiKGEpfWVsc2UgZihiKTthLmJGaWx0ZXJlZD0hMDtyKGEsbnVsbCwic2VhcmNoIixbYV0pfWZ1bmN0aW9uIHhiKGEpe2Zvcih2YXIgYj0NCiAgICAgICAgbS5leHQuc2VhcmNoLGM9YS5haURpc3BsYXksZCxlLGY9MCxnPWIubGVuZ3RoO2Y8ZztmKyspe2Zvcih2YXIgaj1bXSxpPTAsbj1jLmxlbmd0aDtpPG47aSsrKWU9Y1tpXSxkPWEuYW9EYXRhW2VdLGJbZl0oYSxkLl9hRmlsdGVyRGF0YSxlLGQuX2FEYXRhLGkpJiZqLnB1c2goZSk7Yy5sZW5ndGg9MDtoLm1lcmdlKGMsail9fWZ1bmN0aW9uIHdiKGEsYixjLGQsZSxmKXtpZigiIiE9PWIpe2Zvcih2YXIgZz1bXSxqPWEuYWlEaXNwbGF5LGQ9T2EoYixkLGUsZiksZT0wO2U8ai5sZW5ndGg7ZSsrKWI9YS5hb0RhdGFbaltlXV0uX2FGaWx0ZXJEYXRhW2NdLGQudGVzdChiKSYmZy5wdXNoKGpbZV0pO2EuYWlEaXNwbGF5PWd9fWZ1bmN0aW9uIHZiKGEsYixjLGQsZSxmKXt2YXIgZD1PYShiLGQsZSxmKSxmPWEub1ByZXZpb3VzU2VhcmNoLnNTZWFyY2gsZz1hLmFpRGlzcGxheU1hc3RlcixqLGU9W107MCE9PW0uZXh0LnNlYXJjaC5sZW5ndGgmJihjPSEwKTtqPXliKGEpO2lmKDA+PWIubGVuZ3RoKWEuYWlEaXNwbGF5PQ0KICAgICAgICBnLnNsaWNlKCk7ZWxzZXtpZihqfHxjfHxmLmxlbmd0aD5iLmxlbmd0aHx8MCE9PWIuaW5kZXhPZihmKXx8YS5iU29ydGVkKWEuYWlEaXNwbGF5PWcuc2xpY2UoKTtiPWEuYWlEaXNwbGF5O2ZvcihjPTA7YzxiLmxlbmd0aDtjKyspZC50ZXN0KGEuYW9EYXRhW2JbY11dLl9zRmlsdGVyUm93KSYmZS5wdXNoKGJbY10pO2EuYWlEaXNwbGF5PWV9fWZ1bmN0aW9uIE9hKGEsYixjLGQpe2E9Yj9hOlBhKGEpO2MmJihhPSJeKD89Lio/IitoLm1hcChhLm1hdGNoKC8iW14iXSsifFteIF0rL2cpfHxbIiJdLGZ1bmN0aW9uKGEpe2lmKCciJz09PWEuY2hhckF0KDApKXZhciBiPWEubWF0Y2goL14iKC4qKSIkLyksYT1iP2JbMV06YTtyZXR1cm4gYS5yZXBsYWNlKCciJywiIil9KS5qb2luKCIpKD89Lio/IikrIikuKiQiKTtyZXR1cm4gUmVnRXhwKGEsZD8iaSI6IiIpfWZ1bmN0aW9uIHliKGEpe3ZhciBiPWEuYW9Db2x1bW5zLGMsZCxlLGYsZyxqLGksaCxsPW0uZXh0LnR5cGUuc2VhcmNoO2M9ITE7DQogICAgICAgIGQ9MDtmb3IoZj1hLmFvRGF0YS5sZW5ndGg7ZDxmO2QrKylpZihoPWEuYW9EYXRhW2RdLCFoLl9hRmlsdGVyRGF0YSl7aj1bXTtlPTA7Zm9yKGc9Yi5sZW5ndGg7ZTxnO2UrKyljPWJbZV0sYy5iU2VhcmNoYWJsZT8oaT1CKGEsZCxlLCJmaWx0ZXIiKSxsW2Muc1R5cGVdJiYoaT1sW2Muc1R5cGVdKGkpKSxudWxsPT09aSYmKGk9IiIpLCJzdHJpbmciIT09dHlwZW9mIGkmJmkudG9TdHJpbmcmJihpPWkudG9TdHJpbmcoKSkpOmk9IiIsaS5pbmRleE9mJiYtMSE9PWkuaW5kZXhPZigiJiIpJiYodmEuaW5uZXJIVE1MPWksaT1XYj92YS50ZXh0Q29udGVudDp2YS5pbm5lclRleHQpLGkucmVwbGFjZSYmKGk9aS5yZXBsYWNlKC9bXHJcbl0vZywiIikpLGoucHVzaChpKTtoLl9hRmlsdGVyRGF0YT1qO2guX3NGaWx0ZXJSb3c9ai5qb2luKCIgICIpO2M9ITB9cmV0dXJuIGN9ZnVuY3Rpb24gemIoYSl7cmV0dXJue3NlYXJjaDphLnNTZWFyY2gsc21hcnQ6YS5iU21hcnQscmVnZXg6YS5iUmVnZXgsDQogICAgICAgIGNhc2VJbnNlbnNpdGl2ZTphLmJDYXNlSW5zZW5zaXRpdmV9fWZ1bmN0aW9uIEFiKGEpe3JldHVybntzU2VhcmNoOmEuc2VhcmNoLGJTbWFydDphLnNtYXJ0LGJSZWdleDphLnJlZ2V4LGJDYXNlSW5zZW5zaXRpdmU6YS5jYXNlSW5zZW5zaXRpdmV9fWZ1bmN0aW9uIHJiKGEpe3ZhciBiPWEuc1RhYmxlSWQsYz1hLmFhbkZlYXR1cmVzLmksZD1oKCI8ZGl2Lz4iLHsiY2xhc3MiOmEub0NsYXNzZXMuc0luZm8saWQ6IWM/YisiX2luZm8iOm51bGx9KTtjfHwoYS5hb0RyYXdDYWxsYmFjay5wdXNoKHtmbjpCYixzTmFtZToiaW5mb3JtYXRpb24ifSksZC5hdHRyKCJyb2xlIiwic3RhdHVzIikuYXR0cigiYXJpYS1saXZlIiwicG9saXRlIiksaChhLm5UYWJsZSkuYXR0cigiYXJpYS1kZXNjcmliZWRieSIsYisiX2luZm8iKSk7cmV0dXJuIGRbMF19ZnVuY3Rpb24gQmIoYSl7dmFyIGI9YS5hYW5GZWF0dXJlcy5pO2lmKDAhPT1iLmxlbmd0aCl7dmFyIGM9YS5vTGFuZ3VhZ2UsZD1hLl9pRGlzcGxheVN0YXJ0Kw0KICAgICAgICAxLGU9YS5mbkRpc3BsYXlFbmQoKSxmPWEuZm5SZWNvcmRzVG90YWwoKSxnPWEuZm5SZWNvcmRzRGlzcGxheSgpLGo9Zz9jLnNJbmZvOmMuc0luZm9FbXB0eTtnIT09ZiYmKGorPSIgIitjLnNJbmZvRmlsdGVyZWQpO2orPWMuc0luZm9Qb3N0Rml4O2o9Q2IoYSxqKTtjPWMuZm5JbmZvQ2FsbGJhY2s7bnVsbCE9PWMmJihqPWMuY2FsbChhLm9JbnN0YW5jZSxhLGQsZSxmLGcsaikpO2goYikuaHRtbChqKX19ZnVuY3Rpb24gQ2IoYSxiKXt2YXIgYz1hLmZuRm9ybWF0TnVtYmVyLGQ9YS5faURpc3BsYXlTdGFydCsxLGU9YS5faURpc3BsYXlMZW5ndGgsZj1hLmZuUmVjb3Jkc0Rpc3BsYXkoKSxnPS0xPT09ZTtyZXR1cm4gYi5yZXBsYWNlKC9fU1RBUlRfL2csYy5jYWxsKGEsZCkpLnJlcGxhY2UoL19FTkRfL2csYy5jYWxsKGEsYS5mbkRpc3BsYXlFbmQoKSkpLnJlcGxhY2UoL19NQVhfL2csYy5jYWxsKGEsYS5mblJlY29yZHNUb3RhbCgpKSkucmVwbGFjZSgvX1RPVEFMXy9nLGMuY2FsbChhLA0KICAgICAgICBmKSkucmVwbGFjZSgvX1BBR0VfL2csYy5jYWxsKGEsZz8xOk1hdGguY2VpbChkL2UpKSkucmVwbGFjZSgvX1BBR0VTXy9nLGMuY2FsbChhLGc/MTpNYXRoLmNlaWwoZi9lKSkpfWZ1bmN0aW9uIGdhKGEpe3ZhciBiLGMsZD1hLmlJbml0RGlzcGxheVN0YXJ0LGU9YS5hb0NvbHVtbnMsZjtjPWEub0ZlYXR1cmVzO3ZhciBnPWEuYkRlZmVyTG9hZGluZztpZihhLmJJbml0aWFsaXNlZCl7bWIoYSk7amIoYSk7ZWEoYSxhLmFvSGVhZGVyKTtlYShhLGEuYW9Gb290ZXIpO0MoYSwhMCk7Yy5iQXV0b1dpZHRoJiZFYShhKTtiPTA7Zm9yKGM9ZS5sZW5ndGg7YjxjO2IrKylmPWVbYl0sZi5zV2lkdGgmJihmLm5UaC5zdHlsZS53aWR0aD12KGYuc1dpZHRoKSk7cihhLG51bGwsInByZUluaXQiLFthXSk7UyhhKTtlPXkoYSk7aWYoInNzcCIhPWV8fGcpImFqYXgiPT1lP3NhKGEsW10sZnVuY3Rpb24oYyl7dmFyIGY9dGEoYSxjKTtmb3IoYj0wO2I8Zi5sZW5ndGg7YisrKU0oYSxmW2JdKTthLmlJbml0RGlzcGxheVN0YXJ0PQ0KICAgICAgICBkO1MoYSk7QyhhLCExKTt1YShhLGMpfSxhKTooQyhhLCExKSx1YShhKSl9ZWxzZSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Z2EoYSl9LDIwMCl9ZnVuY3Rpb24gdWEoYSxiKXthLl9iSW5pdENvbXBsZXRlPSEwOyhifHxhLm9Jbml0LmFhRGF0YSkmJlkoYSk7cihhLG51bGwsInBsdWdpbi1pbml0IixbYSxiXSk7cihhLCJhb0luaXRDb21wbGV0ZSIsImluaXQiLFthLGJdKX1mdW5jdGlvbiBRYShhLGIpe3ZhciBjPXBhcnNlSW50KGIsMTApO2EuX2lEaXNwbGF5TGVuZ3RoPWM7UmEoYSk7cihhLG51bGwsImxlbmd0aCIsW2EsY10pfWZ1bmN0aW9uIG5iKGEpe2Zvcih2YXIgYj1hLm9DbGFzc2VzLGM9YS5zVGFibGVJZCxkPWEuYUxlbmd0aE1lbnUsZT1oLmlzQXJyYXkoZFswXSksZj1lP2RbMF06ZCxkPWU/ZFsxXTpkLGU9aCgiPHNlbGVjdC8+Iix7bmFtZTpjKyJfbGVuZ3RoIiwiYXJpYS1jb250cm9scyI6YywiY2xhc3MiOmIuc0xlbmd0aFNlbGVjdH0pLGc9MCxqPWYubGVuZ3RoO2c8ajtnKyspZVswXVtnXT0NCiAgICAgICAgbmV3IE9wdGlvbigibnVtYmVyIj09PXR5cGVvZiBkW2ddP2EuZm5Gb3JtYXROdW1iZXIoZFtnXSk6ZFtnXSxmW2ddKTt2YXIgaT1oKCI8ZGl2PjxsYWJlbC8+PC9kaXY+IikuYWRkQ2xhc3MoYi5zTGVuZ3RoKTthLmFhbkZlYXR1cmVzLmx8fChpWzBdLmlkPWMrIl9sZW5ndGgiKTtpLmNoaWxkcmVuKCkuYXBwZW5kKGEub0xhbmd1YWdlLnNMZW5ndGhNZW51LnJlcGxhY2UoIl9NRU5VXyIsZVswXS5vdXRlckhUTUwpKTtoKCJzZWxlY3QiLGkpLnZhbChhLl9pRGlzcGxheUxlbmd0aCkub24oImNoYW5nZS5EVCIsZnVuY3Rpb24oKXtRYShhLGgodGhpcykudmFsKCkpO04oYSl9KTtoKGEublRhYmxlKS5vbigibGVuZ3RoLmR0LkRUIixmdW5jdGlvbihiLGMsZCl7YT09PWMmJmgoInNlbGVjdCIsaSkudmFsKGQpfSk7cmV0dXJuIGlbMF19ZnVuY3Rpb24gc2IoYSl7dmFyIGI9YS5zUGFnaW5hdGlvblR5cGUsYz1tLmV4dC5wYWdlcltiXSxkPSJmdW5jdGlvbiI9PT10eXBlb2YgYyxlPWZ1bmN0aW9uKGEpe04oYSl9LA0KICAgICAgICBiPWgoIjxkaXYvPiIpLmFkZENsYXNzKGEub0NsYXNzZXMuc1BhZ2luZytiKVswXSxmPWEuYWFuRmVhdHVyZXM7ZHx8Yy5mbkluaXQoYSxiLGUpO2YucHx8KGIuaWQ9YS5zVGFibGVJZCsiX3BhZ2luYXRlIixhLmFvRHJhd0NhbGxiYWNrLnB1c2goe2ZuOmZ1bmN0aW9uKGEpe2lmKGQpe3ZhciBiPWEuX2lEaXNwbGF5U3RhcnQsaT1hLl9pRGlzcGxheUxlbmd0aCxoPWEuZm5SZWNvcmRzRGlzcGxheSgpLGw9LTE9PT1pLGI9bD8wOk1hdGguY2VpbChiL2kpLGk9bD8xOk1hdGguY2VpbChoL2kpLGg9YyhiLGkpLGssbD0wO2ZvcihrPWYucC5sZW5ndGg7bDxrO2wrKylNYShhLCJwYWdlQnV0dG9uIikoYSxmLnBbbF0sbCxoLGIsaSl9ZWxzZSBjLmZuVXBkYXRlKGEsZSl9LHNOYW1lOiJwYWdpbmF0aW9uIn0pKTtyZXR1cm4gYn1mdW5jdGlvbiBTYShhLGIsYyl7dmFyIGQ9YS5faURpc3BsYXlTdGFydCxlPWEuX2lEaXNwbGF5TGVuZ3RoLGY9YS5mblJlY29yZHNEaXNwbGF5KCk7MD09PWZ8fC0xPT09DQogICAgZT9kPTA6Im51bWJlciI9PT10eXBlb2YgYj8oZD1iKmUsZD5mJiYoZD0wKSk6ImZpcnN0Ij09Yj9kPTA6InByZXZpb3VzIj09Yj8oZD0wPD1lP2QtZTowLDA+ZCYmKGQ9MCkpOiJuZXh0Ij09Yj9kK2U8ZiYmKGQrPWUpOiJsYXN0Ij09Yj9kPU1hdGguZmxvb3IoKGYtMSkvZSkqZTpKKGEsMCwiVW5rbm93biBwYWdpbmcgYWN0aW9uOiAiK2IsNSk7Yj1hLl9pRGlzcGxheVN0YXJ0IT09ZDthLl9pRGlzcGxheVN0YXJ0PWQ7YiYmKHIoYSxudWxsLCJwYWdlIixbYV0pLGMmJk4oYSkpO3JldHVybiBifWZ1bmN0aW9uIHBiKGEpe3JldHVybiBoKCI8ZGl2Lz4iLHtpZDohYS5hYW5GZWF0dXJlcy5yP2Euc1RhYmxlSWQrIl9wcm9jZXNzaW5nIjpudWxsLCJjbGFzcyI6YS5vQ2xhc3Nlcy5zUHJvY2Vzc2luZ30pLmh0bWwoYS5vTGFuZ3VhZ2Uuc1Byb2Nlc3NpbmcpLmluc2VydEJlZm9yZShhLm5UYWJsZSlbMF19ZnVuY3Rpb24gQyhhLGIpe2Eub0ZlYXR1cmVzLmJQcm9jZXNzaW5nJiZoKGEuYWFuRmVhdHVyZXMucikuY3NzKCJkaXNwbGF5IiwNCiAgICAgICAgYj8iYmxvY2siOiJub25lIik7cihhLG51bGwsInByb2Nlc3NpbmciLFthLGJdKX1mdW5jdGlvbiBxYihhKXt2YXIgYj1oKGEublRhYmxlKTtiLmF0dHIoInJvbGUiLCJncmlkIik7dmFyIGM9YS5vU2Nyb2xsO2lmKCIiPT09Yy5zWCYmIiI9PT1jLnNZKXJldHVybiBhLm5UYWJsZTt2YXIgZD1jLnNYLGU9Yy5zWSxmPWEub0NsYXNzZXMsZz1iLmNoaWxkcmVuKCJjYXB0aW9uIiksaj1nLmxlbmd0aD9nWzBdLl9jYXB0aW9uU2lkZTpudWxsLGk9aChiWzBdLmNsb25lTm9kZSghMSkpLG49aChiWzBdLmNsb25lTm9kZSghMSkpLGw9Yi5jaGlsZHJlbigidGZvb3QiKTtsLmxlbmd0aHx8KGw9bnVsbCk7aT1oKCI8ZGl2Lz4iLHsiY2xhc3MiOmYuc1Njcm9sbFdyYXBwZXJ9KS5hcHBlbmQoaCgiPGRpdi8+Iix7ImNsYXNzIjpmLnNTY3JvbGxIZWFkfSkuY3NzKHtvdmVyZmxvdzoiaGlkZGVuIixwb3NpdGlvbjoicmVsYXRpdmUiLGJvcmRlcjowLHdpZHRoOmQ/IWQ/bnVsbDp2KGQpOiIxMDAlIn0pLmFwcGVuZChoKCI8ZGl2Lz4iLA0KICAgICAgICB7ImNsYXNzIjpmLnNTY3JvbGxIZWFkSW5uZXJ9KS5jc3MoeyJib3gtc2l6aW5nIjoiY29udGVudC1ib3giLHdpZHRoOmMuc1hJbm5lcnx8IjEwMCUifSkuYXBwZW5kKGkucmVtb3ZlQXR0cigiaWQiKS5jc3MoIm1hcmdpbi1sZWZ0IiwwKS5hcHBlbmQoInRvcCI9PT1qP2c6bnVsbCkuYXBwZW5kKGIuY2hpbGRyZW4oInRoZWFkIikpKSkpLmFwcGVuZChoKCI8ZGl2Lz4iLHsiY2xhc3MiOmYuc1Njcm9sbEJvZHl9KS5jc3Moe3Bvc2l0aW9uOiJyZWxhdGl2ZSIsb3ZlcmZsb3c6ImF1dG8iLHdpZHRoOiFkP251bGw6dihkKX0pLmFwcGVuZChiKSk7bCYmaS5hcHBlbmQoaCgiPGRpdi8+Iix7ImNsYXNzIjpmLnNTY3JvbGxGb290fSkuY3NzKHtvdmVyZmxvdzoiaGlkZGVuIixib3JkZXI6MCx3aWR0aDpkPyFkP251bGw6dihkKToiMTAwJSJ9KS5hcHBlbmQoaCgiPGRpdi8+Iix7ImNsYXNzIjpmLnNTY3JvbGxGb290SW5uZXJ9KS5hcHBlbmQobi5yZW1vdmVBdHRyKCJpZCIpLmNzcygibWFyZ2luLWxlZnQiLA0KICAgICAgICAwKS5hcHBlbmQoImJvdHRvbSI9PT1qP2c6bnVsbCkuYXBwZW5kKGIuY2hpbGRyZW4oInRmb290IikpKSkpO3ZhciBiPWkuY2hpbGRyZW4oKSxrPWJbMF0sZj1iWzFdLHQ9bD9iWzJdOm51bGw7aWYoZCloKGYpLm9uKCJzY3JvbGwuRFQiLGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5zY3JvbGxMZWZ0O2suc2Nyb2xsTGVmdD1hO2wmJih0LnNjcm9sbExlZnQ9YSl9KTtoKGYpLmNzcyhlJiZjLmJDb2xsYXBzZT8ibWF4LWhlaWdodCI6ImhlaWdodCIsZSk7YS5uU2Nyb2xsSGVhZD1rO2EublNjcm9sbEJvZHk9ZjthLm5TY3JvbGxGb290PXQ7YS5hb0RyYXdDYWxsYmFjay5wdXNoKHtmbjprYSxzTmFtZToic2Nyb2xsaW5nIn0pO3JldHVybiBpWzBdfWZ1bmN0aW9uIGthKGEpe3ZhciBiPWEub1Njcm9sbCxjPWIuc1gsZD1iLnNYSW5uZXIsZT1iLnNZLGI9Yi5pQmFyV2lkdGgsZj1oKGEublNjcm9sbEhlYWQpLGc9ZlswXS5zdHlsZSxqPWYuY2hpbGRyZW4oImRpdiIpLGk9alswXS5zdHlsZSxuPWouY2hpbGRyZW4oInRhYmxlIiksDQogICAgICAgIGo9YS5uU2Nyb2xsQm9keSxsPWgoaikscT1qLnN0eWxlLHQ9aChhLm5TY3JvbGxGb290KS5jaGlsZHJlbigiZGl2IiksbT10LmNoaWxkcmVuKCJ0YWJsZSIpLG89aChhLm5USGVhZCkscD1oKGEublRhYmxlKSxzPXBbMF0scj1zLnN0eWxlLHU9YS5uVEZvb3Q/aChhLm5URm9vdCk6bnVsbCx4PWEub0Jyb3dzZXIsVD14LmJTY3JvbGxPdmVyc2l6ZSxYYj1EKGEuYW9Db2x1bW5zLCJuVGgiKSxPLEssUCx3LFRhPVtdLHk9W10sej1bXSxBPVtdLEIsQz1mdW5jdGlvbihhKXthPWEuc3R5bGU7YS5wYWRkaW5nVG9wPSIwIjthLnBhZGRpbmdCb3R0b209IjAiO2EuYm9yZGVyVG9wV2lkdGg9IjAiO2EuYm9yZGVyQm90dG9tV2lkdGg9IjAiO2EuaGVpZ2h0PTB9O0s9ai5zY3JvbGxIZWlnaHQ+ai5jbGllbnRIZWlnaHQ7aWYoYS5zY3JvbGxCYXJWaXMhPT1LJiZhLnNjcm9sbEJhclZpcyE9PWspYS5zY3JvbGxCYXJWaXM9SyxZKGEpO2Vsc2V7YS5zY3JvbGxCYXJWaXM9SztwLmNoaWxkcmVuKCJ0aGVhZCwgdGZvb3QiKS5yZW1vdmUoKTsNCiAgICAgICAgdSYmKFA9dS5jbG9uZSgpLnByZXBlbmRUbyhwKSxPPXUuZmluZCgidHIiKSxQPVAuZmluZCgidHIiKSk7dz1vLmNsb25lKCkucHJlcGVuZFRvKHApO289by5maW5kKCJ0ciIpO0s9dy5maW5kKCJ0ciIpO3cuZmluZCgidGgsIHRkIikucmVtb3ZlQXR0cigidGFiaW5kZXgiKTtjfHwocS53aWR0aD0iMTAwJSIsZlswXS5zdHlsZS53aWR0aD0iMTAwJSIpO2guZWFjaChyYShhLHcpLGZ1bmN0aW9uKGIsYyl7Qj1aKGEsYik7Yy5zdHlsZS53aWR0aD1hLmFvQ29sdW1uc1tCXS5zV2lkdGh9KTt1JiZIKGZ1bmN0aW9uKGEpe2Euc3R5bGUud2lkdGg9IiJ9LFApO2Y9cC5vdXRlcldpZHRoKCk7aWYoIiI9PT1jKXtyLndpZHRoPSIxMDAlIjtpZihUJiYocC5maW5kKCJ0Ym9keSIpLmhlaWdodCgpPmoub2Zmc2V0SGVpZ2h0fHwic2Nyb2xsIj09bC5jc3MoIm92ZXJmbG93LXkiKSkpci53aWR0aD12KHAub3V0ZXJXaWR0aCgpLWIpO2Y9cC5vdXRlcldpZHRoKCl9ZWxzZSIiIT09ZCYmKHIud2lkdGg9DQogICAgICAgICAgICB2KGQpLGY9cC5vdXRlcldpZHRoKCkpO0goQyxLKTtIKGZ1bmN0aW9uKGEpe3oucHVzaChhLmlubmVySFRNTCk7VGEucHVzaCh2KGgoYSkuY3NzKCJ3aWR0aCIpKSl9LEspO0goZnVuY3Rpb24oYSxiKXtpZihoLmluQXJyYXkoYSxYYikhPT0tMSlhLnN0eWxlLndpZHRoPVRhW2JdfSxvKTtoKEspLmhlaWdodCgwKTt1JiYoSChDLFApLEgoZnVuY3Rpb24oYSl7QS5wdXNoKGEuaW5uZXJIVE1MKTt5LnB1c2godihoKGEpLmNzcygid2lkdGgiKSkpfSxQKSxIKGZ1bmN0aW9uKGEsYil7YS5zdHlsZS53aWR0aD15W2JdfSxPKSxoKFApLmhlaWdodCgwKSk7SChmdW5jdGlvbihhLGIpe2EuaW5uZXJIVE1MPSc8ZGl2IGNsYXNzPSJkYXRhVGFibGVzX3NpemluZyIgc3R5bGU9ImhlaWdodDowO292ZXJmbG93OmhpZGRlbjsiPicreltiXSsiPC9kaXY+IjthLnN0eWxlLndpZHRoPVRhW2JdfSxLKTt1JiZIKGZ1bmN0aW9uKGEsYil7YS5pbm5lckhUTUw9JzxkaXYgY2xhc3M9ImRhdGFUYWJsZXNfc2l6aW5nIiBzdHlsZT0iaGVpZ2h0OjA7b3ZlcmZsb3c6aGlkZGVuOyI+JysNCiAgICAgICAgICAgIEFbYl0rIjwvZGl2PiI7YS5zdHlsZS53aWR0aD15W2JdfSxQKTtpZihwLm91dGVyV2lkdGgoKTxmKXtPPWouc2Nyb2xsSGVpZ2h0Pmoub2Zmc2V0SGVpZ2h0fHwic2Nyb2xsIj09bC5jc3MoIm92ZXJmbG93LXkiKT9mK2I6ZjtpZihUJiYoai5zY3JvbGxIZWlnaHQ+ai5vZmZzZXRIZWlnaHR8fCJzY3JvbGwiPT1sLmNzcygib3ZlcmZsb3cteSIpKSlyLndpZHRoPXYoTy1iKTsoIiI9PT1jfHwiIiE9PWQpJiZKKGEsMSwiUG9zc2libGUgY29sdW1uIG1pc2FsaWdubWVudCIsNil9ZWxzZSBPPSIxMDAlIjtxLndpZHRoPXYoTyk7Zy53aWR0aD12KE8pO3UmJihhLm5TY3JvbGxGb290LnN0eWxlLndpZHRoPXYoTykpOyFlJiZUJiYocS5oZWlnaHQ9dihzLm9mZnNldEhlaWdodCtiKSk7Yz1wLm91dGVyV2lkdGgoKTtuWzBdLnN0eWxlLndpZHRoPXYoYyk7aS53aWR0aD12KGMpO2Q9cC5oZWlnaHQoKT5qLmNsaWVudEhlaWdodHx8InNjcm9sbCI9PWwuY3NzKCJvdmVyZmxvdy15Iik7ZT0icGFkZGluZyIrDQogICAgICAgICAgICAoeC5iU2Nyb2xsYmFyTGVmdD8iTGVmdCI6IlJpZ2h0Iik7aVtlXT1kP2IrInB4IjoiMHB4Ijt1JiYobVswXS5zdHlsZS53aWR0aD12KGMpLHRbMF0uc3R5bGUud2lkdGg9dihjKSx0WzBdLnN0eWxlW2VdPWQ/YisicHgiOiIwcHgiKTtwLmNoaWxkcmVuKCJjb2xncm91cCIpLmluc2VydEJlZm9yZShwLmNoaWxkcmVuKCJ0aGVhZCIpKTtsLnNjcm9sbCgpO2lmKChhLmJTb3J0ZWR8fGEuYkZpbHRlcmVkKSYmIWEuX2RyYXdIb2xkKWouc2Nyb2xsVG9wPTB9fWZ1bmN0aW9uIEgoYSxiLGMpe2Zvcih2YXIgZD0wLGU9MCxmPWIubGVuZ3RoLGcsajtlPGY7KXtnPWJbZV0uZmlyc3RDaGlsZDtmb3Ioaj1jP2NbZV0uZmlyc3RDaGlsZDpudWxsO2c7KTE9PT1nLm5vZGVUeXBlJiYoYz9hKGcsaixkKTphKGcsZCksZCsrKSxnPWcubmV4dFNpYmxpbmcsaj1jP2oubmV4dFNpYmxpbmc6bnVsbDtlKyt9fWZ1bmN0aW9uIEVhKGEpe3ZhciBiPWEublRhYmxlLGM9YS5hb0NvbHVtbnMsZD1hLm9TY3JvbGwsDQogICAgICAgIGU9ZC5zWSxmPWQuc1gsZz1kLnNYSW5uZXIsaj1jLmxlbmd0aCxpPWxhKGEsImJWaXNpYmxlIiksbj1oKCJ0aCIsYS5uVEhlYWQpLGw9Yi5nZXRBdHRyaWJ1dGUoIndpZHRoIiksaz1iLnBhcmVudE5vZGUsdD0hMSxtLG8scD1hLm9Ccm93c2VyLGQ9cC5iU2Nyb2xsT3ZlcnNpemU7KG09Yi5zdHlsZS53aWR0aCkmJi0xIT09bS5pbmRleE9mKCIlIikmJihsPW0pO2ZvcihtPTA7bTxpLmxlbmd0aDttKyspbz1jW2lbbV1dLG51bGwhPT1vLnNXaWR0aCYmKG8uc1dpZHRoPURiKG8uc1dpZHRoT3JpZyxrKSx0PSEwKTtpZihkfHwhdCYmIWYmJiFlJiZqPT1hYShhKSYmaj09bi5sZW5ndGgpZm9yKG09MDttPGo7bSsrKWk9WihhLG0pLG51bGwhPT1pJiYoY1tpXS5zV2lkdGg9dihuLmVxKG0pLndpZHRoKCkpKTtlbHNle2o9aChiKS5jbG9uZSgpLmNzcygidmlzaWJpbGl0eSIsImhpZGRlbiIpLnJlbW92ZUF0dHIoImlkIik7ai5maW5kKCJ0Ym9keSB0ciIpLnJlbW92ZSgpO3ZhciBzPWgoIjx0ci8+IikuYXBwZW5kVG8oai5maW5kKCJ0Ym9keSIpKTsNCiAgICAgICAgai5maW5kKCJ0aGVhZCwgdGZvb3QiKS5yZW1vdmUoKTtqLmFwcGVuZChoKGEublRIZWFkKS5jbG9uZSgpKS5hcHBlbmQoaChhLm5URm9vdCkuY2xvbmUoKSk7ai5maW5kKCJ0Zm9vdCB0aCwgdGZvb3QgdGQiKS5jc3MoIndpZHRoIiwiIik7bj1yYShhLGouZmluZCgidGhlYWQiKVswXSk7Zm9yKG09MDttPGkubGVuZ3RoO20rKylvPWNbaVttXV0sblttXS5zdHlsZS53aWR0aD1udWxsIT09by5zV2lkdGhPcmlnJiYiIiE9PW8uc1dpZHRoT3JpZz92KG8uc1dpZHRoT3JpZyk6IiIsby5zV2lkdGhPcmlnJiZmJiZoKG5bbV0pLmFwcGVuZChoKCI8ZGl2Lz4iKS5jc3Moe3dpZHRoOm8uc1dpZHRoT3JpZyxtYXJnaW46MCxwYWRkaW5nOjAsYm9yZGVyOjAsaGVpZ2h0OjF9KSk7aWYoYS5hb0RhdGEubGVuZ3RoKWZvcihtPTA7bTxpLmxlbmd0aDttKyspdD1pW21dLG89Y1t0XSxoKEViKGEsdCkpLmNsb25lKCExKS5hcHBlbmQoby5zQ29udGVudFBhZGRpbmcpLmFwcGVuZFRvKHMpO2goIltuYW1lXSIsDQogICAgICAgICAgICBqKS5yZW1vdmVBdHRyKCJuYW1lIik7bz1oKCI8ZGl2Lz4iKS5jc3MoZnx8ZT97cG9zaXRpb246ImFic29sdXRlIix0b3A6MCxsZWZ0OjAsaGVpZ2h0OjEscmlnaHQ6MCxvdmVyZmxvdzoiaGlkZGVuIn06e30pLmFwcGVuZChqKS5hcHBlbmRUbyhrKTtmJiZnP2oud2lkdGgoZyk6Zj8oai5jc3MoIndpZHRoIiwiYXV0byIpLGoucmVtb3ZlQXR0cigid2lkdGgiKSxqLndpZHRoKCk8ay5jbGllbnRXaWR0aCYmbCYmai53aWR0aChrLmNsaWVudFdpZHRoKSk6ZT9qLndpZHRoKGsuY2xpZW50V2lkdGgpOmwmJmoud2lkdGgobCk7Zm9yKG09ZT0wO208aS5sZW5ndGg7bSsrKWs9aChuW21dKSxnPWsub3V0ZXJXaWR0aCgpLWsud2lkdGgoKSxrPXAuYkJvdW5kaW5nP01hdGguY2VpbChuW21dLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKTprLm91dGVyV2lkdGgoKSxlKz1rLGNbaVttXV0uc1dpZHRoPXYoay1nKTtiLnN0eWxlLndpZHRoPXYoZSk7by5yZW1vdmUoKX1sJiYoYi5zdHlsZS53aWR0aD0NCiAgICAgICAgdihsKSk7aWYoKGx8fGYpJiYhYS5fcmVzekV2dCliPWZ1bmN0aW9uKCl7aChFKS5vbigicmVzaXplLkRULSIrYS5zSW5zdGFuY2UsTmEoZnVuY3Rpb24oKXtZKGEpfSkpfSxkP3NldFRpbWVvdXQoYiwxRTMpOmIoKSxhLl9yZXN6RXZ0PSEwfWZ1bmN0aW9uIERiKGEsYil7aWYoIWEpcmV0dXJuIDA7dmFyIGM9aCgiPGRpdi8+IikuY3NzKCJ3aWR0aCIsdihhKSkuYXBwZW5kVG8oYnx8Ry5ib2R5KSxkPWNbMF0ub2Zmc2V0V2lkdGg7Yy5yZW1vdmUoKTtyZXR1cm4gZH1mdW5jdGlvbiBFYihhLGIpe3ZhciBjPUZiKGEsYik7aWYoMD5jKXJldHVybiBudWxsO3ZhciBkPWEuYW9EYXRhW2NdO3JldHVybiFkLm5Ucj9oKCI8dGQvPiIpLmh0bWwoQihhLGMsYiwiZGlzcGxheSIpKVswXTpkLmFuQ2VsbHNbYl19ZnVuY3Rpb24gRmIoYSxiKXtmb3IodmFyIGMsZD0tMSxlPS0xLGY9MCxnPWEuYW9EYXRhLmxlbmd0aDtmPGc7ZisrKWM9QihhLGYsYiwiZGlzcGxheSIpKyIiLGM9Yy5yZXBsYWNlKFliLA0KICAgICAgICAiIiksYz1jLnJlcGxhY2UoLyZuYnNwOy9nLCIgIiksYy5sZW5ndGg+ZCYmKGQ9Yy5sZW5ndGgsZT1mKTtyZXR1cm4gZX1mdW5jdGlvbiB2KGEpe3JldHVybiBudWxsPT09YT8iMHB4IjoibnVtYmVyIj09dHlwZW9mIGE/MD5hPyIwcHgiOmErInB4IjphLm1hdGNoKC9cZCQvKT9hKyJweCI6YX1mdW5jdGlvbiBWKGEpe3ZhciBiLGMsZD1bXSxlPWEuYW9Db2x1bW5zLGYsZyxqLGk7Yj1hLmFhU29ydGluZ0ZpeGVkO2M9aC5pc1BsYWluT2JqZWN0KGIpO3ZhciBuPVtdO2Y9ZnVuY3Rpb24oYSl7YS5sZW5ndGgmJiFoLmlzQXJyYXkoYVswXSk/bi5wdXNoKGEpOmgubWVyZ2UobixhKX07aC5pc0FycmF5KGIpJiZmKGIpO2MmJmIucHJlJiZmKGIucHJlKTtmKGEuYWFTb3J0aW5nKTtjJiZiLnBvc3QmJmYoYi5wb3N0KTtmb3IoYT0wO2E8bi5sZW5ndGg7YSsrKXtpPW5bYV1bMF07Zj1lW2ldLmFEYXRhU29ydDtiPTA7Zm9yKGM9Zi5sZW5ndGg7YjxjO2IrKylnPWZbYl0saj1lW2ddLnNUeXBlfHwNCiAgICAgICAgInN0cmluZyIsblthXS5faWR4PT09ayYmKG5bYV0uX2lkeD1oLmluQXJyYXkoblthXVsxXSxlW2ddLmFzU29ydGluZykpLGQucHVzaCh7c3JjOmksY29sOmcsZGlyOm5bYV1bMV0saW5kZXg6blthXS5faWR4LHR5cGU6aixmb3JtYXR0ZXI6bS5leHQudHlwZS5vcmRlcltqKyItcHJlIl19KX1yZXR1cm4gZH1mdW5jdGlvbiBsYihhKXt2YXIgYixjLGQ9W10sZT1tLmV4dC50eXBlLm9yZGVyLGY9YS5hb0RhdGEsZz0wLGosaT1hLmFpRGlzcGxheU1hc3RlcixoO0ZhKGEpO2g9VihhKTtiPTA7Zm9yKGM9aC5sZW5ndGg7YjxjO2IrKylqPWhbYl0sai5mb3JtYXR0ZXImJmcrKyxHYihhLGouY29sKTtpZigic3NwIiE9eShhKSYmMCE9PWgubGVuZ3RoKXtiPTA7Zm9yKGM9aS5sZW5ndGg7YjxjO2IrKylkW2lbYl1dPWI7Zz09PWgubGVuZ3RoP2kuc29ydChmdW5jdGlvbihhLGIpe3ZhciBjLGUsZyxqLGk9aC5sZW5ndGgsaz1mW2FdLl9hU29ydERhdGEsbT1mW2JdLl9hU29ydERhdGE7Zm9yKGc9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMDtnPGk7ZysrKWlmKGo9aFtnXSxjPWtbai5jb2xdLGU9bVtqLmNvbF0sYz1jPGU/LTE6Yz5lPzE6MCwwIT09YylyZXR1cm4iYXNjIj09PWouZGlyP2M6LWM7Yz1kW2FdO2U9ZFtiXTtyZXR1cm4gYzxlPy0xOmM+ZT8xOjB9KTppLnNvcnQoZnVuY3Rpb24oYSxiKXt2YXIgYyxnLGosaSxrPWgubGVuZ3RoLG09ZlthXS5fYVNvcnREYXRhLG89ZltiXS5fYVNvcnREYXRhO2ZvcihqPTA7ajxrO2orKylpZihpPWhbal0sYz1tW2kuY29sXSxnPW9baS5jb2xdLGk9ZVtpLnR5cGUrIi0iK2kuZGlyXXx8ZVsic3RyaW5nLSIraS5kaXJdLGM9aShjLGcpLDAhPT1jKXJldHVybiBjO2M9ZFthXTtnPWRbYl07cmV0dXJuIGM8Zz8tMTpjPmc/MTowfSl9YS5iU29ydGVkPSEwfWZ1bmN0aW9uIEhiKGEpe2Zvcih2YXIgYixjLGQ9YS5hb0NvbHVtbnMsZT1WKGEpLGE9YS5vTGFuZ3VhZ2Uub0FyaWEsZj0wLGc9ZC5sZW5ndGg7ZjxnO2YrKyl7Yz1kW2ZdO3ZhciBqPWMuYXNTb3J0aW5nO2I9Yy5zVGl0bGUucmVwbGFjZSgvPC4qPz4vZywNCiAgICAgICAgIiIpO3ZhciBpPWMublRoO2kucmVtb3ZlQXR0cmlidXRlKCJhcmlhLXNvcnQiKTtjLmJTb3J0YWJsZSYmKDA8ZS5sZW5ndGgmJmVbMF0uY29sPT1mPyhpLnNldEF0dHJpYnV0ZSgiYXJpYS1zb3J0IiwiYXNjIj09ZVswXS5kaXI/ImFzY2VuZGluZyI6ImRlc2NlbmRpbmciKSxjPWpbZVswXS5pbmRleCsxXXx8alswXSk6Yz1qWzBdLGIrPSJhc2MiPT09Yz9hLnNTb3J0QXNjZW5kaW5nOmEuc1NvcnREZXNjZW5kaW5nKTtpLnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsYil9fWZ1bmN0aW9uIFVhKGEsYixjLGQpe3ZhciBlPWEuYWFTb3J0aW5nLGY9YS5hb0NvbHVtbnNbYl0uYXNTb3J0aW5nLGc9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLl9pZHg7Yz09PWsmJihjPWguaW5BcnJheShhWzFdLGYpKTtyZXR1cm4gYysxPGYubGVuZ3RoP2MrMTpiP251bGw6MH07Im51bWJlciI9PT10eXBlb2YgZVswXSYmKGU9YS5hYVNvcnRpbmc9W2VdKTtjJiZhLm9GZWF0dXJlcy5iU29ydE11bHRpPyhjPWguaW5BcnJheShiLA0KICAgICAgICBEKGUsIjAiKSksLTEhPT1jPyhiPWcoZVtjXSwhMCksbnVsbD09PWImJjE9PT1lLmxlbmd0aCYmKGI9MCksbnVsbD09PWI/ZS5zcGxpY2UoYywxKTooZVtjXVsxXT1mW2JdLGVbY10uX2lkeD1iKSk6KGUucHVzaChbYixmWzBdLDBdKSxlW2UubGVuZ3RoLTFdLl9pZHg9MCkpOmUubGVuZ3RoJiZlWzBdWzBdPT1iPyhiPWcoZVswXSksZS5sZW5ndGg9MSxlWzBdWzFdPWZbYl0sZVswXS5faWR4PWIpOihlLmxlbmd0aD0wLGUucHVzaChbYixmWzBdXSksZVswXS5faWR4PTApO1MoYSk7ImZ1bmN0aW9uIj09dHlwZW9mIGQmJmQoYSl9ZnVuY3Rpb24gTGEoYSxiLGMsZCl7dmFyIGU9YS5hb0NvbHVtbnNbY107VmEoYix7fSxmdW5jdGlvbihiKXshMSE9PWUuYlNvcnRhYmxlJiYoYS5vRmVhdHVyZXMuYlByb2Nlc3Npbmc/KEMoYSwhMCksc2V0VGltZW91dChmdW5jdGlvbigpe1VhKGEsYyxiLnNoaWZ0S2V5LGQpOyJzc3AiIT09eShhKSYmQyhhLCExKX0sMCkpOlVhKGEsYyxiLnNoaWZ0S2V5LGQpKX0pfQ0KICAgIGZ1bmN0aW9uIHdhKGEpe3ZhciBiPWEuYUxhc3RTb3J0LGM9YS5vQ2xhc3Nlcy5zU29ydENvbHVtbixkPVYoYSksZT1hLm9GZWF0dXJlcyxmLGc7aWYoZS5iU29ydCYmZS5iU29ydENsYXNzZXMpe2U9MDtmb3IoZj1iLmxlbmd0aDtlPGY7ZSsrKWc9YltlXS5zcmMsaChEKGEuYW9EYXRhLCJhbkNlbGxzIixnKSkucmVtb3ZlQ2xhc3MoYysoMj5lP2UrMTozKSk7ZT0wO2ZvcihmPWQubGVuZ3RoO2U8ZjtlKyspZz1kW2VdLnNyYyxoKEQoYS5hb0RhdGEsImFuQ2VsbHMiLGcpKS5hZGRDbGFzcyhjKygyPmU/ZSsxOjMpKX1hLmFMYXN0U29ydD1kfWZ1bmN0aW9uIEdiKGEsYil7dmFyIGM9YS5hb0NvbHVtbnNbYl0sZD1tLmV4dC5vcmRlcltjLnNTb3J0RGF0YVR5cGVdLGU7ZCYmKGU9ZC5jYWxsKGEub0luc3RhbmNlLGEsYiwkKGEsYikpKTtmb3IodmFyIGYsZz1tLmV4dC50eXBlLm9yZGVyW2Muc1R5cGUrIi1wcmUiXSxqPTAsaT1hLmFvRGF0YS5sZW5ndGg7ajxpO2orKylpZihjPWEuYW9EYXRhW2pdLA0KICAgICAgICBjLl9hU29ydERhdGF8fChjLl9hU29ydERhdGE9W10pLCFjLl9hU29ydERhdGFbYl18fGQpZj1kP2Vbal06QihhLGosYiwic29ydCIpLGMuX2FTb3J0RGF0YVtiXT1nP2coZik6Zn1mdW5jdGlvbiB4YShhKXtpZihhLm9GZWF0dXJlcy5iU3RhdGVTYXZlJiYhYS5iRGVzdHJveWluZyl7dmFyIGI9e3RpbWU6K25ldyBEYXRlLHN0YXJ0OmEuX2lEaXNwbGF5U3RhcnQsbGVuZ3RoOmEuX2lEaXNwbGF5TGVuZ3RoLG9yZGVyOmguZXh0ZW5kKCEwLFtdLGEuYWFTb3J0aW5nKSxzZWFyY2g6emIoYS5vUHJldmlvdXNTZWFyY2gpLGNvbHVtbnM6aC5tYXAoYS5hb0NvbHVtbnMsZnVuY3Rpb24oYixkKXtyZXR1cm57dmlzaWJsZTpiLmJWaXNpYmxlLHNlYXJjaDp6YihhLmFvUHJlU2VhcmNoQ29sc1tkXSl9fSl9O3IoYSwiYW9TdGF0ZVNhdmVQYXJhbXMiLCJzdGF0ZVNhdmVQYXJhbXMiLFthLGJdKTthLm9TYXZlZFN0YXRlPWI7YS5mblN0YXRlU2F2ZUNhbGxiYWNrLmNhbGwoYS5vSW5zdGFuY2UsYSwNCiAgICAgICAgYil9fWZ1bmN0aW9uIEliKGEsYixjKXt2YXIgZCxlLGY9YS5hb0NvbHVtbnMsYj1mdW5jdGlvbihiKXtpZihiJiZiLnRpbWUpe3ZhciBnPXIoYSwiYW9TdGF0ZUxvYWRQYXJhbXMiLCJzdGF0ZUxvYWRQYXJhbXMiLFthLGJdKTtpZigtMT09PWguaW5BcnJheSghMSxnKSYmKGc9YS5pU3RhdGVEdXJhdGlvbiwhKDA8ZyYmYi50aW1lPCtuZXcgRGF0ZS0xRTMqZykmJiEoYi5jb2x1bW5zJiZmLmxlbmd0aCE9PWIuY29sdW1ucy5sZW5ndGgpKSl7YS5vTG9hZGVkU3RhdGU9aC5leHRlbmQoITAse30sYik7Yi5zdGFydCE9PWsmJihhLl9pRGlzcGxheVN0YXJ0PWIuc3RhcnQsYS5pSW5pdERpc3BsYXlTdGFydD1iLnN0YXJ0KTtiLmxlbmd0aCE9PWsmJihhLl9pRGlzcGxheUxlbmd0aD1iLmxlbmd0aCk7Yi5vcmRlciE9PWsmJihhLmFhU29ydGluZz1bXSxoLmVhY2goYi5vcmRlcixmdW5jdGlvbihiLGMpe2EuYWFTb3J0aW5nLnB1c2goY1swXT49Zi5sZW5ndGg/WzAsY1sxXV06Yyl9KSk7Yi5zZWFyY2ghPT0NCiAgICBrJiZoLmV4dGVuZChhLm9QcmV2aW91c1NlYXJjaCxBYihiLnNlYXJjaCkpO2lmKGIuY29sdW1ucyl7ZD0wO2ZvcihlPWIuY29sdW1ucy5sZW5ndGg7ZDxlO2QrKylnPWIuY29sdW1uc1tkXSxnLnZpc2libGUhPT1rJiYoZltkXS5iVmlzaWJsZT1nLnZpc2libGUpLGcuc2VhcmNoIT09ayYmaC5leHRlbmQoYS5hb1ByZVNlYXJjaENvbHNbZF0sQWIoZy5zZWFyY2gpKX1yKGEsImFvU3RhdGVMb2FkZWQiLCJzdGF0ZUxvYWRlZCIsW2EsYl0pfX1jKCl9O2lmKGEub0ZlYXR1cmVzLmJTdGF0ZVNhdmUpe3ZhciBnPWEuZm5TdGF0ZUxvYWRDYWxsYmFjay5jYWxsKGEub0luc3RhbmNlLGEsYik7ZyE9PWsmJmIoZyl9ZWxzZSBjKCl9ZnVuY3Rpb24geWEoYSl7dmFyIGI9bS5zZXR0aW5ncyxhPWguaW5BcnJheShhLEQoYiwiblRhYmxlIikpO3JldHVybi0xIT09YT9iW2FdOm51bGx9ZnVuY3Rpb24gSihhLGIsYyxkKXtjPSJEYXRhVGFibGVzIHdhcm5pbmc6ICIrKGE/InRhYmxlIGlkPSIrYS5zVGFibGVJZCsNCiAgICAgICAgIiAtICI6IiIpK2M7ZCYmKGMrPSIuIEZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgZXJyb3IsIHBsZWFzZSBzZWUgaHR0cDovL2RhdGF0YWJsZXMubmV0L3RuLyIrZCk7aWYoYilFLmNvbnNvbGUmJmNvbnNvbGUubG9nJiZjb25zb2xlLmxvZyhjKTtlbHNlIGlmKGI9bS5leHQsYj1iLnNFcnJNb2RlfHxiLmVyck1vZGUsYSYmcihhLG51bGwsImVycm9yIixbYSxkLGNdKSwiYWxlcnQiPT1iKWFsZXJ0KGMpO2Vsc2V7aWYoInRocm93Ij09Yil0aHJvdyBFcnJvcihjKTsiZnVuY3Rpb24iPT10eXBlb2YgYiYmYihhLGQsYyl9fWZ1bmN0aW9uIEYoYSxiLGMsZCl7aC5pc0FycmF5KGMpP2guZWFjaChjLGZ1bmN0aW9uKGMsZCl7aC5pc0FycmF5KGQpP0YoYSxiLGRbMF0sZFsxXSk6RihhLGIsZCl9KTooZD09PWsmJihkPWMpLGJbY10hPT1rJiYoYVtkXT1iW2NdKSl9ZnVuY3Rpb24gSmIoYSxiLGMpe3ZhciBkLGU7Zm9yKGUgaW4gYiliLmhhc093blByb3BlcnR5KGUpJiYoZD1iW2VdLA0KICAgICAgICBoLmlzUGxhaW5PYmplY3QoZCk/KGguaXNQbGFpbk9iamVjdChhW2VdKXx8KGFbZV09e30pLGguZXh0ZW5kKCEwLGFbZV0sZCkpOmFbZV09YyYmImRhdGEiIT09ZSYmImFhRGF0YSIhPT1lJiZoLmlzQXJyYXkoZCk/ZC5zbGljZSgpOmQpO3JldHVybiBhfWZ1bmN0aW9uIFZhKGEsYixjKXtoKGEpLm9uKCJjbGljay5EVCIsYixmdW5jdGlvbihiKXthLmJsdXIoKTtjKGIpfSkub24oImtleXByZXNzLkRUIixiLGZ1bmN0aW9uKGEpezEzPT09YS53aGljaCYmKGEucHJldmVudERlZmF1bHQoKSxjKGEpKX0pLm9uKCJzZWxlY3RzdGFydC5EVCIsZnVuY3Rpb24oKXtyZXR1cm4hMX0pfWZ1bmN0aW9uIHooYSxiLGMsZCl7YyYmYVtiXS5wdXNoKHtmbjpjLHNOYW1lOmR9KX1mdW5jdGlvbiByKGEsYixjLGQpe3ZhciBlPVtdO2ImJihlPWgubWFwKGFbYl0uc2xpY2UoKS5yZXZlcnNlKCksZnVuY3Rpb24oYil7cmV0dXJuIGIuZm4uYXBwbHkoYS5vSW5zdGFuY2UsZCl9KSk7bnVsbCE9PWMmJihiPWguRXZlbnQoYysNCiAgICAgICAgIi5kdCIpLGgoYS5uVGFibGUpLnRyaWdnZXIoYixkKSxlLnB1c2goYi5yZXN1bHQpKTtyZXR1cm4gZX1mdW5jdGlvbiBSYShhKXt2YXIgYj1hLl9pRGlzcGxheVN0YXJ0LGM9YS5mbkRpc3BsYXlFbmQoKSxkPWEuX2lEaXNwbGF5TGVuZ3RoO2I+PWMmJihiPWMtZCk7Yi09YiVkO2lmKC0xPT09ZHx8MD5iKWI9MDthLl9pRGlzcGxheVN0YXJ0PWJ9ZnVuY3Rpb24gTWEoYSxiKXt2YXIgYz1hLnJlbmRlcmVyLGQ9bS5leHQucmVuZGVyZXJbYl07cmV0dXJuIGguaXNQbGFpbk9iamVjdChjKSYmY1tiXT9kW2NbYl1dfHxkLl86InN0cmluZyI9PT10eXBlb2YgYz9kW2NdfHxkLl86ZC5ffWZ1bmN0aW9uIHkoYSl7cmV0dXJuIGEub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlPyJzc3AiOmEuYWpheHx8YS5zQWpheFNvdXJjZT8iYWpheCI6ImRvbSJ9ZnVuY3Rpb24gaGEoYSxiKXt2YXIgYz1bXSxjPUtiLm51bWJlcnNfbGVuZ3RoLGQ9TWF0aC5mbG9vcihjLzIpO2I8PWM/Yz1XKDAsYik6YTw9ZD8oYz1XKDAsDQogICAgICAgIGMtMiksYy5wdXNoKCJlbGxpcHNpcyIpLGMucHVzaChiLTEpKTooYT49Yi0xLWQ/Yz1XKGItKGMtMiksYik6KGM9VyhhLWQrMixhK2QtMSksYy5wdXNoKCJlbGxpcHNpcyIpLGMucHVzaChiLTEpKSxjLnNwbGljZSgwLDAsImVsbGlwc2lzIiksYy5zcGxpY2UoMCwwLDApKTtjLkRUX2VsPSJzcGFuIjtyZXR1cm4gY31mdW5jdGlvbiBjYihhKXtoLmVhY2goe251bTpmdW5jdGlvbihiKXtyZXR1cm4gemEoYixhKX0sIm51bS1mbXQiOmZ1bmN0aW9uKGIpe3JldHVybiB6YShiLGEsV2EpfSwiaHRtbC1udW0iOmZ1bmN0aW9uKGIpe3JldHVybiB6YShiLGEsQWEpfSwiaHRtbC1udW0tZm10IjpmdW5jdGlvbihiKXtyZXR1cm4gemEoYixhLEFhLFdhKX19LGZ1bmN0aW9uKGIsYyl7eC50eXBlLm9yZGVyW2IrYSsiLXByZSJdPWM7Yi5tYXRjaCgvXmh0bWxcLS8pJiYoeC50eXBlLnNlYXJjaFtiK2FdPXgudHlwZS5zZWFyY2guaHRtbCl9KX1mdW5jdGlvbiBMYihhKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYj0NCiAgICAgICAgW3lhKHRoaXNbbS5leHQuaUFwaUluZGV4XSldLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTtyZXR1cm4gbS5leHQuaW50ZXJuYWxbYV0uYXBwbHkodGhpcyxiKX19dmFyIG09ZnVuY3Rpb24oYSl7dGhpcy4kPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuYXBpKCEwKS4kKGEsYil9O3RoaXMuXz1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmFwaSghMCkucm93cyhhLGIpLmRhdGEoKX07dGhpcy5hcGk9ZnVuY3Rpb24oYSl7cmV0dXJuIGE/bmV3IHMoeWEodGhpc1t4LmlBcGlJbmRleF0pKTpuZXcgcyh0aGlzKX07dGhpcy5mbkFkZERhdGE9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmFwaSghMCksZD1oLmlzQXJyYXkoYSkmJihoLmlzQXJyYXkoYVswXSl8fGguaXNQbGFpbk9iamVjdChhWzBdKSk/Yy5yb3dzLmFkZChhKTpjLnJvdy5hZGQoYSk7KGI9PT1rfHxiKSYmYy5kcmF3KCk7cmV0dXJuIGQuZmxhdHRlbigpLnRvQXJyYXkoKX07dGhpcy5mbkFkanVzdENvbHVtblNpemluZz0NCiAgICAgICAgZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hcGkoITApLmNvbHVtbnMuYWRqdXN0KCksYz1iLnNldHRpbmdzKClbMF0sZD1jLm9TY3JvbGw7YT09PWt8fGE/Yi5kcmF3KCExKTooIiIhPT1kLnNYfHwiIiE9PWQuc1kpJiZrYShjKX07dGhpcy5mbkNsZWFyVGFibGU9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hcGkoITApLmNsZWFyKCk7KGE9PT1rfHxhKSYmYi5kcmF3KCl9O3RoaXMuZm5DbG9zZT1mdW5jdGlvbihhKXt0aGlzLmFwaSghMCkucm93KGEpLmNoaWxkLmhpZGUoKX07dGhpcy5mbkRlbGV0ZVJvdz1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5hcGkoITApLGE9ZC5yb3dzKGEpLGU9YS5zZXR0aW5ncygpWzBdLGg9ZS5hb0RhdGFbYVswXVswXV07YS5yZW1vdmUoKTtiJiZiLmNhbGwodGhpcyxlLGgpOyhjPT09a3x8YykmJmQuZHJhdygpO3JldHVybiBofTt0aGlzLmZuRGVzdHJveT1mdW5jdGlvbihhKXt0aGlzLmFwaSghMCkuZGVzdHJveShhKX07dGhpcy5mbkRyYXc9ZnVuY3Rpb24oYSl7dGhpcy5hcGkoITApLmRyYXcoYSl9Ow0KICAgICAgICB0aGlzLmZuRmlsdGVyPWZ1bmN0aW9uKGEsYixjLGQsZSxoKXtlPXRoaXMuYXBpKCEwKTtudWxsPT09Ynx8Yj09PWs/ZS5zZWFyY2goYSxjLGQsaCk6ZS5jb2x1bW4oYikuc2VhcmNoKGEsYyxkLGgpO2UuZHJhdygpfTt0aGlzLmZuR2V0RGF0YT1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuYXBpKCEwKTtpZihhIT09ayl7dmFyIGQ9YS5ub2RlTmFtZT9hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk6IiI7cmV0dXJuIGIhPT1rfHwidGQiPT1kfHwidGgiPT1kP2MuY2VsbChhLGIpLmRhdGEoKTpjLnJvdyhhKS5kYXRhKCl8fG51bGx9cmV0dXJuIGMuZGF0YSgpLnRvQXJyYXkoKX07dGhpcy5mbkdldE5vZGVzPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYXBpKCEwKTtyZXR1cm4gYSE9PWs/Yi5yb3coYSkubm9kZSgpOmIucm93cygpLm5vZGVzKCkuZmxhdHRlbigpLnRvQXJyYXkoKX07dGhpcy5mbkdldFBvc2l0aW9uPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYXBpKCEwKSxjPWEubm9kZU5hbWUudG9VcHBlckNhc2UoKTsNCiAgICAgICAgICAgIHJldHVybiJUUiI9PWM/Yi5yb3coYSkuaW5kZXgoKToiVEQiPT1jfHwiVEgiPT1jPyhhPWIuY2VsbChhKS5pbmRleCgpLFthLnJvdyxhLmNvbHVtblZpc2libGUsYS5jb2x1bW5dKTpudWxsfTt0aGlzLmZuSXNPcGVuPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmFwaSghMCkucm93KGEpLmNoaWxkLmlzU2hvd24oKX07dGhpcy5mbk9wZW49ZnVuY3Rpb24oYSxiLGMpe3JldHVybiB0aGlzLmFwaSghMCkucm93KGEpLmNoaWxkKGIsYykuc2hvdygpLmNoaWxkKClbMF19O3RoaXMuZm5QYWdlQ2hhbmdlPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5hcGkoITApLnBhZ2UoYSk7KGI9PT1rfHxiKSYmYy5kcmF3KCExKX07dGhpcy5mblNldENvbHVtblZpcz1mdW5jdGlvbihhLGIsYyl7YT10aGlzLmFwaSghMCkuY29sdW1uKGEpLnZpc2libGUoYik7KGM9PT1rfHxjKSYmYS5jb2x1bW5zLmFkanVzdCgpLmRyYXcoKX07dGhpcy5mblNldHRpbmdzPWZ1bmN0aW9uKCl7cmV0dXJuIHlhKHRoaXNbeC5pQXBpSW5kZXhdKX07DQogICAgICAgIHRoaXMuZm5Tb3J0PWZ1bmN0aW9uKGEpe3RoaXMuYXBpKCEwKS5vcmRlcihhKS5kcmF3KCl9O3RoaXMuZm5Tb3J0TGlzdGVuZXI9ZnVuY3Rpb24oYSxiLGMpe3RoaXMuYXBpKCEwKS5vcmRlci5saXN0ZW5lcihhLGIsYyl9O3RoaXMuZm5VcGRhdGU9ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgaD10aGlzLmFwaSghMCk7Yz09PWt8fG51bGw9PT1jP2gucm93KGIpLmRhdGEoYSk6aC5jZWxsKGIsYykuZGF0YShhKTsoZT09PWt8fGUpJiZoLmNvbHVtbnMuYWRqdXN0KCk7KGQ9PT1rfHxkKSYmaC5kcmF3KCk7cmV0dXJuIDB9O3RoaXMuZm5WZXJzaW9uQ2hlY2s9eC5mblZlcnNpb25DaGVjazt2YXIgYj10aGlzLGM9YT09PWssZD10aGlzLmxlbmd0aDtjJiYoYT17fSk7dGhpcy5vQXBpPXRoaXMuaW50ZXJuYWw9eC5pbnRlcm5hbDtmb3IodmFyIGUgaW4gbS5leHQuaW50ZXJuYWwpZSYmKHRoaXNbZV09TGIoZSkpO3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBlPXt9LGc9MTxkP0piKGUsYSwhMCk6DQogICAgICAgICAgICBhLGo9MCxpLGU9dGhpcy5nZXRBdHRyaWJ1dGUoImlkIiksbj0hMSxsPW0uZGVmYXVsdHMscT1oKHRoaXMpO2lmKCJ0YWJsZSIhPXRoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKSlKKG51bGwsMCwiTm9uLXRhYmxlIG5vZGUgaW5pdGlhbGlzYXRpb24gKCIrdGhpcy5ub2RlTmFtZSsiKSIsMik7ZWxzZXtkYihsKTtlYihsLmNvbHVtbik7SShsLGwsITApO0kobC5jb2x1bW4sbC5jb2x1bW4sITApO0kobCxoLmV4dGVuZChnLHEuZGF0YSgpKSk7dmFyIHQ9bS5zZXR0aW5ncyxqPTA7Zm9yKGk9dC5sZW5ndGg7ajxpO2orKyl7dmFyIG89dFtqXTtpZihvLm5UYWJsZT09dGhpc3x8by5uVEhlYWQucGFyZW50Tm9kZT09dGhpc3x8by5uVEZvb3QmJm8ublRGb290LnBhcmVudE5vZGU9PXRoaXMpe3ZhciBzPWcuYlJldHJpZXZlIT09az9nLmJSZXRyaWV2ZTpsLmJSZXRyaWV2ZTtpZihjfHxzKXJldHVybiBvLm9JbnN0YW5jZTtpZihnLmJEZXN0cm95IT09az9nLmJEZXN0cm95OmwuYkRlc3Ryb3kpe28ub0luc3RhbmNlLmZuRGVzdHJveSgpOw0KICAgICAgICAgICAgYnJlYWt9ZWxzZXtKKG8sMCwiQ2Fubm90IHJlaW5pdGlhbGlzZSBEYXRhVGFibGUiLDMpO3JldHVybn19aWYoby5zVGFibGVJZD09dGhpcy5pZCl7dC5zcGxpY2UoaiwxKTticmVha319aWYobnVsbD09PWV8fCIiPT09ZSl0aGlzLmlkPWU9IkRhdGFUYWJsZXNfVGFibGVfIittLmV4dC5fdW5pcXVlKys7dmFyIHA9aC5leHRlbmQoITAse30sbS5tb2RlbHMub1NldHRpbmdzLHtzRGVzdHJveVdpZHRoOnFbMF0uc3R5bGUud2lkdGgsc0luc3RhbmNlOmUsc1RhYmxlSWQ6ZX0pO3AublRhYmxlPXRoaXM7cC5vQXBpPWIuaW50ZXJuYWw7cC5vSW5pdD1nO3QucHVzaChwKTtwLm9JbnN0YW5jZT0xPT09Yi5sZW5ndGg/YjpxLmRhdGFUYWJsZSgpO2RiKGcpO2cub0xhbmd1YWdlJiZDYShnLm9MYW5ndWFnZSk7Zy5hTGVuZ3RoTWVudSYmIWcuaURpc3BsYXlMZW5ndGgmJihnLmlEaXNwbGF5TGVuZ3RoPWguaXNBcnJheShnLmFMZW5ndGhNZW51WzBdKT9nLmFMZW5ndGhNZW51WzBdWzBdOmcuYUxlbmd0aE1lbnVbMF0pOw0KICAgICAgICAgICAgZz1KYihoLmV4dGVuZCghMCx7fSxsKSxnKTtGKHAub0ZlYXR1cmVzLGcsImJQYWdpbmF0ZSBiTGVuZ3RoQ2hhbmdlIGJGaWx0ZXIgYlNvcnQgYlNvcnRNdWx0aSBiSW5mbyBiUHJvY2Vzc2luZyBiQXV0b1dpZHRoIGJTb3J0Q2xhc3NlcyBiU2VydmVyU2lkZSBiRGVmZXJSZW5kZXIiLnNwbGl0KCIgIikpO0YocCxnLFsiYXNTdHJpcGVDbGFzc2VzIiwiYWpheCIsImZuU2VydmVyRGF0YSIsImZuRm9ybWF0TnVtYmVyIiwic1NlcnZlck1ldGhvZCIsImFhU29ydGluZyIsImFhU29ydGluZ0ZpeGVkIiwiYUxlbmd0aE1lbnUiLCJzUGFnaW5hdGlvblR5cGUiLCJzQWpheFNvdXJjZSIsInNBamF4RGF0YVByb3AiLCJpU3RhdGVEdXJhdGlvbiIsInNEb20iLCJiU29ydENlbGxzVG9wIiwiaVRhYkluZGV4IiwiZm5TdGF0ZUxvYWRDYWxsYmFjayIsImZuU3RhdGVTYXZlQ2FsbGJhY2siLCJyZW5kZXJlciIsInNlYXJjaERlbGF5Iiwicm93SWQiLFsiaUNvb2tpZUR1cmF0aW9uIiwiaVN0YXRlRHVyYXRpb24iXSwNCiAgICAgICAgICAgICAgICBbIm9TZWFyY2giLCJvUHJldmlvdXNTZWFyY2giXSxbImFvU2VhcmNoQ29scyIsImFvUHJlU2VhcmNoQ29scyJdLFsiaURpc3BsYXlMZW5ndGgiLCJfaURpc3BsYXlMZW5ndGgiXV0pO0YocC5vU2Nyb2xsLGcsW1sic1Njcm9sbFgiLCJzWCJdLFsic1Njcm9sbFhJbm5lciIsInNYSW5uZXIiXSxbInNTY3JvbGxZIiwic1kiXSxbImJTY3JvbGxDb2xsYXBzZSIsImJDb2xsYXBzZSJdXSk7RihwLm9MYW5ndWFnZSxnLCJmbkluZm9DYWxsYmFjayIpO3oocCwiYW9EcmF3Q2FsbGJhY2siLGcuZm5EcmF3Q2FsbGJhY2ssInVzZXIiKTt6KHAsImFvU2VydmVyUGFyYW1zIixnLmZuU2VydmVyUGFyYW1zLCJ1c2VyIik7eihwLCJhb1N0YXRlU2F2ZVBhcmFtcyIsZy5mblN0YXRlU2F2ZVBhcmFtcywidXNlciIpO3oocCwiYW9TdGF0ZUxvYWRQYXJhbXMiLGcuZm5TdGF0ZUxvYWRQYXJhbXMsInVzZXIiKTt6KHAsImFvU3RhdGVMb2FkZWQiLGcuZm5TdGF0ZUxvYWRlZCwidXNlciIpO3oocCwiYW9Sb3dDYWxsYmFjayIsDQogICAgICAgICAgICAgICAgZy5mblJvd0NhbGxiYWNrLCJ1c2VyIik7eihwLCJhb1Jvd0NyZWF0ZWRDYWxsYmFjayIsZy5mbkNyZWF0ZWRSb3csInVzZXIiKTt6KHAsImFvSGVhZGVyQ2FsbGJhY2siLGcuZm5IZWFkZXJDYWxsYmFjaywidXNlciIpO3oocCwiYW9Gb290ZXJDYWxsYmFjayIsZy5mbkZvb3RlckNhbGxiYWNrLCJ1c2VyIik7eihwLCJhb0luaXRDb21wbGV0ZSIsZy5mbkluaXRDb21wbGV0ZSwidXNlciIpO3oocCwiYW9QcmVEcmF3Q2FsbGJhY2siLGcuZm5QcmVEcmF3Q2FsbGJhY2ssInVzZXIiKTtwLnJvd0lkRm49UShnLnJvd0lkKTtmYihwKTt2YXIgdT1wLm9DbGFzc2VzO2guZXh0ZW5kKHUsbS5leHQuY2xhc3NlcyxnLm9DbGFzc2VzKTtxLmFkZENsYXNzKHUuc1RhYmxlKTtwLmlJbml0RGlzcGxheVN0YXJ0PT09ayYmKHAuaUluaXREaXNwbGF5U3RhcnQ9Zy5pRGlzcGxheVN0YXJ0LHAuX2lEaXNwbGF5U3RhcnQ9Zy5pRGlzcGxheVN0YXJ0KTtudWxsIT09Zy5pRGVmZXJMb2FkaW5nJiYocC5iRGVmZXJMb2FkaW5nPQ0KICAgICAgICAgICAgICAgICEwLGU9aC5pc0FycmF5KGcuaURlZmVyTG9hZGluZykscC5faVJlY29yZHNEaXNwbGF5PWU/Zy5pRGVmZXJMb2FkaW5nWzBdOmcuaURlZmVyTG9hZGluZyxwLl9pUmVjb3Jkc1RvdGFsPWU/Zy5pRGVmZXJMb2FkaW5nWzFdOmcuaURlZmVyTG9hZGluZyk7dmFyIHY9cC5vTGFuZ3VhZ2U7aC5leHRlbmQoITAsdixnLm9MYW5ndWFnZSk7di5zVXJsJiYoaC5hamF4KHtkYXRhVHlwZToianNvbiIsdXJsOnYuc1VybCxzdWNjZXNzOmZ1bmN0aW9uKGEpe0NhKGEpO0kobC5vTGFuZ3VhZ2UsYSk7aC5leHRlbmQodHJ1ZSx2LGEpO2dhKHApfSxlcnJvcjpmdW5jdGlvbigpe2dhKHApfX0pLG49ITApO251bGw9PT1nLmFzU3RyaXBlQ2xhc3NlcyYmKHAuYXNTdHJpcGVDbGFzc2VzPVt1LnNTdHJpcGVPZGQsdS5zU3RyaXBlRXZlbl0pO3ZhciBlPXAuYXNTdHJpcGVDbGFzc2VzLHg9cS5jaGlsZHJlbigidGJvZHkiKS5maW5kKCJ0ciIpLmVxKDApOy0xIT09aC5pbkFycmF5KCEwLGgubWFwKGUsZnVuY3Rpb24oYSl7cmV0dXJuIHguaGFzQ2xhc3MoYSl9KSkmJg0KICAgICAgICAgICAgKGgoInRib2R5IHRyIix0aGlzKS5yZW1vdmVDbGFzcyhlLmpvaW4oIiAiKSkscC5hc0Rlc3Ryb3lTdHJpcGVzPWUuc2xpY2UoKSk7ZT1bXTt0PXRoaXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRoZWFkIik7MCE9PXQubGVuZ3RoJiYoZGEocC5hb0hlYWRlcix0WzBdKSxlPXJhKHApKTtpZihudWxsPT09Zy5hb0NvbHVtbnMpe3Q9W107aj0wO2ZvcihpPWUubGVuZ3RoO2o8aTtqKyspdC5wdXNoKG51bGwpfWVsc2UgdD1nLmFvQ29sdW1ucztqPTA7Zm9yKGk9dC5sZW5ndGg7ajxpO2orKylEYShwLGU/ZVtqXTpudWxsKTtoYihwLGcuYW9Db2x1bW5EZWZzLHQsZnVuY3Rpb24oYSxiKXtqYShwLGEsYil9KTtpZih4Lmxlbmd0aCl7dmFyIHc9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImRhdGEtIitiKSE9PW51bGw/YjpudWxsfTtoKHhbMF0pLmNoaWxkcmVuKCJ0aCwgdGQiKS5lYWNoKGZ1bmN0aW9uKGEsYil7dmFyIGM9cC5hb0NvbHVtbnNbYV07aWYoYy5tRGF0YT09PQ0KICAgICAgICAgICAgICAgIGEpe3ZhciBkPXcoYiwic29ydCIpfHx3KGIsIm9yZGVyIiksZT13KGIsImZpbHRlciIpfHx3KGIsInNlYXJjaCIpO2lmKGQhPT1udWxsfHxlIT09bnVsbCl7Yy5tRGF0YT17XzphKyIuZGlzcGxheSIsc29ydDpkIT09bnVsbD9hKyIuQGRhdGEtIitkOmssdHlwZTpkIT09bnVsbD9hKyIuQGRhdGEtIitkOmssZmlsdGVyOmUhPT1udWxsP2ErIi5AZGF0YS0iK2U6a307amEocCxhKX19fSl9dmFyIFQ9cC5vRmVhdHVyZXMsZT1mdW5jdGlvbigpe2lmKGcuYWFTb3J0aW5nPT09ayl7dmFyIGE9cC5hYVNvcnRpbmc7aj0wO2ZvcihpPWEubGVuZ3RoO2o8aTtqKyspYVtqXVsxXT1wLmFvQ29sdW1uc1tqXS5hc1NvcnRpbmdbMF19d2EocCk7VC5iU29ydCYmeihwLCJhb0RyYXdDYWxsYmFjayIsZnVuY3Rpb24oKXtpZihwLmJTb3J0ZWQpe3ZhciBhPVYocCksYj17fTtoLmVhY2goYSxmdW5jdGlvbihhLGMpe2JbYy5zcmNdPWMuZGlyfSk7cihwLG51bGwsIm9yZGVyIixbcCxhLGJdKTtIYihwKX19KTsNCiAgICAgICAgICAgICAgICB6KHAsImFvRHJhd0NhbGxiYWNrIixmdW5jdGlvbigpeyhwLmJTb3J0ZWR8fHkocCk9PT0ic3NwInx8VC5iRGVmZXJSZW5kZXIpJiZ3YShwKX0sInNjIik7dmFyIGE9cS5jaGlsZHJlbigiY2FwdGlvbiIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLl9jYXB0aW9uU2lkZT1oKHRoaXMpLmNzcygiY2FwdGlvbi1zaWRlIil9KSxiPXEuY2hpbGRyZW4oInRoZWFkIik7Yi5sZW5ndGg9PT0wJiYoYj1oKCI8dGhlYWQvPiIpLmFwcGVuZFRvKHEpKTtwLm5USGVhZD1iWzBdO2I9cS5jaGlsZHJlbigidGJvZHkiKTtiLmxlbmd0aD09PTAmJihiPWgoIjx0Ym9keS8+IikuYXBwZW5kVG8ocSkpO3AublRCb2R5PWJbMF07Yj1xLmNoaWxkcmVuKCJ0Zm9vdCIpO2lmKGIubGVuZ3RoPT09MCYmYS5sZW5ndGg+MCYmKHAub1Njcm9sbC5zWCE9PSIifHxwLm9TY3JvbGwuc1khPT0iIikpYj1oKCI8dGZvb3QvPiIpLmFwcGVuZFRvKHEpO2lmKGIubGVuZ3RoPT09MHx8Yi5jaGlsZHJlbigpLmxlbmd0aD09PTApcS5hZGRDbGFzcyh1LnNOb0Zvb3Rlcik7DQogICAgICAgICAgICAgICAgZWxzZSBpZihiLmxlbmd0aD4wKXtwLm5URm9vdD1iWzBdO2RhKHAuYW9Gb290ZXIscC5uVEZvb3QpfWlmKGcuYWFEYXRhKWZvcihqPTA7ajxnLmFhRGF0YS5sZW5ndGg7aisrKU0ocCxnLmFhRGF0YVtqXSk7ZWxzZShwLmJEZWZlckxvYWRpbmd8fHkocCk9PSJkb20iKSYmbWEocCxoKHAublRCb2R5KS5jaGlsZHJlbigidHIiKSk7cC5haURpc3BsYXk9cC5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTtwLmJJbml0aWFsaXNlZD10cnVlO249PT1mYWxzZSYmZ2EocCl9O2cuYlN0YXRlU2F2ZT8oVC5iU3RhdGVTYXZlPSEwLHoocCwiYW9EcmF3Q2FsbGJhY2siLHhhLCJzdGF0ZV9zYXZlIiksSWIocCxnLGUpKTplKCl9fSk7Yj1udWxsO3JldHVybiB0aGlzfSx4LHMsbyx1LFhhPXt9LE1iPS9bXHJcbl0vZyxBYT0vPC4qPz4vZyxaYj0vXlxkezIsNH1bXC5cL1wtXVxkezEsMn1bXC5cL1wtXVxkezEsMn0oW1QgXXsxfVxkezEsMn1bOlwuXVxkezJ9KFtcLjpdXGR7Mn0pPyk/JC8sJGI9UmVnRXhwKCIoXFwvfFxcLnxcXCp8XFwrfFxcP3xcXHx8XFwofFxcKXxcXFt8XFxdfFxce3xcXH18XFxcXHxcXCR8XFxefFxcLSkiLA0KICAgICAgICAiZyIpLFdhPS9bJywkwqPigqzCpSVcdTIwMDlcdTIwMkZcdTIwQkRcdTIwYTlcdTIwQkFyZmtdL2dpLEw9ZnVuY3Rpb24oYSl7cmV0dXJuIWF8fCEwPT09YXx8Ii0iPT09YT8hMDohMX0sTmI9ZnVuY3Rpb24oYSl7dmFyIGI9cGFyc2VJbnQoYSwxMCk7cmV0dXJuIWlzTmFOKGIpJiZpc0Zpbml0ZShhKT9iOm51bGx9LE9iPWZ1bmN0aW9uKGEsYil7WGFbYl18fChYYVtiXT1SZWdFeHAoUGEoYiksImciKSk7cmV0dXJuInN0cmluZyI9PT10eXBlb2YgYSYmIi4iIT09Yj9hLnJlcGxhY2UoL1wuL2csIiIpLnJlcGxhY2UoWGFbYl0sIi4iKTphfSxZYT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9InN0cmluZyI9PT10eXBlb2YgYTtpZihMKGEpKXJldHVybiEwO2ImJmQmJihhPU9iKGEsYikpO2MmJmQmJihhPWEucmVwbGFjZShXYSwiIikpO3JldHVybiFpc05hTihwYXJzZUZsb2F0KGEpKSYmaXNGaW5pdGUoYSl9LFBiPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gTChhKT8hMDohKEwoYSl8fCJzdHJpbmciPT09DQogICAgICAgIHR5cGVvZiBhKT9udWxsOllhKGEucmVwbGFjZShBYSwiIiksYixjKT8hMDpudWxsfSxEPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1bXSxlPTAsZj1hLmxlbmd0aDtpZihjIT09aylmb3IoO2U8ZjtlKyspYVtlXSYmYVtlXVtiXSYmZC5wdXNoKGFbZV1bYl1bY10pO2Vsc2UgZm9yKDtlPGY7ZSsrKWFbZV0mJmQucHVzaChhW2VdW2JdKTtyZXR1cm4gZH0saWE9ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9W10sZj0wLGc9Yi5sZW5ndGg7aWYoZCE9PWspZm9yKDtmPGc7ZisrKWFbYltmXV1bY10mJmUucHVzaChhW2JbZl1dW2NdW2RdKTtlbHNlIGZvcig7ZjxnO2YrKyllLnB1c2goYVtiW2ZdXVtjXSk7cmV0dXJuIGV9LFc9ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXSxkO2I9PT1rPyhiPTAsZD1hKTooZD1iLGI9YSk7Zm9yKHZhciBlPWI7ZTxkO2UrKyljLnB1c2goZSk7cmV0dXJuIGN9LFFiPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj1bXSxjPTAsZD1hLmxlbmd0aDtjPGQ7YysrKWFbY10mJmIucHVzaChhW2NdKTsNCiAgICAgICAgcmV0dXJuIGJ9LHFhPWZ1bmN0aW9uKGEpe3ZhciBiO2E6e2lmKCEoMj5hLmxlbmd0aCkpe2I9YS5zbGljZSgpLnNvcnQoKTtmb3IodmFyIGM9YlswXSxkPTEsZT1iLmxlbmd0aDtkPGU7ZCsrKXtpZihiW2RdPT09Yyl7Yj0hMTticmVhayBhfWM9YltkXX19Yj0hMH1pZihiKXJldHVybiBhLnNsaWNlKCk7Yj1bXTt2YXIgZT1hLmxlbmd0aCxmLGc9MCxkPTA7YTpmb3IoO2Q8ZTtkKyspe2M9YVtkXTtmb3IoZj0wO2Y8ZztmKyspaWYoYltmXT09PWMpY29udGludWUgYTtiLnB1c2goYyk7ZysrfXJldHVybiBifTttLnV0aWw9e3Rocm90dGxlOmZ1bmN0aW9uKGEsYil7dmFyIGM9YiE9PWs/YjoyMDAsZCxlO3JldHVybiBmdW5jdGlvbigpe3ZhciBiPXRoaXMsZz0rbmV3IERhdGUsaj1hcmd1bWVudHM7ZCYmZzxkK2M/KGNsZWFyVGltZW91dChlKSxlPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtkPWs7YS5hcHBseShiLGopfSxjKSk6KGQ9ZyxhLmFwcGx5KGIsaikpfX0sZXNjYXBlUmVnZXg6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgkYiwNCiAgICAgICAgIlxcJDEiKX19O3ZhciBBPWZ1bmN0aW9uKGEsYixjKXthW2JdIT09ayYmKGFbY109YVtiXSl9LGJhPS9cWy4qP1xdJC8sVT0vXChcKSQvLFBhPW0udXRpbC5lc2NhcGVSZWdleCx2YT1oKCI8ZGl2PiIpWzBdLFdiPXZhLnRleHRDb250ZW50IT09ayxZYj0vPC4qPz4vZyxOYT1tLnV0aWwudGhyb3R0bGUsUmI9W10sdz1BcnJheS5wcm90b3R5cGUsYWM9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkPW0uc2V0dGluZ3MsZT1oLm1hcChkLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5UYWJsZX0pO2lmKGEpe2lmKGEublRhYmxlJiZhLm9BcGkpcmV0dXJuW2FdO2lmKGEubm9kZU5hbWUmJiJ0YWJsZSI9PT1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuIGI9aC5pbkFycmF5KGEsZSksLTEhPT1iP1tkW2JdXTpudWxsO2lmKGEmJiJmdW5jdGlvbiI9PT10eXBlb2YgYS5zZXR0aW5ncylyZXR1cm4gYS5zZXR0aW5ncygpLnRvQXJyYXkoKTsic3RyaW5nIj09PXR5cGVvZiBhP2M9aChhKTphIGluc3RhbmNlb2YNCiAgICAgICAgaCYmKGM9YSl9ZWxzZSByZXR1cm5bXTtpZihjKXJldHVybiBjLm1hcChmdW5jdGlvbigpe2I9aC5pbkFycmF5KHRoaXMsZSk7cmV0dXJuLTEhPT1iP2RbYl06bnVsbH0pLnRvQXJyYXkoKX07cz1mdW5jdGlvbihhLGIpe2lmKCEodGhpcyBpbnN0YW5jZW9mIHMpKXJldHVybiBuZXcgcyhhLGIpO3ZhciBjPVtdLGQ9ZnVuY3Rpb24oYSl7KGE9YWMoYSkpJiYoYz1jLmNvbmNhdChhKSl9O2lmKGguaXNBcnJheShhKSlmb3IodmFyIGU9MCxmPWEubGVuZ3RoO2U8ZjtlKyspZChhW2VdKTtlbHNlIGQoYSk7dGhpcy5jb250ZXh0PXFhKGMpO2ImJmgubWVyZ2UodGhpcyxiKTt0aGlzLnNlbGVjdG9yPXtyb3dzOm51bGwsY29sczpudWxsLG9wdHM6bnVsbH07cy5leHRlbmQodGhpcyx0aGlzLFJiKX07bS5BcGk9cztoLmV4dGVuZChzLnByb3RvdHlwZSx7YW55OmZ1bmN0aW9uKCl7cmV0dXJuIDAhPT10aGlzLmNvdW50KCl9LGNvbmNhdDp3LmNvbmNhdCxjb250ZXh0OltdLGNvdW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZmxhdHRlbigpLmxlbmd0aH0sDQogICAgICAgIGVhY2g6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPTAsYz10aGlzLmxlbmd0aDtiPGM7YisrKWEuY2FsbCh0aGlzLHRoaXNbYl0sYix0aGlzKTtyZXR1cm4gdGhpc30sZXE6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5jb250ZXh0O3JldHVybiBiLmxlbmd0aD5hP25ldyBzKGJbYV0sdGhpc1thXSk6bnVsbH0sZmlsdGVyOmZ1bmN0aW9uKGEpe3ZhciBiPVtdO2lmKHcuZmlsdGVyKWI9dy5maWx0ZXIuY2FsbCh0aGlzLGEsdGhpcyk7ZWxzZSBmb3IodmFyIGM9MCxkPXRoaXMubGVuZ3RoO2M8ZDtjKyspYS5jYWxsKHRoaXMsdGhpc1tjXSxjLHRoaXMpJiZiLnB1c2godGhpc1tjXSk7cmV0dXJuIG5ldyBzKHRoaXMuY29udGV4dCxiKX0sZmxhdHRlbjpmdW5jdGlvbigpe3ZhciBhPVtdO3JldHVybiBuZXcgcyh0aGlzLmNvbnRleHQsYS5jb25jYXQuYXBwbHkoYSx0aGlzLnRvQXJyYXkoKSkpfSxqb2luOncuam9pbixpbmRleE9mOncuaW5kZXhPZnx8ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9Ynx8MCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZD10aGlzLmxlbmd0aDtjPGQ7YysrKWlmKHRoaXNbY109PT1hKXJldHVybiBjO3JldHVybi0xfSxpdGVyYXRvcjpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1bXSxmLGcsaixoLG4sbD10aGlzLmNvbnRleHQsbSxvLHU9dGhpcy5zZWxlY3Rvcjsic3RyaW5nIj09PXR5cGVvZiBhJiYoZD1jLGM9YixiPWEsYT0hMSk7Zz0wO2ZvcihqPWwubGVuZ3RoO2c8ajtnKyspe3ZhciByPW5ldyBzKGxbZ10pO2lmKCJ0YWJsZSI9PT1iKWY9Yy5jYWxsKHIsbFtnXSxnKSxmIT09ayYmZS5wdXNoKGYpO2Vsc2UgaWYoImNvbHVtbnMiPT09Ynx8InJvd3MiPT09YilmPWMuY2FsbChyLGxbZ10sdGhpc1tnXSxnKSxmIT09ayYmZS5wdXNoKGYpO2Vsc2UgaWYoImNvbHVtbiI9PT1ifHwiY29sdW1uLXJvd3MiPT09Ynx8InJvdyI9PT1ifHwiY2VsbCI9PT1iKXtvPXRoaXNbZ107ImNvbHVtbi1yb3dzIj09PWImJihtPUJhKGxbZ10sdS5vcHRzKSk7aD0wO2ZvcihuPW8ubGVuZ3RoO2g8bjtoKyspZj1vW2hdLGY9DQogICAgICAgICAgICAiY2VsbCI9PT1iP2MuY2FsbChyLGxbZ10sZi5yb3csZi5jb2x1bW4sZyxoKTpjLmNhbGwocixsW2ddLGYsZyxoLG0pLGYhPT1rJiZlLnB1c2goZil9fXJldHVybiBlLmxlbmd0aHx8ZD8oYT1uZXcgcyhsLGE/ZS5jb25jYXQuYXBwbHkoW10sZSk6ZSksYj1hLnNlbGVjdG9yLGIucm93cz11LnJvd3MsYi5jb2xzPXUuY29scyxiLm9wdHM9dS5vcHRzLGEpOnRoaXN9LGxhc3RJbmRleE9mOncubGFzdEluZGV4T2Z8fGZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuaW5kZXhPZi5hcHBseSh0aGlzLnRvQXJyYXkucmV2ZXJzZSgpLGFyZ3VtZW50cyl9LGxlbmd0aDowLG1hcDpmdW5jdGlvbihhKXt2YXIgYj1bXTtpZih3Lm1hcCliPXcubWFwLmNhbGwodGhpcyxhLHRoaXMpO2Vsc2UgZm9yKHZhciBjPTAsZD10aGlzLmxlbmd0aDtjPGQ7YysrKWIucHVzaChhLmNhbGwodGhpcyx0aGlzW2NdLGMpKTtyZXR1cm4gbmV3IHModGhpcy5jb250ZXh0LGIpfSxwbHVjazpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oYil7cmV0dXJuIGJbYV19KX0sDQogICAgICAgIHBvcDp3LnBvcCxwdXNoOncucHVzaCxyZWR1Y2U6dy5yZWR1Y2V8fGZ1bmN0aW9uKGEsYil7cmV0dXJuIGdiKHRoaXMsYSxiLDAsdGhpcy5sZW5ndGgsMSl9LHJlZHVjZVJpZ2h0OncucmVkdWNlUmlnaHR8fGZ1bmN0aW9uKGEsYil7cmV0dXJuIGdiKHRoaXMsYSxiLHRoaXMubGVuZ3RoLTEsLTEsLTEpfSxyZXZlcnNlOncucmV2ZXJzZSxzZWxlY3RvcjpudWxsLHNoaWZ0Oncuc2hpZnQsc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHModGhpcy5jb250ZXh0LHRoaXMpfSxzb3J0Oncuc29ydCxzcGxpY2U6dy5zcGxpY2UsdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiB3LnNsaWNlLmNhbGwodGhpcyl9LHRvJDpmdW5jdGlvbigpe3JldHVybiBoKHRoaXMpfSx0b0pRdWVyeTpmdW5jdGlvbigpe3JldHVybiBoKHRoaXMpfSx1bmlxdWU6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHModGhpcy5jb250ZXh0LHFhKHRoaXMpKX0sdW5zaGlmdDp3LnVuc2hpZnR9KTtzLmV4dGVuZD1mdW5jdGlvbihhLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYixjKXtpZihjLmxlbmd0aCYmYiYmKGIgaW5zdGFuY2VvZiBzfHxiLl9fZHRfd3JhcHBlcikpe3ZhciBkLGUsZixnPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZD1iLmFwcGx5KGEsYXJndW1lbnRzKTtzLmV4dGVuZChkLGQsYy5tZXRob2RFeHQpO3JldHVybiBkfX07ZD0wO2ZvcihlPWMubGVuZ3RoO2Q8ZTtkKyspZj1jW2RdLGJbZi5uYW1lXT0iZnVuY3Rpb24iPT09dHlwZW9mIGYudmFsP2coYSxmLnZhbCxmKTpoLmlzUGxhaW5PYmplY3QoZi52YWwpP3t9OmYudmFsLGJbZi5uYW1lXS5fX2R0X3dyYXBwZXI9ITAscy5leHRlbmQoYSxiW2YubmFtZV0sZi5wcm9wRXh0KX19O3MucmVnaXN0ZXI9bz1mdW5jdGlvbihhLGIpe2lmKGguaXNBcnJheShhKSlmb3IodmFyIGM9MCxkPWEubGVuZ3RoO2M8ZDtjKyspcy5yZWdpc3RlcihhW2NdLGIpO2Vsc2UgZm9yKHZhciBlPWEuc3BsaXQoIi4iKSxmPVJiLGcsaixjPTAsZD1lLmxlbmd0aDtjPGQ7YysrKXtnPShqPS0xIT09DQogICAgICAgIGVbY10uaW5kZXhPZigiKCkiKSk/ZVtjXS5yZXBsYWNlKCIoKSIsIiIpOmVbY107dmFyIGk7YTp7aT0wO2Zvcih2YXIgbj1mLmxlbmd0aDtpPG47aSsrKWlmKGZbaV0ubmFtZT09PWcpe2k9ZltpXTticmVhayBhfWk9bnVsbH1pfHwoaT17bmFtZTpnLHZhbDp7fSxtZXRob2RFeHQ6W10scHJvcEV4dDpbXX0sZi5wdXNoKGkpKTtjPT09ZC0xP2kudmFsPWI6Zj1qP2kubWV0aG9kRXh0OmkucHJvcEV4dH19O3MucmVnaXN0ZXJQbHVyYWw9dT1mdW5jdGlvbihhLGIsYyl7cy5yZWdpc3RlcihhLGMpO3MucmVnaXN0ZXIoYixmdW5jdGlvbigpe3ZhciBhPWMuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiBhPT09dGhpcz90aGlzOmEgaW5zdGFuY2VvZiBzP2EubGVuZ3RoP2guaXNBcnJheShhWzBdKT9uZXcgcyhhLmNvbnRleHQsYVswXSk6YVswXTprOmF9KX07bygidGFibGVzKCkiLGZ1bmN0aW9uKGEpe3ZhciBiO2lmKGEpe2I9czt2YXIgYz10aGlzLmNvbnRleHQ7aWYoIm51bWJlciI9PT0NCiAgICAgICAgdHlwZW9mIGEpYT1bY1thXV07ZWxzZSB2YXIgZD1oLm1hcChjLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5UYWJsZX0pLGE9aChkKS5maWx0ZXIoYSkubWFwKGZ1bmN0aW9uKCl7dmFyIGE9aC5pbkFycmF5KHRoaXMsZCk7cmV0dXJuIGNbYV19KS50b0FycmF5KCk7Yj1uZXcgYihhKX1lbHNlIGI9dGhpcztyZXR1cm4gYn0pO28oInRhYmxlKCkiLGZ1bmN0aW9uKGEpe3ZhciBhPXRoaXMudGFibGVzKGEpLGI9YS5jb250ZXh0O3JldHVybiBiLmxlbmd0aD9uZXcgcyhiWzBdKTphfSk7dSgidGFibGVzKCkubm9kZXMoKSIsInRhYmxlKCkubm9kZSgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSl7cmV0dXJuIGEublRhYmxlfSwxKX0pO3UoInRhYmxlcygpLmJvZHkoKSIsInRhYmxlKCkuYm9keSgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSl7cmV0dXJuIGEublRCb2R5fSwxKX0pO3UoInRhYmxlcygpLmhlYWRlcigpIiwNCiAgICAgICAgInRhYmxlKCkuaGVhZGVyKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtyZXR1cm4gYS5uVEhlYWR9LDEpfSk7dSgidGFibGVzKCkuZm9vdGVyKCkiLCJ0YWJsZSgpLmZvb3RlcigpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSl7cmV0dXJuIGEublRGb290fSwxKX0pO3UoInRhYmxlcygpLmNvbnRhaW5lcnMoKSIsInRhYmxlKCkuY29udGFpbmVyKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtyZXR1cm4gYS5uVGFibGVXcmFwcGVyfSwxKX0pO28oImRyYXcoKSIsZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihiKXsicGFnZSI9PT1hP04oYik6KCJzdHJpbmciPT09dHlwZW9mIGEmJihhPSJmdWxsLWhvbGQiPT09YT8hMTohMCksUyhiLCExPT09YSkpfSl9KTtvKCJwYWdlKCkiLGZ1bmN0aW9uKGEpe3JldHVybiBhPT09DQogICAgaz90aGlzLnBhZ2UuaW5mbygpLnBhZ2U6dGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGIpe1NhKGIsYSl9KX0pO28oInBhZ2UuaW5mbygpIixmdW5jdGlvbigpe2lmKDA9PT10aGlzLmNvbnRleHQubGVuZ3RoKXJldHVybiBrO3ZhciBhPXRoaXMuY29udGV4dFswXSxiPWEuX2lEaXNwbGF5U3RhcnQsYz1hLm9GZWF0dXJlcy5iUGFnaW5hdGU/YS5faURpc3BsYXlMZW5ndGg6LTEsZD1hLmZuUmVjb3Jkc0Rpc3BsYXkoKSxlPS0xPT09YztyZXR1cm57cGFnZTplPzA6TWF0aC5mbG9vcihiL2MpLHBhZ2VzOmU/MTpNYXRoLmNlaWwoZC9jKSxzdGFydDpiLGVuZDphLmZuRGlzcGxheUVuZCgpLGxlbmd0aDpjLHJlY29yZHNUb3RhbDphLmZuUmVjb3Jkc1RvdGFsKCkscmVjb3Jkc0Rpc3BsYXk6ZCxzZXJ2ZXJTaWRlOiJzc3AiPT09eShhKX19KTtvKCJwYWdlLmxlbigpIixmdW5jdGlvbihhKXtyZXR1cm4gYT09PWs/MCE9PXRoaXMuY29udGV4dC5sZW5ndGg/dGhpcy5jb250ZXh0WzBdLl9pRGlzcGxheUxlbmd0aDoNCiAgICAgICAgazp0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7UWEoYixhKX0pfSk7dmFyIFNiPWZ1bmN0aW9uKGEsYixjKXtpZihjKXt2YXIgZD1uZXcgcyhhKTtkLm9uZSgiZHJhdyIsZnVuY3Rpb24oKXtjKGQuYWpheC5qc29uKCkpfSl9aWYoInNzcCI9PXkoYSkpUyhhLGIpO2Vsc2V7QyhhLCEwKTt2YXIgZT1hLmpxWEhSO2UmJjQhPT1lLnJlYWR5U3RhdGUmJmUuYWJvcnQoKTtzYShhLFtdLGZ1bmN0aW9uKGMpe25hKGEpO2Zvcih2YXIgYz10YShhLGMpLGQ9MCxlPWMubGVuZ3RoO2Q8ZTtkKyspTShhLGNbZF0pO1MoYSxiKTtDKGEsITEpfSl9fTtvKCJhamF4Lmpzb24oKSIsZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvbnRleHQ7aWYoMDxhLmxlbmd0aClyZXR1cm4gYVswXS5qc29ufSk7bygiYWpheC5wYXJhbXMoKSIsZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvbnRleHQ7aWYoMDxhLmxlbmd0aClyZXR1cm4gYVswXS5vQWpheERhdGF9KTtvKCJhamF4LnJlbG9hZCgpIixmdW5jdGlvbihhLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYyl7U2IoYywhMT09PWIsYSl9KX0pO28oImFqYXgudXJsKCkiLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuY29udGV4dDtpZihhPT09ayl7aWYoMD09PWIubGVuZ3RoKXJldHVybiBrO2I9YlswXTtyZXR1cm4gYi5hamF4P2guaXNQbGFpbk9iamVjdChiLmFqYXgpP2IuYWpheC51cmw6Yi5hamF4OmIuc0FqYXhTb3VyY2V9cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihiKXtoLmlzUGxhaW5PYmplY3QoYi5hamF4KT9iLmFqYXgudXJsPWE6Yi5hamF4PWF9KX0pO28oImFqYXgudXJsKCkubG9hZCgpIixmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYyl7U2IoYywhMT09PWIsYSl9KX0pO3ZhciBaYT1mdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPVtdLGcsaixpLG4sbCxtO2k9dHlwZW9mIGI7aWYoIWJ8fCJzdHJpbmciPT09aXx8ImZ1bmN0aW9uIj09PQ0KICAgICAgICBpfHxiLmxlbmd0aD09PWspYj1bYl07aT0wO2ZvcihuPWIubGVuZ3RoO2k8bjtpKyspe2o9YltpXSYmYltpXS5zcGxpdCYmIWJbaV0ubWF0Y2goL1tcW1woOl0vKT9iW2ldLnNwbGl0KCIsIik6W2JbaV1dO2w9MDtmb3IobT1qLmxlbmd0aDtsPG07bCsrKShnPWMoInN0cmluZyI9PT10eXBlb2YgaltsXT9oLnRyaW0oaltsXSk6altsXSkpJiZnLmxlbmd0aCYmKGY9Zi5jb25jYXQoZykpfWE9eC5zZWxlY3RvclthXTtpZihhLmxlbmd0aCl7aT0wO2ZvcihuPWEubGVuZ3RoO2k8bjtpKyspZj1hW2ldKGQsZSxmKX1yZXR1cm4gcWEoZil9LCRhPWZ1bmN0aW9uKGEpe2F8fChhPXt9KTthLmZpbHRlciYmYS5zZWFyY2g9PT1rJiYoYS5zZWFyY2g9YS5maWx0ZXIpO3JldHVybiBoLmV4dGVuZCh7c2VhcmNoOiJub25lIixvcmRlcjoiY3VycmVudCIscGFnZToiYWxsIn0sYSl9LGFiPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj0wLGM9YS5sZW5ndGg7YjxjO2IrKylpZigwPGFbYl0ubGVuZ3RoKXJldHVybiBhWzBdPQ0KICAgICAgICBhW2JdLGFbMF0ubGVuZ3RoPTEsYS5sZW5ndGg9MSxhLmNvbnRleHQ9W2EuY29udGV4dFtiXV0sYTthLmxlbmd0aD0wO3JldHVybiBhfSxCYT1mdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxmPVtdLGc9YS5haURpc3BsYXk7Yz1hLmFpRGlzcGxheU1hc3Rlcjt2YXIgaj1iLnNlYXJjaDtkPWIub3JkZXI7ZT1iLnBhZ2U7aWYoInNzcCI9PXkoYSkpcmV0dXJuInJlbW92ZWQiPT09aj9bXTpXKDAsYy5sZW5ndGgpO2lmKCJjdXJyZW50Ij09ZSl7Yz1hLl9pRGlzcGxheVN0YXJ0O2ZvcihkPWEuZm5EaXNwbGF5RW5kKCk7YzxkO2MrKylmLnB1c2goZ1tjXSl9ZWxzZSBpZigiY3VycmVudCI9PWR8fCJhcHBsaWVkIj09ZClmPSJub25lIj09aj9jLnNsaWNlKCk6ImFwcGxpZWQiPT1qP2cuc2xpY2UoKTpoLm1hcChjLGZ1bmN0aW9uKGEpe3JldHVybi0xPT09aC5pbkFycmF5KGEsZyk/YTpudWxsfSk7ZWxzZSBpZigiaW5kZXgiPT1kfHwib3JpZ2luYWwiPT1kKXtjPTA7Zm9yKGQ9YS5hb0RhdGEubGVuZ3RoO2M8DQogICAgZDtjKyspIm5vbmUiPT1qP2YucHVzaChjKTooZT1oLmluQXJyYXkoYyxnKSwoLTE9PT1lJiYicmVtb3ZlZCI9PWp8fDA8PWUmJiJhcHBsaWVkIj09aikmJmYucHVzaChjKSl9cmV0dXJuIGZ9O28oInJvd3MoKSIsZnVuY3Rpb24oYSxiKXthPT09az9hPSIiOmguaXNQbGFpbk9iamVjdChhKSYmKGI9YSxhPSIiKTt2YXIgYj0kYShiKSxjPXRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihjKXt2YXIgZT1iLGY7cmV0dXJuIFphKCJyb3ciLGEsZnVuY3Rpb24oYSl7dmFyIGI9TmIoYSk7aWYoYiE9PW51bGwmJiFlKXJldHVybltiXTtmfHwoZj1CYShjLGUpKTtpZihiIT09bnVsbCYmaC5pbkFycmF5KGIsZikhPT0tMSlyZXR1cm5bYl07aWYoYT09PW51bGx8fGE9PT1rfHxhPT09IiIpcmV0dXJuIGY7aWYodHlwZW9mIGE9PT0iZnVuY3Rpb24iKXJldHVybiBoLm1hcChmLGZ1bmN0aW9uKGIpe3ZhciBlPWMuYW9EYXRhW2JdO3JldHVybiBhKGIsZS5fYURhdGEsZS5uVHIpP2I6bnVsbH0pOw0KICAgICAgICBiPVFiKGlhKGMuYW9EYXRhLGYsIm5UciIpKTtpZihhLm5vZGVOYW1lKXtpZihhLl9EVF9Sb3dJbmRleCE9PWspcmV0dXJuW2EuX0RUX1Jvd0luZGV4XTtpZihhLl9EVF9DZWxsSW5kZXgpcmV0dXJuW2EuX0RUX0NlbGxJbmRleC5yb3ddO2I9aChhKS5jbG9zZXN0KCIqW2RhdGEtZHQtcm93XSIpO3JldHVybiBiLmxlbmd0aD9bYi5kYXRhKCJkdC1yb3ciKV06W119aWYodHlwZW9mIGE9PT0ic3RyaW5nIiYmYS5jaGFyQXQoMCk9PT0iIyIpe3ZhciBpPWMuYUlkc1thLnJlcGxhY2UoL14jLywiIildO2lmKGkhPT1rKXJldHVybltpLmlkeF19cmV0dXJuIGgoYikuZmlsdGVyKGEpLm1hcChmdW5jdGlvbigpe3JldHVybiB0aGlzLl9EVF9Sb3dJbmRleH0pLnRvQXJyYXkoKX0sYyxlKX0sMSk7Yy5zZWxlY3Rvci5yb3dzPWE7Yy5zZWxlY3Rvci5vcHRzPWI7cmV0dXJuIGN9KTtvKCJyb3dzKCkubm9kZXMoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigicm93IixmdW5jdGlvbihhLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiKXtyZXR1cm4gYS5hb0RhdGFbYl0ublRyfHxrfSwxKX0pO28oInJvd3MoKS5kYXRhKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoITAsInJvd3MiLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGlhKGEuYW9EYXRhLGIsIl9hRGF0YSIpfSwxKX0pO3UoInJvd3MoKS5jYWNoZSgpIiwicm93KCkuY2FjaGUoKSIsZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInJvdyIsZnVuY3Rpb24oYixjKXt2YXIgZD1iLmFvRGF0YVtjXTtyZXR1cm4ic2VhcmNoIj09PWE/ZC5fYUZpbHRlckRhdGE6ZC5fYVNvcnREYXRhfSwxKX0pO3UoInJvd3MoKS5pbnZhbGlkYXRlKCkiLCJyb3coKS5pbnZhbGlkYXRlKCkiLGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJyb3ciLGZ1bmN0aW9uKGIsYyl7Y2EoYixjLGEpfSl9KTt1KCJyb3dzKCkuaW5kZXhlcygpIiwicm93KCkuaW5kZXgoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigicm93IixmdW5jdGlvbihhLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiKXtyZXR1cm4gYn0sMSl9KTt1KCJyb3dzKCkuaWRzKCkiLCJyb3coKS5pZCgpIixmdW5jdGlvbihhKXtmb3IodmFyIGI9W10sYz10aGlzLmNvbnRleHQsZD0wLGU9Yy5sZW5ndGg7ZDxlO2QrKylmb3IodmFyIGY9MCxnPXRoaXNbZF0ubGVuZ3RoO2Y8ZztmKyspe3ZhciBoPWNbZF0ucm93SWRGbihjW2RdLmFvRGF0YVt0aGlzW2RdW2ZdXS5fYURhdGEpO2IucHVzaCgoITA9PT1hPyIjIjoiIikraCl9cmV0dXJuIG5ldyBzKGMsYil9KTt1KCJyb3dzKCkucmVtb3ZlKCkiLCJyb3coKS5yZW1vdmUoKSIsZnVuY3Rpb24oKXt2YXIgYT10aGlzO3RoaXMuaXRlcmF0b3IoInJvdyIsZnVuY3Rpb24oYixjLGQpe3ZhciBlPWIuYW9EYXRhLGY9ZVtjXSxnLGgsaSxuLGw7ZS5zcGxpY2UoYywxKTtnPTA7Zm9yKGg9ZS5sZW5ndGg7ZzxoO2crKylpZihpPWVbZ10sbD1pLmFuQ2VsbHMsbnVsbCE9PWkublRyJiYoaS5uVHIuX0RUX1Jvd0luZGV4PWcpLG51bGwhPT1sKXtpPTA7Zm9yKG49bC5sZW5ndGg7aTwNCiAgICBuO2krKylsW2ldLl9EVF9DZWxsSW5kZXgucm93PWd9b2EoYi5haURpc3BsYXlNYXN0ZXIsYyk7b2EoYi5haURpc3BsYXksYyk7b2EoYVtkXSxjLCExKTswPGIuX2lSZWNvcmRzRGlzcGxheSYmYi5faVJlY29yZHNEaXNwbGF5LS07UmEoYik7Yz1iLnJvd0lkRm4oZi5fYURhdGEpO2MhPT1rJiZkZWxldGUgYi5hSWRzW2NdfSk7dGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGEpe2Zvcih2YXIgYz0wLGQ9YS5hb0RhdGEubGVuZ3RoO2M8ZDtjKyspYS5hb0RhdGFbY10uaWR4PWN9KTtyZXR1cm4gdGhpc30pO28oInJvd3MuYWRkKCkiLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihiKXt2YXIgYyxmLGcsaD1bXTtmPTA7Zm9yKGc9YS5sZW5ndGg7ZjxnO2YrKyljPWFbZl0sYy5ub2RlTmFtZSYmIlRSIj09PWMubm9kZU5hbWUudG9VcHBlckNhc2UoKT9oLnB1c2gobWEoYixjKVswXSk6aC5wdXNoKE0oYixjKSk7cmV0dXJuIGh9LDEpLGM9dGhpcy5yb3dzKC0xKTsNCiAgICAgICAgYy5wb3AoKTtoLm1lcmdlKGMsYik7cmV0dXJuIGN9KTtvKCJyb3coKSIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYWIodGhpcy5yb3dzKGEsYikpfSk7bygicm93KCkuZGF0YSgpIixmdW5jdGlvbihhKXt2YXIgYj10aGlzLmNvbnRleHQ7aWYoYT09PWspcmV0dXJuIGIubGVuZ3RoJiZ0aGlzLmxlbmd0aD9iWzBdLmFvRGF0YVt0aGlzWzBdXS5fYURhdGE6aztiWzBdLmFvRGF0YVt0aGlzWzBdXS5fYURhdGE9YTtjYShiWzBdLHRoaXNbMF0sImRhdGEiKTtyZXR1cm4gdGhpc30pO28oInJvdygpLm5vZGUoKSIsZnVuY3Rpb24oKXt2YXIgYT10aGlzLmNvbnRleHQ7cmV0dXJuIGEubGVuZ3RoJiZ0aGlzLmxlbmd0aD9hWzBdLmFvRGF0YVt0aGlzWzBdXS5uVHJ8fG51bGw6bnVsbH0pO28oInJvdy5hZGQoKSIsZnVuY3Rpb24oYSl7YSBpbnN0YW5jZW9mIGgmJmEubGVuZ3RoJiYoYT1hWzBdKTt2YXIgYj10aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7cmV0dXJuIGEubm9kZU5hbWUmJg0KICAgICJUUiI9PT1hLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk/bWEoYixhKVswXTpNKGIsYSl9KTtyZXR1cm4gdGhpcy5yb3coYlswXSl9KTt2YXIgYmI9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmNvbnRleHQ7aWYoYy5sZW5ndGgmJihjPWNbMF0uYW9EYXRhW2IhPT1rP2I6YVswXV0pJiZjLl9kZXRhaWxzKWMuX2RldGFpbHMucmVtb3ZlKCksYy5fZGV0YWlsc1Nob3c9ayxjLl9kZXRhaWxzPWt9LFRiPWZ1bmN0aW9uKGEsYil7dmFyIGM9YS5jb250ZXh0O2lmKGMubGVuZ3RoJiZhLmxlbmd0aCl7dmFyIGQ9Y1swXS5hb0RhdGFbYVswXV07aWYoZC5fZGV0YWlscyl7KGQuX2RldGFpbHNTaG93PWIpP2QuX2RldGFpbHMuaW5zZXJ0QWZ0ZXIoZC5uVHIpOmQuX2RldGFpbHMuZGV0YWNoKCk7dmFyIGU9Y1swXSxmPW5ldyBzKGUpLGc9ZS5hb0RhdGE7Zi5vZmYoImRyYXcuZHQuRFRfZGV0YWlscyBjb2x1bW4tdmlzaWJpbGl0eS5kdC5EVF9kZXRhaWxzIGRlc3Ryb3kuZHQuRFRfZGV0YWlscyIpOzA8RChnLA0KICAgICAgICAiX2RldGFpbHMiKS5sZW5ndGgmJihmLm9uKCJkcmF3LmR0LkRUX2RldGFpbHMiLGZ1bmN0aW9uKGEsYil7ZT09PWImJmYucm93cyh7cGFnZToiY3VycmVudCJ9KS5lcSgwKS5lYWNoKGZ1bmN0aW9uKGEpe2E9Z1thXTthLl9kZXRhaWxzU2hvdyYmYS5fZGV0YWlscy5pbnNlcnRBZnRlcihhLm5Ucil9KX0pLGYub24oImNvbHVtbi12aXNpYmlsaXR5LmR0LkRUX2RldGFpbHMiLGZ1bmN0aW9uKGEsYil7aWYoZT09PWIpZm9yKHZhciBjLGQ9YWEoYiksZj0wLGg9Zy5sZW5ndGg7ZjxoO2YrKyljPWdbZl0sYy5fZGV0YWlscyYmYy5fZGV0YWlscy5jaGlsZHJlbigidGRbY29sc3Bhbl0iKS5hdHRyKCJjb2xzcGFuIixkKX0pLGYub24oImRlc3Ryb3kuZHQuRFRfZGV0YWlscyIsZnVuY3Rpb24oYSxiKXtpZihlPT09Yilmb3IodmFyIGM9MCxkPWcubGVuZ3RoO2M8ZDtjKyspZ1tjXS5fZGV0YWlscyYmYmIoZixjKX0pKX19fTtvKCJyb3coKS5jaGlsZCgpIixmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuY29udGV4dDsNCiAgICAgICAgaWYoYT09PWspcmV0dXJuIGMubGVuZ3RoJiZ0aGlzLmxlbmd0aD9jWzBdLmFvRGF0YVt0aGlzWzBdXS5fZGV0YWlsczprO2lmKCEwPT09YSl0aGlzLmNoaWxkLnNob3coKTtlbHNlIGlmKCExPT09YSliYih0aGlzKTtlbHNlIGlmKGMubGVuZ3RoJiZ0aGlzLmxlbmd0aCl7dmFyIGQ9Y1swXSxjPWNbMF0uYW9EYXRhW3RoaXNbMF1dLGU9W10sZj1mdW5jdGlvbihhLGIpe2lmKGguaXNBcnJheShhKXx8YSBpbnN0YW5jZW9mIGgpZm9yKHZhciBjPTAsaz1hLmxlbmd0aDtjPGs7YysrKWYoYVtjXSxiKTtlbHNlIGEubm9kZU5hbWUmJiJ0ciI9PT1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk/ZS5wdXNoKGEpOihjPWgoIjx0cj48dGQvPjwvdHI+IikuYWRkQ2xhc3MoYiksaCgidGQiLGMpLmFkZENsYXNzKGIpLmh0bWwoYSlbMF0uY29sU3Bhbj1hYShkKSxlLnB1c2goY1swXSkpfTtmKGEsYik7Yy5fZGV0YWlscyYmYy5fZGV0YWlscy5kZXRhY2goKTtjLl9kZXRhaWxzPWgoZSk7Yy5fZGV0YWlsc1Nob3cmJg0KICAgICAgICBjLl9kZXRhaWxzLmluc2VydEFmdGVyKGMublRyKX1yZXR1cm4gdGhpc30pO28oWyJyb3coKS5jaGlsZC5zaG93KCkiLCJyb3coKS5jaGlsZCgpLnNob3coKSJdLGZ1bmN0aW9uKCl7VGIodGhpcywhMCk7cmV0dXJuIHRoaXN9KTtvKFsicm93KCkuY2hpbGQuaGlkZSgpIiwicm93KCkuY2hpbGQoKS5oaWRlKCkiXSxmdW5jdGlvbigpe1RiKHRoaXMsITEpO3JldHVybiB0aGlzfSk7byhbInJvdygpLmNoaWxkLnJlbW92ZSgpIiwicm93KCkuY2hpbGQoKS5yZW1vdmUoKSJdLGZ1bmN0aW9uKCl7YmIodGhpcyk7cmV0dXJuIHRoaXN9KTtvKCJyb3coKS5jaGlsZC5pc1Nob3duKCkiLGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jb250ZXh0O3JldHVybiBhLmxlbmd0aCYmdGhpcy5sZW5ndGg/YVswXS5hb0RhdGFbdGhpc1swXV0uX2RldGFpbHNTaG93fHwhMTohMX0pO3ZhciBiYz0vXihbXjpdKyk6KG5hbWV8dmlzSWR4fHZpc2libGUpJC8sVWI9ZnVuY3Rpb24oYSxiLGMsZCxlKXtmb3IodmFyIGM9DQogICAgICAgIFtdLGQ9MCxmPWUubGVuZ3RoO2Q8ZjtkKyspYy5wdXNoKEIoYSxlW2RdLGIpKTtyZXR1cm4gY307bygiY29sdW1ucygpIixmdW5jdGlvbihhLGIpe2E9PT1rP2E9IiI6aC5pc1BsYWluT2JqZWN0KGEpJiYoYj1hLGE9IiIpO3ZhciBiPSRhKGIpLGM9dGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGMpe3ZhciBlPWEsZj1iLGc9Yy5hb0NvbHVtbnMsaj1EKGcsInNOYW1lIiksaT1EKGcsIm5UaCIpO3JldHVybiBaYSgiY29sdW1uIixlLGZ1bmN0aW9uKGEpe3ZhciBiPU5iKGEpO2lmKGE9PT0iIilyZXR1cm4gVyhnLmxlbmd0aCk7aWYoYiE9PW51bGwpcmV0dXJuW2I+PTA/YjpnLmxlbmd0aCtiXTtpZih0eXBlb2YgYT09PSJmdW5jdGlvbiIpe3ZhciBlPUJhKGMsZik7cmV0dXJuIGgubWFwKGcsZnVuY3Rpb24oYixmKXtyZXR1cm4gYShmLFViKGMsZiwwLDAsZSksaVtmXSk/ZjpudWxsfSl9dmFyIGs9dHlwZW9mIGE9PT0ic3RyaW5nIj9hLm1hdGNoKGJjKToiIjtpZihrKXN3aXRjaChrWzJdKXtjYXNlICJ2aXNJZHgiOmNhc2UgInZpc2libGUiOmI9DQogICAgICAgIHBhcnNlSW50KGtbMV0sMTApO2lmKGI8MCl7dmFyIG09aC5tYXAoZyxmdW5jdGlvbihhLGIpe3JldHVybiBhLmJWaXNpYmxlP2I6bnVsbH0pO3JldHVyblttW20ubGVuZ3RoK2JdXX1yZXR1cm5bWihjLGIpXTtjYXNlICJuYW1lIjpyZXR1cm4gaC5tYXAoaixmdW5jdGlvbihhLGIpe3JldHVybiBhPT09a1sxXT9iOm51bGx9KTtkZWZhdWx0OnJldHVybltdfWlmKGEubm9kZU5hbWUmJmEuX0RUX0NlbGxJbmRleClyZXR1cm5bYS5fRFRfQ2VsbEluZGV4LmNvbHVtbl07Yj1oKGkpLmZpbHRlcihhKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gaC5pbkFycmF5KHRoaXMsaSl9KS50b0FycmF5KCk7aWYoYi5sZW5ndGh8fCFhLm5vZGVOYW1lKXJldHVybiBiO2I9aChhKS5jbG9zZXN0KCIqW2RhdGEtZHQtY29sdW1uXSIpO3JldHVybiBiLmxlbmd0aD9bYi5kYXRhKCJkdC1jb2x1bW4iKV06W119LGMsZil9LDEpO2Muc2VsZWN0b3IuY29scz1hO2Muc2VsZWN0b3Iub3B0cz1iO3JldHVybiBjfSk7dSgiY29sdW1ucygpLmhlYWRlcigpIiwNCiAgICAgICAgImNvbHVtbigpLmhlYWRlcigpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJjb2x1bW4iLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuYW9Db2x1bW5zW2JdLm5UaH0sMSl9KTt1KCJjb2x1bW5zKCkuZm9vdGVyKCkiLCJjb2x1bW4oKS5mb290ZXIoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uIixmdW5jdGlvbihhLGIpe3JldHVybiBhLmFvQ29sdW1uc1tiXS5uVGZ9LDEpfSk7dSgiY29sdW1ucygpLmRhdGEoKSIsImNvbHVtbigpLmRhdGEoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uLXJvd3MiLFViLDEpfSk7dSgiY29sdW1ucygpLmRhdGFTcmMoKSIsImNvbHVtbigpLmRhdGFTcmMoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uIixmdW5jdGlvbihhLGIpe3JldHVybiBhLmFvQ29sdW1uc1tiXS5tRGF0YX0sMSl9KTt1KCJjb2x1bW5zKCkuY2FjaGUoKSIsImNvbHVtbigpLmNhY2hlKCkiLA0KICAgICAgICBmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uLXJvd3MiLGZ1bmN0aW9uKGIsYyxkLGUsZil7cmV0dXJuIGlhKGIuYW9EYXRhLGYsInNlYXJjaCI9PT1hPyJfYUZpbHRlckRhdGEiOiJfYVNvcnREYXRhIixjKX0sMSl9KTt1KCJjb2x1bW5zKCkubm9kZXMoKSIsImNvbHVtbigpLm5vZGVzKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoImNvbHVtbi1yb3dzIixmdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiBpYShhLmFvRGF0YSxlLCJhbkNlbGxzIixiKX0sMSl9KTt1KCJjb2x1bW5zKCkudmlzaWJsZSgpIiwiY29sdW1uKCkudmlzaWJsZSgpIixmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuaXRlcmF0b3IoImNvbHVtbiIsZnVuY3Rpb24oYixjKXtpZihhPT09aylyZXR1cm4gYi5hb0NvbHVtbnNbY10uYlZpc2libGU7dmFyIGY9Yi5hb0NvbHVtbnMsZz1mW2NdLGo9Yi5hb0RhdGEsaSxuLGw7aWYoYSE9PWsmJmcuYlZpc2libGUhPT1hKXtpZihhKXt2YXIgbT0NCiAgICAgICAgaC5pbkFycmF5KCEwLEQoZiwiYlZpc2libGUiKSxjKzEpO2k9MDtmb3Iobj1qLmxlbmd0aDtpPG47aSsrKWw9altpXS5uVHIsZj1qW2ldLmFuQ2VsbHMsbCYmbC5pbnNlcnRCZWZvcmUoZltjXSxmW21dfHxudWxsKX1lbHNlIGgoRChiLmFvRGF0YSwiYW5DZWxscyIsYykpLmRldGFjaCgpO2cuYlZpc2libGU9YTtlYShiLGIuYW9IZWFkZXIpO2VhKGIsYi5hb0Zvb3Rlcik7eGEoYil9fSk7YSE9PWsmJih0aGlzLml0ZXJhdG9yKCJjb2x1bW4iLGZ1bmN0aW9uKGMsZSl7cihjLG51bGwsImNvbHVtbi12aXNpYmlsaXR5IixbYyxlLGEsYl0pfSksKGI9PT1rfHxiKSYmdGhpcy5jb2x1bW5zLmFkanVzdCgpKTtyZXR1cm4gY30pO3UoImNvbHVtbnMoKS5pbmRleGVzKCkiLCJjb2x1bW4oKS5pbmRleCgpIixmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uIixmdW5jdGlvbihiLGMpe3JldHVybiJ2aXNpYmxlIj09PWE/JChiLGMpOmN9LDEpfSk7bygiY29sdW1ucy5hZGp1c3QoKSIsDQogICAgICAgIGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXtZKGEpfSwxKX0pO28oImNvbHVtbi5pbmRleCgpIixmdW5jdGlvbihhLGIpe2lmKDAhPT10aGlzLmNvbnRleHQubGVuZ3RoKXt2YXIgYz10aGlzLmNvbnRleHRbMF07aWYoImZyb21WaXNpYmxlIj09PWF8fCJ0b0RhdGEiPT09YSlyZXR1cm4gWihjLGIpO2lmKCJmcm9tRGF0YSI9PT1hfHwidG9WaXNpYmxlIj09PWEpcmV0dXJuICQoYyxiKX19KTtvKCJjb2x1bW4oKSIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYWIodGhpcy5jb2x1bW5zKGEsYikpfSk7bygiY2VsbHMoKSIsZnVuY3Rpb24oYSxiLGMpe2guaXNQbGFpbk9iamVjdChhKSYmKGEucm93PT09az8oYz1hLGE9bnVsbCk6KGM9YixiPW51bGwpKTtoLmlzUGxhaW5PYmplY3QoYikmJihjPWIsYj1udWxsKTtpZihudWxsPT09Ynx8Yj09PWspcmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihiKXt2YXIgZD1hLGU9JGEoYyksZj0NCiAgICAgICAgYi5hb0RhdGEsZz1CYShiLGUpLGo9UWIoaWEoZixnLCJhbkNlbGxzIikpLGk9aChbXS5jb25jYXQuYXBwbHkoW10saikpLGwsbj1iLmFvQ29sdW1ucy5sZW5ndGgsbSxvLHUscyxyLHY7cmV0dXJuIFphKCJjZWxsIixkLGZ1bmN0aW9uKGEpe3ZhciBjPXR5cGVvZiBhPT09ImZ1bmN0aW9uIjtpZihhPT09bnVsbHx8YT09PWt8fGMpe209W107bz0wO2Zvcih1PWcubGVuZ3RoO288dTtvKyspe2w9Z1tvXTtmb3Iocz0wO3M8bjtzKyspe3I9e3JvdzpsLGNvbHVtbjpzfTtpZihjKXt2PWZbbF07YShyLEIoYixsLHMpLHYuYW5DZWxscz92LmFuQ2VsbHNbc106bnVsbCkmJm0ucHVzaChyKX1lbHNlIG0ucHVzaChyKX19cmV0dXJuIG19aWYoaC5pc1BsYWluT2JqZWN0KGEpKXJldHVyblthXTtjPWkuZmlsdGVyKGEpLm1hcChmdW5jdGlvbihhLGIpe3JldHVybntyb3c6Yi5fRFRfQ2VsbEluZGV4LnJvdyxjb2x1bW46Yi5fRFRfQ2VsbEluZGV4LmNvbHVtbn19KS50b0FycmF5KCk7aWYoYy5sZW5ndGh8fA0KICAgICAgICAhYS5ub2RlTmFtZSlyZXR1cm4gYzt2PWgoYSkuY2xvc2VzdCgiKltkYXRhLWR0LXJvd10iKTtyZXR1cm4gdi5sZW5ndGg/W3tyb3c6di5kYXRhKCJkdC1yb3ciKSxjb2x1bW46di5kYXRhKCJkdC1jb2x1bW4iKX1dOltdfSxiLGUpfSk7dmFyIGQ9dGhpcy5jb2x1bW5zKGIsYyksZT10aGlzLnJvd3MoYSxjKSxmLGcsaixpLG4sbD10aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSxiKXtmPVtdO2c9MDtmb3Ioaj1lW2JdLmxlbmd0aDtnPGo7ZysrKXtpPTA7Zm9yKG49ZFtiXS5sZW5ndGg7aTxuO2krKylmLnB1c2goe3JvdzplW2JdW2ddLGNvbHVtbjpkW2JdW2ldfSl9cmV0dXJuIGZ9LDEpO2guZXh0ZW5kKGwuc2VsZWN0b3Ise2NvbHM6Yixyb3dzOmEsb3B0czpjfSk7cmV0dXJuIGx9KTt1KCJjZWxscygpLm5vZGVzKCkiLCJjZWxsKCkubm9kZSgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJjZWxsIixmdW5jdGlvbihhLGIsYyl7cmV0dXJuKGE9YS5hb0RhdGFbYl0pJiYNCiAgICBhLmFuQ2VsbHM/YS5hbkNlbGxzW2NdOmt9LDEpfSk7bygiY2VsbHMoKS5kYXRhKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoImNlbGwiLGZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gQihhLGIsYyl9LDEpfSk7dSgiY2VsbHMoKS5jYWNoZSgpIiwiY2VsbCgpLmNhY2hlKCkiLGZ1bmN0aW9uKGEpe2E9InNlYXJjaCI9PT1hPyJfYUZpbHRlckRhdGEiOiJfYVNvcnREYXRhIjtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY2VsbCIsZnVuY3Rpb24oYixjLGQpe3JldHVybiBiLmFvRGF0YVtjXVthXVtkXX0sMSl9KTt1KCJjZWxscygpLnJlbmRlcigpIiwiY2VsbCgpLnJlbmRlcigpIixmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY2VsbCIsZnVuY3Rpb24oYixjLGQpe3JldHVybiBCKGIsYyxkLGEpfSwxKX0pO3UoImNlbGxzKCkuaW5kZXhlcygpIiwiY2VsbCgpLmluZGV4KCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoImNlbGwiLGZ1bmN0aW9uKGEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLGMpe3JldHVybntyb3c6Yixjb2x1bW46Yyxjb2x1bW5WaXNpYmxlOiQoYSxjKX19LDEpfSk7dSgiY2VsbHMoKS5pbnZhbGlkYXRlKCkiLCJjZWxsKCkuaW52YWxpZGF0ZSgpIixmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY2VsbCIsZnVuY3Rpb24oYixjLGQpe2NhKGIsYyxhLGQpfSl9KTtvKCJjZWxsKCkiLGZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYWIodGhpcy5jZWxscyhhLGIsYykpfSk7bygiY2VsbCgpLmRhdGEoKSIsZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5jb250ZXh0LGM9dGhpc1swXTtpZihhPT09aylyZXR1cm4gYi5sZW5ndGgmJmMubGVuZ3RoP0IoYlswXSxjWzBdLnJvdyxjWzBdLmNvbHVtbik6aztpYihiWzBdLGNbMF0ucm93LGNbMF0uY29sdW1uLGEpO2NhKGJbMF0sY1swXS5yb3csImRhdGEiLGNbMF0uY29sdW1uKTtyZXR1cm4gdGhpc30pO28oIm9yZGVyKCkiLGZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5jb250ZXh0O2lmKGE9PT1rKXJldHVybiAwIT09DQogICAgYy5sZW5ndGg/Y1swXS5hYVNvcnRpbmc6azsibnVtYmVyIj09PXR5cGVvZiBhP2E9W1thLGJdXTphLmxlbmd0aCYmIWguaXNBcnJheShhWzBdKSYmKGE9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihiKXtiLmFhU29ydGluZz1hLnNsaWNlKCl9KX0pO28oIm9yZGVyLmxpc3RlbmVyKCkiLGZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGQpe0xhKGQsYSxiLGMpfSl9KTtvKCJvcmRlci5maXhlZCgpIixmdW5jdGlvbihhKXtpZighYSl7dmFyIGI9dGhpcy5jb250ZXh0LGI9Yi5sZW5ndGg/YlswXS5hYVNvcnRpbmdGaXhlZDprO3JldHVybiBoLmlzQXJyYXkoYik/e3ByZTpifTpifXJldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYil7Yi5hYVNvcnRpbmdGaXhlZD1oLmV4dGVuZCghMCx7fSxhKX0pfSk7byhbImNvbHVtbnMoKS5vcmRlcigpIiwNCiAgICAgICAgImNvbHVtbigpLm9yZGVyKCkiXSxmdW5jdGlvbihhKXt2YXIgYj10aGlzO3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYyxkKXt2YXIgZT1bXTtoLmVhY2goYltkXSxmdW5jdGlvbihiLGMpe2UucHVzaChbYyxhXSl9KTtjLmFhU29ydGluZz1lfSl9KTtvKCJzZWFyY2goKSIsZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9dGhpcy5jb250ZXh0O3JldHVybiBhPT09az8wIT09ZS5sZW5ndGg/ZVswXS5vUHJldmlvdXNTZWFyY2guc1NlYXJjaDprOnRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihlKXtlLm9GZWF0dXJlcy5iRmlsdGVyJiZmYShlLGguZXh0ZW5kKHt9LGUub1ByZXZpb3VzU2VhcmNoLHtzU2VhcmNoOmErIiIsYlJlZ2V4Om51bGw9PT1iPyExOmIsYlNtYXJ0Om51bGw9PT1jPyEwOmMsYkNhc2VJbnNlbnNpdGl2ZTpudWxsPT09ZD8hMDpkfSksMSl9KX0pO3UoImNvbHVtbnMoKS5zZWFyY2goKSIsImNvbHVtbigpLnNlYXJjaCgpIixmdW5jdGlvbihhLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIsYyxkKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigiY29sdW1uIixmdW5jdGlvbihlLGYpe3ZhciBnPWUuYW9QcmVTZWFyY2hDb2xzO2lmKGE9PT1rKXJldHVybiBnW2ZdLnNTZWFyY2g7ZS5vRmVhdHVyZXMuYkZpbHRlciYmKGguZXh0ZW5kKGdbZl0se3NTZWFyY2g6YSsiIixiUmVnZXg6bnVsbD09PWI/ITE6YixiU21hcnQ6bnVsbD09PWM/ITA6YyxiQ2FzZUluc2Vuc2l0aXZlOm51bGw9PT1kPyEwOmR9KSxmYShlLGUub1ByZXZpb3VzU2VhcmNoLDEpKX0pfSk7bygic3RhdGUoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb250ZXh0Lmxlbmd0aD90aGlzLmNvbnRleHRbMF0ub1NhdmVkU3RhdGU6bnVsbH0pO28oInN0YXRlLmNsZWFyKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXthLmZuU3RhdGVTYXZlQ2FsbGJhY2suY2FsbChhLm9JbnN0YW5jZSxhLHt9KX0pfSk7bygic3RhdGUubG9hZGVkKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29udGV4dC5sZW5ndGg/DQogICAgICAgIHRoaXMuY29udGV4dFswXS5vTG9hZGVkU3RhdGU6bnVsbH0pO28oInN0YXRlLnNhdmUoKSIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGEpe3hhKGEpfSl9KTttLnZlcnNpb25DaGVjaz1tLmZuVmVyc2lvbkNoZWNrPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj1tLnZlcnNpb24uc3BsaXQoIi4iKSxhPWEuc3BsaXQoIi4iKSxjLGQsZT0wLGY9YS5sZW5ndGg7ZTxmO2UrKylpZihjPXBhcnNlSW50KGJbZV0sMTApfHwwLGQ9cGFyc2VJbnQoYVtlXSwxMCl8fDAsYyE9PWQpcmV0dXJuIGM+ZDtyZXR1cm4hMH07bS5pc0RhdGFUYWJsZT1tLmZuSXNEYXRhVGFibGU9ZnVuY3Rpb24oYSl7dmFyIGI9aChhKS5nZXQoMCksYz0hMTtpZihhIGluc3RhbmNlb2YgbS5BcGkpcmV0dXJuITA7aC5lYWNoKG0uc2V0dGluZ3MsZnVuY3Rpb24oYSxlKXt2YXIgZj1lLm5TY3JvbGxIZWFkP2goInRhYmxlIixlLm5TY3JvbGxIZWFkKVswXTpudWxsLGc9ZS5uU2Nyb2xsRm9vdD8NCiAgICAgICAgaCgidGFibGUiLGUublNjcm9sbEZvb3QpWzBdOm51bGw7aWYoZS5uVGFibGU9PT1ifHxmPT09Ynx8Zz09PWIpYz0hMH0pO3JldHVybiBjfTttLnRhYmxlcz1tLmZuVGFibGVzPWZ1bmN0aW9uKGEpe3ZhciBiPSExO2guaXNQbGFpbk9iamVjdChhKSYmKGI9YS5hcGksYT1hLnZpc2libGUpO3ZhciBjPWgubWFwKG0uc2V0dGluZ3MsZnVuY3Rpb24oYil7aWYoIWF8fGEmJmgoYi5uVGFibGUpLmlzKCI6dmlzaWJsZSIpKXJldHVybiBiLm5UYWJsZX0pO3JldHVybiBiP25ldyBzKGMpOmN9O20uY2FtZWxUb0h1bmdhcmlhbj1JO28oIiQoKSIsZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLnJvd3MoYikubm9kZXMoKSxjPWgoYyk7cmV0dXJuIGgoW10uY29uY2F0KGMuZmlsdGVyKGEpLnRvQXJyYXkoKSxjLmZpbmQoYSkudG9BcnJheSgpKSl9KTtoLmVhY2goWyJvbiIsIm9uZSIsIm9mZiJdLGZ1bmN0aW9uKGEsYil7byhiKyIoKSIsZnVuY3Rpb24oKXt2YXIgYT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOw0KICAgICAgICBhWzBdPWgubWFwKGFbMF0uc3BsaXQoL1xzLyksZnVuY3Rpb24oYSl7cmV0dXJuIWEubWF0Y2goL1wuZHRcYi8pP2ErIi5kdCI6YX0pLmpvaW4oIiAiKTt2YXIgZD1oKHRoaXMudGFibGVzKCkubm9kZXMoKSk7ZFtiXS5hcHBseShkLGEpO3JldHVybiB0aGlzfSl9KTtvKCJjbGVhcigpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSl7bmEoYSl9KX0pO28oInNldHRpbmdzKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBzKHRoaXMuY29udGV4dCx0aGlzLmNvbnRleHQpfSk7bygiaW5pdCgpIixmdW5jdGlvbigpe3ZhciBhPXRoaXMuY29udGV4dDtyZXR1cm4gYS5sZW5ndGg/YVswXS5vSW5pdDpudWxsfSk7bygiZGF0YSgpIixmdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJhdG9yKCJ0YWJsZSIsZnVuY3Rpb24oYSl7cmV0dXJuIEQoYS5hb0RhdGEsIl9hRGF0YSIpfSkuZmxhdHRlbigpfSk7bygiZGVzdHJveSgpIixmdW5jdGlvbihhKXthPWF8fA0KICAgICAgICAhMTtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGIpe3ZhciBjPWIublRhYmxlV3JhcHBlci5wYXJlbnROb2RlLGQ9Yi5vQ2xhc3NlcyxlPWIublRhYmxlLGY9Yi5uVEJvZHksZz1iLm5USGVhZCxqPWIublRGb290LGk9aChlKSxmPWgoZiksaz1oKGIublRhYmxlV3JhcHBlciksbD1oLm1hcChiLmFvRGF0YSxmdW5jdGlvbihhKXtyZXR1cm4gYS5uVHJ9KSxvO2IuYkRlc3Ryb3lpbmc9ITA7cihiLCJhb0Rlc3Ryb3lDYWxsYmFjayIsImRlc3Ryb3kiLFtiXSk7YXx8KG5ldyBzKGIpKS5jb2x1bW5zKCkudmlzaWJsZSghMCk7ay5vZmYoIi5EVCIpLmZpbmQoIjpub3QodGJvZHkgKikiKS5vZmYoIi5EVCIpO2goRSkub2ZmKCIuRFQtIitiLnNJbnN0YW5jZSk7ZSE9Zy5wYXJlbnROb2RlJiYoaS5jaGlsZHJlbigidGhlYWQiKS5kZXRhY2goKSxpLmFwcGVuZChnKSk7aiYmZSE9ai5wYXJlbnROb2RlJiYoaS5jaGlsZHJlbigidGZvb3QiKS5kZXRhY2goKSxpLmFwcGVuZChqKSk7DQogICAgICAgIGIuYWFTb3J0aW5nPVtdO2IuYWFTb3J0aW5nRml4ZWQ9W107d2EoYik7aChsKS5yZW1vdmVDbGFzcyhiLmFzU3RyaXBlQ2xhc3Nlcy5qb2luKCIgIikpO2goInRoLCB0ZCIsZykucmVtb3ZlQ2xhc3MoZC5zU29ydGFibGUrIiAiK2Quc1NvcnRhYmxlQXNjKyIgIitkLnNTb3J0YWJsZURlc2MrIiAiK2Quc1NvcnRhYmxlTm9uZSk7Zi5jaGlsZHJlbigpLmRldGFjaCgpO2YuYXBwZW5kKGwpO2c9YT8icmVtb3ZlIjoiZGV0YWNoIjtpW2ddKCk7a1tnXSgpOyFhJiZjJiYoYy5pbnNlcnRCZWZvcmUoZSxiLm5UYWJsZVJlaW5zZXJ0QmVmb3JlKSxpLmNzcygid2lkdGgiLGIuc0Rlc3Ryb3lXaWR0aCkucmVtb3ZlQ2xhc3MoZC5zVGFibGUpLChvPWIuYXNEZXN0cm95U3RyaXBlcy5sZW5ndGgpJiZmLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbihhKXtoKHRoaXMpLmFkZENsYXNzKGIuYXNEZXN0cm95U3RyaXBlc1thJW9dKX0pKTtjPWguaW5BcnJheShiLG0uc2V0dGluZ3MpOy0xIT09YyYmbS5zZXR0aW5ncy5zcGxpY2UoYywNCiAgICAgICAgICAgIDEpfSl9KTtoLmVhY2goWyJjb2x1bW4iLCJyb3ciLCJjZWxsIl0sZnVuY3Rpb24oYSxiKXtvKGIrInMoKS5ldmVyeSgpIixmdW5jdGlvbihhKXt2YXIgZD10aGlzLnNlbGVjdG9yLm9wdHMsZT10aGlzO3JldHVybiB0aGlzLml0ZXJhdG9yKGIsZnVuY3Rpb24oZixnLGgsaSxuKXthLmNhbGwoZVtiXShnLCJjZWxsIj09PWI/aDpkLCJjZWxsIj09PWI/ZDprKSxnLGgsaSxuKX0pfSl9KTtvKCJpMThuKCkiLGZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLmNvbnRleHRbMF0sYT1RKGEpKGQub0xhbmd1YWdlKTthPT09ayYmKGE9Yik7YyE9PWsmJmguaXNQbGFpbk9iamVjdChhKSYmKGE9YVtjXSE9PWs/YVtjXTphLl8pO3JldHVybiBhLnJlcGxhY2UoIiVkIixjKX0pO20udmVyc2lvbj0iMS4xMC4xNiI7bS5zZXR0aW5ncz1bXTttLm1vZGVscz17fTttLm1vZGVscy5vU2VhcmNoPXtiQ2FzZUluc2Vuc2l0aXZlOiEwLHNTZWFyY2g6IiIsYlJlZ2V4OiExLGJTbWFydDohMH07bS5tb2RlbHMub1Jvdz0NCiAgICAgICAge25UcjpudWxsLGFuQ2VsbHM6bnVsbCxfYURhdGE6W10sX2FTb3J0RGF0YTpudWxsLF9hRmlsdGVyRGF0YTpudWxsLF9zRmlsdGVyUm93Om51bGwsX3NSb3dTdHJpcGU6IiIsc3JjOm51bGwsaWR4Oi0xfTttLm1vZGVscy5vQ29sdW1uPXtpZHg6bnVsbCxhRGF0YVNvcnQ6bnVsbCxhc1NvcnRpbmc6bnVsbCxiU2VhcmNoYWJsZTpudWxsLGJTb3J0YWJsZTpudWxsLGJWaXNpYmxlOm51bGwsX3NNYW51YWxUeXBlOm51bGwsX2JBdHRyU3JjOiExLGZuQ3JlYXRlZENlbGw6bnVsbCxmbkdldERhdGE6bnVsbCxmblNldERhdGE6bnVsbCxtRGF0YTpudWxsLG1SZW5kZXI6bnVsbCxuVGg6bnVsbCxuVGY6bnVsbCxzQ2xhc3M6bnVsbCxzQ29udGVudFBhZGRpbmc6bnVsbCxzRGVmYXVsdENvbnRlbnQ6bnVsbCxzTmFtZTpudWxsLHNTb3J0RGF0YVR5cGU6InN0ZCIsc1NvcnRpbmdDbGFzczpudWxsLHNTb3J0aW5nQ2xhc3NKVUk6bnVsbCxzVGl0bGU6bnVsbCxzVHlwZTpudWxsLHNXaWR0aDpudWxsLA0KICAgICAgICBzV2lkdGhPcmlnOm51bGx9O20uZGVmYXVsdHM9e2FhRGF0YTpudWxsLGFhU29ydGluZzpbWzAsImFzYyJdXSxhYVNvcnRpbmdGaXhlZDpbXSxhamF4Om51bGwsYUxlbmd0aE1lbnU6WzEwLDI1LDUwLDEwMF0sYW9Db2x1bW5zOm51bGwsYW9Db2x1bW5EZWZzOm51bGwsYW9TZWFyY2hDb2xzOltdLGFzU3RyaXBlQ2xhc3NlczpudWxsLGJBdXRvV2lkdGg6ITAsYkRlZmVyUmVuZGVyOiExLGJEZXN0cm95OiExLGJGaWx0ZXI6ITAsYkluZm86ITAsYkxlbmd0aENoYW5nZTohMCxiUGFnaW5hdGU6ITAsYlByb2Nlc3Npbmc6ITEsYlJldHJpZXZlOiExLGJTY3JvbGxDb2xsYXBzZTohMSxiU2VydmVyU2lkZTohMSxiU29ydDohMCxiU29ydE11bHRpOiEwLGJTb3J0Q2VsbHNUb3A6ITEsYlNvcnRDbGFzc2VzOiEwLGJTdGF0ZVNhdmU6ITEsZm5DcmVhdGVkUm93Om51bGwsZm5EcmF3Q2FsbGJhY2s6bnVsbCxmbkZvb3RlckNhbGxiYWNrOm51bGwsZm5Gb3JtYXROdW1iZXI6ZnVuY3Rpb24oYSl7cmV0dXJuIGEudG9TdHJpbmcoKS5yZXBsYWNlKC9cQig/PShcZHszfSkrKD8hXGQpKS9nLA0KICAgICAgICB0aGlzLm9MYW5ndWFnZS5zVGhvdXNhbmRzKX0sZm5IZWFkZXJDYWxsYmFjazpudWxsLGZuSW5mb0NhbGxiYWNrOm51bGwsZm5Jbml0Q29tcGxldGU6bnVsbCxmblByZURyYXdDYWxsYmFjazpudWxsLGZuUm93Q2FsbGJhY2s6bnVsbCxmblNlcnZlckRhdGE6bnVsbCxmblNlcnZlclBhcmFtczpudWxsLGZuU3RhdGVMb2FkQ2FsbGJhY2s6ZnVuY3Rpb24oYSl7dHJ5e3JldHVybiBKU09OLnBhcnNlKCgtMT09PWEuaVN0YXRlRHVyYXRpb24/c2Vzc2lvblN0b3JhZ2U6bG9jYWxTdG9yYWdlKS5nZXRJdGVtKCJEYXRhVGFibGVzXyIrYS5zSW5zdGFuY2UrIl8iK2xvY2F0aW9uLnBhdGhuYW1lKSl9Y2F0Y2goYil7fX0sZm5TdGF0ZUxvYWRQYXJhbXM6bnVsbCxmblN0YXRlTG9hZGVkOm51bGwsZm5TdGF0ZVNhdmVDYWxsYmFjazpmdW5jdGlvbihhLGIpe3RyeXsoLTE9PT1hLmlTdGF0ZUR1cmF0aW9uP3Nlc3Npb25TdG9yYWdlOmxvY2FsU3RvcmFnZSkuc2V0SXRlbSgiRGF0YVRhYmxlc18iK2Euc0luc3RhbmNlKw0KICAgICAgICAiXyIrbG9jYXRpb24ucGF0aG5hbWUsSlNPTi5zdHJpbmdpZnkoYikpfWNhdGNoKGMpe319LGZuU3RhdGVTYXZlUGFyYW1zOm51bGwsaVN0YXRlRHVyYXRpb246NzIwMCxpRGVmZXJMb2FkaW5nOm51bGwsaURpc3BsYXlMZW5ndGg6MTAsaURpc3BsYXlTdGFydDowLGlUYWJJbmRleDowLG9DbGFzc2VzOnt9LG9MYW5ndWFnZTp7b0FyaWE6e3NTb3J0QXNjZW5kaW5nOiI6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGFzY2VuZGluZyIsc1NvcnREZXNjZW5kaW5nOiI6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGRlc2NlbmRpbmcifSxvUGFnaW5hdGU6e3NGaXJzdDoiRmlyc3QiLHNMYXN0OiJMYXN0IixzTmV4dDoiTmV4dCIsc1ByZXZpb3VzOiJQcmV2aW91cyJ9LHNFbXB0eVRhYmxlOiJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsc0luZm86IlNob3dpbmcgX1NUQVJUXyB0byBfRU5EXyBvZiBfVE9UQUxfIGVudHJpZXMiLHNJbmZvRW1wdHk6IlNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcyIsDQogICAgICAgIHNJbmZvRmlsdGVyZWQ6IihmaWx0ZXJlZCBmcm9tIF9NQVhfIHRvdGFsIGVudHJpZXMpIixzSW5mb1Bvc3RGaXg6IiIsc0RlY2ltYWw6IiIsc1Rob3VzYW5kczoiLCIsc0xlbmd0aE1lbnU6IlNob3cgX01FTlVfIGVudHJpZXMiLHNMb2FkaW5nUmVjb3JkczoiTG9hZGluZy4uLiIsc1Byb2Nlc3Npbmc6IlByb2Nlc3NpbmcuLi4iLHNTZWFyY2g6IlNlYXJjaDoiLHNTZWFyY2hQbGFjZWhvbGRlcjoiIixzVXJsOiIiLHNaZXJvUmVjb3JkczoiTm8gbWF0Y2hpbmcgcmVjb3JkcyBmb3VuZCJ9LG9TZWFyY2g6aC5leHRlbmQoe30sbS5tb2RlbHMub1NlYXJjaCksc0FqYXhEYXRhUHJvcDoiZGF0YSIsc0FqYXhTb3VyY2U6bnVsbCxzRG9tOiJsZnJ0aXAiLHNlYXJjaERlbGF5Om51bGwsc1BhZ2luYXRpb25UeXBlOiJzaW1wbGVfbnVtYmVycyIsc1Njcm9sbFg6IiIsc1Njcm9sbFhJbm5lcjoiIixzU2Nyb2xsWToiIixzU2VydmVyTWV0aG9kOiJHRVQiLHJlbmRlcmVyOm51bGwscm93SWQ6IkRUX1Jvd0lkIn07DQogICAgWChtLmRlZmF1bHRzKTttLmRlZmF1bHRzLmNvbHVtbj17YURhdGFTb3J0Om51bGwsaURhdGFTb3J0Oi0xLGFzU29ydGluZzpbImFzYyIsImRlc2MiXSxiU2VhcmNoYWJsZTohMCxiU29ydGFibGU6ITAsYlZpc2libGU6ITAsZm5DcmVhdGVkQ2VsbDpudWxsLG1EYXRhOm51bGwsbVJlbmRlcjpudWxsLHNDZWxsVHlwZToidGQiLHNDbGFzczoiIixzQ29udGVudFBhZGRpbmc6IiIsc0RlZmF1bHRDb250ZW50Om51bGwsc05hbWU6IiIsc1NvcnREYXRhVHlwZToic3RkIixzVGl0bGU6bnVsbCxzVHlwZTpudWxsLHNXaWR0aDpudWxsfTtYKG0uZGVmYXVsdHMuY29sdW1uKTttLm1vZGVscy5vU2V0dGluZ3M9e29GZWF0dXJlczp7YkF1dG9XaWR0aDpudWxsLGJEZWZlclJlbmRlcjpudWxsLGJGaWx0ZXI6bnVsbCxiSW5mbzpudWxsLGJMZW5ndGhDaGFuZ2U6bnVsbCxiUGFnaW5hdGU6bnVsbCxiUHJvY2Vzc2luZzpudWxsLGJTZXJ2ZXJTaWRlOm51bGwsYlNvcnQ6bnVsbCxiU29ydE11bHRpOm51bGwsDQogICAgICAgIGJTb3J0Q2xhc3NlczpudWxsLGJTdGF0ZVNhdmU6bnVsbH0sb1Njcm9sbDp7YkNvbGxhcHNlOm51bGwsaUJhcldpZHRoOjAsc1g6bnVsbCxzWElubmVyOm51bGwsc1k6bnVsbH0sb0xhbmd1YWdlOntmbkluZm9DYWxsYmFjazpudWxsfSxvQnJvd3Nlcjp7YlNjcm9sbE92ZXJzaXplOiExLGJTY3JvbGxiYXJMZWZ0OiExLGJCb3VuZGluZzohMSxiYXJXaWR0aDowfSxhamF4Om51bGwsYWFuRmVhdHVyZXM6W10sYW9EYXRhOltdLGFpRGlzcGxheTpbXSxhaURpc3BsYXlNYXN0ZXI6W10sYUlkczp7fSxhb0NvbHVtbnM6W10sYW9IZWFkZXI6W10sYW9Gb290ZXI6W10sb1ByZXZpb3VzU2VhcmNoOnt9LGFvUHJlU2VhcmNoQ29sczpbXSxhYVNvcnRpbmc6bnVsbCxhYVNvcnRpbmdGaXhlZDpbXSxhc1N0cmlwZUNsYXNzZXM6bnVsbCxhc0Rlc3Ryb3lTdHJpcGVzOltdLHNEZXN0cm95V2lkdGg6MCxhb1Jvd0NhbGxiYWNrOltdLGFvSGVhZGVyQ2FsbGJhY2s6W10sYW9Gb290ZXJDYWxsYmFjazpbXSwNCiAgICAgICAgYW9EcmF3Q2FsbGJhY2s6W10sYW9Sb3dDcmVhdGVkQ2FsbGJhY2s6W10sYW9QcmVEcmF3Q2FsbGJhY2s6W10sYW9Jbml0Q29tcGxldGU6W10sYW9TdGF0ZVNhdmVQYXJhbXM6W10sYW9TdGF0ZUxvYWRQYXJhbXM6W10sYW9TdGF0ZUxvYWRlZDpbXSxzVGFibGVJZDoiIixuVGFibGU6bnVsbCxuVEhlYWQ6bnVsbCxuVEZvb3Q6bnVsbCxuVEJvZHk6bnVsbCxuVGFibGVXcmFwcGVyOm51bGwsYkRlZmVyTG9hZGluZzohMSxiSW5pdGlhbGlzZWQ6ITEsYW9PcGVuUm93czpbXSxzRG9tOm51bGwsc2VhcmNoRGVsYXk6bnVsbCxzUGFnaW5hdGlvblR5cGU6InR3b19idXR0b24iLGlTdGF0ZUR1cmF0aW9uOjAsYW9TdGF0ZVNhdmU6W10sYW9TdGF0ZUxvYWQ6W10sb1NhdmVkU3RhdGU6bnVsbCxvTG9hZGVkU3RhdGU6bnVsbCxzQWpheFNvdXJjZTpudWxsLHNBamF4RGF0YVByb3A6bnVsbCxiQWpheERhdGFHZXQ6ITAsanFYSFI6bnVsbCxqc29uOmssb0FqYXhEYXRhOmssZm5TZXJ2ZXJEYXRhOm51bGwsDQogICAgICAgIGFvU2VydmVyUGFyYW1zOltdLHNTZXJ2ZXJNZXRob2Q6bnVsbCxmbkZvcm1hdE51bWJlcjpudWxsLGFMZW5ndGhNZW51Om51bGwsaURyYXc6MCxiRHJhd2luZzohMSxpRHJhd0Vycm9yOi0xLF9pRGlzcGxheUxlbmd0aDoxMCxfaURpc3BsYXlTdGFydDowLF9pUmVjb3Jkc1RvdGFsOjAsX2lSZWNvcmRzRGlzcGxheTowLG9DbGFzc2VzOnt9LGJGaWx0ZXJlZDohMSxiU29ydGVkOiExLGJTb3J0Q2VsbHNUb3A6bnVsbCxvSW5pdDpudWxsLGFvRGVzdHJveUNhbGxiYWNrOltdLGZuUmVjb3Jkc1RvdGFsOmZ1bmN0aW9uKCl7cmV0dXJuInNzcCI9PXkodGhpcyk/MSp0aGlzLl9pUmVjb3Jkc1RvdGFsOnRoaXMuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aH0sZm5SZWNvcmRzRGlzcGxheTpmdW5jdGlvbigpe3JldHVybiJzc3AiPT15KHRoaXMpPzEqdGhpcy5faVJlY29yZHNEaXNwbGF5OnRoaXMuYWlEaXNwbGF5Lmxlbmd0aH0sZm5EaXNwbGF5RW5kOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5faURpc3BsYXlMZW5ndGgsDQogICAgICAgICAgICBiPXRoaXMuX2lEaXNwbGF5U3RhcnQsYz1iK2EsZD10aGlzLmFpRGlzcGxheS5sZW5ndGgsZT10aGlzLm9GZWF0dXJlcyxmPWUuYlBhZ2luYXRlO3JldHVybiBlLmJTZXJ2ZXJTaWRlPyExPT09Znx8LTE9PT1hP2IrZDpNYXRoLm1pbihiK2EsdGhpcy5faVJlY29yZHNEaXNwbGF5KTohZnx8Yz5kfHwtMT09PWE/ZDpjfSxvSW5zdGFuY2U6bnVsbCxzSW5zdGFuY2U6bnVsbCxpVGFiSW5kZXg6MCxuU2Nyb2xsSGVhZDpudWxsLG5TY3JvbGxGb290Om51bGwsYUxhc3RTb3J0OltdLG9QbHVnaW5zOnt9LHJvd0lkRm46bnVsbCxyb3dJZDpudWxsfTttLmV4dD14PXtidXR0b25zOnt9LGNsYXNzZXM6e30sYnVpbGRlcjoiLXNvdXJjZS0iLGVyck1vZGU6ImFsZXJ0IixmZWF0dXJlOltdLHNlYXJjaDpbXSxzZWxlY3Rvcjp7Y2VsbDpbXSxjb2x1bW46W10scm93OltdfSxpbnRlcm5hbDp7fSxsZWdhY3k6e2FqYXg6bnVsbH0scGFnZXI6e30scmVuZGVyZXI6e3BhZ2VCdXR0b246e30saGVhZGVyOnt9fSwNCiAgICAgICAgb3JkZXI6e30sdHlwZTp7ZGV0ZWN0OltdLHNlYXJjaDp7fSxvcmRlcjp7fX0sX3VuaXF1ZTowLGZuVmVyc2lvbkNoZWNrOm0uZm5WZXJzaW9uQ2hlY2ssaUFwaUluZGV4OjAsb0pVSUNsYXNzZXM6e30sc1ZlcnNpb246bS52ZXJzaW9ufTtoLmV4dGVuZCh4LHthZm5GaWx0ZXJpbmc6eC5zZWFyY2gsYVR5cGVzOngudHlwZS5kZXRlY3Qsb2ZuU2VhcmNoOngudHlwZS5zZWFyY2gsb1NvcnQ6eC50eXBlLm9yZGVyLGFmblNvcnREYXRhOngub3JkZXIsYW9GZWF0dXJlczp4LmZlYXR1cmUsb0FwaTp4LmludGVybmFsLG9TdGRDbGFzc2VzOnguY2xhc3NlcyxvUGFnaW5hdGlvbjp4LnBhZ2VyfSk7aC5leHRlbmQobS5leHQuY2xhc3Nlcyx7c1RhYmxlOiJkYXRhVGFibGUiLHNOb0Zvb3Rlcjoibm8tZm9vdGVyIixzUGFnZUJ1dHRvbjoicGFnaW5hdGVfYnV0dG9uIixzUGFnZUJ1dHRvbkFjdGl2ZToiY3VycmVudCIsc1BhZ2VCdXR0b25EaXNhYmxlZDoiZGlzYWJsZWQiLHNTdHJpcGVPZGQ6Im9kZCIsDQogICAgICAgIHNTdHJpcGVFdmVuOiJldmVuIixzUm93RW1wdHk6ImRhdGFUYWJsZXNfZW1wdHkiLHNXcmFwcGVyOiJkYXRhVGFibGVzX3dyYXBwZXIiLHNGaWx0ZXI6ImRhdGFUYWJsZXNfZmlsdGVyIixzSW5mbzoiZGF0YVRhYmxlc19pbmZvIixzUGFnaW5nOiJkYXRhVGFibGVzX3BhZ2luYXRlIHBhZ2luZ18iLHNMZW5ndGg6ImRhdGFUYWJsZXNfbGVuZ3RoIixzUHJvY2Vzc2luZzoiZGF0YVRhYmxlc19wcm9jZXNzaW5nIixzU29ydEFzYzoic29ydGluZ19hc2MiLHNTb3J0RGVzYzoic29ydGluZ19kZXNjIixzU29ydGFibGU6InNvcnRpbmciLHNTb3J0YWJsZUFzYzoic29ydGluZ19hc2NfZGlzYWJsZWQiLHNTb3J0YWJsZURlc2M6InNvcnRpbmdfZGVzY19kaXNhYmxlZCIsc1NvcnRhYmxlTm9uZToic29ydGluZ19kaXNhYmxlZCIsc1NvcnRDb2x1bW46InNvcnRpbmdfIixzRmlsdGVySW5wdXQ6IiIsc0xlbmd0aFNlbGVjdDoiIixzU2Nyb2xsV3JhcHBlcjoiZGF0YVRhYmxlc19zY3JvbGwiLHNTY3JvbGxIZWFkOiJkYXRhVGFibGVzX3Njcm9sbEhlYWQiLA0KICAgICAgICBzU2Nyb2xsSGVhZElubmVyOiJkYXRhVGFibGVzX3Njcm9sbEhlYWRJbm5lciIsc1Njcm9sbEJvZHk6ImRhdGFUYWJsZXNfc2Nyb2xsQm9keSIsc1Njcm9sbEZvb3Q6ImRhdGFUYWJsZXNfc2Nyb2xsRm9vdCIsc1Njcm9sbEZvb3RJbm5lcjoiZGF0YVRhYmxlc19zY3JvbGxGb290SW5uZXIiLHNIZWFkZXJUSDoiIixzRm9vdGVyVEg6IiIsc1NvcnRKVUlBc2M6IiIsc1NvcnRKVUlEZXNjOiIiLHNTb3J0SlVJOiIiLHNTb3J0SlVJQXNjQWxsb3dlZDoiIixzU29ydEpVSURlc2NBbGxvd2VkOiIiLHNTb3J0SlVJV3JhcHBlcjoiIixzU29ydEljb246IiIsc0pVSUhlYWRlcjoiIixzSlVJRm9vdGVyOiIifSk7dmFyIEtiPW0uZXh0LnBhZ2VyO2guZXh0ZW5kKEtiLHtzaW1wbGU6ZnVuY3Rpb24oKXtyZXR1cm5bInByZXZpb3VzIiwibmV4dCJdfSxmdWxsOmZ1bmN0aW9uKCl7cmV0dXJuWyJmaXJzdCIsInByZXZpb3VzIiwibmV4dCIsImxhc3QiXX0sbnVtYmVyczpmdW5jdGlvbihhLGIpe3JldHVybltoYShhLA0KICAgICAgICBiKV19LHNpbXBsZV9udW1iZXJzOmZ1bmN0aW9uKGEsYil7cmV0dXJuWyJwcmV2aW91cyIsaGEoYSxiKSwibmV4dCJdfSxmdWxsX251bWJlcnM6ZnVuY3Rpb24oYSxiKXtyZXR1cm5bImZpcnN0IiwicHJldmlvdXMiLGhhKGEsYiksIm5leHQiLCJsYXN0Il19LGZpcnN0X2xhc3RfbnVtYmVyczpmdW5jdGlvbihhLGIpe3JldHVyblsiZmlyc3QiLGhhKGEsYiksImxhc3QiXX0sX251bWJlcnM6aGEsbnVtYmVyc19sZW5ndGg6N30pO2guZXh0ZW5kKCEwLG0uZXh0LnJlbmRlcmVyLHtwYWdlQnV0dG9uOntfOmZ1bmN0aW9uKGEsYixjLGQsZSxmKXt2YXIgZz1hLm9DbGFzc2VzLGo9YS5vTGFuZ3VhZ2Uub1BhZ2luYXRlLGk9YS5vTGFuZ3VhZ2Uub0FyaWEucGFnaW5hdGV8fHt9LG4sbCxtPTAsbz1mdW5jdGlvbihiLGQpe3ZhciBrLHMsdSxyLHY9ZnVuY3Rpb24oYil7U2EoYSxiLmRhdGEuYWN0aW9uLHRydWUpfTtrPTA7Zm9yKHM9ZC5sZW5ndGg7azxzO2srKyl7cj1kW2tdO2lmKGguaXNBcnJheShyKSl7dT0NCiAgICAgICAgaCgiPCIrKHIuRFRfZWx8fCJkaXYiKSsiLz4iKS5hcHBlbmRUbyhiKTtvKHUscil9ZWxzZXtuPW51bGw7bD0iIjtzd2l0Y2gocil7Y2FzZSAiZWxsaXBzaXMiOmIuYXBwZW5kKCc8c3BhbiBjbGFzcz0iZWxsaXBzaXMiPiYjeDIwMjY7PC9zcGFuPicpO2JyZWFrO2Nhc2UgImZpcnN0IjpuPWouc0ZpcnN0O2w9cisoZT4wPyIiOiIgIitnLnNQYWdlQnV0dG9uRGlzYWJsZWQpO2JyZWFrO2Nhc2UgInByZXZpb3VzIjpuPWouc1ByZXZpb3VzO2w9cisoZT4wPyIiOiIgIitnLnNQYWdlQnV0dG9uRGlzYWJsZWQpO2JyZWFrO2Nhc2UgIm5leHQiOm49ai5zTmV4dDtsPXIrKGU8Zi0xPyIiOiIgIitnLnNQYWdlQnV0dG9uRGlzYWJsZWQpO2JyZWFrO2Nhc2UgImxhc3QiOm49ai5zTGFzdDtsPXIrKGU8Zi0xPyIiOiIgIitnLnNQYWdlQnV0dG9uRGlzYWJsZWQpO2JyZWFrO2RlZmF1bHQ6bj1yKzE7bD1lPT09cj9nLnNQYWdlQnV0dG9uQWN0aXZlOiIifWlmKG4hPT1udWxsKXt1PWgoIjxhPiIseyJjbGFzcyI6Zy5zUGFnZUJ1dHRvbisNCiAgICAiICIrbCwiYXJpYS1jb250cm9scyI6YS5zVGFibGVJZCwiYXJpYS1sYWJlbCI6aVtyXSwiZGF0YS1kdC1pZHgiOm0sdGFiaW5kZXg6YS5pVGFiSW5kZXgsaWQ6Yz09PTAmJnR5cGVvZiByPT09InN0cmluZyI/YS5zVGFibGVJZCsiXyIrcjpudWxsfSkuaHRtbChuKS5hcHBlbmRUbyhiKTtWYSh1LHthY3Rpb246cn0sdik7bSsrfX19fSxzO3RyeXtzPWgoYikuZmluZChHLmFjdGl2ZUVsZW1lbnQpLmRhdGEoImR0LWlkeCIpfWNhdGNoKHUpe31vKGgoYikuZW1wdHkoKSxkKTtzIT09ayYmaChiKS5maW5kKCJbZGF0YS1kdC1pZHg9IitzKyJdIikuZm9jdXMoKX19fSk7aC5leHRlbmQobS5leHQudHlwZS5kZXRlY3QsW2Z1bmN0aW9uKGEsYil7dmFyIGM9Yi5vTGFuZ3VhZ2Uuc0RlY2ltYWw7cmV0dXJuIFlhKGEsYyk/Im51bSIrYzpudWxsfSxmdW5jdGlvbihhKXtpZihhJiYhKGEgaW5zdGFuY2VvZiBEYXRlKSYmIVpiLnRlc3QoYSkpcmV0dXJuIG51bGw7dmFyIGI9RGF0ZS5wYXJzZShhKTsNCiAgICAgICAgcmV0dXJuIG51bGwhPT1iJiYhaXNOYU4oYil8fEwoYSk/ImRhdGUiOm51bGx9LGZ1bmN0aW9uKGEsYil7dmFyIGM9Yi5vTGFuZ3VhZ2Uuc0RlY2ltYWw7cmV0dXJuIFlhKGEsYywhMCk/Im51bS1mbXQiK2M6bnVsbH0sZnVuY3Rpb24oYSxiKXt2YXIgYz1iLm9MYW5ndWFnZS5zRGVjaW1hbDtyZXR1cm4gUGIoYSxjKT8iaHRtbC1udW0iK2M6bnVsbH0sZnVuY3Rpb24oYSxiKXt2YXIgYz1iLm9MYW5ndWFnZS5zRGVjaW1hbDtyZXR1cm4gUGIoYSxjLCEwKT8iaHRtbC1udW0tZm10IitjOm51bGx9LGZ1bmN0aW9uKGEpe3JldHVybiBMKGEpfHwic3RyaW5nIj09PXR5cGVvZiBhJiYtMSE9PWEuaW5kZXhPZigiPCIpPyJodG1sIjpudWxsfV0pO2guZXh0ZW5kKG0uZXh0LnR5cGUuc2VhcmNoLHtodG1sOmZ1bmN0aW9uKGEpe3JldHVybiBMKGEpP2E6InN0cmluZyI9PT10eXBlb2YgYT9hLnJlcGxhY2UoTWIsIiAiKS5yZXBsYWNlKEFhLCIiKToiIn0sc3RyaW5nOmZ1bmN0aW9uKGEpe3JldHVybiBMKGEpPw0KICAgICAgICBhOiJzdHJpbmciPT09dHlwZW9mIGE/YS5yZXBsYWNlKE1iLCIgIik6YX19KTt2YXIgemE9ZnVuY3Rpb24oYSxiLGMsZCl7aWYoMCE9PWEmJighYXx8Ii0iPT09YSkpcmV0dXJuLUluZmluaXR5O2ImJihhPU9iKGEsYikpO2EucmVwbGFjZSYmKGMmJihhPWEucmVwbGFjZShjLCIiKSksZCYmKGE9YS5yZXBsYWNlKGQsIiIpKSk7cmV0dXJuIDEqYX07aC5leHRlbmQoeC50eXBlLm9yZGVyLHsiZGF0ZS1wcmUiOmZ1bmN0aW9uKGEpe3JldHVybiBEYXRlLnBhcnNlKGEpfHwtSW5maW5pdHl9LCJodG1sLXByZSI6ZnVuY3Rpb24oYSl7cmV0dXJuIEwoYSk/IiI6YS5yZXBsYWNlP2EucmVwbGFjZSgvPC4qPz4vZywiIikudG9Mb3dlckNhc2UoKTphKyIifSwic3RyaW5nLXByZSI6ZnVuY3Rpb24oYSl7cmV0dXJuIEwoYSk/IiI6InN0cmluZyI9PT10eXBlb2YgYT9hLnRvTG93ZXJDYXNlKCk6IWEudG9TdHJpbmc/IiI6YS50b1N0cmluZygpfSwic3RyaW5nLWFzYyI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYTwNCiAgICBiPy0xOmE+Yj8xOjB9LCJzdHJpbmctZGVzYyI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYTxiPzE6YT5iPy0xOjB9fSk7Y2IoIiIpO2guZXh0ZW5kKCEwLG0uZXh0LnJlbmRlcmVyLHtoZWFkZXI6e186ZnVuY3Rpb24oYSxiLGMsZCl7aChhLm5UYWJsZSkub24oIm9yZGVyLmR0LkRUIixmdW5jdGlvbihlLGYsZyxoKXtpZihhPT09Zil7ZT1jLmlkeDtiLnJlbW92ZUNsYXNzKGMuc1NvcnRpbmdDbGFzcysiICIrZC5zU29ydEFzYysiICIrZC5zU29ydERlc2MpLmFkZENsYXNzKGhbZV09PSJhc2MiP2Quc1NvcnRBc2M6aFtlXT09ImRlc2MiP2Quc1NvcnREZXNjOmMuc1NvcnRpbmdDbGFzcyl9fSl9LGpxdWVyeXVpOmZ1bmN0aW9uKGEsYixjLGQpe2goIjxkaXYvPiIpLmFkZENsYXNzKGQuc1NvcnRKVUlXcmFwcGVyKS5hcHBlbmQoYi5jb250ZW50cygpKS5hcHBlbmQoaCgiPHNwYW4vPiIpLmFkZENsYXNzKGQuc1NvcnRJY29uKyIgIitjLnNTb3J0aW5nQ2xhc3NKVUkpKS5hcHBlbmRUbyhiKTsNCiAgICAgICAgaChhLm5UYWJsZSkub24oIm9yZGVyLmR0LkRUIixmdW5jdGlvbihlLGYsZyxoKXtpZihhPT09Zil7ZT1jLmlkeDtiLnJlbW92ZUNsYXNzKGQuc1NvcnRBc2MrIiAiK2Quc1NvcnREZXNjKS5hZGRDbGFzcyhoW2VdPT0iYXNjIj9kLnNTb3J0QXNjOmhbZV09PSJkZXNjIj9kLnNTb3J0RGVzYzpjLnNTb3J0aW5nQ2xhc3MpO2IuZmluZCgic3Bhbi4iK2Quc1NvcnRJY29uKS5yZW1vdmVDbGFzcyhkLnNTb3J0SlVJQXNjKyIgIitkLnNTb3J0SlVJRGVzYysiICIrZC5zU29ydEpVSSsiICIrZC5zU29ydEpVSUFzY0FsbG93ZWQrIiAiK2Quc1NvcnRKVUlEZXNjQWxsb3dlZCkuYWRkQ2xhc3MoaFtlXT09ImFzYyI/ZC5zU29ydEpVSUFzYzpoW2VdPT0iZGVzYyI/ZC5zU29ydEpVSURlc2M6Yy5zU29ydGluZ0NsYXNzSlVJKX19KX19fSk7dmFyIFZiPWZ1bmN0aW9uKGEpe3JldHVybiJzdHJpbmciPT09dHlwZW9mIGE/YS5yZXBsYWNlKC88L2csIiZsdDsiKS5yZXBsYWNlKC8+L2csIiZndDsiKS5yZXBsYWNlKC8iL2csDQogICAgICAgICImcXVvdDsiKTphfTttLnJlbmRlcj17bnVtYmVyOmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJue2Rpc3BsYXk6ZnVuY3Rpb24oZil7aWYoIm51bWJlciIhPT10eXBlb2YgZiYmInN0cmluZyIhPT10eXBlb2YgZilyZXR1cm4gZjt2YXIgZz0wPmY/Ii0iOiIiLGg9cGFyc2VGbG9hdChmKTtpZihpc05hTihoKSlyZXR1cm4gVmIoZik7aD1oLnRvRml4ZWQoYyk7Zj1NYXRoLmFicyhoKTtoPXBhcnNlSW50KGYsMTApO2Y9Yz9iKyhmLWgpLnRvRml4ZWQoYykuc3Vic3RyaW5nKDIpOiIiO3JldHVybiBnKyhkfHwiIikraC50b1N0cmluZygpLnJlcGxhY2UoL1xCKD89KFxkezN9KSsoPyFcZCkpL2csYSkrZisoZXx8IiIpfX19LHRleHQ6ZnVuY3Rpb24oKXtyZXR1cm57ZGlzcGxheTpWYn19fTtoLmV4dGVuZChtLmV4dC5pbnRlcm5hbCx7X2ZuRXh0ZXJuQXBpRnVuYzpMYixfZm5CdWlsZEFqYXg6c2EsX2ZuQWpheFVwZGF0ZTprYixfZm5BamF4UGFyYW1ldGVyczp0YixfZm5BamF4VXBkYXRlRHJhdzp1YiwNCiAgICAgICAgX2ZuQWpheERhdGFTcmM6dGEsX2ZuQWRkQ29sdW1uOkRhLF9mbkNvbHVtbk9wdGlvbnM6amEsX2ZuQWRqdXN0Q29sdW1uU2l6aW5nOlksX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXg6WixfZm5Db2x1bW5JbmRleFRvVmlzaWJsZTokLF9mblZpc2JsZUNvbHVtbnM6YWEsX2ZuR2V0Q29sdW1uczpsYSxfZm5Db2x1bW5UeXBlczpGYSxfZm5BcHBseUNvbHVtbkRlZnM6aGIsX2ZuSHVuZ2FyaWFuTWFwOlgsX2ZuQ2FtZWxUb0h1bmdhcmlhbjpJLF9mbkxhbmd1YWdlQ29tcGF0OkNhLF9mbkJyb3dzZXJEZXRlY3Q6ZmIsX2ZuQWRkRGF0YTpNLF9mbkFkZFRyOm1hLF9mbk5vZGVUb0RhdGFJbmRleDpmdW5jdGlvbihhLGIpe3JldHVybiBiLl9EVF9Sb3dJbmRleCE9PWs/Yi5fRFRfUm93SW5kZXg6bnVsbH0sX2ZuTm9kZVRvQ29sdW1uSW5kZXg6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBoLmluQXJyYXkoYyxhLmFvRGF0YVtiXS5hbkNlbGxzKX0sX2ZuR2V0Q2VsbERhdGE6QixfZm5TZXRDZWxsRGF0YTppYiwNCiAgICAgICAgX2ZuU3BsaXRPYmpOb3RhdGlvbjpJYSxfZm5HZXRPYmplY3REYXRhRm46USxfZm5TZXRPYmplY3REYXRhRm46UixfZm5HZXREYXRhTWFzdGVyOkphLF9mbkNsZWFyVGFibGU6bmEsX2ZuRGVsZXRlSW5kZXg6b2EsX2ZuSW52YWxpZGF0ZTpjYSxfZm5HZXRSb3dFbGVtZW50czpIYSxfZm5DcmVhdGVUcjpHYSxfZm5CdWlsZEhlYWQ6amIsX2ZuRHJhd0hlYWQ6ZWEsX2ZuRHJhdzpOLF9mblJlRHJhdzpTLF9mbkFkZE9wdGlvbnNIdG1sOm1iLF9mbkRldGVjdEhlYWRlcjpkYSxfZm5HZXRVbmlxdWVUaHM6cmEsX2ZuRmVhdHVyZUh0bWxGaWx0ZXI6b2IsX2ZuRmlsdGVyQ29tcGxldGU6ZmEsX2ZuRmlsdGVyQ3VzdG9tOnhiLF9mbkZpbHRlckNvbHVtbjp3YixfZm5GaWx0ZXI6dmIsX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoOk9hLF9mbkVzY2FwZVJlZ2V4OlBhLF9mbkZpbHRlckRhdGE6eWIsX2ZuRmVhdHVyZUh0bWxJbmZvOnJiLF9mblVwZGF0ZUluZm86QmIsX2ZuSW5mb01hY3JvczpDYixfZm5Jbml0aWFsaXNlOmdhLA0KICAgICAgICBfZm5Jbml0Q29tcGxldGU6dWEsX2ZuTGVuZ3RoQ2hhbmdlOlFhLF9mbkZlYXR1cmVIdG1sTGVuZ3RoOm5iLF9mbkZlYXR1cmVIdG1sUGFnaW5hdGU6c2IsX2ZuUGFnZUNoYW5nZTpTYSxfZm5GZWF0dXJlSHRtbFByb2Nlc3Npbmc6cGIsX2ZuUHJvY2Vzc2luZ0Rpc3BsYXk6QyxfZm5GZWF0dXJlSHRtbFRhYmxlOnFiLF9mblNjcm9sbERyYXc6a2EsX2ZuQXBwbHlUb0NoaWxkcmVuOkgsX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzOkVhLF9mblRocm90dGxlOk5hLF9mbkNvbnZlcnRUb1dpZHRoOkRiLF9mbkdldFdpZGVzdE5vZGU6RWIsX2ZuR2V0TWF4TGVuU3RyaW5nOkZiLF9mblN0cmluZ1RvQ3NzOnYsX2ZuU29ydEZsYXR0ZW46VixfZm5Tb3J0OmxiLF9mblNvcnRBcmlhOkhiLF9mblNvcnRMaXN0ZW5lcjpVYSxfZm5Tb3J0QXR0YWNoTGlzdGVuZXI6TGEsX2ZuU29ydGluZ0NsYXNzZXM6d2EsX2ZuU29ydERhdGE6R2IsX2ZuU2F2ZVN0YXRlOnhhLF9mbkxvYWRTdGF0ZTpJYixfZm5TZXR0aW5nc0Zyb21Ob2RlOnlhLA0KICAgICAgICBfZm5Mb2c6SixfZm5NYXA6RixfZm5CaW5kQWN0aW9uOlZhLF9mbkNhbGxiYWNrUmVnOnosX2ZuQ2FsbGJhY2tGaXJlOnIsX2ZuTGVuZ3RoT3ZlcmZsb3c6UmEsX2ZuUmVuZGVyZXI6TWEsX2ZuRGF0YVNvdXJjZTp5LF9mblJvd0F0dHJpYnV0ZXM6S2EsX2ZuQ2FsY3VsYXRlRW5kOmZ1bmN0aW9uKCl7fX0pO2guZm4uZGF0YVRhYmxlPW07bS4kPWg7aC5mbi5kYXRhVGFibGVTZXR0aW5ncz1tLnNldHRpbmdzO2guZm4uZGF0YVRhYmxlRXh0PW0uZXh0O2guZm4uRGF0YVRhYmxlPWZ1bmN0aW9uKGEpe3JldHVybiBoKHRoaXMpLmRhdGFUYWJsZShhKS5hcGkoKX07aC5lYWNoKG0sZnVuY3Rpb24oYSxiKXtoLmZuLkRhdGFUYWJsZVthXT1ifSk7cmV0dXJuIGguZm4uZGF0YVRhYmxlfSk7Ci8qISBGaXhlZENvbHVtbnMgMy4yLjMtZGV2DQogKiDCqTIwMTAtMjAxNiBTcHJ5TWVkaWEgTHRkIC0gZGF0YXRhYmxlcy5uZXQvbGljZW5zZQ0KICovDQoNCi8qKg0KICogQHN1bW1hcnkgICAgIEZpeGVkQ29sdW1ucw0KICogQGRlc2NyaXB0aW9uIEZyZWV6ZSBjb2x1bW5zIGluIHBsYWNlIG9uIGEgc2Nyb2xsaW5nIERhdGFUYWJsZQ0KICogQHZlcnNpb24gICAgIDMuMi4zLWRldg0KICogQGZpbGUgICAgICAgIGRhdGFUYWJsZXMuZml4ZWRDb2x1bW5zLmpzDQogKiBAYXV0aG9yICAgICAgU3ByeU1lZGlhIEx0ZCAod3d3LnNwcnltZWRpYS5jby51aykNCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QNCiAqIEBjb3B5cmlnaHQgICBDb3B5cmlnaHQgMjAxMC0yMDE2IFNwcnlNZWRpYSBMdGQuDQogKg0KICogVGhpcyBzb3VyY2UgZmlsZSBpcyBmcmVlIHNvZnR3YXJlLCBhdmFpbGFibGUgdW5kZXIgdGhlIGZvbGxvd2luZyBsaWNlbnNlOg0KICogICBNSVQgbGljZW5zZSAtIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlL21pdA0KICoNCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0DQogKiBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWQ0KICogb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgbGljZW5zZSBmaWxlcyBmb3IgZGV0YWlscy4NCiAqDQogKiBGb3IgZGV0YWlscyBwbGVhc2UgcmVmZXIgdG86IGh0dHA6Ly93d3cuZGF0YXRhYmxlcy5uZXQNCiAqLw0KKGZ1bmN0aW9uKCBmYWN0b3J5ICl7DQogICAgaWYgKCB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgKSB7DQogICAgICAgIC8vIEFNRA0KICAgICAgICBkZWZpbmUoIFsnanF1ZXJ5JywgJ2RhdGF0YWJsZXMubmV0J10sIGZ1bmN0aW9uICggJCApIHsNCiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KCAkLCB3aW5kb3csIGRvY3VtZW50ICk7DQogICAgICAgIH0gKTsNCiAgICB9DQogICAgZWxzZSBpZiAoIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyApIHsNCiAgICAgICAgLy8gQ29tbW9uSlMNCiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAocm9vdCwgJCkgew0KICAgICAgICAgICAgaWYgKCAhIHJvb3QgKSB7DQogICAgICAgICAgICAgICAgcm9vdCA9IHdpbmRvdzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCAhICQgfHwgISAkLmZuLmRhdGFUYWJsZSApIHsNCiAgICAgICAgICAgICAgICAkID0gcmVxdWlyZSgnZGF0YXRhYmxlcy5uZXQnKShyb290LCAkKS4kOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFjdG9yeSggJCwgcm9vdCwgcm9vdC5kb2N1bWVudCApOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgLy8gQnJvd3Nlcg0KICAgICAgICBmYWN0b3J5KCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTsNCiAgICB9DQp9KGZ1bmN0aW9uKCAkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQgKSB7DQogICAgJ3VzZSBzdHJpY3QnOw0KICAgIHZhciBEYXRhVGFibGUgPSAkLmZuLmRhdGFUYWJsZTsNCiAgICB2YXIgX2ZpcmVmb3hTY3JvbGw7DQoNCiAgICAvKioNCiAgICAgKiBXaGVuIG1ha2luZyB1c2Ugb2YgRGF0YVRhYmxlcycgeC1heGlzIHNjcm9sbGluZyBmZWF0dXJlLCB5b3UgbWF5IHdpc2ggdG8NCiAgICAgKiBmaXggdGhlIGxlZnQgbW9zdCBjb2x1bW4gaW4gcGxhY2UuIFRoaXMgcGx1Zy1pbiBmb3IgRGF0YVRhYmxlcyBwcm92aWRlcw0KICAgICAqIGV4YWN0bHkgdGhpcyBvcHRpb24gKG5vdGUgZm9yIG5vbi1zY3JvbGxpbmcgdGFibGVzLCBwbGVhc2UgdXNlIHRoZQ0KICAgICAqIEZpeGVkSGVhZGVyIHBsdWctaW4sIHdoaWNoIGNhbiBmaXggaGVhZGVycyBhbmQgZm9vdGVycykuIEtleQ0KICAgICAqIGZlYXR1cmVzIGluY2x1ZGU6DQogICAgICoNCiAgICAgKiAqIEZyZWV6ZXMgdGhlIGxlZnQgb3IgcmlnaHQgbW9zdCBjb2x1bW5zIHRvIHRoZSBzaWRlIG9mIHRoZSB0YWJsZQ0KICAgICAqICogT3B0aW9uIHRvIGZyZWV6ZSB0d28gb3IgbW9yZSBjb2x1bW5zDQogICAgICogKiBGdWxsIGludGVncmF0aW9uIHdpdGggRGF0YVRhYmxlcycgc2Nyb2xsaW5nIG9wdGlvbnMNCiAgICAgKiAqIFNwZWVkIC0gRml4ZWRDb2x1bW5zIGlzIGZhc3QgaW4gaXRzIG9wZXJhdGlvbg0KICAgICAqDQogICAgICogIEBjbGFzcw0KICAgICAqICBAY29uc3RydWN0b3INCiAgICAgKiAgQGdsb2JhbA0KICAgICAqICBAcGFyYW0ge29iamVjdH0gZHQgRGF0YVRhYmxlcyBpbnN0YW5jZS4gV2l0aCBEYXRhVGFibGVzIDEuMTAgdGhpcyBjYW4gYWxzbw0KICAgICAqICAgIGJlIGEgalF1ZXJ5IGNvbGxlY3Rpb24sIGEgalF1ZXJ5IHNlbGVjdG9yLCBEYXRhVGFibGVzIEFQSSBpbnN0YW5jZSBvcg0KICAgICAqICAgIHNldHRpbmdzIG9iamVjdC4NCiAgICAgKiAgQHBhcmFtIHtvYmplY3R9IFtpbml0PXt9XSBDb25maWd1cmF0aW9uIG9iamVjdCBmb3IgRml4ZWRDb2x1bW5zLiBPcHRpb25zIGFyZQ0KICAgICAqICAgIGRlZmluZWQgYnkge0BsaW5rIEZpeGVkQ29sdW1ucy5kZWZhdWx0c30NCiAgICAgKg0KICAgICAqICBAcmVxdWlyZXMgalF1ZXJ5IDEuNysNCiAgICAgKiAgQHJlcXVpcmVzIERhdGFUYWJsZXMgMS44LjArDQogICAgICoNCiAgICAgKiAgQGV4YW1wbGUNCiAgICAgKiAgICAgIHZhciB0YWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7DQogKiAgICAgICAgInNjcm9sbFgiOiAiMTAwJSINCiAqICAgICAgfSApOw0KICAgICAqICAgICAgbmV3ICQuZm4uZGF0YVRhYmxlLmZpeGVkQ29sdW1ucyggdGFibGUgKTsNCiAgICAgKi8NCiAgICB2YXIgRml4ZWRDb2x1bW5zID0gZnVuY3Rpb24gKCBkdCwgaW5pdCApIHsNCiAgICAgICAgdmFyIHRoYXQgPSB0aGlzOw0KDQogICAgICAgIC8qIFNhbml0eSBjaGVjayAtIHlvdSBqdXN0IGtub3cgaXQgd2lsbCBoYXBwZW4gKi8NCiAgICAgICAgaWYgKCAhICggdGhpcyBpbnN0YW5jZW9mIEZpeGVkQ29sdW1ucyApICkgew0KICAgICAgICAgICAgYWxlcnQoICJGaXhlZENvbHVtbnMgd2FybmluZzogRml4ZWRDb2x1bW5zIG11c3QgYmUgaW5pdGlhbGlzZWQgd2l0aCB0aGUgJ25ldycga2V5d29yZC4iICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIGluaXQgPT09IHVuZGVmaW5lZCB8fCBpbml0ID09PSB0cnVlICkgew0KICAgICAgICAgICAgaW5pdCA9IHt9Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8gVXNlIHRoZSBEYXRhVGFibGVzIEh1bmdhcmlhbiBub3RhdGlvbiBtYXBwaW5nIG1ldGhvZCwgaWYgaXQgZXhpc3RzIHRvDQogICAgICAgIC8vIHByb3ZpZGUgZm9yd2FyZHMgY29tcGF0aWJpbGl0eSBmb3IgY2FtZWwgY2FzZSB2YXJpYWJsZXMNCiAgICAgICAgdmFyIGNhbWVsVG9IdW5nYXJpYW4gPSAkLmZuLmRhdGFUYWJsZS5jYW1lbFRvSHVuZ2FyaWFuOw0KICAgICAgICBpZiAoIGNhbWVsVG9IdW5nYXJpYW4gKSB7DQogICAgICAgICAgICBjYW1lbFRvSHVuZ2FyaWFuKCBGaXhlZENvbHVtbnMuZGVmYXVsdHMsIEZpeGVkQ29sdW1ucy5kZWZhdWx0cywgdHJ1ZSApOw0KICAgICAgICAgICAgY2FtZWxUb0h1bmdhcmlhbiggRml4ZWRDb2x1bW5zLmRlZmF1bHRzLCBpbml0ICk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyB2MS4xMCBhbGxvd3MgdGhlIHNldHRpbmdzIG9iamVjdCB0byBiZSBnb3QgZm9ybSBhIG51bWJlciBvZiBzb3VyY2VzDQogICAgICAgIHZhciBkdFNldHRpbmdzID0gbmV3ICQuZm4uZGF0YVRhYmxlLkFwaSggZHQgKS5zZXR0aW5ncygpWzBdOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTZXR0aW5ncyBvYmplY3Qgd2hpY2ggY29udGFpbnMgY3VzdG9taXNhYmxlIGluZm9ybWF0aW9uIGZvciBGaXhlZENvbHVtbnMgaW5zdGFuY2UNCiAgICAgICAgICogQG5hbWVzcGFjZQ0KICAgICAgICAgKiBAZXh0ZW5kcyBGaXhlZENvbHVtbnMuZGVmYXVsdHMNCiAgICAgICAgICogQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgIHRoaXMucyA9IHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3RzDQogICAgICAgICAgICAgKiAgQHR5cGUgICAgIG9iamVjdA0KICAgICAgICAgICAgICogIEBkZWZhdWx0ICBPYnRhaW5lZCBmcm9tIERhdGFUYWJsZXMgaW5zdGFuY2UNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgImR0IjogZHRTZXR0aW5ncywNCg0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBOdW1iZXIgb2YgY29sdW1ucyBpbiB0aGUgRGF0YVRhYmxlIC0gc3RvcmVkIGZvciBxdWljayBhY2Nlc3MNCiAgICAgICAgICAgICAqICBAdHlwZSAgICAgaW50DQogICAgICAgICAgICAgKiAgQGRlZmF1bHQgIE9idGFpbmVkIGZyb20gRGF0YVRhYmxlcyBpbnN0YW5jZQ0KICAgICAgICAgICAgICovDQogICAgICAgICAgICAiaVRhYmxlQ29sdW1ucyI6IGR0U2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCwNCg0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBPcmlnaW5hbCBvdXRlciB3aWR0aHMgb2YgdGhlIGNvbHVtbnMgYXMgcmVuZGVyZWQgYnkgRGF0YVRhYmxlcyAtIHVzZWQgdG8gY2FsY3VsYXRlDQogICAgICAgICAgICAgKiB0aGUgRml4ZWRDb2x1bW5zIGdyaWQgYm91bmRpbmcgYm94DQogICAgICAgICAgICAgKiAgQHR5cGUgICAgIGFycmF5LjxpbnQ+DQogICAgICAgICAgICAgKiAgQGRlZmF1bHQgIFtdDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJhaU91dGVyV2lkdGhzIjogW10sDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogT3JpZ2luYWwgaW5uZXIgd2lkdGhzIG9mIHRoZSBjb2x1bW5zIGFzIHJlbmRlcmVkIGJ5IERhdGFUYWJsZXMgLSB1c2VkIHRvIGFwcGx5IHdpZHRocw0KICAgICAgICAgICAgICogdG8gdGhlIGNvbHVtbnMNCiAgICAgICAgICAgICAqICBAdHlwZSAgICAgYXJyYXkuPGludD4NCiAgICAgICAgICAgICAqICBAZGVmYXVsdCAgW10NCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgImFpSW5uZXJXaWR0aHMiOiBbXSwNCg0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIElzIHRoZSBkb2N1bWVudCBsYXlvdXQgcmlnaHQtdG8tbGVmdA0KICAgICAgICAgICAgICogQHR5cGUgYm9vbGVhbg0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBydGw6ICQoZHRTZXR0aW5ncy5uVGFibGUpLmNzcygnZGlyZWN0aW9uJykgPT09ICdydGwnDQogICAgICAgIH07DQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogRE9NIGVsZW1lbnRzIHVzZWQgYnkgdGhlIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqIEBuYW1lc3BhY2UNCiAgICAgICAgICogQHByaXZhdGUNCiAgICAgICAgICoNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZG9tID0gew0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBEYXRhVGFibGVzIHNjcm9sbGluZyBlbGVtZW50DQogICAgICAgICAgICAgKiAgQHR5cGUgICAgIG5vZGUNCiAgICAgICAgICAgICAqICBAZGVmYXVsdCAgbnVsbA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICAic2Nyb2xsZXIiOiBudWxsLA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIERhdGFUYWJsZXMgaGVhZGVyIHRhYmxlDQogICAgICAgICAgICAgKiAgQHR5cGUgICAgIG5vZGUNCiAgICAgICAgICAgICAqICBAZGVmYXVsdCAgbnVsbA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICAiaGVhZGVyIjogbnVsbCwNCg0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBEYXRhVGFibGVzIGJvZHkgdGFibGUNCiAgICAgICAgICAgICAqICBAdHlwZSAgICAgbm9kZQ0KICAgICAgICAgICAgICogIEBkZWZhdWx0ICBudWxsDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJib2R5IjogbnVsbCwNCg0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBEYXRhVGFibGVzIGZvb3RlciB0YWJsZQ0KICAgICAgICAgICAgICogIEB0eXBlICAgICBub2RlDQogICAgICAgICAgICAgKiAgQGRlZmF1bHQgIG51bGwNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgImZvb3RlciI6IG51bGwsDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogRGlzcGxheSBncmlkIGVsZW1lbnRzDQogICAgICAgICAgICAgKiBAbmFtZXNwYWNlDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJncmlkIjogew0KICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIEdyaWQgd3JhcHBlci4gVGhpcyBpcyB0aGUgY29udGFpbmVyIGVsZW1lbnQgZm9yIHRoZSAzeDMgZ3JpZA0KICAgICAgICAgICAgICAgICAqICBAdHlwZSAgICAgbm9kZQ0KICAgICAgICAgICAgICAgICAqICBAZGVmYXVsdCAgbnVsbA0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgICJ3cmFwcGVyIjogbnVsbCwNCg0KICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIERhdGFUYWJsZXMgc2Nyb2xsaW5nIGVsZW1lbnQuIFRoaXMgZWxlbWVudCBpcyB0aGUgRGF0YVRhYmxlcw0KICAgICAgICAgICAgICAgICAqIGNvbXBvbmVudCBpbiB0aGUgZGlzcGxheSBncmlkIChtYWtpbmcgdXAgdGhlIG1haW4gdGFibGUgLSBpLmUuDQogICAgICAgICAgICAgICAgICogbm90IHRoZSBmaXhlZCBjb2x1bW5zKS4NCiAgICAgICAgICAgICAgICAgKiAgQHR5cGUgICAgIG5vZGUNCiAgICAgICAgICAgICAgICAgKiAgQGRlZmF1bHQgIG51bGwNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICAiZHQiOiBudWxsLA0KDQogICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICogTGVmdCBmaXhlZCBjb2x1bW4gZ3JpZCBjb21wb25lbnRzDQogICAgICAgICAgICAgICAgICogQG5hbWVzcGFjZQ0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgICJsZWZ0Ijogew0KICAgICAgICAgICAgICAgICAgICAid3JhcHBlciI6IG51bGwsDQogICAgICAgICAgICAgICAgICAgICJoZWFkIjogbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgImJvZHkiOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICAiZm9vdCI6IG51bGwNCiAgICAgICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICogUmlnaHQgZml4ZWQgY29sdW1uIGdyaWQgY29tcG9uZW50cw0KICAgICAgICAgICAgICAgICAqIEBuYW1lc3BhY2UNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICAicmlnaHQiOiB7DQogICAgICAgICAgICAgICAgICAgICJ3cmFwcGVyIjogbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgImhlYWQiOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICAiYm9keSI6IG51bGwsDQogICAgICAgICAgICAgICAgICAgICJmb290IjogbnVsbA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ2xvbmVkIHRhYmxlIG5vZGVzDQogICAgICAgICAgICAgKiBAbmFtZXNwYWNlDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJjbG9uZSI6IHsNCiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBMZWZ0IGNvbHVtbiBjbG9uZWQgdGFibGUgbm9kZXMNCiAgICAgICAgICAgICAgICAgKiBAbmFtZXNwYWNlDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgImxlZnQiOiB7DQogICAgICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAgICAgKiBDbG9uZWQgaGVhZGVyIHRhYmxlDQogICAgICAgICAgICAgICAgICAgICAqICBAdHlwZSAgICAgbm9kZQ0KICAgICAgICAgICAgICAgICAgICAgKiAgQGRlZmF1bHQgIG51bGwNCiAgICAgICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgICAgICJoZWFkZXIiOiBudWxsLA0KDQogICAgICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAgICAgKiBDbG9uZWQgYm9keSB0YWJsZQ0KICAgICAgICAgICAgICAgICAgICAgKiAgQHR5cGUgICAgIG5vZGUNCiAgICAgICAgICAgICAgICAgICAgICogIEBkZWZhdWx0ICBudWxsDQogICAgICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgICAgICAiYm9keSI6IG51bGwsDQoNCiAgICAgICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICAgICAqIENsb25lZCBmb290ZXIgdGFibGUNCiAgICAgICAgICAgICAgICAgICAgICogIEB0eXBlICAgICBub2RlDQogICAgICAgICAgICAgICAgICAgICAqICBAZGVmYXVsdCAgbnVsbA0KICAgICAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICAgICAgImZvb3RlciI6IG51bGwNCiAgICAgICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICogUmlnaHQgY29sdW1uIGNsb25lZCB0YWJsZSBub2Rlcw0KICAgICAgICAgICAgICAgICAqIEBuYW1lc3BhY2UNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICAicmlnaHQiOiB7DQogICAgICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAgICAgKiBDbG9uZWQgaGVhZGVyIHRhYmxlDQogICAgICAgICAgICAgICAgICAgICAqICBAdHlwZSAgICAgbm9kZQ0KICAgICAgICAgICAgICAgICAgICAgKiAgQGRlZmF1bHQgIG51bGwNCiAgICAgICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgICAgICJoZWFkZXIiOiBudWxsLA0KDQogICAgICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAgICAgKiBDbG9uZWQgYm9keSB0YWJsZQ0KICAgICAgICAgICAgICAgICAgICAgKiAgQHR5cGUgICAgIG5vZGUNCiAgICAgICAgICAgICAgICAgICAgICogIEBkZWZhdWx0ICBudWxsDQogICAgICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgICAgICAiYm9keSI6IG51bGwsDQoNCiAgICAgICAgICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgICAgICAgICAqIENsb25lZCBmb290ZXIgdGFibGUNCiAgICAgICAgICAgICAgICAgICAgICogIEB0eXBlICAgICBub2RlDQogICAgICAgICAgICAgICAgICAgICAqICBAZGVmYXVsdCAgbnVsbA0KICAgICAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICAgICAgImZvb3RlciI6IG51bGwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgaWYgKCBkdFNldHRpbmdzLl9vRml4ZWRDb2x1bW5zICkgew0KICAgICAgICAgICAgdGhyb3cgJ0ZpeGVkQ29sdW1ucyBhbHJlYWR5IGluaXRpYWxpc2VkIG9uIHRoaXMgdGFibGUnOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogQXR0YWNoIHRoZSBpbnN0YW5jZSB0byB0aGUgRGF0YVRhYmxlcyBpbnN0YW5jZSBzbyBpdCBjYW4gYmUgYWNjZXNzZWQgZWFzaWx5ICovDQogICAgICAgIGR0U2V0dGluZ3MuX29GaXhlZENvbHVtbnMgPSB0aGlzOw0KDQogICAgICAgIC8qIExldCdzIGRvIGl0ICovDQogICAgICAgIGlmICggISBkdFNldHRpbmdzLl9iSW5pdENvbXBsZXRlICkNCiAgICAgICAgew0KICAgICAgICAgICAgZHRTZXR0aW5ncy5vQXBpLl9mbkNhbGxiYWNrUmVnKCBkdFNldHRpbmdzLCAnYW9Jbml0Q29tcGxldGUnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhhdC5fZm5Db25zdHJ1Y3QoIGluaXQgKTsNCiAgICAgICAgICAgIH0sICdGaXhlZENvbHVtbnMnICk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLl9mbkNvbnN0cnVjdCggaW5pdCApOw0KICAgICAgICB9DQogICAgfTsNCg0KDQoNCiAgICAkLmV4dGVuZCggRml4ZWRDb2x1bW5zLnByb3RvdHlwZSAsIHsNCiAgICAgICAgLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKg0KICAgICAgICAgKiBQdWJsaWMgbWV0aG9kcw0KICAgICAgICAgKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqLw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBVcGRhdGUgdGhlIGZpeGVkIGNvbHVtbnMgLSBpbmNsdWRpbmcgaGVhZGVycyBhbmQgZm9vdGVycy4gTm90ZSB0aGF0IEZpeGVkQ29sdW1ucyB3aWxsDQogICAgICAgICAqIGF1dG9tYXRpY2FsbHkgdXBkYXRlIHRoZSBkaXNwbGF5IHdoZW5ldmVyIHRoZSBob3N0IERhdGFUYWJsZSByZWRyYXdzLg0KICAgICAgICAgKiAgQHJldHVybnMge3ZvaWR9DQogICAgICAgICAqICBAZXhhbXBsZQ0KICAgICAgICAgKiAgICAgIHZhciB0YWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7DQoJICogICAgICAgICAgInNjcm9sbFgiOiAiMTAwJSINCgkgKiAgICAgIH0gKTsNCiAgICAgICAgICogICAgICB2YXIgZmMgPSBuZXcgJC5mbi5kYXRhVGFibGUuZml4ZWRDb2x1bW5zKCB0YWJsZSApOw0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgIC8vIGF0IHNvbWUgbGF0ZXIgcG9pbnQgd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gbWFuaXB1bGF0ZWQuLi4uDQogICAgICAgICAqICAgICAgZmMuZm5VcGRhdGUoKTsNCiAgICAgICAgICovDQogICAgICAgICJmblVwZGF0ZSI6IGZ1bmN0aW9uICgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRoaXMuX2ZuRHJhdyggdHJ1ZSApOw0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlY2FsY3VsYXRlIHRoZSByZXNpemVzIG9mIHRoZSAzeDMgZ3JpZCB0aGF0IEZpeGVkQ29sdW1ucyB1c2VzIGZvciBkaXNwbGF5IG9mIHRoZSB0YWJsZS4NCiAgICAgICAgICogVGhpcyBpcyB1c2VmdWwgaWYgeW91IHVwZGF0ZSB0aGUgd2lkdGggb2YgdGhlIHRhYmxlIGNvbnRhaW5lci4gTm90ZSB0aGF0IEZpeGVkQ29sdW1ucyB3aWxsDQogICAgICAgICAqIHBlcmZvcm0gdGhpcyBmdW5jdGlvbiBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlIHdpbmRvdy5yZXNpemUgZXZlbnQgaXMgZmlyZWQuDQogICAgICAgICAqICBAcmV0dXJucyB7dm9pZH0NCiAgICAgICAgICogIEBleGFtcGxlDQogICAgICAgICAqICAgICAgdmFyIHRhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsNCgkgKiAgICAgICAgICAic2Nyb2xsWCI6ICIxMDAlIg0KCSAqICAgICAgfSApOw0KICAgICAgICAgKiAgICAgIHZhciBmYyA9IG5ldyAkLmZuLmRhdGFUYWJsZS5maXhlZENvbHVtbnMoIHRhYmxlICk7DQogICAgICAgICAqDQogICAgICAgICAqICAgICAgLy8gUmVzaXplIHRoZSB0YWJsZSBjb250YWluZXIgYW5kIHRoZW4gaGF2ZSBGaXhlZENvbHVtbnMgYWRqdXN0IGl0cyBsYXlvdXQuLi4uDQogICAgICAgICAqICAgICAgJCgnI2NvbnRlbnQnKS53aWR0aCggMTIwMCApOw0KICAgICAgICAgKiAgICAgIGZjLmZuUmVkcmF3TGF5b3V0KCk7DQogICAgICAgICAqLw0KICAgICAgICAiZm5SZWRyYXdMYXlvdXQiOiBmdW5jdGlvbiAoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLl9mbkNvbENhbGMoKTsNCiAgICAgICAgICAgIHRoaXMuX2ZuR3JpZExheW91dCgpOw0KICAgICAgICAgICAgdGhpcy5mblVwZGF0ZSgpOw0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIE1hcmsgYSByb3cgc3VjaCB0aGF0IGl0J3MgaGVpZ2h0IHNob3VsZCBiZSByZWNhbGN1bGF0ZWQgd2hlbiB1c2luZyAnc2VtaWF1dG8nIHJvdw0KICAgICAgICAgKiBoZWlnaHQgbWF0Y2hpbmcuIFRoaXMgZnVuY3Rpb24gd2lsbCBoYXZlIG5vIGVmZmVjdCB3aGVuICdub25lJyBvciAnYXV0bycgcm93IGhlaWdodA0KICAgICAgICAgKiBtYXRjaGluZyBpcyB1c2VkLg0KICAgICAgICAgKiAgQHBhcmFtICAge05vZGV9IG5UciBUUiBlbGVtZW50IHRoYXQgc2hvdWxkIGhhdmUgaXQncyBoZWlnaHQgcmVjYWxjdWxhdGVkDQogICAgICAgICAqICBAcmV0dXJucyB7dm9pZH0NCiAgICAgICAgICogIEBleGFtcGxlDQogICAgICAgICAqICAgICAgdmFyIHRhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsNCgkgKiAgICAgICAgICAic2Nyb2xsWCI6ICIxMDAlIg0KCSAqICAgICAgfSApOw0KICAgICAgICAgKiAgICAgIHZhciBmYyA9IG5ldyAkLmZuLmRhdGFUYWJsZS5maXhlZENvbHVtbnMoIHRhYmxlICk7DQogICAgICAgICAqDQogICAgICAgICAqICAgICAgLy8gbWFuaXB1bGF0ZSB0aGUgdGFibGUgLSBtYXJrIHRoZSByb3cgYXMgbmVlZGluZyBhbiB1cGRhdGUgdGhlbiB1cGRhdGUgdGhlIHRhYmxlDQogICAgICAgICAqICAgICAgLy8gdGhpcyBhbGxvd3MgdGhlIHJlZHJhdyBwZXJmb3JtZWQgYnkgRGF0YVRhYmxlcyBmblVwZGF0ZSB0byByZWNhbGN1bGF0ZSB0aGUgcm93DQogICAgICAgICAqICAgICAgLy8gaGVpZ2h0DQogICAgICAgICAqICAgICAgZmMuZm5SZWNhbGN1bGF0ZUhlaWdodCgpOw0KICAgICAgICAgKiAgICAgIHRhYmxlLmZuVXBkYXRlKCAkKCcjZXhhbXBsZSB0Ym9keSB0cjplcSgwKScpWzBdLCBbImluc2VydCBkYXRlIiwgMSwgMiwgMyAuLi4gXSk7DQogICAgICAgICAqLw0KICAgICAgICAiZm5SZWNhbGN1bGF0ZUhlaWdodCI6IGZ1bmN0aW9uICggblRyICkNCiAgICAgICAgew0KICAgICAgICAgICAgZGVsZXRlIG5Uci5fRFRUQ19pSGVpZ2h0Ow0KICAgICAgICAgICAgblRyLnN0eWxlLmhlaWdodCA9ICdhdXRvJzsNCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTZXQgdGhlIGhlaWdodCBvZiBhIGdpdmVuIHJvdyAtIHByb3ZpZGVzIGNyb3NzIGJyb3dzZXIgY29tcGF0aWJpbGl0eQ0KICAgICAgICAgKiAgQHBhcmFtICAge05vZGV9IG5UYXJnZXQgVFIgZWxlbWVudCB0aGF0IHNob3VsZCBoYXZlIGl0J3MgaGVpZ2h0IHJlY2FsY3VsYXRlZA0KICAgICAgICAgKiAgQHBhcmFtICAge2ludH0gaUhlaWdodCBIZWlnaHQgaW4gcGl4ZWxzIHRvIHNldA0KICAgICAgICAgKiAgQHJldHVybnMge3ZvaWR9DQogICAgICAgICAqICBAZXhhbXBsZQ0KICAgICAgICAgKiAgICAgIHZhciB0YWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7DQoJICogICAgICAgICAgInNjcm9sbFgiOiAiMTAwJSINCgkgKiAgICAgIH0gKTsNCiAgICAgICAgICogICAgICB2YXIgZmMgPSBuZXcgJC5mbi5kYXRhVGFibGUuZml4ZWRDb2x1bW5zKCB0YWJsZSApOw0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgIC8vIFlvdSBtYXkgd2FudCB0byBkbyB0aGlzIGFmdGVyIG1hbmlwdWxhdGluZyBhIHJvdyBpbiB0aGUgZml4ZWQgY29sdW1uDQogICAgICAgICAqICAgICAgZmMuZm5TZXRSb3dIZWlnaHQoICQoJyNleGFtcGxlIHRib2R5IHRyOmVxKDApJylbMF0sIDUwICk7DQogICAgICAgICAqLw0KICAgICAgICAiZm5TZXRSb3dIZWlnaHQiOiBmdW5jdGlvbiAoIG5UYXJnZXQsIGlIZWlnaHQgKQ0KICAgICAgICB7DQogICAgICAgICAgICBuVGFyZ2V0LnN0eWxlLmhlaWdodCA9IGlIZWlnaHQrInB4IjsNCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBHZXQgZGF0YSBpbmRleCBpbmZvcm1hdGlvbiBhYm91dCBhIHJvdyBvciBjZWxsIGluIHRoZSB0YWJsZSBib2R5Lg0KICAgICAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGZ1bmN0aW9uYWxseSBpZGVudGljYWwgdG8gZm5HZXRQb3NpdGlvbiBpbiBEYXRhVGFibGVzLA0KICAgICAgICAgKiB0YWtpbmcgdGhlIHNhbWUgcGFyYW1ldGVyIChUSCwgVEQgb3IgVFIgbm9kZSkgYW5kIHJldHVybmluZyBleGFjdGx5IHRoZQ0KICAgICAgICAgKiB0aGUgc2FtZSBpbmZvcm1hdGlvbiAoZGF0YSBpbmRleCBpbmZvcm1hdGlvbikuIFRIZSBkaWZmZXJlbmNlIGJldHdlZW4NCiAgICAgICAgICogdGhlIHR3byBpcyB0aGF0IHRoaXMgbWV0aG9kIHRha2VzIGludG8gYWNjb3VudCB0aGUgZml4ZWQgY29sdW1ucyBpbiB0aGUNCiAgICAgICAgICogdGFibGUsIHNvIHlvdSBjYW4gcGFzcyBpbiBub2RlcyBmcm9tIHRoZSBtYXN0ZXIgdGFibGUsIG9yIHRoZSBjbG9uZWQNCiAgICAgICAgICogdGFibGVzIGFuZCBnZXQgdGhlIGluZGV4IHBvc2l0aW9uIGZvciB0aGUgZGF0YSBpbiB0aGUgbWFpbiB0YWJsZS4NCiAgICAgICAgICogIEBwYXJhbSB7bm9kZX0gbm9kZSBUUiwgVEggb3IgVEQgZWxlbWVudCB0byBnZXQgdGhlIGluZm9ybWF0aW9uIGFib3V0DQogICAgICAgICAqICBAcmV0dXJucyB7aW50fSBJZiBuTm9kZSBpcyBnaXZlbiBhcyBhIFRSLCB0aGVuIGEgc2luZ2xlIGluZGV4IGlzDQogICAgICAgICAqICAgIHJldHVybmVkLCBvciBpZiBnaXZlbiBhcyBhIGNlbGwsIGFuIGFycmF5IG9mIFtyb3cgaW5kZXgsIGNvbHVtbiBpbmRleA0KICAgICAgICAgKiAgICAodmlzaWJsZSksIGNvbHVtbiBpbmRleCAoYWxsKV0gaXMgZ2l2ZW4uDQogICAgICAgICAqLw0KICAgICAgICAiZm5HZXRQb3NpdGlvbiI6IGZ1bmN0aW9uICggbm9kZSApDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBpZHg7DQogICAgICAgICAgICB2YXIgaW5zdCA9IHRoaXMucy5kdC5vSW5zdGFuY2U7DQoNCiAgICAgICAgICAgIGlmICggISAkKG5vZGUpLnBhcmVudHMoJy5EVEZDX0Nsb25lZCcpLmxlbmd0aCApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gTm90IGluIGEgY2xvbmVkIHRhYmxlDQogICAgICAgICAgICAgICAgcmV0dXJuIGluc3QuZm5HZXRQb3NpdGlvbiggbm9kZSApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIEl0cyBpbiB0aGUgY2xvbmVkIHRhYmxlLCBzbyBuZWVkIHRvIGxvb2sgdXAgcG9zaXRpb24NCiAgICAgICAgICAgICAgICBpZiAoIG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3RyJyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWR4ID0gJChub2RlKS5pbmRleCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5zdC5mbkdldFBvc2l0aW9uKCAkKCd0cicsIHRoaXMucy5kdC5uVEJvZHkpWyBpZHggXSApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB2YXIgY29sSWR4ID0gJChub2RlKS5pbmRleCgpOw0KICAgICAgICAgICAgICAgICAgICBpZHggPSAkKG5vZGUucGFyZW50Tm9kZSkuaW5kZXgoKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHJvdyA9IGluc3QuZm5HZXRQb3NpdGlvbiggJCgndHInLCB0aGlzLnMuZHQublRCb2R5KVsgaWR4IF0gKTsNCg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWw0KICAgICAgICAgICAgICAgICAgICAgICAgcm93LA0KICAgICAgICAgICAgICAgICAgICAgICAgY29sSWR4LA0KICAgICAgICAgICAgICAgICAgICAgICAgaW5zdC5vQXBpLl9mblZpc2libGVUb0NvbHVtbkluZGV4KCB0aGlzLnMuZHQsIGNvbElkeCApDQogICAgICAgICAgICAgICAgICAgIF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQoNCg0KICAgICAgICAvKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqDQogICAgICAgICAqIFByaXZhdGUgbWV0aG9kcyAodGhleSBhcmUgb2YgY291cnNlIHB1YmxpYyBpbiBKUywgYnV0IHJlY29tbWVuZGVkIGFzIHByaXZhdGUpDQogICAgICAgICAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluaXRpYWxpc2F0aW9uIGZvciBGaXhlZENvbHVtbnMNCiAgICAgICAgICogIEBwYXJhbSAgIHtPYmplY3R9IG9Jbml0IFVzZXIgc2V0dGluZ3MgZm9yIGluaXRpYWxpc2F0aW9uDQogICAgICAgICAqICBAcmV0dXJucyB7dm9pZH0NCiAgICAgICAgICogIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICAiX2ZuQ29uc3RydWN0IjogZnVuY3Rpb24gKCBvSW5pdCApDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBpLCBpTGVuLCBpV2lkdGgsDQogICAgICAgICAgICAgICAgdGhhdCA9IHRoaXM7DQoNCiAgICAgICAgICAgIC8qIFNhbml0eSBjaGVja2luZyAqLw0KICAgICAgICAgICAgaWYgKCB0eXBlb2YgdGhpcy5zLmR0Lm9JbnN0YW5jZS5mblZlcnNpb25DaGVjayAhPSAnZnVuY3Rpb24nIHx8DQogICAgICAgICAgICAgICAgdGhpcy5zLmR0Lm9JbnN0YW5jZS5mblZlcnNpb25DaGVjayggJzEuOC4wJyApICE9PSB0cnVlICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhbGVydCggIkZpeGVkQ29sdW1ucyAiK0ZpeGVkQ29sdW1ucy5WRVJTSU9OKyIgcmVxdWlyZWQgRGF0YVRhYmxlcyAxLjguMCBvciBsYXRlci4gIisNCiAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSB1cGdyYWRlIHlvdXIgRGF0YVRhYmxlcyBpbnN0YWxsYXRpb24iICk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIHRoaXMucy5kdC5vU2Nyb2xsLnNYID09PSAiIiApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdGhpcy5zLmR0Lm9JbnN0YW5jZS5vQXBpLl9mbkxvZyggdGhpcy5zLmR0LCAxLCAiRml4ZWRDb2x1bW5zIGlzIG5vdCBuZWVkZWQgKG5vICIrDQogICAgICAgICAgICAgICAgICAgICJ4LXNjcm9sbGluZyBpbiBEYXRhVGFibGVzIGVuYWJsZWQpLCBzbyBubyBhY3Rpb24gd2lsbCBiZSB0YWtlbi4gVXNlICdGaXhlZEhlYWRlcicgZm9yICIrDQogICAgICAgICAgICAgICAgICAgICJjb2x1bW4gZml4aW5nIHdoZW4gc2Nyb2xsaW5nIGlzIG5vdCBlbmFibGVkIiApOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLyogQXBwbHkgdGhlIHNldHRpbmdzIGZyb20gdGhlIHVzZXIgLyBkZWZhdWx0cyAqLw0KICAgICAgICAgICAgdGhpcy5zID0gJC5leHRlbmQoIHRydWUsIHRoaXMucywgRml4ZWRDb2x1bW5zLmRlZmF1bHRzLCBvSW5pdCApOw0KDQogICAgICAgICAgICAvKiBTZXQgdXAgdGhlIERPTSBhcyB3ZSBuZWVkIGl0IGFuZCBjYWNoZSBub2RlcyAqLw0KICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSB0aGlzLnMuZHQub0NsYXNzZXM7DQogICAgICAgICAgICB0aGlzLmRvbS5ncmlkLmR0ID0gJCh0aGlzLnMuZHQublRhYmxlKS5wYXJlbnRzKCdkaXYuJytjbGFzc2VzLnNTY3JvbGxXcmFwcGVyKVswXTsNCiAgICAgICAgICAgIHRoaXMuZG9tLnNjcm9sbGVyID0gJCgnZGl2LicrY2xhc3Nlcy5zU2Nyb2xsQm9keSwgdGhpcy5kb20uZ3JpZC5kdCApWzBdOw0KDQogICAgICAgICAgICAvKiBTZXQgdXAgdGhlIERPTSB0aGF0IHdlIHdhbnQgZm9yIHRoZSBmaXhlZCBjb2x1bW4gbGF5b3V0IGdyaWQgKi8NCiAgICAgICAgICAgIHRoaXMuX2ZuQ29sQ2FsYygpOw0KICAgICAgICAgICAgdGhpcy5fZm5HcmlkU2V0dXAoKTsNCg0KICAgICAgICAgICAgLyogRXZlbnQgaGFuZGxlcnMgKi8NCiAgICAgICAgICAgIHZhciBtb3VzZUNvbnRyb2xsZXI7DQogICAgICAgICAgICB2YXIgbW91c2VEb3duID0gZmFsc2U7DQoNCiAgICAgICAgICAgIC8vIFdoZW4gdGhlIG1vdXNlIGlzIGRvd24gKGRyYWcgc2Nyb2xsKSB0aGUgbW91c2UgY29udHJvbGxlciBjYW5ub3QNCiAgICAgICAgICAgIC8vIGNoYW5nZSwgYXMgdGhlIGJyb3dzZXIga2VlcHMgdGhlIG9yaWdpbmFsIGVsZW1lbnQgYXMgdGhlIHNjcm9sbGluZyBvbmUNCiAgICAgICAgICAgICQodGhpcy5zLmR0Lm5UYWJsZVdyYXBwZXIpLm9uKCAnbW91c2Vkb3duLkRURkMnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgbW91c2VEb3duID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uZSggJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIG1vdXNlRG93biA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgIH0gKTsNCg0KICAgICAgICAgICAgLy8gV2hlbiB0aGUgYm9keSBpcyBzY3JvbGxlZCAtIHNjcm9sbCB0aGUgbGVmdCBhbmQgcmlnaHQgY29sdW1ucw0KICAgICAgICAgICAgJCh0aGlzLmRvbS5zY3JvbGxlcikNCiAgICAgICAgICAgICAgICAub24oICdtb3VzZW92ZXIuRFRGQyB0b3VjaHN0YXJ0LkRURkMnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggISBtb3VzZURvd24gKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUNvbnRyb2xsZXIgPSAnbWFpbic7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9ICkNCiAgICAgICAgICAgICAgICAub24oICdzY3JvbGwuRFRGQycsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICggISBtb3VzZUNvbnRyb2xsZXIgJiYgZS5vcmlnaW5hbEV2ZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbW91c2VDb250cm9sbGVyID0gJ21haW4nOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBtb3VzZUNvbnRyb2xsZXIgPT09ICdtYWluJyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhhdC5zLmlMZWZ0Q29sdW1ucyA+IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kb20uZ3JpZC5sZWZ0LmxpbmVyLnNjcm9sbFRvcCA9IHRoYXQuZG9tLnNjcm9sbGVyLnNjcm9sbFRvcDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhhdC5zLmlSaWdodENvbHVtbnMgPiAwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZG9tLmdyaWQucmlnaHQubGluZXIuc2Nyb2xsVG9wID0gdGhhdC5kb20uc2Nyb2xsZXIuc2Nyb2xsVG9wOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSApOw0KDQogICAgICAgICAgICB2YXIgd2hlZWxUeXBlID0gJ29ud2hlZWwnIGluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpID8NCiAgICAgICAgICAgICAgICAnd2hlZWwuRFRGQycgOg0KICAgICAgICAgICAgICAgICdtb3VzZXdoZWVsLkRURkMnOw0KDQogICAgICAgICAgICBpZiAoIHRoYXQucy5pTGVmdENvbHVtbnMgPiAwICkgew0KICAgICAgICAgICAgICAgIC8vIFdoZW4gc2Nyb2xsaW5nIHRoZSBsZWZ0IGNvbHVtbiwgc2Nyb2xsIHRoZSBib2R5IGFuZCByaWdodCBjb2x1bW4NCiAgICAgICAgICAgICAgICAkKHRoYXQuZG9tLmdyaWQubGVmdC5saW5lcikNCiAgICAgICAgICAgICAgICAgICAgLm9uKCAnbW91c2VvdmVyLkRURkMgdG91Y2hzdGFydC5EVEZDJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhIG1vdXNlRG93biApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUNvbnRyb2xsZXIgPSAnbGVmdCc7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgICAgICAub24oICdzY3JvbGwuRFRGQycsIGZ1bmN0aW9uICggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISBtb3VzZUNvbnRyb2xsZXIgJiYgZS5vcmlnaW5hbEV2ZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlQ29udHJvbGxlciA9ICdsZWZ0JzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBtb3VzZUNvbnRyb2xsZXIgPT09ICdsZWZ0JyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmRvbS5zY3JvbGxlci5zY3JvbGxUb3AgPSB0aGF0LmRvbS5ncmlkLmxlZnQubGluZXIuc2Nyb2xsVG9wOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhhdC5zLmlSaWdodENvbHVtbnMgPiAwICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmRvbS5ncmlkLnJpZ2h0LmxpbmVyLnNjcm9sbFRvcCA9IHRoYXQuZG9tLmdyaWQubGVmdC5saW5lci5zY3JvbGxUb3A7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9ICkNCiAgICAgICAgICAgICAgICAgICAgLm9uKCB3aGVlbFR5cGUsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBhc3MgaG9yaXpvbnRhbCBzY3JvbGxpbmcgdGhyb3VnaA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhEZWx0YSA9IGUudHlwZSA9PT0gJ3doZWVsJyA/DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLWUub3JpZ2luYWxFdmVudC5kZWx0YVggOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhWDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZG9tLnNjcm9sbGVyLnNjcm9sbExlZnQgLT0geERlbHRhOw0KICAgICAgICAgICAgICAgICAgICB9ICk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICggdGhhdC5zLmlSaWdodENvbHVtbnMgPiAwICkgew0KICAgICAgICAgICAgICAgIC8vIFdoZW4gc2Nyb2xsaW5nIHRoZSByaWdodCBjb2x1bW4sIHNjcm9sbCB0aGUgYm9keSBhbmQgdGhlIGxlZnQgY29sdW1uDQogICAgICAgICAgICAgICAgJCh0aGF0LmRvbS5ncmlkLnJpZ2h0LmxpbmVyKQ0KICAgICAgICAgICAgICAgICAgICAub24oICdtb3VzZW92ZXIuRFRGQyB0b3VjaHN0YXJ0LkRURkMnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEgbW91c2VEb3duICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlQ29udHJvbGxlciA9ICdyaWdodCc7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgICAgICAub24oICdzY3JvbGwuRFRGQycsIGZ1bmN0aW9uICggZSApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISBtb3VzZUNvbnRyb2xsZXIgJiYgZS5vcmlnaW5hbEV2ZW50ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlQ29udHJvbGxlciA9ICdyaWdodCc7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggbW91c2VDb250cm9sbGVyID09PSAncmlnaHQnICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZG9tLnNjcm9sbGVyLnNjcm9sbFRvcCA9IHRoYXQuZG9tLmdyaWQucmlnaHQubGluZXIuc2Nyb2xsVG9wOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdGhhdC5zLmlMZWZ0Q29sdW1ucyA+IDAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZG9tLmdyaWQubGVmdC5saW5lci5zY3JvbGxUb3AgPSB0aGF0LmRvbS5ncmlkLnJpZ2h0LmxpbmVyLnNjcm9sbFRvcDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgICAgICAub24oIHdoZWVsVHlwZSwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGFzcyBob3Jpem9udGFsIHNjcm9sbGluZyB0aHJvdWdoDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeERlbHRhID0gZS50eXBlID09PSAnd2hlZWwnID8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtZS5vcmlnaW5hbEV2ZW50LmRlbHRhWCA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGFYOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kb20uc2Nyb2xsZXIuc2Nyb2xsTGVmdCAtPSB4RGVsdGE7DQogICAgICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCAncmVzaXplLkRURkMnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhhdC5fZm5HcmlkTGF5b3V0LmNhbGwoIHRoYXQgKTsNCiAgICAgICAgICAgIH0gKTsNCg0KICAgICAgICAgICAgdmFyIGJGaXJzdERyYXcgPSB0cnVlOw0KICAgICAgICAgICAgdmFyIGpxVGFibGUgPSAkKHRoaXMucy5kdC5uVGFibGUpOw0KDQogICAgICAgICAgICBqcVRhYmxlDQogICAgICAgICAgICAgICAgLm9uKCAnZHJhdy5kdC5EVEZDJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB0aGF0Ll9mbkNvbENhbGMoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZm5EcmF3LmNhbGwoIHRoYXQsIGJGaXJzdERyYXcgKTsNCiAgICAgICAgICAgICAgICAgICAgYkZpcnN0RHJhdyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgIC5vbiggJ2NvbHVtbi1zaXppbmcuZHQuRFRGQycsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZm5Db2xDYWxjKCk7DQogICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZuR3JpZExheW91dCggdGhhdCApOw0KICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgIC5vbiggJ2NvbHVtbi12aXNpYmlsaXR5LmR0LkRURkMnLCBmdW5jdGlvbiAoIGUsIHNldHRpbmdzLCBjb2x1bW4sIHZpcywgcmVjYWxjICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIHJlY2FsYyA9PT0gdW5kZWZpbmVkIHx8IHJlY2FsYyApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZuQ29sQ2FsYygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZm5HcmlkTGF5b3V0KCB0aGF0ICk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9mbkRyYXcoIHRydWUgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgIC5vbiggJ3NlbGVjdC5kdC5EVEZDIGRlc2VsZWN0LmR0LkRURkMnLCBmdW5jdGlvbiAoIGUsIGR0LCB0eXBlLCBpbmRleGVzICkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIGUubmFtZXNwYWNlID09PSAnZHQnICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZm5EcmF3KCBmYWxzZSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSApDQogICAgICAgICAgICAgICAgLm9uKCAnZGVzdHJveS5kdC5EVEZDJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBqcVRhYmxlLm9mZiggJy5EVEZDJyApOw0KDQogICAgICAgICAgICAgICAgICAgICQodGhhdC5kb20uc2Nyb2xsZXIpLm9mZiggJy5EVEZDJyApOw0KICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykub2ZmKCAnLkRURkMnICk7DQogICAgICAgICAgICAgICAgICAgICQodGhhdC5zLmR0Lm5UYWJsZVdyYXBwZXIpLm9mZiggJy5EVEZDJyApOw0KDQogICAgICAgICAgICAgICAgICAgICQodGhhdC5kb20uZ3JpZC5sZWZ0LmxpbmVyKS5vZmYoICcuRFRGQyAnK3doZWVsVHlwZSApOw0KICAgICAgICAgICAgICAgICAgICAkKHRoYXQuZG9tLmdyaWQubGVmdC53cmFwcGVyKS5yZW1vdmUoKTsNCg0KICAgICAgICAgICAgICAgICAgICAkKHRoYXQuZG9tLmdyaWQucmlnaHQubGluZXIpLm9mZiggJy5EVEZDICcrd2hlZWxUeXBlICk7DQogICAgICAgICAgICAgICAgICAgICQodGhhdC5kb20uZ3JpZC5yaWdodC53cmFwcGVyKS5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICB9ICk7DQoNCiAgICAgICAgICAgIC8qIEdldCB0aGluZ3MgcmlnaHQgdG8gc3RhcnQgd2l0aCAtIG5vdGUgdGhhdCBkdWUgdG8gYWRqdXN0aW5nIHRoZSBjb2x1bW5zLCB0aGVyZSBtdXN0IGJlDQogICAgICAgICAgICAgKiBhbm90aGVyIHJlZHJhdyBvZiB0aGUgbWFpbiB0YWJsZS4gSXQgZG9lc24ndCBuZWVkIHRvIGJlIGEgZnVsbCByZWRyYXcgaG93ZXZlci4NCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgdGhpcy5fZm5HcmlkTGF5b3V0KCk7DQogICAgICAgICAgICB0aGlzLnMuZHQub0luc3RhbmNlLmZuRHJhdyhmYWxzZSk7DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ2FsY3VsYXRlIHRoZSBjb2x1bW4gd2lkdGhzIGZvciB0aGUgZ3JpZCBsYXlvdXQNCiAgICAgICAgICogIEByZXR1cm5zIHt2b2lkfQ0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5Db2xDYWxjIjogZnVuY3Rpb24gKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOw0KICAgICAgICAgICAgdmFyIGlMZWZ0V2lkdGggPSAwOw0KICAgICAgICAgICAgdmFyIGlSaWdodFdpZHRoID0gMDsNCg0KICAgICAgICAgICAgdGhpcy5zLmFpSW5uZXJXaWR0aHMgPSBbXTsNCiAgICAgICAgICAgIHRoaXMucy5haU91dGVyV2lkdGhzID0gW107DQoNCiAgICAgICAgICAgICQuZWFjaCggdGhpcy5zLmR0LmFvQ29sdW1ucywgZnVuY3Rpb24gKGksIGNvbCkgew0KICAgICAgICAgICAgICAgIHZhciB0aCA9ICQoY29sLm5UaCk7DQogICAgICAgICAgICAgICAgdmFyIGJvcmRlcjsNCg0KICAgICAgICAgICAgICAgIGlmICggISB0aC5maWx0ZXIoJzp2aXNpYmxlJykubGVuZ3RoICkgew0KICAgICAgICAgICAgICAgICAgICB0aGF0LnMuYWlJbm5lcldpZHRocy5wdXNoKCAwICk7DQogICAgICAgICAgICAgICAgICAgIHRoYXQucy5haU91dGVyV2lkdGhzLnB1c2goIDAgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSW5uZXIgd2lkdGggaXMgdXNlZCB0byBhc3NpZ24gd2lkdGhzIHRvIGNlbGxzDQogICAgICAgICAgICAgICAgICAgIC8vIE91dGVyIHdpZHRoIGlzIHVzZWQgdG8gY2FsY3VsYXRlIHRoZSBjb250YWluZXINCiAgICAgICAgICAgICAgICAgICAgdmFyIGlXaWR0aCA9IHRoLm91dGVyV2lkdGgoKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIHdvcmtpbmcgd2l0aCB0aGUgbGVmdCBtb3N0LWNlbGwsIG5lZWQgdG8gYWRkIG9uIHRoZQ0KICAgICAgICAgICAgICAgICAgICAvLyB0YWJsZSdzIGJvcmRlciB0byB0aGUgb3V0ZXJXaWR0aCwgc2luY2Ugd2UgbmVlZCB0byB0YWtlDQogICAgICAgICAgICAgICAgICAgIC8vIGFjY291bnQgb2YgaXQsIGJ1dCBpdCBpc24ndCBpbiBhbnkgY2VsbA0KICAgICAgICAgICAgICAgICAgICBpZiAoIHRoYXQucy5haU91dGVyV2lkdGhzLmxlbmd0aCA9PT0gMCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlciA9ICQodGhhdC5zLmR0Lm5UYWJsZSkuY3NzKCdib3JkZXItbGVmdC13aWR0aCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaVdpZHRoICs9IHR5cGVvZiBib3JkZXIgPT09ICdzdHJpbmcnID8gMSA6IHBhcnNlSW50KCBib3JkZXIsIDEwICk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAvLyBMaWtld2lzZSB3aXRoIHRoZSBmaW5hbCBjb2x1bW4gb24gdGhlIHJpZ2h0DQogICAgICAgICAgICAgICAgICAgIGlmICggdGhhdC5zLmFpT3V0ZXJXaWR0aHMubGVuZ3RoID09PSB0aGF0LnMuZHQuYW9Db2x1bW5zLmxlbmd0aC0xICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyID0gJCh0aGF0LnMuZHQublRhYmxlKS5jc3MoJ2JvcmRlci1yaWdodC13aWR0aCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaVdpZHRoICs9IHR5cGVvZiBib3JkZXIgPT09ICdzdHJpbmcnID8gMSA6IHBhcnNlSW50KCBib3JkZXIsIDEwICk7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB0aGF0LnMuYWlPdXRlcldpZHRocy5wdXNoKCBpV2lkdGggKTsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC5zLmFpSW5uZXJXaWR0aHMucHVzaCggdGgud2lkdGgoKSApOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICggaSA8IHRoYXQucy5pTGVmdENvbHVtbnMgKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpTGVmdFdpZHRoICs9IGlXaWR0aDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmICggdGhhdC5zLmlUYWJsZUNvbHVtbnMtdGhhdC5zLmlSaWdodENvbHVtbnMgPD0gaSApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlSaWdodFdpZHRoICs9IGlXaWR0aDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gKTsNCg0KICAgICAgICAgICAgdGhpcy5zLmlMZWZ0V2lkdGggPSBpTGVmdFdpZHRoOw0KICAgICAgICAgICAgdGhpcy5zLmlSaWdodFdpZHRoID0gaVJpZ2h0V2lkdGg7DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogU2V0IHVwIHRoZSBET00gZm9yIHRoZSBmaXhlZCBjb2x1bW4uIFRoZSB3YXkgdGhlIGxheW91dCB3b3JrcyBpcyB0byBjcmVhdGUgYSAxeDMgZ3JpZA0KICAgICAgICAgKiBmb3IgdGhlIGxlZnQgY29sdW1uLCB0aGUgRGF0YVRhYmxlIChmb3Igd2hpY2ggd2UganVzdCByZXVzZSB0aGUgc2Nyb2xsaW5nIGVsZW1lbnQgRGF0YVRhYmxlDQogICAgICAgICAqIHB1dHMgaW50byB0aGUgRE9NKSBhbmQgdGhlIHJpZ2h0IGNvbHVtbi4gSW4gZWFjaCBvZiBoZSB0d28gZml4ZWQgY29sdW1uIGVsZW1lbnRzIHRoZXJlIGlzIGENCiAgICAgICAgICogZ3JvdXBpbmcgd3JhcHBlciBlbGVtZW50IGFuZCB0aGVuIGEgaGVhZCwgYm9keSBhbmQgZm9vdGVyIHdyYXBwZXIuIEluIGVhY2ggb2YgdGhlc2Ugd2UgdGhlbg0KICAgICAgICAgKiBwbGFjZSB0aGUgY2xvbmVkIGhlYWRlciwgYm9keSBvciBmb290ZXIgdGFibGVzLiBUaGlzIGVmZmVjdGl2ZWx5IGdpdmVzIGFzIDN4MyBncmlkIHN0cnVjdHVyZS4NCiAgICAgICAgICogIEByZXR1cm5zIHt2b2lkfQ0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5HcmlkU2V0dXAiOiBmdW5jdGlvbiAoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7DQogICAgICAgICAgICB2YXIgb092ZXJmbG93ID0gdGhpcy5fZm5EVE92ZXJmbG93KCk7DQogICAgICAgICAgICB2YXIgYmxvY2s7DQoNCiAgICAgICAgICAgIHRoaXMuZG9tLmJvZHkgPSB0aGlzLnMuZHQublRhYmxlOw0KICAgICAgICAgICAgdGhpcy5kb20uaGVhZGVyID0gdGhpcy5zLmR0Lm5USGVhZC5wYXJlbnROb2RlOw0KICAgICAgICAgICAgdGhpcy5kb20uaGVhZGVyLnBhcmVudE5vZGUucGFyZW50Tm9kZS5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7DQoNCiAgICAgICAgICAgIHZhciBuU1dyYXBwZXIgPQ0KICAgICAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9IkRURkNfU2Nyb2xsV3JhcHBlciIgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlOyBjbGVhcjpib3RoOyI+JysNCiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9IkRURkNfTGVmdFdyYXBwZXIiIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjA7IGxlZnQ6MDsiPicrDQogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJEVEZDX0xlZnRIZWFkV3JhcHBlciIgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlOyB0b3A6MDsgbGVmdDowOyBvdmVyZmxvdzpoaWRkZW47Ij48L2Rpdj4nKw0KICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iRFRGQ19MZWZ0Qm9keVdyYXBwZXIiIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTsgdG9wOjA7IGxlZnQ6MDsgb3ZlcmZsb3c6aGlkZGVuOyI+JysNCiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9IkRURkNfTGVmdEJvZHlMaW5lciIgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlOyB0b3A6MDsgbGVmdDowOyBvdmVyZmxvdy15OnNjcm9sbDsgb3ZlcmZsb3cteDpoaWRkZW4iPjwvZGl2PicrDQogICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKw0KICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iRFRGQ19MZWZ0Rm9vdFdyYXBwZXIiIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTsgdG9wOjA7IGxlZnQ6MDsgb3ZlcmZsb3c6aGlkZGVuOyI+PC9kaXY+JysNCiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrDQogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJEVEZDX1JpZ2h0V3JhcHBlciIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOyB0b3A6MDsgcmlnaHQ6MDsiPicrDQogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJEVEZDX1JpZ2h0SGVhZFdyYXBwZXIiIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTsgdG9wOjA7IGxlZnQ6MDsiPicrDQogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJEVEZDX1JpZ2h0SGVhZEJsb2NrZXIgRFRGQ19CbG9ja2VyIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IHRvcDowOyBib3R0b206MDsiPjwvZGl2PicrDQogICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKw0KICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iRFRGQ19SaWdodEJvZHlXcmFwcGVyIiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7IHRvcDowOyBsZWZ0OjA7IG92ZXJmbG93OmhpZGRlbjsiPicrDQogICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJEVEZDX1JpZ2h0Qm9keUxpbmVyIiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7IHRvcDowOyBsZWZ0OjA7IG92ZXJmbG93LXk6c2Nyb2xsOyBvdmVyZmxvdy14OiBoaWRkZW4iPjwvZGl2PicrDQogICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKw0KICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iRFRGQ19SaWdodEZvb3RXcmFwcGVyIiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7IHRvcDowOyBsZWZ0OjA7Ij4nKw0KICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iRFRGQ19SaWdodEZvb3RCbG9ja2VyIERURkNfQmxvY2tlciIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOyB0b3A6MDsgYm90dG9tOjA7Ij48L2Rpdj4nKw0KICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JysNCiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrDQogICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKVswXTsNCiAgICAgICAgICAgIHZhciBuTGVmdCA9IG5TV3JhcHBlci5jaGlsZE5vZGVzWzBdOw0KICAgICAgICAgICAgdmFyIG5SaWdodCA9IG5TV3JhcHBlci5jaGlsZE5vZGVzWzFdOw0KDQogICAgICAgICAgICB0aGlzLmRvbS5ncmlkLmR0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBuU1dyYXBwZXIsIHRoaXMuZG9tLmdyaWQuZHQgKTsNCiAgICAgICAgICAgIG5TV3JhcHBlci5hcHBlbmRDaGlsZCggdGhpcy5kb20uZ3JpZC5kdCApOw0KDQogICAgICAgICAgICB0aGlzLmRvbS5ncmlkLndyYXBwZXIgPSBuU1dyYXBwZXI7DQoNCiAgICAgICAgICAgIGlmICggdGhpcy5zLmlMZWZ0Q29sdW1ucyA+IDAgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRoaXMuZG9tLmdyaWQubGVmdC53cmFwcGVyID0gbkxlZnQ7DQogICAgICAgICAgICAgICAgdGhpcy5kb20uZ3JpZC5sZWZ0LmhlYWQgPSBuTGVmdC5jaGlsZE5vZGVzWzBdOw0KICAgICAgICAgICAgICAgIHRoaXMuZG9tLmdyaWQubGVmdC5ib2R5ID0gbkxlZnQuY2hpbGROb2Rlc1sxXTsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5ncmlkLmxlZnQubGluZXIgPSAkKCdkaXYuRFRGQ19MZWZ0Qm9keUxpbmVyJywgblNXcmFwcGVyKVswXTsNCg0KICAgICAgICAgICAgICAgIG5TV3JhcHBlci5hcHBlbmRDaGlsZCggbkxlZnQgKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuaVJpZ2h0Q29sdW1ucyA+IDAgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRoaXMuZG9tLmdyaWQucmlnaHQud3JhcHBlciA9IG5SaWdodDsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5ncmlkLnJpZ2h0LmhlYWQgPSBuUmlnaHQuY2hpbGROb2Rlc1swXTsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5ncmlkLnJpZ2h0LmJvZHkgPSBuUmlnaHQuY2hpbGROb2Rlc1sxXTsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5ncmlkLnJpZ2h0LmxpbmVyID0gJCgnZGl2LkRURkNfUmlnaHRCb2R5TGluZXInLCBuU1dyYXBwZXIpWzBdOw0KDQogICAgICAgICAgICAgICAgLy8gblJpZ2h0LnN0eWxlLnJpZ2h0ID0gb092ZXJmbG93LmJhcisicHgiOw0KICAgICAgICAgICAgICAgIHZhciBkYXRhVGFibGVTY3JvbGxQYW5lID0gJCgkKHRoaXMuZG9tLmdyaWQuZHQpWzBdKQ0KICAgICAgICAgICAgICAgIHZhciByaWdodFBvc2kgPSBkYXRhVGFibGVTY3JvbGxQYW5lLndpZHRoKCkgLQ0KICAgICAgICAgICAgICAgICAgICBkYXRhVGFibGVTY3JvbGxQYW5lLmNoaWxkcmVuKCcuZGF0YVRhYmxlc19zY3JvbGxCb2R5JykuY2hpbGRyZW4oJ3RhYmxlJykud2lkdGgoKTsNCg0KICAgICAgICAgICAgICAgIGlmIChyaWdodFBvc2kgPCAwKQ0KICAgICAgICAgICAgICAgICAgICByaWdodFBvc2kgPSAwOw0KDQogICAgICAgICAgICAgICAgblJpZ2h0LnN0eWxlLnJpZ2h0ID0gcmlnaHRQb3NpICsgInB4IjsNCg0KICAgICAgICAgICAgICAgIGJsb2NrID0gJCgnZGl2LkRURkNfUmlnaHRIZWFkQmxvY2tlcicsIG5TV3JhcHBlcilbMF07DQogICAgICAgICAgICAgICAgYmxvY2suc3R5bGUud2lkdGggPSBvT3ZlcmZsb3cuYmFyKyJweCI7DQogICAgICAgICAgICAgICAgLy8gYmxvY2suc3R5bGUucmlnaHQgPSAtb092ZXJmbG93LmJhcisicHgiOw0KDQogICAgICAgICAgICAgICAgYmxvY2suc3R5bGUucmlnaHQgPSByaWdodFBvc2kgKyJweCI7DQoNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5ncmlkLnJpZ2h0LmhlYWRCbG9jayA9IGJsb2NrOw0KDQogICAgICAgICAgICAgICAgYmxvY2sgPSAkKCdkaXYuRFRGQ19SaWdodEZvb3RCbG9ja2VyJywgblNXcmFwcGVyKVswXTsNCiAgICAgICAgICAgICAgICBibG9jay5zdHlsZS53aWR0aCA9IG9PdmVyZmxvdy5iYXIrInB4IjsNCiAgICAgICAgICAgICAgICAvLyBibG9jay5zdHlsZS5yaWdodCA9IC1vT3ZlcmZsb3cuYmFyKyJweCI7DQogICAgICAgICAgICAgICAgYmxvY2suc3R5bGUucmlnaHQgPSByaWdodFBvc2krInB4IjsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5ncmlkLnJpZ2h0LmZvb3RCbG9jayA9IGJsb2NrOw0KDQogICAgICAgICAgICAgICAgblNXcmFwcGVyLmFwcGVuZENoaWxkKCBuUmlnaHQgKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuZHQublRGb290ICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5mb290ZXIgPSB0aGlzLnMuZHQublRGb290LnBhcmVudE5vZGU7DQogICAgICAgICAgICAgICAgaWYgKCB0aGlzLnMuaUxlZnRDb2x1bW5zID4gMCApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbS5ncmlkLmxlZnQuZm9vdCA9IG5MZWZ0LmNoaWxkTm9kZXNbMl07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICggdGhpcy5zLmlSaWdodENvbHVtbnMgPiAwICkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZG9tLmdyaWQucmlnaHQuZm9vdCA9IG5SaWdodC5jaGlsZE5vZGVzWzJdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gUlRMIHN1cHBvcnQgLSBzd2FwIHRoZSBwb3NpdGlvbiBvZiB0aGUgbGVmdCBhbmQgcmlnaHQgY29sdW1ucyAoIzQ4KQ0KICAgICAgICAgICAgaWYgKCB0aGlzLnMucnRsICkgew0KICAgICAgICAgICAgICAgICQoJ2Rpdi5EVEZDX1JpZ2h0SGVhZEJsb2NrZXInLCBuU1dyYXBwZXIpLmNzcyggew0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiAtb092ZXJmbG93LmJhcisncHgnLA0KICAgICAgICAgICAgICAgICAgICByaWdodDogJycNCiAgICAgICAgICAgICAgICB9ICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogU3R5bGUgYW5kIHBvc2l0aW9uIHRoZSBncmlkIHVzZWQgZm9yIHRoZSBGaXhlZENvbHVtbnMgbGF5b3V0DQogICAgICAgICAqICBAcmV0dXJucyB7dm9pZH0NCiAgICAgICAgICogIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICAiX2ZuR3JpZExheW91dCI6IGZ1bmN0aW9uICgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsNCiAgICAgICAgICAgIHZhciBvR3JpZCA9IHRoaXMuZG9tLmdyaWQ7DQogICAgICAgICAgICB2YXIgaVdpZHRoID0gJChvR3JpZC53cmFwcGVyKS53aWR0aCgpOw0KICAgICAgICAgICAgdmFyIGlCb2R5SGVpZ2h0ID0gJCh0aGlzLnMuZHQublRhYmxlLnBhcmVudE5vZGUpLm91dGVySGVpZ2h0KCk7DQogICAgICAgICAgICB2YXIgaUZ1bGxIZWlnaHQgPSAkKHRoaXMucy5kdC5uVGFibGUucGFyZW50Tm9kZS5wYXJlbnROb2RlKS5vdXRlckhlaWdodCgpOw0KICAgICAgICAgICAgdmFyIG9PdmVyZmxvdyA9IHRoaXMuX2ZuRFRPdmVyZmxvdygpOw0KICAgICAgICAgICAgdmFyIGlMZWZ0V2lkdGggPSB0aGlzLnMuaUxlZnRXaWR0aDsNCiAgICAgICAgICAgIHZhciBpUmlnaHRXaWR0aCA9IHRoaXMucy5pUmlnaHRXaWR0aDsNCiAgICAgICAgICAgIHZhciBydGwgPSAkKHRoaXMuZG9tLmJvZHkpLmNzcygnZGlyZWN0aW9uJykgPT09ICdydGwnOw0KICAgICAgICAgICAgdmFyIHdyYXBwZXI7DQogICAgICAgICAgICB2YXIgc2Nyb2xsYmFyQWRqdXN0ID0gZnVuY3Rpb24gKCBub2RlLCB3aWR0aCApIHsNCiAgICAgICAgICAgICAgICBpZiAoICEgb092ZXJmbG93LmJhciApIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gc2Nyb2xsYmFyIChNYWNzKSB3ZSBuZWVkIHRvIGhpZGUgdGhlIGF1dG8gc2Nyb2xsYmFyDQogICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUud2lkdGggPSAod2lkdGgrMjApKyJweCI7DQogICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUucGFkZGluZ1JpZ2h0ID0gIjIwcHgiOw0KICAgICAgICAgICAgICAgICAgICBub2RlLnN0eWxlLmJveFNpemluZyA9ICJib3JkZXItYm94IjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoIHRoYXQuX2ZpcmVmb3hTY3JvbGxFcnJvcigpICkgew0KICAgICAgICAgICAgICAgICAgICAvLyBTZWUgdGhlIGFib3ZlIGZ1bmN0aW9uIGZvciB3aHkgdGhpcyBpcyByZXF1aXJlZA0KICAgICAgICAgICAgICAgICAgICBpZiAoICQobm9kZSkuaGVpZ2h0KCkgPiAzNCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUud2lkdGggPSAod2lkdGgrb092ZXJmbG93LmJhcikrInB4IjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGp1c3Qgb3ZlcmZsb3cgYnkgdGhlIHNjcm9sbGJhcg0KICAgICAgICAgICAgICAgICAgICBub2RlLnN0eWxlLndpZHRoID0gKHdpZHRoK29PdmVyZmxvdy5iYXIpKyJweCI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgLy8gV2hlbiB4IHNjcm9sbGluZyAtIGRvbid0IHBhaW50IHRoZSBmaXhlZCBjb2x1bW5zIG92ZXIgdGhlIHggc2Nyb2xsYmFyDQogICAgICAgICAgICBpZiAoIG9PdmVyZmxvdy54ICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpQm9keUhlaWdodCAtPSBvT3ZlcmZsb3cuYmFyOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBvR3JpZC53cmFwcGVyLnN0eWxlLmhlaWdodCA9IGlGdWxsSGVpZ2h0KyJweCI7DQoNCiAgICAgICAgICAgIGlmICggdGhpcy5zLmlMZWZ0Q29sdW1ucyA+IDAgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHdyYXBwZXIgPSBvR3JpZC5sZWZ0LndyYXBwZXI7DQogICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS53aWR0aCA9IGlMZWZ0V2lkdGgrJ3B4JzsNCiAgICAgICAgICAgICAgICB3cmFwcGVyLnN0eWxlLmhlaWdodCA9ICcxcHgnOw0KDQogICAgICAgICAgICAgICAgLy8gU3dhcCB0aGUgcG9zaXRpb24gb2YgdGhlIGxlZnQgYW5kIHJpZ2h0IGNvbHVtbnMgZm9yIHJ0bCAoIzQ4KQ0KICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYWx3YXlzIHVwIGFnYWluc3QgdGhlIGVkZ2UsIHNjcm9sbGJhciBvbiB0aGUgZmFyIHNpZGUNCiAgICAgICAgICAgICAgICBpZiAoIHJ0bCApIHsNCiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5sZWZ0ID0gJyc7DQogICAgICAgICAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUucmlnaHQgPSAwOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5sZWZ0ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5yaWdodCA9ICcnOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIG9HcmlkLmxlZnQuYm9keS5zdHlsZS5oZWlnaHQgPSBpQm9keUhlaWdodCsicHgiOw0KICAgICAgICAgICAgICAgIGlmICggb0dyaWQubGVmdC5mb290ICkgew0KICAgICAgICAgICAgICAgICAgICBvR3JpZC5sZWZ0LmZvb3Quc3R5bGUudG9wID0gKG9PdmVyZmxvdy54ID8gb092ZXJmbG93LmJhciA6IDApKyJweCI7IC8vIHNoaWZ0IGZvb3RlciBmb3Igc2Nyb2xsYmFyDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgc2Nyb2xsYmFyQWRqdXN0KCBvR3JpZC5sZWZ0LmxpbmVyLCBpTGVmdFdpZHRoICk7DQogICAgICAgICAgICAgICAgb0dyaWQubGVmdC5saW5lci5zdHlsZS5oZWlnaHQgPSBpQm9keUhlaWdodCsicHgiOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIHRoaXMucy5pUmlnaHRDb2x1bW5zID4gMCApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgd3JhcHBlciA9IG9HcmlkLnJpZ2h0LndyYXBwZXI7DQogICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS53aWR0aCA9IGlSaWdodFdpZHRoKydweCc7DQogICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5oZWlnaHQgPSAnMXB4JzsNCg0KICAgICAgICAgICAgICAgIHZhciBkYXRhVGFibGVTY3JvbGxQYW5lID0gJCgkKG9HcmlkLmR0KVswXSkNCiAgICAgICAgICAgICAgICB2YXIgcmlnaHRQb3NpID0gZGF0YVRhYmxlU2Nyb2xsUGFuZS53aWR0aCgpIC0NCiAgICAgICAgICAgICAgICAgICAgZGF0YVRhYmxlU2Nyb2xsUGFuZS5jaGlsZHJlbignLmRhdGFUYWJsZXNfc2Nyb2xsQm9keScpLmNoaWxkcmVuKCd0YWJsZScpLndpZHRoKCk7DQoNCiAgICAgICAgICAgICAgICBpZiAocmlnaHRQb3NpIDwgMCkNCiAgICAgICAgICAgICAgICAgICAgcmlnaHRQb3NpID0gMDsNCg0KICAgICAgICAgICAgICAgIC8vIE5lZWQgdG8gdGFrZSBhY2NvdW50IG9mIHRoZSB2ZXJ0aWNhbCBzY3JvbGxiYXINCiAgICAgICAgICAgICAgICBpZiAoIHRoaXMucy5ydGwgKSB7DQogICAgICAgICAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUubGVmdCA9IG9PdmVyZmxvdy55ID8gb092ZXJmbG93LmJhcisncHgnIDogMDsNCiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5yaWdodCA9ICcnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5sZWZ0ID0gJyc7DQogICAgICAgICAgICAgICAgICAgIC8vIHdyYXBwZXIuc3R5bGUucmlnaHQgPSBvT3ZlcmZsb3cueSA/IG9PdmVyZmxvdy5iYXIrJ3B4JyA6IDA7DQoNCiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5yaWdodCA9IHJpZ2h0UG9zaSArICJweCI7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgb0dyaWQucmlnaHQuYm9keS5zdHlsZS5oZWlnaHQgPSBpQm9keUhlaWdodCsicHgiOw0KICAgICAgICAgICAgICAgIGlmICggb0dyaWQucmlnaHQuZm9vdCApIHsNCiAgICAgICAgICAgICAgICAgICAgb0dyaWQucmlnaHQuZm9vdC5zdHlsZS50b3AgPSAob092ZXJmbG93LnggPyBvT3ZlcmZsb3cuYmFyIDogMCkrInB4IjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBzY3JvbGxiYXJBZGp1c3QoIG9HcmlkLnJpZ2h0LmxpbmVyLCBpUmlnaHRXaWR0aCApOw0KICAgICAgICAgICAgICAgIG9HcmlkLnJpZ2h0LmxpbmVyLnN0eWxlLmhlaWdodCA9IGlCb2R5SGVpZ2h0KyJweCI7DQoNCiAgICAgICAgICAgICAgICBvR3JpZC5yaWdodC5oZWFkQmxvY2suc3R5bGUuZGlzcGxheSA9IG9PdmVyZmxvdy55ID8gJ2Jsb2NrJyA6ICdub25lJzsNCiAgICAgICAgICAgICAgICBvR3JpZC5yaWdodC5mb290QmxvY2suc3R5bGUuZGlzcGxheSA9IG9PdmVyZmxvdy55ID8gJ2Jsb2NrJyA6ICdub25lJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBHZXQgaW5mb3JtYXRpb24gYWJvdXQgdGhlIERhdGFUYWJsZSdzIHNjcm9sbGluZyBzdGF0ZSAtIHNwZWNpZmljYWxseSBpZiB0aGUgdGFibGUgaXMgc2Nyb2xsaW5nDQogICAgICAgICAqIG9uIGVpdGhlciB0aGUgeCBvciB5IGF4aXMsIGFuZCBhbHNvIHRoZSBzY3JvbGxiYXIgd2lkdGguDQogICAgICAgICAqICBAcmV0dXJucyB7b2JqZWN0fSBJbmZvcm1hdGlvbiBhYm91dCB0aGUgRGF0YVRhYmxlcyBzY3JvbGxpbmcgc3RhdGUgd2l0aCB0aGUgcHJvcGVydGllczoNCiAgICAgICAgICogICAgJ3gnLCAneScgYW5kICdiYXInDQogICAgICAgICAqICBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgIl9mbkRUT3ZlcmZsb3ciOiBmdW5jdGlvbiAoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgblRhYmxlID0gdGhpcy5zLmR0Lm5UYWJsZTsNCiAgICAgICAgICAgIHZhciBuVGFibGVTY3JvbGxCb2R5ID0gblRhYmxlLnBhcmVudE5vZGU7DQogICAgICAgICAgICB2YXIgb3V0ID0gew0KICAgICAgICAgICAgICAgICJ4IjogZmFsc2UsDQogICAgICAgICAgICAgICAgInkiOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAiYmFyIjogdGhpcy5zLmR0Lm9TY3JvbGwuaUJhcldpZHRoDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBpZiAoIG5UYWJsZS5vZmZzZXRXaWR0aCA+IG5UYWJsZVNjcm9sbEJvZHkuY2xpZW50V2lkdGggKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG91dC54ID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCBuVGFibGUub2Zmc2V0SGVpZ2h0ID4gblRhYmxlU2Nyb2xsQm9keS5jbGllbnRIZWlnaHQgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG91dC55ID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG91dDsNCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDbG9uZSBhbmQgcG9zaXRpb24gdGhlIGZpeGVkIGNvbHVtbnMNCiAgICAgICAgICogIEByZXR1cm5zIHt2b2lkfQ0KICAgICAgICAgKiAgQHBhcmFtICAge0Jvb2xlYW59IGJBbGwgSW5kaWNhdGUgaWYgdGhlIGhlYWRlciBhbmQgZm9vdGVyIHNob3VsZCBiZSB1cGRhdGVkIGFzIHdlbGwgKHRydWUpDQogICAgICAgICAqICBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgIl9mbkRyYXciOiBmdW5jdGlvbiAoIGJBbGwgKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLl9mbkdyaWRMYXlvdXQoKTsNCiAgICAgICAgICAgIHRoaXMuX2ZuQ2xvbmVMZWZ0KCBiQWxsICk7DQogICAgICAgICAgICB0aGlzLl9mbkNsb25lUmlnaHQoIGJBbGwgKTsNCg0KICAgICAgICAgICAgLyogRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAqLw0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuZm5EcmF3Q2FsbGJhY2sgIT09IG51bGwgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRoaXMucy5mbkRyYXdDYWxsYmFjay5jYWxsKCB0aGlzLCB0aGlzLmRvbS5jbG9uZS5sZWZ0LCB0aGlzLmRvbS5jbG9uZS5yaWdodCApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvKiBFdmVudCB0cmlnZ2VyaW5nICovDQogICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoICdkcmF3LmR0ZmMnLCB7DQogICAgICAgICAgICAgICAgImxlZnRDbG9uZSI6IHRoaXMuZG9tLmNsb25lLmxlZnQsDQogICAgICAgICAgICAgICAgInJpZ2h0Q2xvbmUiOiB0aGlzLmRvbS5jbG9uZS5yaWdodA0KICAgICAgICAgICAgfSApOw0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENsb25lIHRoZSByaWdodCBjb2x1bW5zDQogICAgICAgICAqICBAcmV0dXJucyB7dm9pZH0NCiAgICAgICAgICogIEBwYXJhbSAgIHtCb29sZWFufSBiQWxsIEluZGljYXRlIGlmIHRoZSBoZWFkZXIgYW5kIGZvb3RlciBzaG91bGQgYmUgdXBkYXRlZCBhcyB3ZWxsICh0cnVlKQ0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5DbG9uZVJpZ2h0IjogZnVuY3Rpb24gKCBiQWxsICkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuaVJpZ2h0Q29sdW1ucyA8PSAwICkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGksIGpxLA0KICAgICAgICAgICAgICAgIGFpQ29sdW1ucyA9IFtdOw0KDQogICAgICAgICAgICBmb3IgKCBpPXRoaXMucy5pVGFibGVDb2x1bW5zLXRoaXMucy5pUmlnaHRDb2x1bW5zIDsgaTx0aGlzLnMuaVRhYmxlQ29sdW1ucyA7IGkrKyApIHsNCiAgICAgICAgICAgICAgICBpZiAoIHRoaXMucy5kdC5hb0NvbHVtbnNbaV0uYlZpc2libGUgKSB7DQogICAgICAgICAgICAgICAgICAgIGFpQ29sdW1ucy5wdXNoKCBpICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0aGlzLl9mbkNsb25lKCB0aGlzLmRvbS5jbG9uZS5yaWdodCwgdGhpcy5kb20uZ3JpZC5yaWdodCwgYWlDb2x1bW5zLCBiQWxsICk7DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ2xvbmUgdGhlIGxlZnQgY29sdW1ucw0KICAgICAgICAgKiAgQHJldHVybnMge3ZvaWR9DQogICAgICAgICAqICBAcGFyYW0gICB7Qm9vbGVhbn0gYkFsbCBJbmRpY2F0ZSBpZiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgc2hvdWxkIGJlIHVwZGF0ZWQgYXMgd2VsbCAodHJ1ZSkNCiAgICAgICAgICogIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICAiX2ZuQ2xvbmVMZWZ0IjogZnVuY3Rpb24gKCBiQWxsICkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuaUxlZnRDb2x1bW5zIDw9IDAgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsDQogICAgICAgICAgICAgICAgaSwganEsDQogICAgICAgICAgICAgICAgYWlDb2x1bW5zID0gW107DQoNCiAgICAgICAgICAgIGZvciAoIGk9MCA7IGk8dGhpcy5zLmlMZWZ0Q29sdW1ucyA7IGkrKyApIHsNCiAgICAgICAgICAgICAgICBpZiAoIHRoaXMucy5kdC5hb0NvbHVtbnNbaV0uYlZpc2libGUgKSB7DQogICAgICAgICAgICAgICAgICAgIGFpQ29sdW1ucy5wdXNoKCBpICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0aGlzLl9mbkNsb25lKCB0aGlzLmRvbS5jbG9uZS5sZWZ0LCB0aGlzLmRvbS5ncmlkLmxlZnQsIGFpQ29sdW1ucywgYkFsbCApOw0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIE1ha2UgYSBjb3B5IG9mIHRoZSBsYXlvdXQgb2JqZWN0IGZvciBhIGhlYWRlciBvciBmb290ZXIgZWxlbWVudCBmcm9tIERhdGFUYWJsZXMuIE5vdGUgdGhhdA0KICAgICAgICAgKiB0aGlzIG1ldGhvZCB3aWxsIGNsb25lIHRoZSBub2RlcyBpbiB0aGUgbGF5b3V0IG9iamVjdC4NCiAgICAgICAgICogIEByZXR1cm5zIHtBcnJheX0gQ29weSBvZiB0aGUgbGF5b3V0IGFycmF5DQogICAgICAgICAqICBAcGFyYW0gICB7T2JqZWN0fSBhb09yaWdpbmFsIExheW91dCBhcnJheSBmcm9tIERhdGFUYWJsZXMgKGFvSGVhZGVyIG9yIGFvRm9vdGVyKQ0KICAgICAgICAgKiAgQHBhcmFtICAge09iamVjdH0gYWlDb2x1bW5zIENvbHVtbnMgdG8gY29weQ0KICAgICAgICAgKiAgQHBhcmFtICAge2Jvb2xlYW59IGV2ZW50cyBDb3B5IGNlbGwgZXZlbnRzIG9yIG5vdA0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5Db3B5TGF5b3V0IjogZnVuY3Rpb24gKCBhb09yaWdpbmFsLCBhaUNvbHVtbnMsIGV2ZW50cyApDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBhUmV0dXJuID0gW107DQogICAgICAgICAgICB2YXIgYUNsb25lcyA9IFtdOw0KICAgICAgICAgICAgdmFyIGFDbG9uZWQgPSBbXTsNCg0KICAgICAgICAgICAgZm9yICggdmFyIGk9MCwgaUxlbj1hb09yaWdpbmFsLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGFSb3cgPSBbXTsNCiAgICAgICAgICAgICAgICBhUm93Lm5UciA9ICQoYW9PcmlnaW5hbFtpXS5uVHIpLmNsb25lKGV2ZW50cywgZmFsc2UpWzBdOw0KDQogICAgICAgICAgICAgICAgZm9yICggdmFyIGo9MCwgakxlbj10aGlzLnMuaVRhYmxlQ29sdW1ucyA7IGo8akxlbiA7IGorKyApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZiAoICQuaW5BcnJheSggaiwgYWlDb2x1bW5zICkgPT09IC0xICkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB2YXIgaUNsb25lZCA9ICQuaW5BcnJheSggYW9PcmlnaW5hbFtpXVtqXS5jZWxsLCBhQ2xvbmVkICk7DQogICAgICAgICAgICAgICAgICAgIGlmICggaUNsb25lZCA9PT0gLTEgKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbkNsb25lID0gJChhb09yaWdpbmFsW2ldW2pdLmNlbGwpLmNsb25lKGV2ZW50cywgZmFsc2UpWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgYUNsb25lcy5wdXNoKCBuQ2xvbmUgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFDbG9uZWQucHVzaCggYW9PcmlnaW5hbFtpXVtqXS5jZWxsICk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFSb3cucHVzaCggew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjZWxsIjogbkNsb25lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1bmlxdWUiOiBhb09yaWdpbmFsW2ldW2pdLnVuaXF1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYVJvdy5wdXNoKCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImNlbGwiOiBhQ2xvbmVzWyBpQ2xvbmVkIF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVuaXF1ZSI6IGFvT3JpZ2luYWxbaV1bal0udW5pcXVlDQogICAgICAgICAgICAgICAgICAgICAgICB9ICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBhUmV0dXJuLnB1c2goIGFSb3cgKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFSZXR1cm47DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ2xvbmUgdGhlIERhdGFUYWJsZSBub2RlcyBhbmQgcGxhY2UgdGhlbSBpbiB0aGUgRE9NIChzaXplZCBjb3JyZWN0bHkpDQogICAgICAgICAqICBAcmV0dXJucyB7dm9pZH0NCiAgICAgICAgICogIEBwYXJhbSAgIHtPYmplY3R9IG9DbG9uZSBPYmplY3QgY29udGFpbmluZyB0aGUgaGVhZGVyLCBmb290ZXIgYW5kIGJvZHkgY2xvbmVkIERPTSBlbGVtZW50cw0KICAgICAgICAgKiAgQHBhcmFtICAge09iamVjdH0gb0dyaWQgR3JpZCBvYmplY3QgY29udGFpbmluZyB0aGUgZGlzcGxheSBncmlkIGVsZW1lbnRzIGZvciB0aGUgY2xvbmVkDQogICAgICAgICAqICAgICAgICAgICAgICAgICAgICBjb2x1bW4gKGxlZnQgb3IgcmlnaHQpDQogICAgICAgICAqICBAcGFyYW0gICB7QXJyYXl9IGFpQ29sdW1ucyBDb2x1bW4gaW5kZXhlcyB3aGljaCBzaG91bGQgYmUgb3BlcmF0ZWQgb24gZnJvbSB0aGUgRGF0YVRhYmxlDQogICAgICAgICAqICBAcGFyYW0gICB7Qm9vbGVhbn0gYkFsbCBJbmRpY2F0ZSBpZiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgc2hvdWxkIGJlIHVwZGF0ZWQgYXMgd2VsbCAodHJ1ZSkNCiAgICAgICAgICogIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICAiX2ZuQ2xvbmUiOiBmdW5jdGlvbiAoIG9DbG9uZSwgb0dyaWQsIGFpQ29sdW1ucywgYkFsbCApDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywNCiAgICAgICAgICAgICAgICBpLCBpTGVuLCBqLCBqTGVuLCBqcSwgblRhcmdldCwgaUNvbHVtbiwgbkNsb25lLCBpSW5kZXgsIGFvQ2xvbmVMYXlvdXQsDQogICAgICAgICAgICAgICAganFDbG9uZVRoZWFkLCBhb0ZpeGVkSGVhZGVyLA0KICAgICAgICAgICAgICAgIGR0ID0gdGhpcy5zLmR0Ow0KDQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgICogSGVhZGVyDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGlmICggYkFsbCApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgJChvQ2xvbmUuaGVhZGVyKS5yZW1vdmUoKTsNCg0KICAgICAgICAgICAgICAgIG9DbG9uZS5oZWFkZXIgPSAkKHRoaXMuZG9tLmhlYWRlcikuY2xvbmUodHJ1ZSwgZmFsc2UpWzBdOw0KICAgICAgICAgICAgICAgIG9DbG9uZS5oZWFkZXIuY2xhc3NOYW1lICs9ICIgRFRGQ19DbG9uZWQiOw0KICAgICAgICAgICAgICAgIG9DbG9uZS5oZWFkZXIuc3R5bGUud2lkdGggPSAiMTAwJSI7DQogICAgICAgICAgICAgICAgb0dyaWQuaGVhZC5hcHBlbmRDaGlsZCggb0Nsb25lLmhlYWRlciApOw0KDQogICAgICAgICAgICAgICAgLyogQ29weSB0aGUgRGF0YVRhYmxlcyBsYXlvdXQgY2FjaGUgZm9yIHRoZSBoZWFkZXIgZm9yIG91ciBmbG9hdGluZyBjb2x1bW4gKi8NCiAgICAgICAgICAgICAgICBhb0Nsb25lTGF5b3V0ID0gdGhpcy5fZm5Db3B5TGF5b3V0KCBkdC5hb0hlYWRlciwgYWlDb2x1bW5zLCB0cnVlICk7DQogICAgICAgICAgICAgICAganFDbG9uZVRoZWFkID0gJCgnPnRoZWFkJywgb0Nsb25lLmhlYWRlcik7DQogICAgICAgICAgICAgICAganFDbG9uZVRoZWFkLmVtcHR5KCk7DQoNCiAgICAgICAgICAgICAgICAvKiBBZGQgdGhlIGNyZWF0ZWQgY2xvbmVkIFRSIGVsZW1lbnRzIHRvIHRoZSB0YWJsZSAqLw0KICAgICAgICAgICAgICAgIGZvciAoIGk9MCwgaUxlbj1hb0Nsb25lTGF5b3V0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBqcUNsb25lVGhlYWRbMF0uYXBwZW5kQ2hpbGQoIGFvQ2xvbmVMYXlvdXRbaV0ublRyICk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLyogVXNlIHRoZSBoYW5keSBfZm5EcmF3SGVhZCBmdW5jdGlvbiBpbiBEYXRhVGFibGVzIHRvIGRvIHRoZSByb3dzcGFuL2NvbHNwYW4NCiAgICAgICAgICAgICAgICAgKiBjYWxjdWxhdGlvbnMgZm9yIHVzDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgZHQub0FwaS5fZm5EcmF3SGVhZCggZHQsIGFvQ2xvbmVMYXlvdXQsIHRydWUgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvKiBUbyBlbnN1cmUgdGhhdCB3ZSBjb3B5IGNlbGwgY2xhc3NlcyBleGFjdGx5LCByZWdhcmRsZXNzIG9mIGNvbHNwYW4sIG11bHRpcGxlIHJvd3MNCiAgICAgICAgICAgICAgICAgKiBldGMsIHdlIG1ha2UgYSBjb3B5IG9mIHRoZSBoZWFkZXIgZnJvbSB0aGUgRGF0YVRhYmxlIGFnYWluLCBidXQgZG9uJ3QgaW5zZXJ0IHRoZQ0KICAgICAgICAgICAgICAgICAqIGNsb25lZCBjZWxscywganVzdCBjb3B5IHRoZSBjbGFzc2VzIGFjcm9zcy4gVG8gZ2V0IHRoZSBtYXRjaGluZyBsYXlvdXQgZm9yIHRoZQ0KICAgICAgICAgICAgICAgICAqIGZpeGVkIGNvbXBvbmVudCwgd2UgdXNlIHRoZSBEYXRhVGFibGVzIF9mbkRldGVjdEhlYWRlciBtZXRob2QsIGFsbG93aW5nIDE6MSBtYXBwaW5nDQogICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgYW9DbG9uZUxheW91dCA9IHRoaXMuX2ZuQ29weUxheW91dCggZHQuYW9IZWFkZXIsIGFpQ29sdW1ucywgZmFsc2UgKTsNCiAgICAgICAgICAgICAgICBhb0ZpeGVkSGVhZGVyPVtdOw0KDQogICAgICAgICAgICAgICAgZHQub0FwaS5fZm5EZXRlY3RIZWFkZXIoIGFvRml4ZWRIZWFkZXIsICQoJz50aGVhZCcsIG9DbG9uZS5oZWFkZXIpWzBdICk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49YW9DbG9uZUxheW91dC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yICggaj0wLCBqTGVuPWFvQ2xvbmVMYXlvdXRbaV0ubGVuZ3RoIDsgajxqTGVuIDsgaisrICkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYW9GaXhlZEhlYWRlcltpXVtqXS5jZWxsLmNsYXNzTmFtZSA9IGFvQ2xvbmVMYXlvdXRbaV1bal0uY2VsbC5jbGFzc05hbWU7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGpRdWVyeSBVSSB0aGVtaW5nIGlzIHVzZWQgd2UgbmVlZCB0byBjb3B5IHRob3NlIGVsZW1lbnRzIGFzIHdlbGwNCiAgICAgICAgICAgICAgICAgICAgICAgICQoJ3NwYW4uRGF0YVRhYmxlc19zb3J0X2ljb24nLCBhb0ZpeGVkSGVhZGVyW2ldW2pdLmNlbGwpLmVhY2goIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICQoJ3NwYW4uRGF0YVRhYmxlc19zb3J0X2ljb24nLCBhb0Nsb25lTGF5b3V0W2ldW2pdLmNlbGwpWzBdLmNsYXNzTmFtZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuX2ZuRXF1YWxpc2VIZWlnaHRzKCAndGhlYWQnLCB0aGlzLmRvbS5oZWFkZXIsIG9DbG9uZS5oZWFkZXIgKTsNCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAqIEJvZHkNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuc0hlaWdodE1hdGNoID09ICdhdXRvJyApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLyogUmVtb3ZlIGFueSBoZWlnaHRzIHdoaWNoIGhhdmUgYmVlbiBhcHBsaWVkIGFscmVhZHkgYW5kIGxldCB0aGUgYnJvd3NlciBmaWd1cmUgaXQgb3V0ICovDQogICAgICAgICAgICAgICAgJCgnPnRib2R5PnRyJywgdGhhdC5kb20uYm9keSkuY3NzKCdoZWlnaHQnLCAnYXV0bycpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIG9DbG9uZS5ib2R5ICE9PSBudWxsICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAkKG9DbG9uZS5ib2R5KS5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICBvQ2xvbmUuYm9keSA9IG51bGw7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIG9DbG9uZS5ib2R5ID0gJCh0aGlzLmRvbS5ib2R5KS5jbG9uZSh0cnVlKVswXTsNCiAgICAgICAgICAgIG9DbG9uZS5ib2R5LmNsYXNzTmFtZSArPSAiIERURkNfQ2xvbmVkIjsNCiAgICAgICAgICAgIG9DbG9uZS5ib2R5LnN0eWxlLnBhZGRpbmdCb3R0b20gPSBkdC5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiOw0KICAgICAgICAgICAgb0Nsb25lLmJvZHkuc3R5bGUubWFyZ2luQm90dG9tID0gKGR0Lm9TY3JvbGwuaUJhcldpZHRoKjIpKyJweCI7IC8qIEZvciBJRSAqLw0KICAgICAgICAgICAgaWYgKCBvQ2xvbmUuYm9keS5nZXRBdHRyaWJ1dGUoJ2lkJykgIT09IG51bGwgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG9DbG9uZS5ib2R5LnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJCgnPnRoZWFkPnRyJywgb0Nsb25lLmJvZHkpLmVtcHR5KCk7DQogICAgICAgICAgICAkKCc+dGZvb3QnLCBvQ2xvbmUuYm9keSkucmVtb3ZlKCk7DQoNCiAgICAgICAgICAgIHZhciBuQm9keSA9ICQoJ3Rib2R5Jywgb0Nsb25lLmJvZHkpWzBdOw0KICAgICAgICAgICAgJChuQm9keSkuZW1wdHkoKTsNCiAgICAgICAgICAgIGlmICggZHQuYWlEaXNwbGF5Lmxlbmd0aCA+IDAgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8qIENvcHkgdGhlIERhdGFUYWJsZXMnIGhlYWRlciBlbGVtZW50cyB0byBmb3JjZSB0aGUgY29sdW1uIHdpZHRoIGluIGV4YWN0bHkgdGhlDQogICAgICAgICAgICAgICAgICogc2FtZSB3YXkgdGhhdCBEYXRhVGFibGVzIGRvZXMgaXQgLSBoYXZlIHRoZSBoZWFkZXIgZWxlbWVudCwgYXBwbHkgdGhlIHdpZHRoIGFuZA0KICAgICAgICAgICAgICAgICAqIGNvbGFwc2UgaXQgZG93bg0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIHZhciBuSW5uZXJUaGVhZCA9ICQoJz50aGVhZD50cicsIG9DbG9uZS5ib2R5KVswXTsNCiAgICAgICAgICAgICAgICBmb3IgKCBpSW5kZXg9MCA7IGlJbmRleDxhaUNvbHVtbnMubGVuZ3RoIDsgaUluZGV4KysgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaUNvbHVtbiA9IGFpQ29sdW1uc1tpSW5kZXhdOw0KDQogICAgICAgICAgICAgICAgICAgIG5DbG9uZSA9ICQoZHQuYW9Db2x1bW5zW2lDb2x1bW5dLm5UaCkuY2xvbmUodHJ1ZSlbMF07DQogICAgICAgICAgICAgICAgICAgIG5DbG9uZS5pbm5lckhUTUwgPSAiIjsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgb1N0eWxlID0gbkNsb25lLnN0eWxlOw0KICAgICAgICAgICAgICAgICAgICBvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsNCiAgICAgICAgICAgICAgICAgICAgb1N0eWxlLnBhZGRpbmdCb3R0b20gPSAiMCI7DQogICAgICAgICAgICAgICAgICAgIG9TdHlsZS5ib3JkZXJUb3BXaWR0aCA9ICIwIjsNCiAgICAgICAgICAgICAgICAgICAgb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOw0KICAgICAgICAgICAgICAgICAgICBvU3R5bGUuaGVpZ2h0ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgb1N0eWxlLndpZHRoID0gdGhhdC5zLmFpSW5uZXJXaWR0aHNbaUNvbHVtbl0rInB4IjsNCg0KICAgICAgICAgICAgICAgICAgICBuSW5uZXJUaGVhZC5hcHBlbmRDaGlsZCggbkNsb25lICk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLyogQWRkIGluIHRoZSB0Ym9keSBlbGVtZW50cywgY2xvbmluZyBmb3JtIHRoZSBtYXN0ZXIgdGFibGUgKi8NCiAgICAgICAgICAgICAgICAkKCc+dGJvZHk+dHInLCB0aGF0LmRvbS5ib2R5KS5lYWNoKCBmdW5jdGlvbiAoeikgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoYXQucy5kdC5vRmVhdHVyZXMuYlNlcnZlclNpZGU9PT1mYWxzZSA/DQogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnMuZHQuYWlEaXNwbGF5WyB0aGF0LnMuZHQuX2lEaXNwbGF5U3RhcnQreiBdIDogejsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgYVRkczsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAoaSA+PSB0aGF0LnMuZHQuYW9EYXRhLmxlbmd0aCB8fCBfLmlzVW5kZWZpbmVkKHRoYXQucy5kdC5hb0RhdGFbIGkgXS5hbkNlbGxzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGFUZHMgPSB0aGF0LnMuZHQuYW9EYXRhWyBpIC0gMSBdLmFuQ2VsbHM7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhVGRzID0gJCh0aGlzKS5jaGlsZHJlbigndGQsIHRoJyk7DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGFUZHMgPSB0aGF0LnMuZHQuYW9EYXRhWyBpIF0uYW5DZWxsczsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuY2xvbmVOb2RlKGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgbi5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7DQogICAgICAgICAgICAgICAgICAgIG4uc2V0QXR0cmlidXRlKCAnZGF0YS1kdC1yb3cnLCBpICk7DQoNCiAgICAgICAgICAgICAgICAgICAgZm9yICggaUluZGV4PTAgOyBpSW5kZXg8YWlDb2x1bW5zLmxlbmd0aCA7IGlJbmRleCsrICkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaUNvbHVtbiA9IGFpQ29sdW1uc1tpSW5kZXhdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGFUZHMubGVuZ3RoID4gMCApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbkNsb25lID0gJCggYVRkc1tpQ29sdW1uXSApLmNsb25lKHRydWUsIHRydWUpWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5DbG9uZS5zZXRBdHRyaWJ1dGUoICdkYXRhLWR0LXJvdycsIGkgKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuQ2xvbmUuc2V0QXR0cmlidXRlKCAnZGF0YS1kdC1jb2x1bW4nLCBkdC5vQXBpLl9mblZpc2libGVUb0NvbHVtbkluZGV4KCBkdCwgaUNvbHVtbiApICk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5hcHBlbmRDaGlsZCggbkNsb25lICk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgbkJvZHkuYXBwZW5kQ2hpbGQoIG4gKTsNCiAgICAgICAgICAgICAgICB9ICk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgJCgnPnRib2R5PnRyJywgdGhhdC5kb20uYm9keSkuZWFjaCggZnVuY3Rpb24gKHopIHsNCiAgICAgICAgICAgICAgICAgICAgbkNsb25lID0gdGhpcy5jbG9uZU5vZGUodHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgIG5DbG9uZS5jbGFzc05hbWUgKz0gJyBEVEZDX05vRGF0YSc7DQogICAgICAgICAgICAgICAgICAgICQoJ3RkJywgbkNsb25lKS5odG1sKCcnKTsNCiAgICAgICAgICAgICAgICAgICAgbkJvZHkuYXBwZW5kQ2hpbGQoIG5DbG9uZSApOw0KICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgb0Nsb25lLmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7DQogICAgICAgICAgICBvQ2xvbmUuYm9keS5zdHlsZS5tYXJnaW4gPSAiMCI7DQogICAgICAgICAgICBvQ2xvbmUuYm9keS5zdHlsZS5wYWRkaW5nID0gIjAiOw0KDQogICAgICAgICAgICAvLyBJbnRlcm9wIHdpdGggU2Nyb2xsZXIgLSBuZWVkIHRvIHVzZSBhIGhlaWdodCBmb3JjaW5nIGVsZW1lbnQgaW4gdGhlDQogICAgICAgICAgICAvLyBzY3JvbGxpbmcgYXJlYSBpbiB0aGUgc2FtZSB3YXkgdGhhdCBTY3JvbGxlciBkb2VzIGluIHRoZSBib2R5IHNjcm9sbC4NCiAgICAgICAgICAgIGlmICggZHQub1Njcm9sbGVyICE9PSB1bmRlZmluZWQgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBzY3JvbGxlckZvcmNlciA9IGR0Lm9TY3JvbGxlci5kb20uZm9yY2U7DQoNCiAgICAgICAgICAgICAgICBpZiAoICEgb0dyaWQuZm9yY2VyICkgew0KICAgICAgICAgICAgICAgICAgICBvR3JpZC5mb3JjZXIgPSBzY3JvbGxlckZvcmNlci5jbG9uZU5vZGUoIHRydWUgKTsNCiAgICAgICAgICAgICAgICAgICAgb0dyaWQubGluZXIuYXBwZW5kQ2hpbGQoIG9HcmlkLmZvcmNlciApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgb0dyaWQuZm9yY2VyLnN0eWxlLmhlaWdodCA9IHNjcm9sbGVyRm9yY2VyLnN0eWxlLmhlaWdodDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIG9HcmlkLmxpbmVyLmFwcGVuZENoaWxkKCBvQ2xvbmUuYm9keSApOw0KDQogICAgICAgICAgICB0aGlzLl9mbkVxdWFsaXNlSGVpZ2h0cyggJ3Rib2R5JywgdGhhdC5kb20uYm9keSwgb0Nsb25lLmJvZHkgKTsNCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAqIEZvb3Rlcg0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBpZiAoIGR0Lm5URm9vdCAhPT0gbnVsbCApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKCBiQWxsICkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGlmICggb0Nsb25lLmZvb3RlciAhPT0gbnVsbCApDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9DbG9uZS5mb290ZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggb0Nsb25lLmZvb3RlciApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIG9DbG9uZS5mb290ZXIgPSAkKHRoaXMuZG9tLmZvb3RlcikuY2xvbmUodHJ1ZSwgdHJ1ZSlbMF07DQogICAgICAgICAgICAgICAgICAgIG9DbG9uZS5mb290ZXIuY2xhc3NOYW1lICs9ICIgRFRGQ19DbG9uZWQiOw0KICAgICAgICAgICAgICAgICAgICBvQ2xvbmUuZm9vdGVyLnN0eWxlLndpZHRoID0gIjEwMCUiOw0KICAgICAgICAgICAgICAgICAgICBvR3JpZC5mb290LmFwcGVuZENoaWxkKCBvQ2xvbmUuZm9vdGVyICk7DQoNCiAgICAgICAgICAgICAgICAgICAgLyogQ29weSB0aGUgZm9vdGVyIGp1c3QgbGlrZSB3ZSBkbyBmb3IgdGhlIGhlYWRlciAqLw0KICAgICAgICAgICAgICAgICAgICBhb0Nsb25lTGF5b3V0ID0gdGhpcy5fZm5Db3B5TGF5b3V0KCBkdC5hb0Zvb3RlciwgYWlDb2x1bW5zLCB0cnVlICk7DQogICAgICAgICAgICAgICAgICAgIHZhciBqcUNsb25lVGZvb3QgPSAkKCc+dGZvb3QnLCBvQ2xvbmUuZm9vdGVyKTsNCiAgICAgICAgICAgICAgICAgICAganFDbG9uZVRmb290LmVtcHR5KCk7DQoNCiAgICAgICAgICAgICAgICAgICAgZm9yICggaT0wLCBpTGVuPWFvQ2xvbmVMYXlvdXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAganFDbG9uZVRmb290WzBdLmFwcGVuZENoaWxkKCBhb0Nsb25lTGF5b3V0W2ldLm5UciApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGR0Lm9BcGkuX2ZuRHJhd0hlYWQoIGR0LCBhb0Nsb25lTGF5b3V0LCB0cnVlICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFvQ2xvbmVMYXlvdXQgPSB0aGlzLl9mbkNvcHlMYXlvdXQoIGR0LmFvRm9vdGVyLCBhaUNvbHVtbnMsIGZhbHNlICk7DQogICAgICAgICAgICAgICAgICAgIHZhciBhb0N1cnJGb290ZXI9W107DQoNCiAgICAgICAgICAgICAgICAgICAgZHQub0FwaS5fZm5EZXRlY3RIZWFkZXIoIGFvQ3VyckZvb3RlciwgJCgnPnRmb290Jywgb0Nsb25lLmZvb3RlcilbMF0gKTsNCg0KICAgICAgICAgICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49YW9DbG9uZUxheW91dC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCBqPTAsIGpMZW49YW9DbG9uZUxheW91dFtpXS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFvQ3VyckZvb3RlcltpXVtqXS5jZWxsLmNsYXNzTmFtZSA9IGFvQ2xvbmVMYXlvdXRbaV1bal0uY2VsbC5jbGFzc05hbWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy5fZm5FcXVhbGlzZUhlaWdodHMoICd0Zm9vdCcsIHRoaXMuZG9tLmZvb3Rlciwgb0Nsb25lLmZvb3RlciApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvKiBFcXVhbGlzZSB0aGUgY29sdW1uIHdpZHRocyBiZXR3ZWVuIHRoZSBoZWFkZXIgZm9vdGVyIGFuZCBib2R5IC0gYm9keSBnZXQncyBwcmlvcml0eSAqLw0KICAgICAgICAgICAgdmFyIGFuVW5pcXVlID0gZHQub0FwaS5fZm5HZXRVbmlxdWVUaHMoIGR0LCAkKCc+dGhlYWQnLCBvQ2xvbmUuaGVhZGVyKVswXSApOw0KICAgICAgICAgICAgJChhblVuaXF1ZSkuZWFjaCggZnVuY3Rpb24gKGkpIHsNCiAgICAgICAgICAgICAgICBpQ29sdW1uID0gYWlDb2x1bW5zW2ldOw0KICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGF0LnMuYWlJbm5lcldpZHRoc1tpQ29sdW1uXSsicHgiOw0KICAgICAgICAgICAgfSApOw0KDQogICAgICAgICAgICBpZiAoIHRoYXQucy5kdC5uVEZvb3QgIT09IG51bGwgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFuVW5pcXVlID0gZHQub0FwaS5fZm5HZXRVbmlxdWVUaHMoIGR0LCAkKCc+dGZvb3QnLCBvQ2xvbmUuZm9vdGVyKVswXSApOw0KICAgICAgICAgICAgICAgICQoYW5VbmlxdWUpLmVhY2goIGZ1bmN0aW9uIChpKSB7DQogICAgICAgICAgICAgICAgICAgIGlDb2x1bW4gPSBhaUNvbHVtbnNbaV07DQogICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGF0LnMuYWlJbm5lcldpZHRoc1tpQ29sdW1uXSsicHgiOw0KICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBGcm9tIGEgZ2l2ZW4gdGFibGUgbm9kZSAoVEhFQUQgZXRjKSwgZ2V0IGEgbGlzdCBvZiBUUiBkaXJlY3QgY2hpbGQgZWxlbWVudHMNCiAgICAgICAgICogIEBwYXJhbSAgIHtOb2RlfSBuSW4gVGFibGUgZWxlbWVudCB0byBzZWFyY2ggZm9yIFRSIGVsZW1lbnRzIChUSEVBRCwgVEJPRFkgb3IgVEZPT1QgZWxlbWVudCkNCiAgICAgICAgICogIEByZXR1cm5zIHtBcnJheX0gTGlzdCBvZiBUUiBlbGVtZW50cyBmb3VuZA0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5HZXRUck5vZGVzIjogZnVuY3Rpb24gKCBuSW4gKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgYU91dCA9IFtdOw0KICAgICAgICAgICAgZm9yICggdmFyIGk9MCwgaUxlbj1uSW4uY2hpbGROb2Rlcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICggbkluLmNoaWxkTm9kZXNbaV0ubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVFIiICkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGFPdXQucHVzaCggbkluLmNoaWxkTm9kZXNbaV0gKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYU91dDsNCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBFcXVhbGlzZSB0aGUgaGVpZ2h0cyBvZiB0aGUgcm93cyBpbiBhIGdpdmVuIHRhYmxlIG5vZGUgaW4gYSBjcm9zcyBicm93c2VyIHdheQ0KICAgICAgICAgKiAgQHJldHVybnMge3ZvaWR9DQogICAgICAgICAqICBAcGFyYW0gICB7U3RyaW5nfSBub2RlTmFtZSBOb2RlIHR5cGUgLSB0aGVhZCwgdGJvZHkgb3IgdGZvb3QNCiAgICAgICAgICogIEBwYXJhbSAgIHtOb2RlfSBvcmlnaW5hbCBPcmlnaW5hbCBub2RlIHRvIHRha2UgdGhlIGhlaWdodHMgZnJvbQ0KICAgICAgICAgKiAgQHBhcmFtICAge05vZGV9IGNsb25lIENvcHkgdGhlIGhlaWdodHMgdG8NCiAgICAgICAgICogIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICAiX2ZuRXF1YWxpc2VIZWlnaHRzIjogZnVuY3Rpb24gKCBub2RlTmFtZSwgb3JpZ2luYWwsIGNsb25lICkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuc0hlaWdodE1hdGNoID09ICdub25lJyAmJiBub2RlTmFtZSAhPT0gJ3RoZWFkJyAmJiBub2RlTmFtZSAhPT0gJ3Rmb290JyApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsDQogICAgICAgICAgICAgICAgaSwgaUxlbiwgaUhlaWdodCwgaUhlaWdodDIsIGlIZWlnaHRPcmlnaW5hbCwgaUhlaWdodENsb25lLA0KICAgICAgICAgICAgICAgIHJvb3RPcmlnaW5hbCA9IG9yaWdpbmFsLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5vZGVOYW1lKVswXSwNCiAgICAgICAgICAgICAgICByb290Q2xvbmUgICAgPSBjbG9uZS5nZXRFbGVtZW50c0J5VGFnTmFtZShub2RlTmFtZSlbMF0sDQogICAgICAgICAgICAgICAganFCb3hIYWNrICAgID0gJCgnPicrbm9kZU5hbWUrJz50cjplcSgwKScsIG9yaWdpbmFsKS5jaGlsZHJlbignOmZpcnN0JyksDQogICAgICAgICAgICAgICAgaUJveEhhY2sgICAgID0ganFCb3hIYWNrLm91dGVySGVpZ2h0KCkgLSBqcUJveEhhY2suaGVpZ2h0KCksDQogICAgICAgICAgICAgICAgYW5PcmlnaW5hbCAgID0gdGhpcy5fZm5HZXRUck5vZGVzKCByb290T3JpZ2luYWwgKSwNCiAgICAgICAgICAgICAgICBhbkNsb25lICAgICAgPSB0aGlzLl9mbkdldFRyTm9kZXMoIHJvb3RDbG9uZSApLA0KICAgICAgICAgICAgICAgIGhlaWdodHMgICAgICA9IFtdOw0KDQogICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49YW5DbG9uZS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlIZWlnaHRPcmlnaW5hbCA9IGFuT3JpZ2luYWxbaV0ub2Zmc2V0SGVpZ2h0Ow0KICAgICAgICAgICAgICAgIGlIZWlnaHRDbG9uZSA9IGFuQ2xvbmVbaV0ub2Zmc2V0SGVpZ2h0Ow0KICAgICAgICAgICAgICAgIGlIZWlnaHQgPSBpSGVpZ2h0Q2xvbmUgPiBpSGVpZ2h0T3JpZ2luYWwgPyBpSGVpZ2h0Q2xvbmUgOiBpSGVpZ2h0T3JpZ2luYWw7DQoNCiAgICAgICAgICAgICAgICBpZiAoIHRoaXMucy5zSGVpZ2h0TWF0Y2ggPT0gJ3NlbWlhdXRvJyApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhbk9yaWdpbmFsW2ldLl9EVFRDX2lIZWlnaHQgPSBpSGVpZ2h0Ow0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGhlaWdodHMucHVzaCggaUhlaWdodCApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49YW5DbG9uZS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFuQ2xvbmVbaV0uc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0c1tpXSsicHgiOw0KICAgICAgICAgICAgICAgIGFuT3JpZ2luYWxbaV0uc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0c1tpXSsicHgiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIFVBIHN1ZmZlcnMgZnJvbSBGaXJlZm94J3Mgb3ZlcmZsb3c6c2Nyb2xsIHNjcm9sbGJhcnMNCiAgICAgICAgICogbm90IGJlaW5nIHNob3duIGJ1Zy4NCiAgICAgICAgICoNCiAgICAgICAgICogRmlyZWZveCBkb2Vzbid0IGRyYXcgc2Nyb2xsYmFycywgZXZlbiBpZiBpdCBpcyB0b2xkIHRvIHVzaW5nDQogICAgICAgICAqIG92ZXJmbG93OnNjcm9sbCwgaWYgdGhlIGRpdiBpcyBsZXNzIHRoYW4gMzRweCBoZWlnaHQuIFNlZSBidWdzIDI5MjI4NCBhbmQNCiAgICAgICAgICogNzgxODg1LiBVc2luZyBVQSBkZXRlY3Rpb24gaGVyZSBzaW5jZSB0aGlzIGlzIHBhcnRpY3VsYXJseSBoYXJkIHRvIGRldGVjdA0KICAgICAgICAgKiB1c2luZyBvYmplY3RzIC0gaXRzIGEgc3RyYWlnaHQgdXAgcmVuZGVyaW5nIGVycm9yIGluIEZpcmVmb3guDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgRmlyZWZveCBlcnJvciBpcyBwcmVzZW50LCBmYWxzZSBvdGhlcndpc2UNCiAgICAgICAgICovDQogICAgICAgIF9maXJlZm94U2Nyb2xsRXJyb3I6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICggX2ZpcmVmb3hTY3JvbGwgPT09IHVuZGVmaW5lZCApIHsNCiAgICAgICAgICAgICAgICB2YXIgdGVzdCA9ICQoJzxkaXYvPicpDQogICAgICAgICAgICAgICAgICAgIC5jc3MoIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTAsDQogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogNTAsDQogICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogJ3Njcm9sbCcNCiAgICAgICAgICAgICAgICAgICAgfSApDQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyggJ2JvZHknICk7DQoNCiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhpcyBkb2Vzbid0IGFwcGx5IG9uIE1hY3Mgd2l0aCAwIHdpZHRoIHNjcm9sbGJhcnMNCiAgICAgICAgICAgICAgICBfZmlyZWZveFNjcm9sbCA9ICgNCiAgICAgICAgICAgICAgICAgICAgdGVzdFswXS5jbGllbnRXaWR0aCA9PT0gdGVzdFswXS5vZmZzZXRXaWR0aCAmJiB0aGlzLl9mbkRUT3ZlcmZsb3coKS5iYXIgIT09IDANCiAgICAgICAgICAgICAgICApOw0KDQogICAgICAgICAgICAgICAgdGVzdC5yZW1vdmUoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIF9maXJlZm94U2Nyb2xsOw0KICAgICAgICB9DQogICAgfSApOw0KDQoNCg0KICAgIC8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKg0KICAgICAqIFN0YXRpY3MNCiAgICAgKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovDQoNCiAgICAvKioNCiAgICAgKiBGaXhlZENvbHVtbnMgZGVmYXVsdCBzZXR0aW5ncyBmb3IgaW5pdGlhbGlzYXRpb24NCiAgICAgKiAgQG5hbWUgRml4ZWRDb2x1bW5zLmRlZmF1bHRzDQogICAgICogIEBuYW1lc3BhY2UNCiAgICAgKiAgQHN0YXRpYw0KICAgICAqLw0KICAgIEZpeGVkQ29sdW1ucy5kZWZhdWx0cyA9IC8qKiBAbGVuZHMgRml4ZWRDb2x1bW5zLmRlZmF1bHRzICovew0KICAgICAgICAvKioNCiAgICAgICAgICogTnVtYmVyIG9mIGxlZnQgaGFuZCBjb2x1bW5zIHRvIGZpeCBpbiBwb3NpdGlvbg0KICAgICAgICAgKiAgQHR5cGUgICAgIGludA0KICAgICAgICAgKiAgQGRlZmF1bHQgIDENCiAgICAgICAgICogIEBzdGF0aWMNCiAgICAgICAgICogIEBleGFtcGxlDQogICAgICAgICAqICAgICAgdmFyICA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7DQoJICogICAgICAgICAgInNjcm9sbFgiOiAiMTAwJSINCgkgKiAgICAgIH0gKTsNCiAgICAgICAgICogICAgICBuZXcgJC5mbi5kYXRhVGFibGUuZml4ZWRDb2x1bW5zKCB0YWJsZSwgew0KCSAqICAgICAgICAgICJsZWZ0Q29sdW1ucyI6IDINCgkgKiAgICAgIH0gKTsNCiAgICAgICAgICovDQogICAgICAgICJpTGVmdENvbHVtbnMiOiAxLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBOdW1iZXIgb2YgcmlnaHQgaGFuZCBjb2x1bW5zIHRvIGZpeCBpbiBwb3NpdGlvbg0KICAgICAgICAgKiAgQHR5cGUgICAgIGludA0KICAgICAgICAgKiAgQGRlZmF1bHQgIDANCiAgICAgICAgICogIEBzdGF0aWMNCiAgICAgICAgICogIEBleGFtcGxlDQogICAgICAgICAqICAgICAgdmFyIHRhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsNCgkgKiAgICAgICAgICAic2Nyb2xsWCI6ICIxMDAlIg0KCSAqICAgICAgfSApOw0KICAgICAgICAgKiAgICAgIG5ldyAkLmZuLmRhdGFUYWJsZS5maXhlZENvbHVtbnMoIHRhYmxlLCB7DQoJICogICAgICAgICAgInJpZ2h0Q29sdW1ucyI6IDENCgkgKiAgICAgIH0gKTsNCiAgICAgICAgICovDQogICAgICAgICJpUmlnaHRDb2x1bW5zIjogMCwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogRHJhdyBjYWxsYmFjayBmdW5jdGlvbiB3aGljaCBpcyBjYWxsZWQgd2hlbiBGaXhlZENvbHVtbnMgaGFzIHJlZHJhd24gdGhlIGZpeGVkIGFzc2V0cw0KICAgICAgICAgKiAgQHR5cGUgICAgIGZ1bmN0aW9uKG9iamVjdCwgb2JqZWN0KTp2b2lkDQogICAgICAgICAqICBAZGVmYXVsdCAgbnVsbA0KICAgICAgICAgKiAgQHN0YXRpYw0KICAgICAgICAgKiAgQGV4YW1wbGUNCiAgICAgICAgICogICAgICB2YXIgdGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggew0KCSAqICAgICAgICAgICJzY3JvbGxYIjogIjEwMCUiDQoJICogICAgICB9ICk7DQogICAgICAgICAqICAgICAgbmV3ICQuZm4uZGF0YVRhYmxlLmZpeGVkQ29sdW1ucyggdGFibGUsIHsNCgkgKiAgICAgICAgICAiZHJhd0NhbGxiYWNrIjogZnVuY3Rpb24gKCkgew0KCSAqCSAgICAgICAgICAgIGFsZXJ0KCAiRml4ZWRDb2x1bW5zIHJlZHJhdyIgKTsNCgkgKgkgICAgICAgIH0NCgkgKiAgICAgIH0gKTsNCiAgICAgICAgICovDQogICAgICAgICJmbkRyYXdDYWxsYmFjayI6IG51bGwsDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEhlaWdodCBtYXRjaGluZyBhbGdvcnRoaW0gdG8gdXNlLiBUaGlzIGNhbiBiZSAibm9uZSIgd2hpY2ggd2lsbCByZXN1bHQgaW4gbm8gaGVpZ2h0DQogICAgICAgICAqIG1hdGNoaW5nIGJlaW5nIGFwcGxpZWQgYnkgRml4ZWRDb2x1bW5zIChoZWlnaHQgbWF0Y2hpbmcgY291bGQgYmUgZm9yY2VkIGJ5IENTUyBpbiB0aGlzDQogICAgICAgICAqIGNhc2UpLCAic2VtaWF1dG8iIHdoZXJlYnkgdGhlIGhlaWdodCBjYWxjdWxhdGlvbiB3aWxsIGJlIHBlcmZvcm1lZCBvbmNlLCBhbmQgdGhlIHJlc3VsdA0KICAgICAgICAgKiBjYWNoZWQgdG8gYmUgdXNlZCBhZ2FpbiAoZm5SZWNhbGN1bGF0ZUhlaWdodCBjYW4gYmUgdXNlZCB0byBmb3JjZSByZWNhbGN1bGF0aW9uKSwgb3INCiAgICAgICAgICogImF1dG8iIHdoZW4gaGVpZ2h0IG1hdGNoaW5nIGlzIHBlcmZvcm1lZCBvbiBldmVyeSBkcmF3IChzbG93ZXN0IGJ1dCBtdXN0IGFjY3VyYXRlKQ0KICAgICAgICAgKiAgQHR5cGUgICAgIHN0cmluZw0KICAgICAgICAgKiAgQGRlZmF1bHQgIHNlbWlhdXRvDQogICAgICAgICAqICBAc3RhdGljDQogICAgICAgICAqICBAZXhhbXBsZQ0KICAgICAgICAgKiAgICAgIHZhciB0YWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7DQoJICogICAgICAgICAgInNjcm9sbFgiOiAiMTAwJSINCgkgKiAgICAgIH0gKTsNCiAgICAgICAgICogICAgICBuZXcgJC5mbi5kYXRhVGFibGUuZml4ZWRDb2x1bW5zKCB0YWJsZSwgew0KCSAqICAgICAgICAgICJoZWlnaHRNYXRjaCI6ICJhdXRvIg0KCSAqICAgICAgfSApOw0KICAgICAgICAgKi8NCiAgICAgICAgInNIZWlnaHRNYXRjaCI6ICJzZW1pYXV0byINCiAgICB9Ow0KDQoNCg0KDQogICAgLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqDQogICAgICogQ29uc3RhbnRzDQogICAgICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqLw0KDQogICAgLyoqDQogICAgICogRml4ZWRDb2x1bW5zIHZlcnNpb24NCiAgICAgKiAgQG5hbWUgICAgICBGaXhlZENvbHVtbnMudmVyc2lvbg0KICAgICAqICBAdHlwZSAgICAgIFN0cmluZw0KICAgICAqICBAZGVmYXVsdCAgIFNlZSBjb2RlDQogICAgICogIEBzdGF0aWMNCiAgICAgKi8NCiAgICBGaXhlZENvbHVtbnMudmVyc2lvbiA9ICIzLjIuMy1kZXYiOw0KDQoNCg0KICAgIC8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKg0KICAgICAqIERhdGFUYWJsZXMgQVBJIGludGVncmF0aW9uDQogICAgICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqLw0KDQogICAgRGF0YVRhYmxlLkFwaS5yZWdpc3RlciggJ2ZpeGVkQ29sdW1ucygpJywgZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9ICk7DQoNCiAgICBEYXRhVGFibGUuQXBpLnJlZ2lzdGVyKCAnZml4ZWRDb2x1bW5zKCkudXBkYXRlKCknLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLml0ZXJhdG9yKCAndGFibGUnLCBmdW5jdGlvbiAoIGN0eCApIHsNCiAgICAgICAgICAgIGlmICggY3R4Ll9vRml4ZWRDb2x1bW5zICkgew0KICAgICAgICAgICAgICAgIGN0eC5fb0ZpeGVkQ29sdW1ucy5mblVwZGF0ZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ICk7DQogICAgfSApOw0KDQogICAgRGF0YVRhYmxlLkFwaS5yZWdpc3RlciggJ2ZpeGVkQ29sdW1ucygpLnJlbGF5b3V0KCknLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLml0ZXJhdG9yKCAndGFibGUnLCBmdW5jdGlvbiAoIGN0eCApIHsNCiAgICAgICAgICAgIGlmICggY3R4Ll9vRml4ZWRDb2x1bW5zICkgew0KICAgICAgICAgICAgICAgIGN0eC5fb0ZpeGVkQ29sdW1ucy5mblJlZHJhd0xheW91dCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ICk7DQogICAgfSApOw0KDQogICAgRGF0YVRhYmxlLkFwaS5yZWdpc3RlciggJ3Jvd3MoKS5yZWNhbGNIZWlnaHQoKScsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IoICdyb3cnLCBmdW5jdGlvbiAoIGN0eCwgaWR4ICkgew0KICAgICAgICAgICAgaWYgKCBjdHguX29GaXhlZENvbHVtbnMgKSB7DQogICAgICAgICAgICAgICAgY3R4Ll9vRml4ZWRDb2x1bW5zLmZuUmVjYWxjdWxhdGVIZWlnaHQoIHRoaXMucm93KGlkeCkubm9kZSgpICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gKTsNCiAgICB9ICk7DQoNCiAgICBEYXRhVGFibGUuQXBpLnJlZ2lzdGVyKCAnZml4ZWRDb2x1bW5zKCkucm93SW5kZXgoKScsIGZ1bmN0aW9uICggcm93ICkgew0KICAgICAgICByb3cgPSAkKHJvdyk7DQoNCiAgICAgICAgcmV0dXJuIHJvdy5wYXJlbnRzKCcuRFRGQ19DbG9uZWQnKS5sZW5ndGggPw0KICAgICAgICAgICAgdGhpcy5yb3dzKCB7IHBhZ2U6ICdjdXJyZW50JyB9ICkuaW5kZXhlcygpWyByb3cuaW5kZXgoKSBdIDoNCiAgICAgICAgICAgIHRoaXMucm93KCByb3cgKS5pbmRleCgpOw0KICAgIH0gKTsNCg0KICAgIERhdGFUYWJsZS5BcGkucmVnaXN0ZXIoICdmaXhlZENvbHVtbnMoKS5jZWxsSW5kZXgoKScsIGZ1bmN0aW9uICggY2VsbCApIHsNCiAgICAgICAgY2VsbCA9ICQoY2VsbCk7DQoNCiAgICAgICAgaWYgKCBjZWxsLnBhcmVudHMoJy5EVEZDX0Nsb25lZCcpLmxlbmd0aCApIHsNCiAgICAgICAgICAgIHZhciByb3dDbG9uZWRJZHggPSBjZWxsLnBhcmVudCgpLmluZGV4KCk7DQogICAgICAgICAgICB2YXIgcm93SWR4ID0gdGhpcy5yb3dzKCB7IHBhZ2U6ICdjdXJyZW50JyB9ICkuaW5kZXhlcygpWyByb3dDbG9uZWRJZHggXTsNCiAgICAgICAgICAgIHZhciBjb2x1bW5JZHg7DQoNCiAgICAgICAgICAgIGlmICggY2VsbC5wYXJlbnRzKCcuRFRGQ19MZWZ0V3JhcHBlcicpLmxlbmd0aCApIHsNCiAgICAgICAgICAgICAgICBjb2x1bW5JZHggPSBjZWxsLmluZGV4KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB2YXIgY29sdW1ucyA9IHRoaXMuY29sdW1ucygpLmZsYXR0ZW4oKS5sZW5ndGg7DQogICAgICAgICAgICAgICAgY29sdW1uSWR4ID0gY29sdW1ucyAtIHRoaXMuY29udGV4dFswXS5fb0ZpeGVkQ29sdW1ucy5zLmlSaWdodENvbHVtbnMgKyBjZWxsLmluZGV4KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgcm93OiByb3dJZHgsDQogICAgICAgICAgICAgICAgY29sdW1uOiB0aGlzLmNvbHVtbi5pbmRleCggJ3RvRGF0YScsIGNvbHVtbklkeCApLA0KICAgICAgICAgICAgICAgIGNvbHVtblZpc2libGU6IGNvbHVtbklkeA0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNlbGwoIGNlbGwgKS5pbmRleCgpOw0KICAgICAgICB9DQogICAgfSApOw0KDQoNCg0KDQogICAgLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqDQogICAgICogSW5pdGlhbGlzYXRpb24NCiAgICAgKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovDQoNCi8vIEF0dGFjaCBhIGxpc3RlbmVyIHRvIHRoZSBkb2N1bWVudCB3aGljaCBsaXN0ZW5zIGZvciBEYXRhVGFibGVzIGluaXRpYWxpc2F0aW9uDQovLyBldmVudHMgc28gd2UgY2FuIGF1dG9tYXRpY2FsbHkgaW5pdGlhbGlzZQ0KICAgICQoZG9jdW1lbnQpLm9uKCAnaW5pdC5kdC5maXhlZENvbHVtbnMnLCBmdW5jdGlvbiAoZSwgc2V0dGluZ3MpIHsNCiAgICAgICAgaWYgKCBlLm5hbWVzcGFjZSAhPT0gJ2R0JyApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBpbml0ID0gc2V0dGluZ3Mub0luaXQuZml4ZWRDb2x1bW5zOw0KICAgICAgICB2YXIgZGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMuZml4ZWRDb2x1bW5zOw0KDQogICAgICAgIGlmICggaW5pdCB8fCBkZWZhdWx0cyApIHsNCiAgICAgICAgICAgIHZhciBvcHRzID0gJC5leHRlbmQoIHt9LCBpbml0LCBkZWZhdWx0cyApOw0KDQogICAgICAgICAgICBpZiAoIGluaXQgIT09IGZhbHNlICkgew0KICAgICAgICAgICAgICAgIG5ldyBGaXhlZENvbHVtbnMoIHNldHRpbmdzLCBvcHRzICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9ICk7DQoNCg0KDQovLyBNYWtlIEZpeGVkQ29sdW1ucyBhY2Nlc3NpYmxlIGZyb20gdGhlIERhdGFUYWJsZXMgaW5zdGFuY2UNCiAgICAkLmZuLmRhdGFUYWJsZS5GaXhlZENvbHVtbnMgPSBGaXhlZENvbHVtbnM7DQogICAgJC5mbi5EYXRhVGFibGUuRml4ZWRDb2x1bW5zID0gRml4ZWRDb2x1bW5zOw0KDQogICAgcmV0dXJuIEZpeGVkQ29sdW1uczsNCn0pKTsKLyohDQogRGF0YVRhYmxlcyBCb290c3RyYXAgMyBpbnRlZ3JhdGlvbg0KIMKpMjAxMS0yMDE1IFNwcnlNZWRpYSBMdGQgLSBkYXRhdGFibGVzLm5ldC9saWNlbnNlDQoqLw0KKGZ1bmN0aW9uKGIpeyJmdW5jdGlvbiI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbImpxdWVyeSIsImRhdGF0YWJsZXMubmV0Il0sZnVuY3Rpb24oYSl7cmV0dXJuIGIoYSx3aW5kb3csZG9jdW1lbnQpfSk6Im9iamVjdCI9PT10eXBlb2YgZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1mdW5jdGlvbihhLGQpe2F8fChhPXdpbmRvdyk7aWYoIWR8fCFkLmZuLmRhdGFUYWJsZSlkPXJlcXVpcmUoImRhdGF0YWJsZXMubmV0IikoYSxkKS4kO3JldHVybiBiKGQsYSxhLmRvY3VtZW50KX06YihqUXVlcnksd2luZG93LGRvY3VtZW50KX0pKGZ1bmN0aW9uKGIsYSxkLG0pe3ZhciBmPWIuZm4uZGF0YVRhYmxlO2IuZXh0ZW5kKCEwLGYuZGVmYXVsdHMse2RvbToiPCdyb3cnPCdjb2wtc20tNidsPjwnY29sLXNtLTYnZj4+PCdyb3cnPCdjb2wtc20tMTIndHI+Pjwncm93JzwnY29sLXNtLTUnaT48J2NvbC1zbS03J3A+PiIscmVuZGVyZXI6ImJvb3RzdHJhcCJ9KTtiLmV4dGVuZChmLmV4dC5jbGFzc2VzLA0Ke3NXcmFwcGVyOiJkYXRhVGFibGVzX3dyYXBwZXIgZm9ybS1pbmxpbmUgZHQtYm9vdHN0cmFwIixzRmlsdGVySW5wdXQ6ImZvcm0tY29udHJvbCBpbnB1dC1zbSIsc0xlbmd0aFNlbGVjdDoiZm9ybS1jb250cm9sIGlucHV0LXNtIixzUHJvY2Vzc2luZzoiZGF0YVRhYmxlc19wcm9jZXNzaW5nIHBhbmVsIHBhbmVsLWRlZmF1bHQifSk7Zi5leHQucmVuZGVyZXIucGFnZUJ1dHRvbi5ib290c3RyYXA9ZnVuY3Rpb24oYSxoLHIscyxqLG4pe3ZhciBvPW5ldyBmLkFwaShhKSx0PWEub0NsYXNzZXMsaz1hLm9MYW5ndWFnZS5vUGFnaW5hdGUsdT1hLm9MYW5ndWFnZS5vQXJpYS5wYWdpbmF0ZXx8e30sZSxnLHA9MCxxPWZ1bmN0aW9uKGQsZil7dmFyIGwsaCxpLGMsbT1mdW5jdGlvbihhKXthLnByZXZlbnREZWZhdWx0KCk7IWIoYS5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcygiZGlzYWJsZWQiKSYmby5wYWdlKCkhPWEuZGF0YS5hY3Rpb24mJm8ucGFnZShhLmRhdGEuYWN0aW9uKS5kcmF3KCJwYWdlIil9Ow0KbD0wO2ZvcihoPWYubGVuZ3RoO2w8aDtsKyspaWYoYz1mW2xdLGIuaXNBcnJheShjKSlxKGQsYyk7ZWxzZXtnPWU9IiI7c3dpdGNoKGMpe2Nhc2UgImVsbGlwc2lzIjplPSImI3gyMDI2OyI7Zz0iZGlzYWJsZWQiO2JyZWFrO2Nhc2UgImZpcnN0IjplPWsuc0ZpcnN0O2c9YysoMDxqPyIiOiIgZGlzYWJsZWQiKTticmVhaztjYXNlICJwcmV2aW91cyI6ZT1rLnNQcmV2aW91cztnPWMrKDA8aj8iIjoiIGRpc2FibGVkIik7YnJlYWs7Y2FzZSAibmV4dCI6ZT1rLnNOZXh0O2c9YysoajxuLTE/IiI6IiBkaXNhYmxlZCIpO2JyZWFrO2Nhc2UgImxhc3QiOmU9ay5zTGFzdDtnPWMrKGo8bi0xPyIiOiIgZGlzYWJsZWQiKTticmVhaztkZWZhdWx0OmU9YysxLGc9aj09PWM/ImFjdGl2ZSI6IiJ9ZSYmKGk9YigiPGxpPiIseyJjbGFzcyI6dC5zUGFnZUJ1dHRvbisiICIrZyxpZDowPT09ciYmInN0cmluZyI9PT10eXBlb2YgYz9hLnNUYWJsZUlkKyJfIitjOm51bGx9KS5hcHBlbmQoYigiPGE+Iix7aHJlZjoiIyIsDQoiYXJpYS1jb250cm9scyI6YS5zVGFibGVJZCwiYXJpYS1sYWJlbCI6dVtjXSwiZGF0YS1kdC1pZHgiOnAsdGFiaW5kZXg6YS5pVGFiSW5kZXh9KS5odG1sKGUpKS5hcHBlbmRUbyhkKSxhLm9BcGkuX2ZuQmluZEFjdGlvbihpLHthY3Rpb246Y30sbSkscCsrKX19LGk7dHJ5e2k9YihoKS5maW5kKGQuYWN0aXZlRWxlbWVudCkuZGF0YSgiZHQtaWR4Iil9Y2F0Y2godil7fXEoYihoKS5lbXB0eSgpLmh0bWwoJzx1bCBjbGFzcz0icGFnaW5hdGlvbiIvPicpLmNoaWxkcmVuKCJ1bCIpLHMpO2khPT1tJiZiKGgpLmZpbmQoIltkYXRhLWR0LWlkeD0iK2krIl0iKS5mb2N1cygpfTtyZXR1cm4gZn0pOw0KCihmdW5jdGlvbihiKXsiZnVuY3Rpb24iPT09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoWyJqcXVlcnkiLCJtb21lbnQiLCJkYXRhdGFibGVzIl0sYik6YihqUXVlcnksbW9tZW50KX0pKGZ1bmN0aW9uKGIsZCl7Yi5mbi5kYXRhVGFibGUubW9tZW50PWZ1bmN0aW9uKGMsZSl7dmFyIGY9Yi5mbi5kYXRhVGFibGUuZXh0LnR5cGU7Zi5kZXRlY3QudW5zaGlmdChmdW5jdGlvbihhKXthJiZhLnJlcGxhY2UmJihhPWEucmVwbGFjZSgvPC4qPz4vZywiIikpO3JldHVybiIiPT09YXx8bnVsbD09PWE/Im1vbWVudC0iK2M6ZChhLGMsZSwhMCkuaXNWYWxpZCgpPyJtb21lbnQtIitjOm51bGx9KTtmLm9yZGVyWyJtb21lbnQtIitjKyItcHJlIl09ZnVuY3Rpb24oYSl7YSYmYS5yZXBsYWNlJiYoYT1hLnJlcGxhY2UoLzwuKj8+L2csIiIpKTtyZXR1cm4iIj09PWF8fG51bGw9PT1hPy1JbmZpbml0eTpwYXJzZUludChkKGEsYyxlLCEwKS5mb3JtYXQoIngiKSwxMCl9fX0pOwovLz0gcmVxdWlyZV9zZWxmDQovLz0gcmVxdWlyZSBfZ3JpZC11dGlscw0KLy89IHJlcXVpcmUgX2dyaWQtdWkNCg0KLy8gdmFyIHB2dWkgPSBwdnVpIHx8IHt9Ow0KCnZhciBwdnVpID0gcHZ1aSB8fCB7fTsNCnB2dWkuZ3JpZCA9IHB2dWkuZ3JpZCB8fCB7fTsNCg0KcHZ1aS5ncmlkLnV0aWxzPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIHdyYXBwZXJDb250YWluZXIgPSAkKCIjd3JhcHBlciIpOw0KICAgIHZhciBoYXNNdWx0aXBsZUxpc3QgPSAkKCIjY29tbW9uTGlzdERhdGFFbGVtZW50cyIpLmRhdGEoImhhcy1tdWx0aXBsZS1saXN0Iik7DQoNCiAgICB2YXIgYXBwZW5kRHJvcGRvd25PdXRzaWRlQ29udGFpbmVyID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgZHJvcGRvd25DbHMpIHsNCiAgICAgICAgdmFyIGFjdGlvbkRyb3Bkb3duTWVudTsNCiAgICAgICAgJChjb250YWluZXIpLm9uKCdzaG93LmJzLmRyb3Bkb3duJyxkcm9wZG93bkNscywgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgYWN0aW9uRHJvcGRvd25NZW51ID0gJChlLmN1cnJlbnRUYXJnZXQpLmZpbmQoJy5kcm9wZG93bi1tZW51Jyk7DQogICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKGFjdGlvbkRyb3Bkb3duTWVudS5kZXRhY2goKSk7DQogICAgICAgICAgICB2YXIgY3VyclRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KSwNCiAgICAgICAgICAgICAgICBlT2Zmc2V0ID0gY3VyclRhcmdldC5vZmZzZXQoKSwNCiAgICAgICAgICAgICAgICBydE9mZnNldCA9ICgkKHdpbmRvdykud2lkdGgoKSAtIChlT2Zmc2V0LmxlZnQgKyBjdXJyVGFyZ2V0Lm91dGVyV2lkdGgoKSkpLA0KICAgICAgICAgICAgICAgIGRyb3Bkb3duSGVpZ2h0ID0gcGFyc2VJbnQoYWN0aW9uRHJvcGRvd25NZW51Lm91dGVySGVpZ2h0KCkpLA0KICAgICAgICAgICAgICAgIGVPZmZzZXRUb3AgPSBlT2Zmc2V0LnRvcCwNCiAgICAgICAgICAgICAgICB0YXJnZXRPdXRlckhlaWdodCA9IHBhcnNlSW50KGN1cnJUYXJnZXQub3V0ZXJIZWlnaHQoKSk7DQogICAgICAgICAgICBhY3Rpb25Ecm9wZG93bk1lbnUuY3NzKHsNCiAgICAgICAgICAgICAgICAnZGlzcGxheSc6ICdibG9jaycsDQogICAgICAgICAgICAgICAgJ3RvcCc6IHNldERyb3Bkb3duUG9zaXRpb25Ub3AoY3VyclRhcmdldCxkcm9wZG93bkhlaWdodCx0YXJnZXRPdXRlckhlaWdodCwgZU9mZnNldFRvcCk/IGVPZmZzZXRUb3AgLSBkcm9wZG93bkhlaWdodCA6IGVPZmZzZXRUb3AgKyB0YXJnZXRPdXRlckhlaWdodCwNCiAgICAgICAgICAgICAgICAncmlnaHQnOiBydE9mZnNldA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KDQogICAgICAgICQoY29udGFpbmVyKS5vbignaGlkZGVuLmJzLmRyb3Bkb3duJyxkcm9wZG93bkNscywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICQoZS5jdXJyZW50VGFyZ2V0KS5hcHBlbmQoYWN0aW9uRHJvcGRvd25NZW51LmRldGFjaCgpKTsNCiAgICAgICAgICAgIGFjdGlvbkRyb3Bkb3duTWVudS5oaWRlKCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHZhciBzZXREcm9wZG93blBvc2l0aW9uVG9wID0gZnVuY3Rpb24gKHRhcmdldCwgZHJvcGRvd25IZWlnaHQsIHRhcmdldE91dGVySGVpZ2h0LCB0b3BPZmZzZXQpIHsNCiAgICAgICAgICAgIHZhciBzY3JlZW5IZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCksDQogICAgICAgICAgICAgICAgY3VycmVudFRhcmdldEhlaWdodCA9IHRhcmdldE91dGVySGVpZ2h0KyBkcm9wZG93bkhlaWdodCwNCiAgICAgICAgICAgICAgICB0b3RhbEhlaWdodCA9IHBhcnNlSW50KGN1cnJlbnRUYXJnZXRIZWlnaHQgKyB0b3BPZmZzZXQpOw0KICAgICAgICAgICAgcmV0dXJuIChzY3JlZW5IZWlnaHQgPCB0b3RhbEhlaWdodCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdmFyIGh0bWxPdmVyZmxvd1lIaWRkZW4gPSBmdW5jdGlvbigpew0KICAgICAgICBpZiAoIWhhc011bHRpcGxlTGlzdCkgew0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2h0bWwnKVswXS5jbGFzc0xpc3QuYWRkKCdvdmVyZmxvdy15LWhpZGRlbicpOyAvLyAnMCcgdG8gYXNzaWduIHRoZSBmaXJzdCAoYW5kIG9ubHkgYEhUTUxgIHRhZykNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB2YXIgZ3JpZFdpZGdldFRhYmxlSGVpZ2h0ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikgew0KICAgICAgICByZXR1cm4gY29udGFpbmVyLmZpbmQoIi5kYXRhVGFibGVzX3Njcm9sbEJvZHkgdGFibGUiKS5vdXRlckhlaWdodCgpOw0KICAgIH07DQoNCiAgICB2YXIgdXBkYXRlRml4ZWRDb2xIZWlnaHQgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7DQogICAgICAgIHZhciBkYXRhU2Nyb2xsYWJsZUJvZHkgPSBjb250YWluZXIuZmluZCgiZGl2LmRhdGFUYWJsZXNfc2Nyb2xsQm9keSIpLA0KICAgICAgICAgICAgZGF0YVNjcm9sbEZpeGVkQ29sID0gY29udGFpbmVyLmZpbmQoImRpdi5EVEZDX0xlZnRCb2R5V3JhcHBlciwgZGl2LkRURkNfTGVmdEJvZHlMaW5lciIpOw0KICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICQoZGF0YVNjcm9sbEZpeGVkQ29sKS5oZWlnaHQoZ2V0R3JpZEhlaWdodChjb250YWluZXIpKTsNCiAgICAgICAgfSwgMTApOw0KICAgICAgICBwdnVpLmdyaWQubWFuYWdlVUlXcmFwcGVyLnVwZGF0ZVBlcmZlY3RTY3JvbGxiYXIoY29udGFpbmVyKTsNCiAgICB9Ow0KDQogICAgdmFyIGdldEdyaWRIZWlnaHQgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7DQogICAgICAgIGlmICghaGFzTXVsdGlwbGVMaXN0KSB7DQogICAgICAgICAgICB2YXIgY29udGFpbmVyVG9wU2VhcmNoID0gY29udGFpbmVyLmZpbmQoIi5wdi10b3BzcmMtY29udGFpbmVyIiksDQogICAgICAgICAgICAgICAgaXNUb3BTcmNWaXNpYmxlID0gY29udGFpbmVyVG9wU2VhcmNoLmlzKCI6dmlzaWJsZSIpLA0KICAgICAgICAgICAgICAgIGNvbnRhaW5lclRvcFNlYXJjaEhlaWdodCA9ICQoY29udGFpbmVyVG9wU2VhcmNoKS5vdXRlckhlaWdodCgpLA0KICAgICAgICAgICAgICAgIHBhZ2VDb250YWluZXJIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCktMjY1OyAvLyAyNjUgaXMgaGVpZ2h0IG9mIHRvcGhlYWRlciArIGJvdHRvbSBmaXhlZCBzZWN0aW9uDQogICAgICAgICAgICByZXR1cm4gaXNUb3BTcmNWaXNpYmxlPyBwYWdlQ29udGFpbmVySGVpZ2h0LWNvbnRhaW5lclRvcFNlYXJjaEhlaWdodDogcGFnZUNvbnRhaW5lckhlaWdodDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBncmlkV2lkZ2V0VGFibGVIZWlnaHQoY29udGFpbmVyKTsvLyBGaXhlZCBXaWRnZXQgSGVpZ2h0DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdmFyIHNldEdyaWRIZWlnaHQgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7DQogICAgICAgIGlmICghaGFzTXVsdGlwbGVMaXN0KSB7DQogICAgICAgICAgICB2YXIgZGF0YVNjcm9sbGFibGVCb2R5ID0gY29udGFpbmVyLmZpbmQoImRpdi5kYXRhVGFibGVzX3Njcm9sbEJvZHkiKTsNCiAgICAgICAgICAgICQoZGF0YVNjcm9sbGFibGVCb2R5KS5jc3MoeyJoZWlnaHQiOmdldEdyaWRIZWlnaHQoY29udGFpbmVyKSwgIm1heC1oZWlnaHQiOmdldEdyaWRIZWlnaHQoY29udGFpbmVyKX0pOw0KICAgICAgICB9DQogICAgICAgIHVwZGF0ZUZpeGVkQ29sSGVpZ2h0KGNvbnRhaW5lcik7Ly8gRml4ZWQgV2lkZ2V0IEhlaWdodA0KICAgIH07DQoNCiAgICB2YXIgdXBkYXRlR3JpZE9uUmVzaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lcikgew0KICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHNldEdyaWRIZWlnaHQoY29udGFpbmVyKTsNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIHZhciBtYW5hZ2VMaXN0aW5nVUkgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBoaWRlU2V0dGluZ1BhbmVsID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgd3JhcHBlckNvbnRhaW5lci5yZW1vdmVDbGFzcygncmlnaHQtYmFyLWVuYWJsZWQnKTsNCiAgICAgICAgICAgICQoIi5yaWdodHBhbmVsLWJhY2tkcm9wIikucmVtb3ZlKCk7DQogICAgICAgIH07DQogICAgICAgIHZhciBzaG93U2V0dGluZ1BhbmVsID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgd3JhcHBlckNvbnRhaW5lci5hZGRDbGFzcygncmlnaHQtYmFyLWVuYWJsZWQnKTsNCiAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuew0KICAgICAgICAgICAgaGlkZVNldHRpbmdQYW5lbDpoaWRlU2V0dGluZ1BhbmVsLA0KICAgICAgICAgICAgc2hvd1NldHRpbmdQYW5lbDogc2hvd1NldHRpbmdQYW5lbA0KICAgICAgICB9DQogICAgfSgpOw0KICAgIHJldHVybnsNCiAgICAgICAgYXBwZW5kRHJvcGRvd25PdXRzaWRlQ29udGFpbmVyOmFwcGVuZERyb3Bkb3duT3V0c2lkZUNvbnRhaW5lciwNCiAgICAgICAgaHRtbE92ZXJmbG93WUhpZGRlbjpodG1sT3ZlcmZsb3dZSGlkZGVuLA0KICAgICAgICBnZXRHcmlkSGVpZ2h0OmdldEdyaWRIZWlnaHQsDQogICAgICAgIHNldEdyaWRIZWlnaHQ6c2V0R3JpZEhlaWdodCwNCiAgICAgICAgdXBkYXRlR3JpZE9uUmVzaXplOnVwZGF0ZUdyaWRPblJlc2l6ZSwNCiAgICAgICAgbWFuYWdlTGlzdGluZ1VJOm1hbmFnZUxpc3RpbmdVSQ0KICAgIH0NCn0oKTsKdmFyIHB2dWkgPSBwdnVpIHx8IHt9Ow0KcHZ1aS5ncmlkID0gcHZ1aS5ncmlkIHx8IHt9Ow0KdmFyIGl0ZW1EcmFnZ2VkID0gZmFsc2U7DQpwdnVpLmdyaWQubWFuYWdlVUlXcmFwcGVyID0gZnVuY3Rpb24gKCkgew0KICAgIHZhciBwc0dyaWQ7DQogICAgdmFyIHByZXZlbnRTY3JvbGxpbmdFbXB0eUdyaWQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBzY3JvbGxhYmxlU2VjdGlvbikgew0KICAgICAgICBpZihjb250YWluZXIuZmluZCgiLmRhdGFUYWJsZXNfZW1wdHkiKS5sZW5ndGgpew0KICAgICAgICAgICAgc2Nyb2xsYWJsZVNlY3Rpb24uY3NzKHsib3ZlcmZsb3cteSI6ImhpZGRlbiJ9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNjcm9sbGFibGVTZWN0aW9uLmNzcyh7Im92ZXJmbG93LXkiOiJhdXRvIn0pOw0KICAgICAgICB9DQogICAgfSwNCiAgICBkaXNhYmxlVGFibGVTY3JvbGxpbmcgPSBmdW5jdGlvbiAoc2Nyb2xsYWJsZVNlY3Rpb24sIHNjcm9sbGFibGVGaXhlZENvbCkgew0KICAgICAgICBzY3JvbGxhYmxlU2VjdGlvbi5jc3MoeyJvdmVyZmxvdyI6ImhpZGRlbiJ9KTsNCiAgICAgICAgc2Nyb2xsYWJsZUZpeGVkQ29sLmNzcyh7Im92ZXJmbG93LXkiOiJoaWRkZW4ifSk7DQogICAgfSwNCiAgICBlbmFibGVUYWJsZVNjcm9sbGluZyA9IGZ1bmN0aW9uIChzY3JvbGxhYmxlU2VjdGlvbiwgc2Nyb2xsYWJsZUZpeGVkQ29sKSB7DQogICAgICAgIHNjcm9sbGFibGVTZWN0aW9uLmNzcyh7Im92ZXJmbG93IjoiYXV0byJ9KTsNCiAgICAgICAgc2Nyb2xsYWJsZUZpeGVkQ29sLmNzcyh7Im92ZXJmbG93LXkiOiJzY3JvbGwifSk7DQogICAgfSwNCiAgICBpc1NlY29uZGFyeVZpZXcgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBncmlkUm93KSB7DQogICAgICAgIHZhciBpZHggPSAkKGdyaWRSb3cpLmluZGV4KCk7DQogICAgICAgIHJldHVybiBjb250YWluZXIuZmluZCgiLmRhdGFUYWJsZXNfc2Nyb2xsQm9keT50YWJsZT50Ym9keT50cjpudGgtY2hpbGQoIitpZHgrIikiKS5oYXNDbGFzcygiZGV0YWlscyIpOw0KICAgIH0sDQogICAgYWxsVGFyZ2V0ZWRSb3dzID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgZ3JpZFJvdykgew0KICAgICAgICB2YXIgaWR4ID0gJChncmlkUm93KS5pbmRleCgpICsgMSwNCiAgICAgICAgICAgIGFsbFJvd3MsDQogICAgICAgICAgICB0YWJsZVNjcm9sbEJvZHkgPSAiLmRhdGFUYWJsZXNfc2Nyb2xsQm9keT50YWJsZT50Ym9keSIsDQogICAgICAgICAgICB0YWJsZUZpeGVkTGVmdCA9ICIuRFRGQ19MZWZ0Qm9keUxpbmVyPnRhYmxlPnRib2R5IiwNCiAgICAgICAgICAgIGhhc1NlY29uZGFyeUFuZFZpc2libGUgPSBjb250YWluZXIuZmluZCh0YWJsZVNjcm9sbEJvZHkrIj50cjpudGgtY2hpbGQoIitpZHgrIikiKS5oYXNDbGFzcygiZGV0YWlscyIpLA0KICAgICAgICAgICAgaXNUaGlzU2Vjb25kYXJ5VmlldyA9IGlzU2Vjb25kYXJ5Vmlldyhjb250YWluZXIsIGdyaWRSb3cpOw0KICAgICAgICBpZihpc1RoaXNTZWNvbmRhcnlWaWV3KSB7DQogICAgICAgICAgICB2YXIgaWR4UHJpbWFyeT0gJChncmlkUm93KS5pbmRleCgpOw0KICAgICAgICAgICAgYWxsUm93cyA9IHRhYmxlU2Nyb2xsQm9keSsiPnRyOm50aC1jaGlsZCgiK2lkeCsiKSwiKw0KICAgICAgICAgICAgICAgIHRhYmxlRml4ZWRMZWZ0KyI+dHI6bnRoLWNoaWxkKCIraWR4ICsgIiksIisNCiAgICAgICAgICAgICAgICB0YWJsZVNjcm9sbEJvZHkrIj50cjpudGgtY2hpbGQoIitpZHhQcmltYXJ5ICsiKSwiKw0KICAgICAgICAgICAgICAgIHRhYmxlRml4ZWRMZWZ0KyI+dHI6bnRoLWNoaWxkKCIraWR4UHJpbWFyeSsiKSI7DQogICAgICAgICAgICByZXR1cm4gYWxsUm93czsNCiAgICAgICAgfSAgZWxzZSBpZihoYXNTZWNvbmRhcnlBbmRWaXNpYmxlKSB7DQogICAgICAgICAgICB2YXIgaWR4U2Vjb25kYXJ5PSAkKGdyaWRSb3cpLmluZGV4KCkrMjsNCiAgICAgICAgICAgIGFsbFJvd3MgPSB0YWJsZVNjcm9sbEJvZHkrIj50cjpudGgtY2hpbGQoIitpZHgrIiksIisNCiAgICAgICAgICAgICAgICB0YWJsZUZpeGVkTGVmdCsiPnRyOm50aC1jaGlsZCgiK2lkeCArICIpLCIrDQogICAgICAgICAgICAgICAgdGFibGVTY3JvbGxCb2R5KyI+dHI6bnRoLWNoaWxkKCIraWR4U2Vjb25kYXJ5KyIpLCIrDQogICAgICAgICAgICAgICAgdGFibGVGaXhlZExlZnQrIj50cjpudGgtY2hpbGQoIitpZHhTZWNvbmRhcnkrIikiOw0KICAgICAgICAgICAgcmV0dXJuIGFsbFJvd3M7DQogICAgICAgIH0gZWxzZXsNCiAgICAgICAgICAgIGFsbFJvd3M9IHRhYmxlU2Nyb2xsQm9keSsiPnRyOm50aC1jaGlsZCgiK2lkeCsiKSwiKw0KICAgICAgICAgICAgICAgIHRhYmxlRml4ZWRMZWZ0KyI+dHI6bnRoLWNoaWxkKCIraWR4ICsgIikiOw0KICAgICAgICAgICAgcmV0dXJuIGFsbFJvd3M7DQogICAgICAgIH0NCiAgICB9LA0KICAgIGNoZWNrUm93QW5kQ2VsbCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGdyaWRSb3cpIHsNCiAgICAgICAgdmFyIGlkeCA9ICQoZ3JpZFJvdykuaW5kZXgoKSArIDEsDQogICAgICAgICAgICBjdXJyQWN0aW9uQnRuUm93ID0gY29udGFpbmVyLmZpbmQoIi5kYXRhVGFibGVzX3Njcm9sbEJvZHk+dGFibGU+dGJvZHk+dHI6bnRoLWNoaWxkKCIrIGlkeCArIikiKSwNCiAgICAgICAgICAgIGFjdGlvbkNvbCA9IGN1cnJBY3Rpb25CdG5Sb3cuZmluZCgiLnB2LXRhYmxlLWFjdGlvbiIpLA0KICAgICAgICAgICAgYWN0aW9uQ2VsbCA9IGN1cnJBY3Rpb25CdG5Sb3cuZmluZCgiLnB2LXRhYmxlLWFjdGlvbj4udGQtYm94IiksDQogICAgICAgICAgICBhbGxGaXhlZEN1cnJSb3cgPSBhbGxUYXJnZXRlZFJvd3MoY29udGFpbmVyLCBncmlkUm93KSwNCiAgICAgICAgICAgIGN1cnJSb3cgPSBjb250YWluZXIuZmluZChhbGxGaXhlZEN1cnJSb3cpOw0KICAgICAgICByZXR1cm4ge3JvdzpjdXJyUm93LGNlbGw6YWN0aW9uQ2VsbCxjb2w6YWN0aW9uQ29sfTsNCiAgICB9LA0KICAgIHNldEdyaWRBY3Rpb25CdXR0b25Qb3NpdGlvbiA9IGZ1bmN0aW9uIChyb3cpIHsNCiAgICAgICAgdmFyIGN1cnJQYXJlbnRDb250YWluZXIgPSAkKHJvdykuY2xvc2VzdCgiLkRURkNfU2Nyb2xsV3JhcHBlciIpLmZpbmQoIi5kYXRhVGFibGVzX3Njcm9sbEJvZHkiKSwNCiAgICAgICAgICAgIGdyaWRDb250YWluZXJXaWR0aCA9IGN1cnJQYXJlbnRDb250YWluZXIub3V0ZXJXaWR0aCgpLA0KICAgICAgICAgICAgZ3JpZFNjcm9sbGVkID0gY3VyclBhcmVudENvbnRhaW5lci5zY3JvbGxMZWZ0KCksDQogICAgICAgICAgICBsZWZ0T2Zmc2V0ID0gZ3JpZENvbnRhaW5lcldpZHRoK2dyaWRTY3JvbGxlZDsNCiAgICAgICAgcmV0dXJuIGxlZnRPZmZzZXQ7DQogICAgfSwNCiAgICBoYW5kbGVSb3dNb3VzZU92ZXJFdmVudCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsNCiAgICAgICAgdmFyIGdyaWRSb3cgPSAiLmRhdGFUYWJsZXNfc2Nyb2xsQm9keT50YWJsZT50Ym9keT50ciwgLkRURkNfTGVmdEJvZHlMaW5lcj50YWJsZT50Ym9keT50ciIsDQogICAgICAgICAgICBjb250YWluZXJHcmlkID0gY29udGFpbmVyLmZpbmQoIi5kYXRhVGFibGVzX3Njcm9sbEJvZHkiKSwNCiAgICAgICAgICAgIGNvbnRhaW5lclNpemUgPSBjb250YWluZXJHcmlkLm91dGVyV2lkdGgoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lclNjcm9sbGFibGVXaWR0aCA9IGNvbnRhaW5lckdyaWQuZ2V0KDApLnNjcm9sbFdpZHRoLA0KICAgICAgICAgICAgY2xvbmVkQ1RBOw0KICAgICAgICBjb250YWluZXIub2ZmKCJtb3VzZWVudGVyIG1vdXNlbGVhdmUiKS5vbigibW91c2VlbnRlciIsIGdyaWRSb3csIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBjaGVja1Jvd0FuZENlbGwoY29udGFpbmVyLCAkKHRoaXMpKTsNCiAgICAgICAgICAgIGlmKGNvbnRhaW5lclNpemUgPCBjb250YWluZXJTY3JvbGxhYmxlV2lkdGgpew0KICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbkNUQSA9IHNldEdyaWRBY3Rpb25CdXR0b25Qb3NpdGlvbigkKHRoaXMpKSAtIHRhcmdldC5jZWxsLm91dGVyV2lkdGgoKTsNCiAgICAgICAgICAgICAgICBjbG9uZWRDVEEgPSB0YXJnZXQuY2VsbC5kZXRhY2goKTsNCiAgICAgICAgICAgICAgICBjbG9uZWRDVEEuYWRkQ2xhc3MoInB2LWxpc3QtYWN0aW9uLWN0YSIpLmNzcyh7bGVmdDpwb3NpdGlvbkNUQSsicHgifSk7DQogICAgICAgICAgICAgICAgdGFyZ2V0LmNvbC5hZnRlcihjbG9uZWRDVEEpOw0KICAgICAgICAgICAgICAgIHRhcmdldC5yb3cuYWRkQ2xhc3MoImN1cnItcmVjb3JkIik7DQogICAgICAgICAgICB9IGVsc2V7DQogICAgICAgICAgICAgICAgdGFyZ2V0LnJvdy5hZGRDbGFzcygiY3Vyci1yZWNvcmQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkub24oIm1vdXNlbGVhdmUiLCBncmlkUm93LCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gY2hlY2tSb3dBbmRDZWxsKGNvbnRhaW5lciwgJCh0aGlzKSk7DQogICAgICAgICAgICBpZihjb250YWluZXJTaXplIDwgY29udGFpbmVyU2Nyb2xsYWJsZVdpZHRoKXsNCiAgICAgICAgICAgICAgICBjbG9uZWRDVEEucmVtb3ZlQ2xhc3MoInB2LWxpc3QtYWN0aW9uLWN0YSIpOw0KICAgICAgICAgICAgICAgIGNsb25lZENUQS5hdHRyKCJzdHlsZSIsICIiKTsNCiAgICAgICAgICAgICAgICB0YXJnZXQuY29sLmFwcGVuZChjbG9uZWRDVEEpOw0KICAgICAgICAgICAgICAgIHRhcmdldC5yb3cucmVtb3ZlQ2xhc3MoImN1cnItcmVjb3JkIik7DQogICAgICAgICAgICB9IGVsc2V7DQogICAgICAgICAgICAgICAgdGFyZ2V0LnJvdy5yZW1vdmVDbGFzcygiY3Vyci1yZWNvcmQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSwNCiAgICBoYW5kbGVEcmFnRHJvcEV2ZW50ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikgew0KICAgICAgICBpdGVtRHJhZ2dlZCA9IGZhbHNlOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLnVpLXNvcnRhYmxlIikuc29ydGFibGUoew0KICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaXRlbURyYWdnZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHBzR3JpZC51cGRhdGUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSwNCiAgICBoYW5kbGVHcmlkSG9yaXpvbnRhbFNjcm9sbCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsNCiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIuZGF0YVRhYmxlc19zY3JvbGxCb2R5Iikub24oInNjcm9sbCwgdG91Y2htb3ZlIixmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSAkKHRoaXMpOw0KICAgICAgICAgICAgICAgIHZhciBpc0dyaWRTY3JvbGxhYmxlID0gdGhhdC5vdXRlcldpZHRoKCkgPCB0aGF0LmdldCgwKS5zY3JvbGxXaWR0aDsNCiAgICAgICAgICAgICAgICB2YXIgc2Vjb2RhcnlWaWV3Um93ID0gdGhhdC5maW5kKCIuZm9vdGFibGUtcm93LWRldGFpbC1pbm5lciIpOw0KICAgICAgICAgICAgICAgIHZhciBzY3JvbGxlZExlZnQgPSB0aGF0LmdldCgwKS5zY3JvbGxMZWZ0Ow0KICAgICAgICAgICAgICAgIGlmKGlzR3JpZFNjcm9sbGFibGUgJiYgc2Nyb2xsZWRMZWZ0ID4gMCl7DQogICAgICAgICAgICAgICAgICAgIHNlY29kYXJ5Vmlld1Jvdy5jc3MoIm1hcmdpbi1sZWZ0IixzY3JvbGxlZExlZnQrInB4Iik7DQogICAgICAgICAgICAgICAgICAgIHZhciBjdGEgPSBjb250YWluZXIuZmluZCgiLmRhdGFUYWJsZXNfc2Nyb2xsQm9keSAucHYtbGlzdC1hY3Rpb24tY3RhIik7DQogICAgICAgICAgICAgICAgICAgIHZhciBjdGFDbG9zZVREID0gY3RhLnByZXYoKTsNCiAgICAgICAgICAgICAgICAgICAgY3RhLmRldGFjaCgpLnJlbW92ZUNsYXNzKCJwdi1saXN0LWFjdGlvbi1jdGEiKS5hcHBlbmRUbyhjdGFDbG9zZVREKTsNCiAgICAgICAgICAgICAgICB9IGVsc2V7DQogICAgICAgICAgICAgICAgICAgIHNlY29kYXJ5Vmlld1Jvdy5jc3MoIm1hcmdpbi1sZWZ0IiwiMHB4Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sDQogICAgYmluZEljb25Ib3ZlckV2ZW50cyA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsNCiAgICAgICAgY29udGFpbmVyLmZpbmQoIi5yZXBvcnRTdGF0ZU1lc3NhZ2UiKS53ZWJ1aVBvcG92ZXIoew0KICAgICAgICAgICAgdHJpZ2dlcjoiaG92ZXIiLA0KICAgICAgICAgICAgd2lkdGg6NDAwLA0KICAgICAgICAgICAgY29udGVudDokKHRoaXMpLmRhdGEoImNvbnRlbnQiKQ0KICAgICAgICB9KTsNCiAgICB9LA0KICAgIHNldFBlcmZlY3RTY3JvbGxiYXIgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7DQogICAgICAgIHBzR3JpZCA9IG5ldyBQZXJmZWN0U2Nyb2xsYmFyKGNvbnRhaW5lci5maW5kKCcuZGF0YVRhYmxlc19zY3JvbGxCb2R5JylbMF0pOw0KICAgICAgICB2YXIgcHNTZXR0aW5nUGFuZWwgPSBuZXcgUGVyZmVjdFNjcm9sbGJhcigiLnNpZGUtYmFyLnJpZ2h0LWJhciIpOw0KICAgIH0sDQogICAgdXBkYXRlUGVyZmVjdFNjcm9sbGJhciA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsNCiAgICAgICAgdmFyIHNjcm9sbENvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKCcuZGF0YVRhYmxlc19zY3JvbGxCb2R5JylbMF07DQogICAgICAgIGlmKHBzR3JpZCl7DQogICAgICAgICAgICBwc0dyaWQudXBkYXRlKCk7DQogICAgICAgIH0NCiAgICAgICAgJChzY3JvbGxDb250YWluZXIpLnNjcm9sbCgpOw0KICAgIH0sDQogICAgc2V0TW9yZU9wdGlvbiA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsNCiAgICAgICAgY29udGFpbmVyLmZpbmQoJy5wdmpzX291dGVyLW1vcmUtYm94JykuZWFjaCggZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJCh0aGlzKSk7DQogICAgICAgICAgICB2YXIgZWxlID0gJCh0aGlzKQ0KICAgICAgICAgICAgdmFyIGlubmVyQ29udGFpbmVyID0gZWxlLmZpbmQoIi5wdmpzX2lubmVyLW1vcmUtYm94Iik7DQogICAgICAgICAgICB2YXIgbW9yZURhdGEgPSBlbGUuYXR0cigiZGF0YS1tb3JlIik7DQogICAgICAgICAgICB2YXIgZGF0YU5hbWUgPSBlbGUuYXR0cigiZGF0YS1uYW1lIik7DQogICAgICAgICAgICB2YXIgbW9yZU9wdGlvbiA9ICc8YSB0eXBlPSJsaW5rIiBjbGFzcz0iY2wtaWMtbW9yZSI+PGkgY2xhc3M9ImZhIGZhLWVsbGlwc2lzLWggbW9yZS1vcHRpb24iICBkYXRhLW1vcmVkYXRhPSInICsgbW9yZURhdGEgKyAnIiBkYXRhLWl0ZW09IicgKyBkYXRhTmFtZSArICciPiA8L2k+IDwvYT4nOw0KICAgICAgICAgICAgaWYoaW5uZXJDb250YWluZXIuaW5uZXJIZWlnaHQoKSA+IGVsZS5pbm5lckhlaWdodCgpKXsNCiAgICAgICAgICAgICAgICBpbm5lckNvbnRhaW5lci5hcHBlbmQobW9yZU9wdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0sDQogICAgc2Nyb2xsVG9wR3JpZCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsNCiAgICAgICAgdmFyIHNjcm9sbENvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKCcuZGF0YVRhYmxlc19zY3JvbGxCb2R5Jyk7DQogICAgICAgIHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3AoMCk7DQogICAgfSwNCiAgICBpbml0aWFsaXplUG9wb3ZlciA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsNCiAgICAgICAgXy5lYWNoKGNvbnRhaW5lci5maW5kKCcubW9yZS1vcHRpb24nKSwgZnVuY3Rpb24gKGVsZSkgew0KICAgICAgICAgICAgdmFyIG1vcmVEYXRhID0gcHZpLnV0aWwucmVtb3ZlSFRNTFRhZ3MoJChlbGUpLmRhdGEoJ21vcmVkYXRhJykpOw0KICAgICAgICAgICAgJChlbGUpLndlYnVpUG9wb3Zlcih7DQogICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnaG92ZXInLA0KICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYoXy5pc0VtcHR5KG1vcmVEYXRhKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbW9yZURhdGEgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2YXIgdGhlRGF0YSA9IF8uZmlsdGVyKG1vcmVEYXRhLnNwbGl0KCcsJyksIGZ1bmN0aW9uIChpdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFfLmlzRW1wdHkoaXQudHJpbSgpKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIHZhciB2ID0gIiI7DQogICAgICAgICAgICAgICAgICAgIHZhciB0aGVEYXRhTGVuZ3RoID0gdGhlRGF0YS5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhlRGF0YUxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhlRGF0YVtpXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdiArICI8YT4iICsgdGhlRGF0YVtpXSArICI8L2E+IjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpIDwgdGhlRGF0YUxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdiArICIsPGJyPiI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgIH0sDQogICAgc2V0TW9yZURhdGFPcHRpb24gPSBmdW5jdGlvbiAoY29udGFpbmVySWQpIHsNCiAgICAgICAgXy5lYWNoKCQoIiMiK2NvbnRhaW5lcklkKS5maW5kKCIucHZqc19vdXRlci1tb3JlLWJveCIpLCBmdW5jdGlvbiAoZWxlKSB7DQogICAgICAgICAgICB2YXIgaW5uZXJDb250YWluZXIgPSAkKGVsZSkuZmluZCgiLnB2anNfaW5uZXItbW9yZS1ib3giKTsNCiAgICAgICAgICAgIHZhciBtb3JlRGF0YSA9IGlubmVyQ29udGFpbmVyLmh0bWwoKTsNCiAgICAgICAgICAgIHZhciBtb3JlT3B0aW9uID0gJzxhIHR5cGU9ImxpbmsiIGNsYXNzPSJjbC1pYy1tb3JlIiB0aXRsZT0iU2VlIEFsbCI+PGkgY2xhc3M9ImZhIGZhLWVsbGlwc2lzLWggbW9yZS1vcHRpb24iPiA8L2k+PHNwYW4gY2xhc3M9ImhpZGUiPicrbW9yZURhdGErJzwvc3Bhbj4gPC9hPic7DQogICAgICAgICAgICBpZihpbm5lckNvbnRhaW5lci5pbm5lckhlaWdodCgpID4gJChlbGUpLmlubmVySGVpZ2h0KCkpew0KICAgICAgICAgICAgICAgIGlubmVyQ29udGFpbmVyLmFwcGVuZChtb3JlT3B0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSwNCg0KICAgIGJpbmRNb3JlQ29udGVudFBvcG92ZXIgPSBmdW5jdGlvbiAoY29udGFpbmVySWQpIHsNCiAgICAgICAgXy5lYWNoKCQoIiMiK2NvbnRhaW5lcklkKS5maW5kKCcubW9yZS1vcHRpb24nKSwgZnVuY3Rpb24gKGVsZSkgew0KICAgICAgICAgICAgJChlbGUpLndlYnVpUG9wb3ZlcignZGVzdHJveScpLndlYnVpUG9wb3Zlcih7DQogICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2hvdmVyJywNCiAgICAgICAgICAgICAgICBjb250ZW50OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkKGVsZSkubmV4dCgnc3BhbicpLmh0bWwoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfSwNCiAgICBjbG9zZVNldHRpbmdQYW5lbCA9IGZ1bmN0aW9uIChjYWxsYmFjaywgdGFyZ2V0KSB7DQogICAgICAgIHZhciBjaGVja0FuZEhpZGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpZiAoaXRlbURyYWdnZWQpIHsNCiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOw0KICAgICAgICAgICAgfSBlbHNlew0KICAgICAgICAgICAgICAgIHB2dWkuZ3JpZC51dGlscy5tYW5hZ2VMaXN0aW5nVUkuaGlkZVNldHRpbmdQYW5lbCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICBpZih0YXJnZXQpIHsNCiAgICAgICAgICAgIHRhcmdldC5jbGljayhmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgY2hlY2tBbmRIaWRlKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCJjbGljayIsICIucmlnaHRwYW5lbC1iYWNrZHJvcCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjaGVja0FuZEhpZGUoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICB9LA0KICAgIHRvZ2dsZUdyaWRGaWx0ZXIgPSBmdW5jdGlvbiAoY29udGFpbmVyLG9wdGlvbnMpIHsNCiAgICAgICAgaWYoY29udGFpbmVyLmZpbmQoJy5saXN0LWZpbHRlcicpLmlzKCc6dmlzaWJsZScpKSB7DQogICAgICAgICAgICBjb250YWluZXIuZmluZCgnLmxpc3QtZmlsdGVyJykuaGlkZSgpOw0KICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5maWx0ZXItaGVhZCcpLmZpbmQoJy5zZWxlY3QyLWNvbnRhaW5lcicpLmhpZGUoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcubGlzdC1maWx0ZXInKS5zaG93KCk7DQogICAgICAgICAgICBjb250YWluZXIuZmluZCgnLnNlbGVjdDItY29udGFpbmVyJykuc2hvdygpOw0KICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5kYXRlLXRpbWUtZmlsdGVyJykuYXR0cigicGxhY2Vob2xkZXIiLCBvcHRpb25zP29wdGlvbnMuZGF0ZUZvcm1hdDonJyk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgcmV0dXJuIHsNCiAgICAgICAgcHJldmVudFNjcm9sbGluZ0VtcHR5R3JpZDpwcmV2ZW50U2Nyb2xsaW5nRW1wdHlHcmlkLA0KICAgICAgICBkaXNhYmxlVGFibGVTY3JvbGxpbmc6IGRpc2FibGVUYWJsZVNjcm9sbGluZywNCiAgICAgICAgZW5hYmxlVGFibGVTY3JvbGxpbmc6IGVuYWJsZVRhYmxlU2Nyb2xsaW5nLA0KICAgICAgICBoYW5kbGVSb3dNb3VzZU92ZXJFdmVudDogaGFuZGxlUm93TW91c2VPdmVyRXZlbnQsDQogICAgICAgIGhhbmRsZUdyaWRIb3Jpem9udGFsU2Nyb2xsOiBoYW5kbGVHcmlkSG9yaXpvbnRhbFNjcm9sbCwNCiAgICAgICAgYmluZEljb25Ib3ZlckV2ZW50czogYmluZEljb25Ib3ZlckV2ZW50cywNCiAgICAgICAgc2V0UGVyZmVjdFNjcm9sbGJhcjpzZXRQZXJmZWN0U2Nyb2xsYmFyLA0KICAgICAgICB1cGRhdGVQZXJmZWN0U2Nyb2xsYmFyOnVwZGF0ZVBlcmZlY3RTY3JvbGxiYXIsDQogICAgICAgIHNldEdyaWRBY3Rpb25CdXR0b25Qb3NpdGlvbjogc2V0R3JpZEFjdGlvbkJ1dHRvblBvc2l0aW9uLA0KICAgICAgICBzZXRNb3JlT3B0aW9uOiBzZXRNb3JlT3B0aW9uLA0KICAgICAgICBoYW5kbGVEcmFnRHJvcEV2ZW50OiBoYW5kbGVEcmFnRHJvcEV2ZW50LA0KICAgICAgICBzY3JvbGxUb3BHcmlkOnNjcm9sbFRvcEdyaWQsDQogICAgICAgIGluaXRpYWxpemVQb3BvdmVyOiBpbml0aWFsaXplUG9wb3ZlciwNCiAgICAgICAgc2V0TW9yZURhdGFPcHRpb246c2V0TW9yZURhdGFPcHRpb24sDQogICAgICAgIGJpbmRNb3JlQ29udGVudFBvcG92ZXI6YmluZE1vcmVDb250ZW50UG9wb3ZlciwNCiAgICAgICAgY2xvc2VTZXR0aW5nUGFuZWw6Y2xvc2VTZXR0aW5nUGFuZWwsDQogICAgICAgIHRvZ2dsZUdyaWRGaWx0ZXI6IHRvZ2dsZUdyaWRGaWx0ZXINCiAgICB9DQp9KCk7Ci8vPSByZXF1aXJlIHZlbmRvclVpL2RhdGF0YWJsZXMvanF1ZXJ5LmRhdGFUYWJsZXMubWluDQovLz0gcmVxdWlyZSB2ZW5kb3JVaS9kYXRhdGFibGVzL2RhdGFUYWJsZXMuZml4ZWRDb2x1bW5zLm1pbg0KLy89IHJlcXVpcmUgdmVuZG9yVWkvZGF0YXRhYmxlcy9kYXRhVGFibGVzLmJvb3RzdHJhcC5taW4NCi8vPSByZXF1aXJlIHZlbmRvclVpL2RhdGF0YWJsZXMvZGF0ZXRpbWUtbW9tZW50DQovLz0gcmVxdWlyZSBjb21wb25lbnQvZ3JpZC9wdnVpLWdyaWQNCi8vPSByZXF1aXJlX3NlbGYKLyohIENvbFJlb3JkZXIgMS4zLjMNCiAqIMKpMjAxMC0yMDE1IFNwcnlNZWRpYSBMdGQgLSBkYXRhdGFibGVzLm5ldC9saWNlbnNlDQogKi8NCg0KLyoqDQogKiBAc3VtbWFyeSAgICAgQ29sUmVvcmRlcg0KICogQGRlc2NyaXB0aW9uIFByb3ZpZGUgdGhlIGFiaWxpdHkgdG8gcmVvcmRlciBjb2x1bW5zIGluIGEgRGF0YVRhYmxlDQogKiBAdmVyc2lvbiAgICAgMS4zLjMNCiAqIEBmaWxlICAgICAgICBkYXRhVGFibGVzLmNvbFJlb3JkZXIuanMNCiAqIEBhdXRob3IgICAgICBTcHJ5TWVkaWEgTHRkICh3d3cuc3ByeW1lZGlhLmNvLnVrKQ0KICogQGNvbnRhY3QgICAgIHd3dy5zcHJ5bWVkaWEuY28udWsvY29udGFjdA0KICogQGNvcHlyaWdodCAgIENvcHlyaWdodCAyMDEwLTIwMTQgU3ByeU1lZGlhIEx0ZC4NCiAqDQogKiBUaGlzIHNvdXJjZSBmaWxlIGlzIGZyZWUgc29mdHdhcmUsIGF2YWlsYWJsZSB1bmRlciB0aGUgZm9sbG93aW5nIGxpY2Vuc2U6DQogKiAgIE1JVCBsaWNlbnNlIC0gaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2UvbWl0DQogKg0KICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQNCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZDQogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLg0KICoNCiAqIEZvciBkZXRhaWxzIHBsZWFzZSByZWZlciB0bzogaHR0cDovL3d3dy5kYXRhdGFibGVzLm5ldA0KICovDQooZnVuY3Rpb24oIGZhY3RvcnkgKXsNCiAgICBpZiAoIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCApIHsNCiAgICAgICAgLy8gQU1EDQogICAgICAgIGRlZmluZSggWydqcXVlcnknLCAnZGF0YXRhYmxlcy5uZXQnXSwgZnVuY3Rpb24gKCAkICkgew0KICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkoICQsIHdpbmRvdywgZG9jdW1lbnQgKTsNCiAgICAgICAgfSApOw0KICAgIH0NCiAgICBlbHNlIGlmICggdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICkgew0KICAgICAgICAvLyBDb21tb25KUw0KICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChyb290LCAkKSB7DQogICAgICAgICAgICBpZiAoICEgcm9vdCApIHsNCiAgICAgICAgICAgICAgICByb290ID0gd2luZG93Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoICEgJCB8fCAhICQuZm4uZGF0YVRhYmxlICkgew0KICAgICAgICAgICAgICAgICQgPSByZXF1aXJlKCdkYXRhdGFibGVzLm5ldCcpKHJvb3QsICQpLiQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KCAkLCByb290LCByb290LmRvY3VtZW50ICk7DQogICAgICAgIH07DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBCcm93c2VyDQogICAgICAgIGZhY3RvcnkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApOw0KICAgIH0NCn0oZnVuY3Rpb24oICQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCApIHsNCiAgICAndXNlIHN0cmljdCc7DQogICAgdmFyIERhdGFUYWJsZSA9ICQuZm4uZGF0YVRhYmxlOw0KDQoNCiAgICAvKioNCiAgICAgKiBTd2l0Y2ggdGhlIGtleSB2YWx1ZSBwYWlyaW5nIG9mIGFuIGluZGV4IGFycmF5IHRvIGJlIHZhbHVlIGtleSAoaS5lLiB0aGUgb2xkIHZhbHVlIGlzIG5vdyB0aGUNCiAgICAgKiBrZXkpLiBGb3IgZXhhbXBsZSBjb25zaWRlciBbIDIsIDAsIDEgXSB0aGlzIHdvdWxkIGJlIHJldHVybmVkIGFzIFsgMSwgMiwgMCBdLg0KICAgICAqICBAbWV0aG9kICBmbkludmVydEtleVZhbHVlcw0KICAgICAqICBAcGFyYW0gICBhcnJheSBhSW4gQXJyYXkgdG8gc3dpdGNoIGFyb3VuZA0KICAgICAqICBAcmV0dXJucyBhcnJheQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZuSW52ZXJ0S2V5VmFsdWVzKCBhSW4gKQ0KICAgIHsNCiAgICAgICAgdmFyIGFSZXQ9W107DQogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49YUluLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgIHsNCiAgICAgICAgICAgIGFSZXRbIGFJbltpXSBdID0gaTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYVJldDsNCiAgICB9DQoNCg0KICAgIC8qKg0KICAgICAqIE1vZGlmeSBhbiBhcnJheSBieSBzd2l0Y2hpbmcgdGhlIHBvc2l0aW9uIG9mIHR3byBlbGVtZW50cw0KICAgICAqICBAbWV0aG9kICBmbkFycmF5U3dpdGNoDQogICAgICogIEBwYXJhbSAgIGFycmF5IGFBcnJheSBBcnJheSB0byBjb25zaWRlciwgd2lsbCBiZSBtb2RpZmllZCBieSByZWZlcmVuY2UgKGkuZS4gbm8gcmV0dXJuKQ0KICAgICAqICBAcGFyYW0gICBpbnQgaUZyb20gRnJvbSBwb2ludA0KICAgICAqICBAcGFyYW0gICBpbnQgaVRvIEluc2VydCBwb2ludA0KICAgICAqICBAcmV0dXJucyB2b2lkDQogICAgICovDQogICAgZnVuY3Rpb24gZm5BcnJheVN3aXRjaCggYUFycmF5LCBpRnJvbSwgaVRvICkNCiAgICB7DQogICAgICAgIHZhciBtU3RvcmUgPSBhQXJyYXkuc3BsaWNlKCBpRnJvbSwgMSApWzBdOw0KICAgICAgICBhQXJyYXkuc3BsaWNlKCBpVG8sIDAsIG1TdG9yZSApOw0KICAgIH0NCg0KDQogICAgLyoqDQogICAgICogU3dpdGNoIHRoZSBwb3NpdGlvbnMgb2Ygbm9kZXMgaW4gYSBwYXJlbnQgbm9kZSAobm90ZSB0aGlzIGlzIHNwZWNpZmljYWxseSBkZXNpZ25lZCBmb3INCiAgICAgKiB0YWJsZSByb3dzKS4gTm90ZSB0aGlzIGZ1bmN0aW9uIGNvbnNpZGVycyBhbGwgZWxlbWVudCBub2RlcyB1bmRlciB0aGUgcGFyZW50IQ0KICAgICAqICBAbWV0aG9kICBmbkRvbVN3aXRjaA0KICAgICAqICBAcGFyYW0gICBzdHJpbmcgc1RhZyBUYWcgdG8gY29uc2lkZXINCiAgICAgKiAgQHBhcmFtICAgaW50IGlGcm9tIEVsZW1lbnQgdG8gbW92ZQ0KICAgICAqICBAcGFyYW0gICBpbnQgUG9pbnQgdG8gZWxlbWVudCB0aGUgZWxlbWVudCB0byAoYmVmb3JlIHRoaXMgcG9pbnQpLCBjYW4gYmUgbnVsbCBmb3IgYXBwZW5kDQogICAgICogIEByZXR1cm5zIHZvaWQNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBmbkRvbVN3aXRjaCggblBhcmVudCwgaUZyb20sIGlUbyApDQogICAgew0KICAgICAgICB2YXIgYW5UYWdzID0gW107DQogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49blBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICggblBhcmVudC5jaGlsZE5vZGVzW2ldLm5vZGVUeXBlID09IDEgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFuVGFncy5wdXNoKCBuUGFyZW50LmNoaWxkTm9kZXNbaV0gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB2YXIgblN0b3JlID0gYW5UYWdzWyBpRnJvbSBdOw0KDQogICAgICAgIGlmICggaVRvICE9PSBudWxsICkNCiAgICAgICAgew0KICAgICAgICAgICAgblBhcmVudC5pbnNlcnRCZWZvcmUoIG5TdG9yZSwgYW5UYWdzW2lUb10gKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlDQogICAgICAgIHsNCiAgICAgICAgICAgIG5QYXJlbnQuYXBwZW5kQ2hpbGQoIG5TdG9yZSApOw0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICAvKioNCiAgICAgKiBQbHVnLWluIGZvciBEYXRhVGFibGVzIHdoaWNoIHdpbGwgcmVvcmRlciB0aGUgaW50ZXJuYWwgY29sdW1uIHN0cnVjdHVyZSBieSB0YWtpbmcgdGhlIGNvbHVtbg0KICAgICAqIGZyb20gb25lIHBvc2l0aW9uIChpRnJvbSkgYW5kIGluc2VydCBpdCBpbnRvIGEgZ2l2ZW4gcG9pbnQgKGlUbykuDQogICAgICogIEBtZXRob2QgICQuZm4uZGF0YVRhYmxlRXh0Lm9BcGkuZm5Db2xSZW9yZGVyDQogICAgICogIEBwYXJhbSAgIG9iamVjdCBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QgLSBhdXRvbWF0aWNhbGx5IGFkZGVkIGJ5IERhdGFUYWJsZXMhDQogICAgICogIEBwYXJhbSAgIGludCBpRnJvbSBUYWtlIHRoZSBjb2x1bW4gdG8gYmUgcmVwb3NpdGlvbmVkIGZyb20gdGhpcyBwb2ludA0KICAgICAqICBAcGFyYW0gICBpbnQgaVRvIGFuZCBpbnNlcnQgaXQgaW50byB0aGlzIHBvaW50DQogICAgICogIEBwYXJhbSAgIGJvb2wgZHJvcCBJbmRpY2F0ZSBpZiB0aGUgcmVvcmRlciBpcyB0aGUgZmluYWwgb25lIChpLmUuIGEgZHJvcCkNCiAgICAgKiAgICBub3QgYSBsaXZlIHJlb3JkZXINCiAgICAgKiAgQHBhcmFtICAgYm9vbCBpbnZhbGlkYXRlUm93cyBzcGVlZHMgdXAgcHJvY2Vzc2luZyBpZiBmYWxzZSBwYXNzZWQNCiAgICAgKiAgQHJldHVybnMgdm9pZA0KICAgICAqLw0KICAgICQuZm4uZGF0YVRhYmxlRXh0Lm9BcGkuZm5Db2xSZW9yZGVyID0gZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGlGcm9tLCBpVG8sIGRyb3AsIGludmFsaWRhdGVSb3dzICkNCiAgICB7DQogICAgICAgIHZhciBpLCBpTGVuLCBqLCBqTGVuLCBqZW4sIGlDb2xzPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoLCBuVHJzLCBvQ29sOw0KICAgICAgICB2YXIgYXR0ck1hcCA9IGZ1bmN0aW9uICggb2JqLCBwcm9wLCBtYXBwaW5nICkgew0KICAgICAgICAgICAgaWYgKCAhIG9ialsgcHJvcCBdIHx8IHR5cGVvZiBvYmpbIHByb3AgXSA9PT0gJ2Z1bmN0aW9uJyApIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBhID0gb2JqWyBwcm9wIF0uc3BsaXQoJy4nKTsNCiAgICAgICAgICAgIHZhciBudW0gPSBhLnNoaWZ0KCk7DQoNCiAgICAgICAgICAgIGlmICggaXNOYU4oIG51bSoxICkgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBvYmpbIHByb3AgXSA9IG1hcHBpbmdbIG51bSoxIF0rJy4nK2Euam9pbignLicpOw0KICAgICAgICB9Ow0KDQogICAgICAgIC8qIFNhbml0eSBjaGVjayBpbiB0aGUgaW5wdXQgKi8NCiAgICAgICAgaWYgKCBpRnJvbSA9PSBpVG8gKQ0KICAgICAgICB7DQogICAgICAgICAgICAvKiBQb2ludGxlc3MgcmVvcmRlciAqLw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCBpRnJvbSA8IDAgfHwgaUZyb20gPj0gaUNvbHMgKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLm9BcGkuX2ZuTG9nKCBvU2V0dGluZ3MsIDEsICJDb2xSZW9yZGVyICdmcm9tJyBpbmRleCBpcyBvdXQgb2YgYm91bmRzOiAiK2lGcm9tICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIGlUbyA8IDAgfHwgaVRvID49IGlDb2xzICkNCiAgICAgICAgew0KICAgICAgICAgICAgdGhpcy5vQXBpLl9mbkxvZyggb1NldHRpbmdzLCAxLCAiQ29sUmVvcmRlciAndG8nIGluZGV4IGlzIG91dCBvZiBib3VuZHM6ICIraVRvICk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAgKiBDYWxjdWxhdGUgdGhlIG5ldyBjb2x1bW4gYXJyYXkgaW5kZXgsIHNvIHdlIGhhdmUgYSBtYXBwaW5nIGJldHdlZW4gdGhlIG9sZCBhbmQgbmV3DQogICAgICAgICAqLw0KICAgICAgICB2YXIgYWlNYXBwaW5nID0gW107DQogICAgICAgIGZvciAoIGk9MCwgaUxlbj1pQ29scyA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgIHsNCiAgICAgICAgICAgIGFpTWFwcGluZ1tpXSA9IGk7DQogICAgICAgIH0NCiAgICAgICAgZm5BcnJheVN3aXRjaCggYWlNYXBwaW5nLCBpRnJvbSwgaVRvICk7DQogICAgICAgIHZhciBhaUludmVydE1hcHBpbmcgPSBmbkludmVydEtleVZhbHVlcyggYWlNYXBwaW5nICk7DQoNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBDb252ZXJ0IGFsbCBpbnRlcm5hbCBpbmRleGluZyB0byB0aGUgbmV3IGNvbHVtbiBvcmRlciBpbmRleGVzDQogICAgICAgICAqLw0KICAgICAgICAvKiBTb3J0aW5nICovDQogICAgICAgIGZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgIHsNCiAgICAgICAgICAgIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPSBhaUludmVydE1hcHBpbmdbIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gXTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIEZpeGVkIHNvcnRpbmcgKi8NCiAgICAgICAgaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgKQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkW2ldWzBdID0gYWlJbnZlcnRNYXBwaW5nWyBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWRbaV1bMF0gXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qIERhdGEgY29sdW1uIHNvcnRpbmcgKHRoZSBjb2x1bW4gd2hpY2ggdGhlIHNvcnQgZm9yIGEgZ2l2ZW4gY29sdW1uIHNob3VsZCB0YWtlIHBsYWNlIG9uKSAqLw0KICAgICAgICBmb3IgKCBpPTAsIGlMZW49aUNvbHMgOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICB7DQogICAgICAgICAgICBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsNCiAgICAgICAgICAgIGZvciAoIGo9MCwgakxlbj1vQ29sLmFEYXRhU29ydC5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG9Db2wuYURhdGFTb3J0W2pdID0gYWlJbnZlcnRNYXBwaW5nWyBvQ29sLmFEYXRhU29ydFtqXSBdOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGNvbHVtbiBpbmRleGVzDQogICAgICAgICAgICBvQ29sLmlkeCA9IGFpSW52ZXJ0TWFwcGluZ1sgb0NvbC5pZHggXTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFVwZGF0ZSAxLjEwIG9wdGltaXNlZCBzb3J0IGNsYXNzIHJlbW92YWwgdmFyaWFibGUNCiAgICAgICAgJC5lYWNoKCBvU2V0dGluZ3MuYUxhc3RTb3J0LCBmdW5jdGlvbiAoaSwgdmFsKSB7DQogICAgICAgICAgICBvU2V0dGluZ3MuYUxhc3RTb3J0W2ldLnNyYyA9IGFpSW52ZXJ0TWFwcGluZ1sgdmFsLnNyYyBdOw0KICAgICAgICB9ICk7DQoNCiAgICAgICAgLyogVXBkYXRlIHRoZSBHZXQgYW5kIFNldCBmdW5jdGlvbnMgZm9yIGVhY2ggY29sdW1uICovDQogICAgICAgIGZvciAoIGk9MCwgaUxlbj1pQ29scyA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgIHsNCiAgICAgICAgICAgIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOw0KDQogICAgICAgICAgICBpZiAoIHR5cGVvZiBvQ29sLm1EYXRhID09ICdudW1iZXInICkgew0KICAgICAgICAgICAgICAgIG9Db2wubURhdGEgPSBhaUludmVydE1hcHBpbmdbIG9Db2wubURhdGEgXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKCAkLmlzUGxhaW5PYmplY3QoIG9Db2wubURhdGEgKSApIHsNCiAgICAgICAgICAgICAgICAvLyBIVE1MNSBkYXRhIHNvdXJjZWQNCiAgICAgICAgICAgICAgICBhdHRyTWFwKCBvQ29sLm1EYXRhLCAnXycsICAgICAgYWlJbnZlcnRNYXBwaW5nICk7DQogICAgICAgICAgICAgICAgYXR0ck1hcCggb0NvbC5tRGF0YSwgJ2ZpbHRlcicsIGFpSW52ZXJ0TWFwcGluZyApOw0KICAgICAgICAgICAgICAgIGF0dHJNYXAoIG9Db2wubURhdGEsICdzb3J0JywgICBhaUludmVydE1hcHBpbmcgKTsNCiAgICAgICAgICAgICAgICBhdHRyTWFwKCBvQ29sLm1EYXRhLCAndHlwZScsICAgYWlJbnZlcnRNYXBwaW5nICk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAgKiBNb3ZlIHRoZSBET00gZWxlbWVudHMNCiAgICAgICAgICovDQogICAgICAgIGlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpRnJvbV0uYlZpc2libGUgKQ0KICAgICAgICB7DQogICAgICAgICAgICAvKiBDYWxjdWxhdGUgdGhlIGN1cnJlbnQgdmlzaWJsZSBpbmRleCBhbmQgdGhlIHBvaW50IHRvIGluc2VydCB0aGUgbm9kZSBiZWZvcmUuIFRoZSBpbnNlcnQNCiAgICAgICAgICAgICAqIGJlZm9yZSBuZWVkcyB0byB0YWtlIGludG8gYWNjb3VudCB0aGF0IHRoZXJlIG1pZ2h0IG5vdCBiZSBhbiBlbGVtZW50IHRvIGluc2VydCBiZWZvcmUsDQogICAgICAgICAgICAgKiBpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgbnVsbCwgYW5kIGFuIGFwcGVuZENoaWxkIHNob3VsZCBiZSB1c2VkDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHZhciBpVmlzaWJsZUluZGV4ID0gdGhpcy5vQXBpLl9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKCBvU2V0dGluZ3MsIGlGcm9tICk7DQogICAgICAgICAgICB2YXIgaUluc2VydEJlZm9yZUluZGV4ID0gbnVsbDsNCg0KICAgICAgICAgICAgaSA9IGlUbyA8IGlGcm9tID8gaVRvIDogaVRvICsgMTsNCiAgICAgICAgICAgIHdoaWxlICggaUluc2VydEJlZm9yZUluZGV4ID09PSBudWxsICYmIGkgPCBpQ29scyApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaUluc2VydEJlZm9yZUluZGV4ID0gdGhpcy5vQXBpLl9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKCBvU2V0dGluZ3MsIGkgKTsNCiAgICAgICAgICAgICAgICBpKys7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIEhlYWRlciAqLw0KICAgICAgICAgICAgblRycyA9IG9TZXR0aW5ncy5uVEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7DQogICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGZuRG9tU3dpdGNoKCBuVHJzW2ldLCBpVmlzaWJsZUluZGV4LCBpSW5zZXJ0QmVmb3JlSW5kZXggKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLyogRm9vdGVyICovDQogICAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5uVEZvb3QgIT09IG51bGwgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG5UcnMgPSBvU2V0dGluZ3MublRGb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOw0KICAgICAgICAgICAgICAgIGZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBmbkRvbVN3aXRjaCggblRyc1tpXSwgaVZpc2libGVJbmRleCwgaUluc2VydEJlZm9yZUluZGV4ICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvKiBCb2R5ICovDQogICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICggb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgZm5Eb21Td2l0Y2goIG9TZXR0aW5ncy5hb0RhdGFbaV0ublRyLCBpVmlzaWJsZUluZGV4LCBpSW5zZXJ0QmVmb3JlSW5kZXggKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAgKiBNb3ZlIHRoZSBpbnRlcm5hbCBhcnJheSBlbGVtZW50cw0KICAgICAgICAgKi8NCiAgICAgICAgLyogQ29sdW1ucyAqLw0KICAgICAgICBmbkFycmF5U3dpdGNoKCBvU2V0dGluZ3MuYW9Db2x1bW5zLCBpRnJvbSwgaVRvICk7DQoNCiAgICAgICAgLy8gcmVnZW5lcmF0ZSB0aGUgZ2V0IC8gc2V0IGZ1bmN0aW9ucw0KICAgICAgICBmb3IgKCBpPTAsIGlMZW49aUNvbHMgOyBpPGlMZW4gOyBpKysgKSB7DQogICAgICAgICAgICBvU2V0dGluZ3Mub0FwaS5fZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGksIHt9ICk7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBTZWFyY2ggY29sdW1ucyAqLw0KICAgICAgICBmbkFycmF5U3dpdGNoKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLCBpRnJvbSwgaVRvICk7DQoNCiAgICAgICAgLyogQXJyYXkgYXJyYXkgLSBpbnRlcm5hbCBkYXRhIGFub2RlcyBjYWNoZSAqLw0KICAgICAgICBmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgZGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaV07DQogICAgICAgICAgICB2YXIgY2VsbHMgPSBkYXRhLmFuQ2VsbHM7DQoNCiAgICAgICAgICAgIGlmICggY2VsbHMgKSB7DQogICAgICAgICAgICAgICAgZm5BcnJheVN3aXRjaCggY2VsbHMsIGlGcm9tLCBpVG8gKTsNCg0KICAgICAgICAgICAgICAgIC8vIExvbmdlciB0ZXJtLCBzaG91bGQgdGhpcyBiZSBtb3ZlZCBpbnRvIHRoZSBEYXRhVGFibGVzJyBpbnZhbGlkYXRlDQogICAgICAgICAgICAgICAgLy8gbWV0aG9kcz8NCiAgICAgICAgICAgICAgICBmb3IgKCBqPTAsIGplbj1jZWxscy5sZW5ndGggOyBqPGplbiA7IGorKyApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCBjZWxsc1tqXSAmJiBjZWxsc1tqXS5fRFRfQ2VsbEluZGV4ICkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2VsbHNbal0uX0RUX0NlbGxJbmRleC5jb2x1bW4gPSBqOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBGb3IgRE9NIHNvdXJjZWQgZGF0YSwgdGhlIGludmFsaWRhdGUgd2lsbCByZXJlYWQgdGhlIGNlbGwgaW50bw0KICAgICAgICAgICAgLy8gdGhlIGRhdGEgYXJyYXksIGJ1dCBmb3IgZGF0YSBzb3VyY2VzIGFzIGFuIGFycmF5LCB0aGV5IG5lZWQgdG8NCiAgICAgICAgICAgIC8vIGJlIGZsaXBwZWQNCiAgICAgICAgICAgIGlmICggZGF0YS5zcmMgIT09ICdkb20nICYmICQuaXNBcnJheSggZGF0YS5fYURhdGEgKSApIHsNCiAgICAgICAgICAgICAgICBmbkFycmF5U3dpdGNoKCBkYXRhLl9hRGF0YSwgaUZyb20sIGlUbyApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyogUmVwb3NpdGlvbiB0aGUgaGVhZGVyIGVsZW1lbnRzIGluIHRoZSBoZWFkZXIgbGF5b3V0IGFycmF5ICovDQogICAgICAgIGZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9IZWFkZXIubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkNCiAgICAgICAgew0KICAgICAgICAgICAgZm5BcnJheVN3aXRjaCggb1NldHRpbmdzLmFvSGVhZGVyW2ldLCBpRnJvbSwgaVRvICk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIG9TZXR0aW5ncy5hb0Zvb3RlciAhPT0gbnVsbCApDQogICAgICAgIHsNCiAgICAgICAgICAgIGZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Gb290ZXIubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBmbkFycmF5U3dpdGNoKCBvU2V0dGluZ3MuYW9Gb290ZXJbaV0sIGlGcm9tLCBpVG8gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICggaW52YWxpZGF0ZVJvd3MgfHwgaW52YWxpZGF0ZVJvd3MgPT09IHVuZGVmaW5lZCApDQogICAgICAgIHsNCiAgICAgICAgICAgICQuZm4uZGF0YVRhYmxlLkFwaSggb1NldHRpbmdzICkucm93cygpLmludmFsaWRhdGUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qDQogICAgICAgICAqIFVwZGF0ZSBEYXRhVGFibGVzJyBldmVudCBoYW5kbGVycw0KICAgICAgICAgKi8NCg0KICAgICAgICAvKiBTb3J0IGxpc3RlbmVyICovDQogICAgICAgIGZvciAoIGk9MCwgaUxlbj1pQ29scyA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgIHsNCiAgICAgICAgICAgICQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLm9mZignY2xpY2suRFQnKTsNCiAgICAgICAgICAgIHRoaXMub0FwaS5fZm5Tb3J0QXR0YWNoTGlzdGVuZXIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgsIGkgKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLyogRmlyZSBhbiBldmVudCBzbyBvdGhlciBwbHVnLWlucyBjYW4gdXBkYXRlICovDQogICAgICAgICQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlciggJ2NvbHVtbi1yZW9yZGVyLmR0JywgWyBvU2V0dGluZ3MsIHsNCiAgICAgICAgICAgIGZyb206IGlGcm9tLA0KICAgICAgICAgICAgdG86IGlUbywNCiAgICAgICAgICAgIG1hcHBpbmc6IGFpSW52ZXJ0TWFwcGluZywNCiAgICAgICAgICAgIGRyb3A6IGRyb3AsDQoNCiAgICAgICAgICAgIC8vIE9sZCBzdHlsZSBwYXJhbWV0ZXJzIGZvciBjb21wYXRpYmlsaXR5DQogICAgICAgICAgICBpRnJvbTogaUZyb20sDQogICAgICAgICAgICBpVG86IGlUbywNCiAgICAgICAgICAgIGFpSW52ZXJ0TWFwcGluZzogYWlJbnZlcnRNYXBwaW5nDQogICAgICAgIH0gXSApOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDb2xSZW9yZGVyIHByb3ZpZGVzIGNvbHVtbiB2aXNpYmlsaXR5IGNvbnRyb2wgZm9yIERhdGFUYWJsZXMNCiAgICAgKiBAY2xhc3MgQ29sUmVvcmRlcg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkdCBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdA0KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIENvbFJlb3JkZXIgb3B0aW9ucw0KICAgICAqLw0KICAgIHZhciBDb2xSZW9yZGVyID0gZnVuY3Rpb24oIGR0LCBvcHRzICkNCiAgICB7DQogICAgICAgIHZhciBzZXR0aW5ncyA9IG5ldyAkLmZuLmRhdGFUYWJsZS5BcGkoIGR0ICkuc2V0dGluZ3MoKVswXTsNCg0KICAgICAgICAvLyBFbnN1cmUgdGhhdCB3ZSBjYW4ndCBpbml0aWFsaXNlIG9uIHRoZSBzYW1lIHRhYmxlIHR3aWNlDQogICAgICAgIGlmICggc2V0dGluZ3MuX2NvbFJlb3JkZXIgKSB7DQogICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MuX2NvbFJlb3JkZXI7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBbGxvdyB0aGUgb3B0aW9ucyB0byBiZSBhIGJvb2xlYW4gZm9yIGRlZmF1bHRzDQogICAgICAgIGlmICggb3B0cyA9PT0gdHJ1ZSApIHsNCiAgICAgICAgICAgIG9wdHMgPSB7fTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENvbnZlcnQgZnJvbSBjYW1lbENhc2UgdG8gSHVuZ2FyaWFuLCBqdXN0IGFzIERhdGFUYWJsZXMgZG9lcw0KICAgICAgICB2YXIgY2FtZWxUb0h1bmdhcmlhbiA9ICQuZm4uZGF0YVRhYmxlLmNhbWVsVG9IdW5nYXJpYW47DQogICAgICAgIGlmICggY2FtZWxUb0h1bmdhcmlhbiApIHsNCiAgICAgICAgICAgIGNhbWVsVG9IdW5nYXJpYW4oIENvbFJlb3JkZXIuZGVmYXVsdHMsIENvbFJlb3JkZXIuZGVmYXVsdHMsIHRydWUgKTsNCiAgICAgICAgICAgIGNhbWVsVG9IdW5nYXJpYW4oIENvbFJlb3JkZXIuZGVmYXVsdHMsIG9wdHMgfHwge30gKTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKg0KICAgICAgICAgKiBQdWJsaWMgY2xhc3MgdmFyaWFibGVzDQogICAgICAgICAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEBuYW1lc3BhY2UgU2V0dGluZ3Mgb2JqZWN0IHdoaWNoIGNvbnRhaW5zIGN1c3RvbWlzYWJsZSBpbmZvcm1hdGlvbiBmb3IgQ29sUmVvcmRlciBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zID0gew0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdA0KICAgICAgICAgICAgICogIEBwcm9wZXJ0eSBkdA0KICAgICAgICAgICAgICogIEB0eXBlICAgICBPYmplY3QNCiAgICAgICAgICAgICAqICBAZGVmYXVsdCAgbnVsbA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICAiZHQiOiBudWxsLA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIEluaXRpYWxpc2F0aW9uIG9iamVjdCB1c2VkIGZvciB0aGlzIGluc3RhbmNlDQogICAgICAgICAgICAgKiAgQHByb3BlcnR5IGluaXQNCiAgICAgICAgICAgICAqICBAdHlwZSAgICAgb2JqZWN0DQogICAgICAgICAgICAgKiAgQGRlZmF1bHQgIHt9DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJpbml0IjogJC5leHRlbmQoIHRydWUsIHt9LCBDb2xSZW9yZGVyLmRlZmF1bHRzLCBvcHRzICksDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogTnVtYmVyIG9mIGNvbHVtbnMgdG8gZml4IChub3QgYWxsb3cgdG8gYmUgcmVvcmRlcmVkKQ0KICAgICAgICAgICAgICogIEBwcm9wZXJ0eSBmaXhlZA0KICAgICAgICAgICAgICogIEB0eXBlICAgICBpbnQNCiAgICAgICAgICAgICAqICBAZGVmYXVsdCAgMA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICAiZml4ZWQiOiAwLA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIE51bWJlciBvZiBjb2x1bW5zIHRvIGZpeCBjb3VudGluZyBmcm9tIHJpZ2h0IChub3QgYWxsb3cgdG8gYmUgcmVvcmRlcmVkKQ0KICAgICAgICAgICAgICogIEBwcm9wZXJ0eSBmaXhlZFJpZ2h0DQogICAgICAgICAgICAgKiAgQHR5cGUgICAgIGludA0KICAgICAgICAgICAgICogIEBkZWZhdWx0ICAwDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJmaXhlZFJpZ2h0IjogMCwNCg0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiBmb3Igb25jZSB0aGUgcmVvcmRlciBoYXMgYmVlbiBkb25lDQogICAgICAgICAgICAgKiAgQHByb3BlcnR5IHJlb3JkZXJDYWxsYmFjaw0KICAgICAgICAgICAgICogIEB0eXBlICAgICBmdW5jdGlvbg0KICAgICAgICAgICAgICogIEBkZWZhdWx0ICBudWxsDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJyZW9yZGVyQ2FsbGJhY2siOiBudWxsLA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIEBuYW1lc3BhY2UgSW5mb3JtYXRpb24gdXNlZCBmb3IgdGhlIG1vdXNlIGRyYWcNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgIm1vdXNlIjogew0KICAgICAgICAgICAgICAgICJzdGFydFgiOiAtMSwNCiAgICAgICAgICAgICAgICAic3RhcnRZIjogLTEsDQogICAgICAgICAgICAgICAgIm9mZnNldFgiOiAtMSwNCiAgICAgICAgICAgICAgICAib2Zmc2V0WSI6IC0xLA0KICAgICAgICAgICAgICAgICJ0YXJnZXQiOiAtMSwNCiAgICAgICAgICAgICAgICAidGFyZ2V0SW5kZXgiOiAtMSwNCiAgICAgICAgICAgICAgICAiZnJvbUluZGV4IjogLTENCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogSW5mb3JtYXRpb24gd2hpY2ggaXMgdXNlZCBmb3IgcG9zaXRpb25pbmcgdGhlIGluc2VydCBjdXNvciBhbmQga25vd2luZyB3aGVyZSB0byBkbyB0aGUNCiAgICAgICAgICAgICAqIGluc2VydC4gQXJyYXkgb2Ygb2JqZWN0cyB3aXRoIHRoZSBwcm9wZXJ0aWVzOg0KICAgICAgICAgICAgICogICB4OiB4LWF4aXMgcG9zaXRpb24NCiAgICAgICAgICAgICAqICAgdG86IGluc2VydCBwb2ludA0KICAgICAgICAgICAgICogIEBwcm9wZXJ0eSBhb1RhcmdldHMNCiAgICAgICAgICAgICAqICBAdHlwZSAgICAgYXJyYXkNCiAgICAgICAgICAgICAqICBAZGVmYXVsdCAgW10NCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgImFvVGFyZ2V0cyI6IFtdDQogICAgICAgIH07DQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQG5hbWVzcGFjZSBDb21tb24gYW5kIHVzZWZ1bCBET00gZWxlbWVudHMgZm9yIHRoZSBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5kb20gPSB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIERyYWdnaW5nIGVsZW1lbnQgKHRoZSBvbmUgdGhlIG1vdXNlIGlzIG1vdmluZykNCiAgICAgICAgICAgICAqICBAcHJvcGVydHkgZHJhZw0KICAgICAgICAgICAgICogIEB0eXBlICAgICBlbGVtZW50DQogICAgICAgICAgICAgKiAgQGRlZmF1bHQgIG51bGwNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgImRyYWciOiBudWxsLA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFRoZSBpbnNlcnQgY3Vyc29yDQogICAgICAgICAgICAgKiAgQHByb3BlcnR5IHBvaW50ZXINCiAgICAgICAgICAgICAqICBAdHlwZSAgICAgZWxlbWVudA0KICAgICAgICAgICAgICogIEBkZWZhdWx0ICBudWxsDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICJwb2ludGVyIjogbnVsbA0KICAgICAgICB9Ow0KDQoNCiAgICAgICAgLyogQ29uc3RydWN0b3IgbG9naWMgKi8NCiAgICAgICAgdGhpcy5zLmR0ID0gc2V0dGluZ3M7DQogICAgICAgIHRoaXMucy5kdC5fY29sUmVvcmRlciA9IHRoaXM7DQogICAgICAgIHRoaXMuX2ZuQ29uc3RydWN0KCk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfTsNCg0KDQoNCiAgICAkLmV4dGVuZCggQ29sUmVvcmRlci5wcm90b3R5cGUsIHsNCiAgICAgICAgLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKg0KICAgICAgICAgKiBQdWJsaWMgbWV0aG9kcw0KICAgICAgICAgKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqLw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZXNldCB0aGUgY29sdW1uIG9yZGVyaW5nIHRvIHRoZSBvcmlnaW5hbCBvcmRlcmluZyB0aGF0IHdhcyBkZXRlY3RlZCBvbg0KICAgICAgICAgKiBzdGFydCB1cC4NCiAgICAgICAgICogIEByZXR1cm4ge3RoaXN9IFJldHVybnMgYHRoaXNgIGZvciBjaGFpbmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogIEBleGFtcGxlDQogICAgICAgICAqICAgIC8vIERhdGFUYWJsZXMgaW5pdGlhbGlzYXRpb24gd2l0aCBDb2xSZW9yZGVyDQogICAgICAgICAqICAgIHZhciB0YWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7DQoJICogICAgICAgICJzRG9tIjogJ1JsZnJ0aXAnDQoJICogICAgfSApOw0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAvLyBBZGQgY2xpY2sgZXZlbnQgdG8gYSBidXR0b24gdG8gcmVzZXQgdGhlIG9yZGVyaW5nDQogICAgICAgICAqICAgICQoJyNyZXNldE9yZGVyaW5nJykuY2xpY2soIGZ1bmN0aW9uIChlKSB7DQoJICogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCgkgKiAgICAgICAgJC5mbi5kYXRhVGFibGUuQ29sUmVvcmRlciggdGFibGUgKS5mblJlc2V0KCk7DQoJICogICAgfSApOw0KICAgICAgICAgKi8NCiAgICAgICAgImZuUmVzZXQiOiBmdW5jdGlvbiAoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLl9mbk9yZGVyQ29sdW1ucyggdGhpcy5mbk9yZGVyKCkgKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIGBEZXByZWNhdGVkYCAtIEdldCB0aGUgY3VycmVudCBvcmRlciBvZiB0aGUgY29sdW1ucywgYXMgYW4gYXJyYXkuDQogICAgICAgICAqICBAcmV0dXJuIHthcnJheX0gQXJyYXkgb2YgY29sdW1uIGlkZW50aWZpZXJzDQogICAgICAgICAqICBAZGVwcmVjYXRlZCBgZm5PcmRlcmAgc2hvdWxkIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byB0aGlzIG1ldGhvZC4NCiAgICAgICAgICogICAgICBgZm5PcmRlcmAgYWN0cyBhcyBhIGdldHRlci9zZXR0ZXIuDQogICAgICAgICAqLw0KICAgICAgICAiZm5HZXRDdXJyZW50T3JkZXIiOiBmdW5jdGlvbiAoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5mbk9yZGVyKCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEdldCB0aGUgY3VycmVudCBvcmRlciBvZiB0aGUgY29sdW1ucywgYXMgYW4gYXJyYXkuIE5vdGUgdGhhdCB0aGUgdmFsdWVzDQogICAgICAgICAqIGdpdmVuIGluIHRoZSBhcnJheSBhcmUgdW5pcXVlIGlkZW50aWZpZXJzIGZvciBlYWNoIGNvbHVtbi4gQ3VycmVudGx5DQogICAgICAgICAqIHRoZXNlIGFyZSB0aGUgb3JpZ2luYWwgb3JkZXJpbmcgb2YgdGhlIGNvbHVtbnMgdGhhdCB3YXMgZGV0ZWN0ZWQgb24NCiAgICAgICAgICogc3RhcnQgdXAsIGJ1dCB0aGlzIGNvdWxkIHBvdGVudGlhbGx5IGNoYW5nZSBpbiBmdXR1cmUuDQogICAgICAgICAqICBAcmV0dXJuIHthcnJheX0gQXJyYXkgb2YgY29sdW1uIGlkZW50aWZpZXJzDQogICAgICAgICAqDQogICAgICAgICAqICBAZXhhbXBsZQ0KICAgICAgICAgKiAgICAvLyBHZXQgY29sdW1uIG9yZGVyaW5nIGZvciB0aGUgdGFibGUNCiAgICAgICAgICogICAgdmFyIG9yZGVyID0gJC5mbi5kYXRhVGFibGUuQ29sUmVvcmRlciggZGF0YVRhYmxlICkuZm5PcmRlcigpOw0KICAgICAgICAgKi8vKioNCiAgICAgICAgICogU2V0IHRoZSBvcmRlciBvZiB0aGUgY29sdW1ucywgZnJvbSB0aGUgcG9zaXRpb25zIGlkZW50aWZpZWQgaW4gdGhlDQogICAgICAgICAqIG9yZGVyaW5nIGFycmF5IGdpdmVuLiBOb3RlIHRoYXQgQ29sUmVvcmRlciB0YWtlcyBhIGJydXRlIGZvcmNlIGFwcHJvYWNoDQogICAgICAgICAqIHRvIHJlb3JkZXJpbmcsIHNvIGl0IGlzIHBvc3NpYmxlIG11bHRpcGxlIHJlb3JkZXJpbmcgZXZlbnRzIHdpbGwgb2NjdXINCiAgICAgICAgICogYmVmb3JlIHRoZSBmaW5hbCBvcmRlciBpcyBzZXR0bGVkIHVwb24uDQogICAgICAgICAqICBAcGFyYW0ge2FycmF5fSBbc2V0XSBBcnJheSBvZiBjb2x1bW4gaWRlbnRpZmllcnMgaW4gdGhlIG5ldyBvcmRlci4gTm90ZQ0KICAgICAgICAgKiAgICB0aGF0IGV2ZXJ5IGNvbHVtbiBtdXN0IGJlIGluY2x1ZGVkLCB1bmlxdWVseSwgaW4gdGhpcyBhcnJheS4NCiAgICAgICAgICogIEByZXR1cm4ge3RoaXN9IFJldHVybnMgYHRoaXNgIGZvciBjaGFpbmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogIEBleGFtcGxlDQogICAgICAgICAqICAgIC8vIFN3YXAgdGhlIGZpcnN0IGFuZCBzZWNvbmQgY29sdW1ucw0KICAgICAgICAgKiAgICAkLmZuLmRhdGFUYWJsZS5Db2xSZW9yZGVyKCBkYXRhVGFibGUgKS5mbk9yZGVyKCBbMSwgMCwgMiwgMywgNF0gKTsNCiAgICAgICAgICoNCiAgICAgICAgICogIEBleGFtcGxlDQogICAgICAgICAqICAgIC8vIE1vdmUgdGhlIGZpcnN0IGNvbHVtbiB0byB0aGUgZW5kIGZvciB0aGUgdGFibGUgYCNleGFtcGxlYA0KICAgICAgICAgKiAgICB2YXIgY3VyciA9ICQuZm4uZGF0YVRhYmxlLkNvbFJlb3JkZXIoICcjZXhhbXBsZScgKS5mbk9yZGVyKCk7DQogICAgICAgICAqICAgIHZhciBmaXJzdCA9IGN1cnIuc2hpZnQoKTsNCiAgICAgICAgICogICAgY3Vyci5wdXNoKCBmaXJzdCApOw0KICAgICAgICAgKiAgICAkLmZuLmRhdGFUYWJsZS5Db2xSZW9yZGVyKCAnI2V4YW1wbGUnICkuZm5PcmRlciggY3VyciApOw0KICAgICAgICAgKg0KICAgICAgICAgKiAgQGV4YW1wbGUNCiAgICAgICAgICogICAgLy8gUmV2ZXJzZSB0aGUgdGFibGUncyBvcmRlcg0KICAgICAgICAgKiAgICAkLmZuLmRhdGFUYWJsZS5Db2xSZW9yZGVyKCAnI2V4YW1wbGUnICkuZm5PcmRlcigNCiAgICAgICAgICogICAgICAkLmZuLmRhdGFUYWJsZS5Db2xSZW9yZGVyKCAnI2V4YW1wbGUnICkuZm5PcmRlcigpLnJldmVyc2UoKQ0KICAgICAgICAgKiAgICApOw0KICAgICAgICAgKi8NCiAgICAgICAgImZuT3JkZXIiOiBmdW5jdGlvbiAoIHNldCwgb3JpZ2luYWwgKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgYSA9IFtdLCBpLCBpZW4sIGosIGplbjsNCiAgICAgICAgICAgIHZhciBjb2x1bW5zID0gdGhpcy5zLmR0LmFvQ29sdW1uczsNCg0KICAgICAgICAgICAgaWYgKCBzZXQgPT09IHVuZGVmaW5lZCApew0KICAgICAgICAgICAgICAgIGZvciAoIGk9MCwgaWVuPWNvbHVtbnMubGVuZ3RoIDsgaTxpZW4gOyBpKysgKSB7DQogICAgICAgICAgICAgICAgICAgIGEucHVzaCggY29sdW1uc1tpXS5fQ29sUmVvcmRlcl9pT3JpZ0NvbCApOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiBhOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGUgb3JkZXIgZ2l2ZW4gaXMgYmFzZWQgb24gdGhlIG9yaWdpbmFsIGluZGV4ZXMsIHJhdGhlciB0aGFuIHRoZQ0KICAgICAgICAgICAgLy8gZXhpc3Rpbmcgb25lcywgc28gd2UgbmVlZCB0byB0cmFuc2xhdGUgZnJvbSB0aGUgb3JpZ2luYWwgdG8gY3VycmVudA0KICAgICAgICAgICAgLy8gYmVmb3JlIHRoZW4gZG9pbmcgdGhlIG9yZGVyDQogICAgICAgICAgICBpZiAoIG9yaWdpbmFsICkgew0KICAgICAgICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMuZm5PcmRlcigpOw0KDQogICAgICAgICAgICAgICAgZm9yICggaT0wLCBpZW49c2V0Lmxlbmd0aCA7IGk8aWVuIDsgaSsrICkgew0KICAgICAgICAgICAgICAgICAgICBhLnB1c2goICQuaW5BcnJheSggc2V0W2ldLCBvcmRlciApICk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgc2V0ID0gYTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGhpcy5fZm5PcmRlckNvbHVtbnMoIGZuSW52ZXJ0S2V5VmFsdWVzKCBzZXQgKSApOw0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0IGZyb20gdGhlIG9yaWdpbmFsIGNvbHVtbiBpbmRleCwgdG8gdGhlIG9yaWdpbmFsDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSAge2ludHxhcnJheX0gaWR4IEluZGV4KGVzKSB0byBjb252ZXJ0DQogICAgICAgICAqIEBwYXJhbSAge3N0cmluZ30gZGlyIFRyYW5zcG9zZSBkaXJlY3Rpb24gLSBgZnJvbU9yaWdpbmFsYCAvIGB0b0N1cnJlbnRgDQogICAgICAgICAqICAgb3IgYCd0b09yaWdpbmFsYCAvIGBmcm9tQ3VycmVudGANCiAgICAgICAgICogQHJldHVybiB7aW50fGFycmF5fSAgICAgQ29udmVydGVkIHZhbHVlcw0KICAgICAgICAgKi8NCiAgICAgICAgZm5UcmFuc3Bvc2U6IGZ1bmN0aW9uICggaWR4LCBkaXIgKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoICEgZGlyICkgew0KICAgICAgICAgICAgICAgIGRpciA9ICd0b0N1cnJlbnQnOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLmZuT3JkZXIoKTsNCiAgICAgICAgICAgIHZhciBjb2x1bW5zID0gdGhpcy5zLmR0LmFvQ29sdW1uczsNCg0KICAgICAgICAgICAgaWYgKCBkaXIgPT09ICd0b0N1cnJlbnQnICkgew0KICAgICAgICAgICAgICAgIC8vIEdpdmVuIGFuIG9yaWdpbmFsIGluZGV4LCB3YW50IHRoZSBjdXJyZW50DQogICAgICAgICAgICAgICAgcmV0dXJuICEgJC5pc0FycmF5KCBpZHggKSA/DQogICAgICAgICAgICAgICAgICAgICQuaW5BcnJheSggaWR4LCBvcmRlciApIDoNCiAgICAgICAgICAgICAgICAgICAgJC5tYXAoIGlkeCwgZnVuY3Rpb24gKCBpbmRleCApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkLmluQXJyYXkoIGluZGV4LCBvcmRlciApOw0KICAgICAgICAgICAgICAgICAgICB9ICk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBHaXZlbiBhIGN1cnJlbnQgaW5kZXgsIHdhbnQgdGhlIG9yaWdpbmFsDQogICAgICAgICAgICAgICAgcmV0dXJuICEgJC5pc0FycmF5KCBpZHggKSA/DQogICAgICAgICAgICAgICAgICAgIGNvbHVtbnNbaWR4XS5fQ29sUmVvcmRlcl9pT3JpZ0NvbCA6DQogICAgICAgICAgICAgICAgICAgICQubWFwKCBpZHgsIGZ1bmN0aW9uICggaW5kZXggKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1uc1tpbmRleF0uX0NvbFJlb3JkZXJfaU9yaWdDb2w7DQogICAgICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoNCiAgICAgICAgICogUHJpdmF0ZSBtZXRob2RzICh0aGV5IGFyZSBvZiBjb3Vyc2UgcHVibGljIGluIEpTLCBidXQgcmVjb21tZW5kZWQgYXMgcHJpdmF0ZSkNCiAgICAgICAgICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKi8NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29uc3RydWN0b3IgbG9naWMNCiAgICAgICAgICogIEBtZXRob2QgIF9mbkNvbnN0cnVjdA0KICAgICAgICAgKiAgQHJldHVybnMgdm9pZA0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5Db25zdHJ1Y3QiOiBmdW5jdGlvbiAoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7DQogICAgICAgICAgICB2YXIgaUxlbiA9IHRoaXMucy5kdC5hb0NvbHVtbnMubGVuZ3RoOw0KICAgICAgICAgICAgdmFyIHRhYmxlID0gdGhpcy5zLmR0Lm5UYWJsZTsNCiAgICAgICAgICAgIHZhciBpOw0KDQogICAgICAgICAgICAvKiBDb2x1bW5zIGRpc2NvdW50ZWQgZnJvbSByZW9yZGVyaW5nIC0gY291bnRpbmcgbGVmdCB0byByaWdodCAqLw0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuaW5pdC5pRml4ZWRDb2x1bW5zICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLnMuZml4ZWQgPSB0aGlzLnMuaW5pdC5pRml4ZWRDb2x1bW5zOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIHRoaXMucy5pbml0LmlGaXhlZENvbHVtbnNMZWZ0ICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLnMuZml4ZWQgPSB0aGlzLnMuaW5pdC5pRml4ZWRDb2x1bW5zTGVmdDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLyogQ29sdW1ucyBkaXNjb3VudGVkIGZyb20gcmVvcmRlcmluZyAtIGNvdW50aW5nIHJpZ2h0IHRvIGxlZnQgKi8NCiAgICAgICAgICAgIHRoaXMucy5maXhlZFJpZ2h0ID0gdGhpcy5zLmluaXQuaUZpeGVkQ29sdW1uc1JpZ2h0ID8NCiAgICAgICAgICAgICAgICB0aGlzLnMuaW5pdC5pRml4ZWRDb2x1bW5zUmlnaHQgOg0KICAgICAgICAgICAgICAgIDA7DQoNCiAgICAgICAgICAgIC8qIERyb3AgY2FsbGJhY2sgaW5pdGlhbGlzYXRpb24gb3B0aW9uICovDQogICAgICAgICAgICBpZiAoIHRoaXMucy5pbml0LmZuUmVvcmRlckNhbGxiYWNrICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLnMucmVvcmRlckNhbGxiYWNrID0gdGhpcy5zLmluaXQuZm5SZW9yZGVyQ2FsbGJhY2s7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIEFkZCBldmVudCBoYW5kbGVycyBmb3IgdGhlIGRyYWcgYW5kIGRyb3AsIGFuZCBhbHNvIG1hcmsgdGhlIG9yaWdpbmFsIGNvbHVtbiBvcmRlciAqLw0KICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBpTGVuOyBpKysgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmICggaSA+IHRoaXMucy5maXhlZC0xICYmIGkgPCBpTGVuIC0gdGhpcy5zLmZpeGVkUmlnaHQgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm5Nb3VzZUxpc3RlbmVyKCBpLCB0aGlzLnMuZHQuYW9Db2x1bW5zW2ldLm5UaCApOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8qIE1hcmsgdGhlIG9yaWdpbmFsIGNvbHVtbiBvcmRlciBmb3IgbGF0ZXIgcmVmZXJlbmNlICovDQogICAgICAgICAgICAgICAgdGhpcy5zLmR0LmFvQ29sdW1uc1tpXS5fQ29sUmVvcmRlcl9pT3JpZ0NvbCA9IGk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIFN0YXRlIHNhdmluZyAqLw0KICAgICAgICAgICAgdGhpcy5zLmR0Lm9BcGkuX2ZuQ2FsbGJhY2tSZWcoIHRoaXMucy5kdCwgJ2FvU3RhdGVTYXZlUGFyYW1zJywgZnVuY3Rpb24gKG9TLCBvRGF0YSkgew0KICAgICAgICAgICAgICAgIHRoYXQuX2ZuU3RhdGVTYXZlLmNhbGwoIHRoYXQsIG9EYXRhICk7DQogICAgICAgICAgICB9LCAiQ29sUmVvcmRlcl9TdGF0ZSIgKTsNCg0KICAgICAgICAgICAgLyogQW4gaW5pdGlhbCBjb2x1bW4gb3JkZXIgaGFzIGJlZW4gc3BlY2lmaWVkICovDQogICAgICAgICAgICB2YXIgYWlPcmRlciA9IG51bGw7DQogICAgICAgICAgICBpZiAoIHRoaXMucy5pbml0LmFpT3JkZXIgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFpT3JkZXIgPSB0aGlzLnMuaW5pdC5haU9yZGVyLnNsaWNlKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIFN0YXRlIGxvYWRpbmcsIG92ZXJyaWRlcyB0aGUgY29sdW1uIG9yZGVyIGdpdmVuICovDQogICAgICAgICAgICBpZiAoIHRoaXMucy5kdC5vTG9hZGVkU3RhdGUgJiYgdHlwZW9mIHRoaXMucy5kdC5vTG9hZGVkU3RhdGUuQ29sUmVvcmRlciAhPSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgICAgIHRoaXMucy5kdC5vTG9hZGVkU3RhdGUuQ29sUmVvcmRlci5sZW5ndGggPT0gdGhpcy5zLmR0LmFvQ29sdW1ucy5sZW5ndGggKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGFpT3JkZXIgPSB0aGlzLnMuZHQub0xvYWRlZFN0YXRlLkNvbFJlb3JkZXI7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIElmIHdlIGhhdmUgYW4gb3JkZXIgdG8gYXBwbHkgLSBkbyBzbyAqLw0KICAgICAgICAgICAgaWYgKCBhaU9yZGVyICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvKiBXZSBtaWdodCBiZSBjYWxsZWQgZHVyaW5nIG9yIGFmdGVyIHRoZSBEYXRhVGFibGVzIGluaXRpYWxpc2F0aW9uLiBJZiBiZWZvcmUsIHRoZW4gd2UgbmVlZA0KICAgICAgICAgICAgICAgICAqIHRvIHdhaXQgdW50aWwgdGhlIGRyYXcgaXMgZG9uZSwgaWYgYWZ0ZXIsIHRoZW4gZG8gd2hhdCB3ZSBuZWVkIHRvIGRvIHJpZ2h0IGF3YXkNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICBpZiAoICF0aGF0LnMuZHQuX2JJbml0Q29tcGxldGUgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGJEb25lID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICQodGFibGUpLm9uKCAnZHJhdy5kdC5jb2xSZW9yZGVyJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhdGhhdC5zLmR0Ll9iSW5pdENvbXBsZXRlICYmICFiRG9uZSApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYkRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNvcnQgPSBmbkludmVydEtleVZhbHVlcyggYWlPcmRlciApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZuT3JkZXJDb2x1bW5zLmNhbGwoIHRoYXQsIHJlc29ydCApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9ICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciByZXNvcnQgPSBmbkludmVydEtleVZhbHVlcyggYWlPcmRlciApOw0KICAgICAgICAgICAgICAgICAgICB0aGF0Ll9mbk9yZGVyQ29sdW1ucy5jYWxsKCB0aGF0LCByZXNvcnQgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLl9mblNldENvbHVtbkluZGV4ZXMoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gRGVzdHJveSBjbGVhbiB1cA0KICAgICAgICAgICAgJCh0YWJsZSkub24oICdkZXN0cm95LmR0LmNvbFJlb3JkZXInLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgJCh0YWJsZSkub2ZmKCAnZGVzdHJveS5kdC5jb2xSZW9yZGVyIGRyYXcuZHQuY29sUmVvcmRlcicgKTsNCiAgICAgICAgICAgICAgICAkKHRoYXQucy5kdC5uVEhlYWQpLmZpbmQoICcqJyApLm9mZiggJy5Db2xSZW9yZGVyJyApOw0KDQogICAgICAgICAgICAgICAgJC5lYWNoKCB0aGF0LnMuZHQuYW9Db2x1bW5zLCBmdW5jdGlvbiAoaSwgY29sdW1uKSB7DQogICAgICAgICAgICAgICAgICAgICQoY29sdW1uLm5UaCkucmVtb3ZlQXR0cignZGF0YS1jb2x1bW4taW5kZXgnKTsNCiAgICAgICAgICAgICAgICB9ICk7DQoNCiAgICAgICAgICAgICAgICB0aGF0LnMuZHQuX2NvbFJlb3JkZXIgPSBudWxsOw0KICAgICAgICAgICAgICAgIHRoYXQucyA9IG51bGw7DQogICAgICAgICAgICB9ICk7DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogU2V0IHRoZSBjb2x1bW4gb3JkZXIgZnJvbSBhbiBhcnJheQ0KICAgICAgICAgKiAgQG1ldGhvZCAgX2ZuT3JkZXJDb2x1bW5zDQogICAgICAgICAqICBAcGFyYW0gICBhcnJheSBhIEFuIGFycmF5IG9mIGludGVnZXJzIHdoaWNoIGRpY3RhdGUgdGhlIGNvbHVtbiBvcmRlciB0aGF0IHNob3VsZCBiZSBhcHBsaWVkDQogICAgICAgICAqICBAcmV0dXJucyB2b2lkDQogICAgICAgICAqICBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgIl9mbk9yZGVyQ29sdW1ucyI6IGZ1bmN0aW9uICggYSApDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7DQoNCiAgICAgICAgICAgIGlmICggYS5sZW5ndGggIT0gdGhpcy5zLmR0LmFvQ29sdW1ucy5sZW5ndGggKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRoaXMucy5kdC5vSW5zdGFuY2Uub0FwaS5fZm5Mb2coIHRoaXMucy5kdCwgMSwgIkNvbFJlb3JkZXIgLSBhcnJheSByZW9yZGVyIGRvZXMgbm90ICIrDQogICAgICAgICAgICAgICAgICAgICJtYXRjaCBrbm93biBudW1iZXIgb2YgY29sdW1ucy4gU2tpcHBpbmcuIiApOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGN1cnJJbmRleCA9ICQuaW5BcnJheSggaSwgYSApOw0KICAgICAgICAgICAgICAgIGlmICggaSAhPSBjdXJySW5kZXggKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLyogUmVvcmRlciBvdXIgc3dpdGNoaW5nIGFycmF5ICovDQogICAgICAgICAgICAgICAgICAgIGZuQXJyYXlTd2l0Y2goIGEsIGN1cnJJbmRleCwgaSApOw0KDQogICAgICAgICAgICAgICAgICAgIC8qIERvIHRoZSBjb2x1bW4gcmVvcmRlciBpbiB0aGUgdGFibGUgKi8NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zLmR0Lm9JbnN0YW5jZS5mbkNvbFJlb3JkZXIoIGN1cnJJbmRleCwgaSwgdHJ1ZSwgZmFsc2UgKTsNCg0KICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICQuZm4uZGF0YVRhYmxlLkFwaSggdGhpcy5zLmR0ICkucm93cygpLmludmFsaWRhdGUoKTsNCg0KICAgICAgICAgICAgdGhpcy5fZm5TZXRDb2x1bW5JbmRleGVzKCk7DQoNCiAgICAgICAgICAgIC8vIEhhcyBhbnl0aGluZyBhY3R1YWxseSBjaGFuZ2VkPyBJZiBub3QsIHRoZW4gbm90aGluZyBlbHNlIHRvIGRvDQogICAgICAgICAgICBpZiAoICEgY2hhbmdlZCApIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIFdoZW4gc2Nyb2xsaW5nIHdlIG5lZWQgdG8gcmVjYWxjdWxhdGUgdGhlIGNvbHVtbiBzaXplcyB0byBhbGxvdyBmb3IgdGhlIHNoaWZ0ICovDQogICAgICAgICAgICBpZiAoIHRoaXMucy5kdC5vU2Nyb2xsLnNYICE9PSAiIiB8fCB0aGlzLnMuZHQub1Njcm9sbC5zWSAhPT0gIiIgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRoaXMucy5kdC5vSW5zdGFuY2UuZm5BZGp1c3RDb2x1bW5TaXppbmcoIGZhbHNlICk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIFNhdmUgdGhlIHN0YXRlICovDQogICAgICAgICAgICB0aGlzLnMuZHQub0luc3RhbmNlLm9BcGkuX2ZuU2F2ZVN0YXRlKCB0aGlzLnMuZHQgKTsNCg0KICAgICAgICAgICAgaWYgKCB0aGlzLnMucmVvcmRlckNhbGxiYWNrICE9PSBudWxsICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLnMucmVvcmRlckNhbGxiYWNrLmNhbGwoIHRoaXMgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBCZWNhdXNlIHdlIGNoYW5nZSB0aGUgaW5kZXhlcyBvZiBjb2x1bW5zIGluIHRoZSB0YWJsZSwgcmVsYXRpdmUgdG8gdGhlaXIgc3RhcnRpbmcgcG9pbnQNCiAgICAgICAgICogd2UgbmVlZCB0byByZW9yZGVyIHRoZSBzdGF0ZSBjb2x1bW5zIHRvIHdoYXQgdGhleSBhcmUgYXQgdGhlIHN0YXJ0aW5nIHBvaW50IHNvIHdlIGNhbg0KICAgICAgICAgKiB0aGVuIHJlYXJyYW5nZSB0aGVtIGFnYWluIG9uIHN0YXRlIGxvYWQhDQogICAgICAgICAqICBAbWV0aG9kICBfZm5TdGF0ZVNhdmUNCiAgICAgICAgICogIEBwYXJhbSAgIG9iamVjdCBvU3RhdGUgRGF0YVRhYmxlcyBzdGF0ZQ0KICAgICAgICAgKiAgQHJldHVybnMgc3RyaW5nIEpTT04gZW5jb2RlZCBjb29raWUgc3RyaW5nIGZvciBEYXRhVGFibGVzDQogICAgICAgICAqICBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgIl9mblN0YXRlU2F2ZSI6IGZ1bmN0aW9uICggb1N0YXRlICkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIGksIGlMZW4sIGFDb3B5LCBpT3JpZ0NvbHVtbjsNCiAgICAgICAgICAgIHZhciBvU2V0dGluZ3MgPSB0aGlzLnMuZHQ7DQogICAgICAgICAgICB2YXIgY29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnM7DQoNCiAgICAgICAgICAgIG9TdGF0ZS5Db2xSZW9yZGVyID0gW107DQoNCiAgICAgICAgICAgIC8qIFNvcnRpbmcgKi8NCiAgICAgICAgICAgIGlmICggb1N0YXRlLmFhU29ydGluZyApIHsNCiAgICAgICAgICAgICAgICAvLyAxLjEwLjAtDQogICAgICAgICAgICAgICAgZm9yICggaT0wIDsgaTxvU3RhdGUuYWFTb3J0aW5nLmxlbmd0aCA7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgb1N0YXRlLmFhU29ydGluZ1tpXVswXSA9IGNvbHVtbnNbIG9TdGF0ZS5hYVNvcnRpbmdbaV1bMF0gXS5fQ29sUmVvcmRlcl9pT3JpZ0NvbDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB2YXIgYVNlYXJjaENvcHkgPSAkLmV4dGVuZCggdHJ1ZSwgW10sIG9TdGF0ZS5hb1NlYXJjaENvbHMgKTsNCg0KICAgICAgICAgICAgICAgIGZvciAoIGk9MCwgaUxlbj1jb2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpT3JpZ0NvbHVtbiA9IGNvbHVtbnNbaV0uX0NvbFJlb3JkZXJfaU9yaWdDb2w7DQoNCiAgICAgICAgICAgICAgICAgICAgLyogQ29sdW1uIGZpbHRlciAqLw0KICAgICAgICAgICAgICAgICAgICBvU3RhdGUuYW9TZWFyY2hDb2xzWyBpT3JpZ0NvbHVtbiBdID0gYVNlYXJjaENvcHlbaV07DQoNCiAgICAgICAgICAgICAgICAgICAgLyogVmlzaWJpbGl0eSAqLw0KICAgICAgICAgICAgICAgICAgICBvU3RhdGUuYWJWaXNDb2xzWyBpT3JpZ0NvbHVtbiBdID0gY29sdW1uc1tpXS5iVmlzaWJsZTsNCg0KICAgICAgICAgICAgICAgICAgICAvKiBDb2x1bW4gcmVvcmRlcmluZyAqLw0KICAgICAgICAgICAgICAgICAgICBvU3RhdGUuQ29sUmVvcmRlci5wdXNoKCBpT3JpZ0NvbHVtbiApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKCBvU3RhdGUub3JkZXIgKSB7DQogICAgICAgICAgICAgICAgLy8gMS4xMC4xKw0KICAgICAgICAgICAgICAgIGZvciAoIGk9MCA7IGk8b1N0YXRlLm9yZGVyLmxlbmd0aCA7IGkrKyApIHsNCiAgICAgICAgICAgICAgICAgICAgb1N0YXRlLm9yZGVyW2ldWzBdID0gY29sdW1uc1sgb1N0YXRlLm9yZGVyW2ldWzBdIF0uX0NvbFJlb3JkZXJfaU9yaWdDb2w7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdmFyIHN0YXRlQ29sdW1uc0NvcHkgPSAkLmV4dGVuZCggdHJ1ZSwgW10sIG9TdGF0ZS5jb2x1bW5zICk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKCBpPTAsIGlMZW49Y29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgaU9yaWdDb2x1bW4gPSBjb2x1bW5zW2ldLl9Db2xSZW9yZGVyX2lPcmlnQ29sOw0KDQogICAgICAgICAgICAgICAgICAgIC8qIENvbHVtbnMgKi8NCiAgICAgICAgICAgICAgICAgICAgb1N0YXRlLmNvbHVtbnNbIGlPcmlnQ29sdW1uIF0gPSBzdGF0ZUNvbHVtbnNDb3B5W2ldOw0KDQogICAgICAgICAgICAgICAgICAgIC8qIENvbHVtbiByZW9yZGVyaW5nICovDQogICAgICAgICAgICAgICAgICAgIG9TdGF0ZS5Db2xSZW9yZGVyLnB1c2goIGlPcmlnQ29sdW1uICk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKg0KICAgICAgICAgKiBNb3VzZSBkcm9wIGFuZCBkcmFnDQogICAgICAgICAqLw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBZGQgYSBtb3VzZSBkb3duIGxpc3RlbmVyIHRvIGEgcGFydGljbHVhciBUSCBlbGVtZW50DQogICAgICAgICAqICBAbWV0aG9kICBfZm5Nb3VzZUxpc3RlbmVyDQogICAgICAgICAqICBAcGFyYW0gICBpbnQgaSBDb2x1bW4gaW5kZXgNCiAgICAgICAgICogIEBwYXJhbSAgIGVsZW1lbnQgblRoIFRIIGVsZW1lbnQgY2xpY2tlZCBvbg0KICAgICAgICAgKiAgQHJldHVybnMgdm9pZA0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5Nb3VzZUxpc3RlbmVyIjogZnVuY3Rpb24gKCBpLCBuVGggKQ0KICAgICAgICB7DQogICAgICAgICAgICAvKg0KICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOw0KICAgICAgICAgICAgJChuVGgpDQogICAgICAgICAgICAgICAgLm9uKCAnbW91c2Vkb3duLkNvbFJlb3JkZXInLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZuTW91c2VEb3duLmNhbGwoIHRoYXQsIGUsIG5UaCApOw0KICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgIC5vbiggJ3RvdWNoc3RhcnQuQ29sUmVvcmRlcicsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZuTW91c2VEb3duLmNhbGwoIHRoYXQsIGUsIG5UaCApOw0KICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgICAgICAqLw0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIE1vdXNlIGRvd24gb24gYSBUSCBlbGVtZW50IGluIHRoZSB0YWJsZSBoZWFkZXINCiAgICAgICAgICogIEBtZXRob2QgIF9mbk1vdXNlRG93bg0KICAgICAgICAgKiAgQHBhcmFtICAgZXZlbnQgZSBNb3VzZSBldmVudA0KICAgICAgICAgKiAgQHBhcmFtICAgZWxlbWVudCBuVGggVEggZWxlbWVudCB0byBiZSBkcmFnZ2VkDQogICAgICAgICAqICBAcmV0dXJucyB2b2lkDQogICAgICAgICAqICBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgIl9mbk1vdXNlRG93biI6IGZ1bmN0aW9uICggZSwgblRoICkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOw0KDQogICAgICAgICAgICAvKiBTdG9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgbW91c2UgcG9zaXRpb24gKi8NCiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0aCwgdGQnKTsNCiAgICAgICAgICAgIHZhciBvZmZzZXQgPSB0YXJnZXQub2Zmc2V0KCk7DQogICAgICAgICAgICB2YXIgaWR4ID0gcGFyc2VJbnQoICQoblRoKS5hdHRyKCdkYXRhLWNvbHVtbi1pbmRleCcpLCAxMCApOw0KDQogICAgICAgICAgICBpZiAoIGlkeCA9PT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGhpcy5zLm1vdXNlLnN0YXJ0WCA9IHRoaXMuX2ZuQ3Vyc29yUG9zaXRpb24oIGUsICdwYWdlWCcgKTsNCiAgICAgICAgICAgIHRoaXMucy5tb3VzZS5zdGFydFkgPSB0aGlzLl9mbkN1cnNvclBvc2l0aW9uKCBlLCAncGFnZVknICk7DQogICAgICAgICAgICB0aGlzLnMubW91c2Uub2Zmc2V0WCA9IHRoaXMuX2ZuQ3Vyc29yUG9zaXRpb24oIGUsICdwYWdlWCcgKSAtIG9mZnNldC5sZWZ0Ow0KICAgICAgICAgICAgdGhpcy5zLm1vdXNlLm9mZnNldFkgPSB0aGlzLl9mbkN1cnNvclBvc2l0aW9uKCBlLCAncGFnZVknICkgLSBvZmZzZXQudG9wOw0KICAgICAgICAgICAgdGhpcy5zLm1vdXNlLnRhcmdldCA9IHRoaXMucy5kdC5hb0NvbHVtbnNbIGlkeCBdLm5UaDsvL3RhcmdldFswXTsNCiAgICAgICAgICAgIHRoaXMucy5tb3VzZS50YXJnZXRJbmRleCA9IGlkeDsNCiAgICAgICAgICAgIHRoaXMucy5tb3VzZS5mcm9tSW5kZXggPSBpZHg7DQoNCiAgICAgICAgICAgIHRoaXMuX2ZuUmVnaW9ucygpOw0KDQogICAgICAgICAgICAvKiBBZGQgZXZlbnQgaGFuZGxlcnMgdG8gdGhlIGRvY3VtZW50ICovDQogICAgICAgICAgICAkKGRvY3VtZW50KQ0KICAgICAgICAgICAgICAgIC5vbiggJ21vdXNlbW92ZS5Db2xSZW9yZGVyIHRvdWNobW92ZS5Db2xSZW9yZGVyJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZm5Nb3VzZU1vdmUuY2FsbCggdGhhdCwgZSApOw0KICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgIC5vbiggJ21vdXNldXAuQ29sUmVvcmRlciB0b3VjaGVuZC5Db2xSZW9yZGVyJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZm5Nb3VzZVVwLmNhbGwoIHRoYXQsIGUgKTsNCiAgICAgICAgICAgICAgICB9ICk7DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogRGVhbCB3aXRoIGEgbW91c2UgbW92ZSBldmVudCB3aGlsZSBkcmFnZ2luZyBhIG5vZGUNCiAgICAgICAgICogIEBtZXRob2QgIF9mbk1vdXNlTW92ZQ0KICAgICAgICAgKiAgQHBhcmFtICAgZXZlbnQgZSBNb3VzZSBldmVudA0KICAgICAgICAgKiAgQHJldHVybnMgdm9pZA0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5Nb3VzZU1vdmUiOiBmdW5jdGlvbiAoIGUgKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7DQoNCiAgICAgICAgICAgIGlmICggdGhpcy5kb20uZHJhZyA9PT0gbnVsbCApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLyogT25seSBjcmVhdGUgdGhlIGRyYWcgZWxlbWVudCBpZiB0aGUgbW91c2UgaGFzIG1vdmVkIGEgc3BlY2lmaWMgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQNCiAgICAgICAgICAgICAgICAgKiBwb2ludCAtIHRoaXMgYWxsb3dzIHRoZSB1c2VyIHRvIG1ha2Ugc21hbGwgbW91c2UgbW92ZW1lbnRzIHdoZW4gc29ydGluZyBhbmQgbm90IGhhdmUgYQ0KICAgICAgICAgICAgICAgICAqIHBvc3NpYmx5IGNvbmZ1c2luZyBkcmFnIGVsZW1lbnQgc2hvd2luZyB1cA0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIGlmICggTWF0aC5wb3coDQogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnBvdyh0aGlzLl9mbkN1cnNvclBvc2l0aW9uKCBlLCAncGFnZVgnKSAtIHRoaXMucy5tb3VzZS5zdGFydFgsIDIpICsNCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucG93KHRoaXMuX2ZuQ3Vyc29yUG9zaXRpb24oIGUsICdwYWdlWScpIC0gdGhpcy5zLm1vdXNlLnN0YXJ0WSwgMiksIDAuNSApIDwgNSApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMuX2ZuQ3JlYXRlRHJhZ05vZGUoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLyogUG9zaXRpb24gdGhlIGVsZW1lbnQgLSB3ZSByZXNwZWN0IHdoZXJlIGluIHRoZSBlbGVtZW50IHRoZSBjbGljayBvY2N1cmVkICovDQogICAgICAgICAgICB0aGlzLmRvbS5kcmFnLmNzcyggew0KICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMuX2ZuQ3Vyc29yUG9zaXRpb24oIGUsICdwYWdlWCcgKSAtIHRoaXMucy5tb3VzZS5vZmZzZXRYLA0KICAgICAgICAgICAgICAgIHRvcDogdGhpcy5fZm5DdXJzb3JQb3NpdGlvbiggZSwgJ3BhZ2VZJyApIC0gdGhpcy5zLm1vdXNlLm9mZnNldFkNCiAgICAgICAgICAgIH0gKTsNCg0KICAgICAgICAgICAgLyogQmFzZWQgb24gdGhlIGN1cnJlbnQgbW91c2UgcG9zaXRpb24sIGNhbGN1bGF0ZSB3aGVyZSB0aGUgaW5zZXJ0IHNob3VsZCBnbyAqLw0KICAgICAgICAgICAgdmFyIGJTZXQgPSBmYWxzZTsNCiAgICAgICAgICAgIHZhciBsYXN0VG9JbmRleCA9IHRoaXMucy5tb3VzZS50b0luZGV4Ow0KDQogICAgICAgICAgICBmb3IgKCB2YXIgaT0xLCBpTGVuPXRoaXMucy5hb1RhcmdldHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoIHRoaXMuX2ZuQ3Vyc29yUG9zaXRpb24oZSwgJ3BhZ2VYJykgPCB0aGlzLnMuYW9UYXJnZXRzW2ktMV0ueCArICgodGhpcy5zLmFvVGFyZ2V0c1tpXS54LXRoaXMucy5hb1RhcmdldHNbaS0xXS54KS8yKSApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbS5wb2ludGVyLmNzcyggJ2xlZnQnLCB0aGlzLnMuYW9UYXJnZXRzW2ktMV0ueCApOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnMubW91c2UudG9JbmRleCA9IHRoaXMucy5hb1RhcmdldHNbaS0xXS50bzsNCiAgICAgICAgICAgICAgICAgICAgYlNldCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGhlIGluc2VydCBlbGVtZW50IHdhc24ndCBwb3NpdGlvbmVkIGluIHRoZSBhcnJheSAobGVzcyB0aGFuDQogICAgICAgICAgICAvLyBvcGVyYXRvciksIHNvIHdlIHB1dCBpdCBhdCB0aGUgZW5kDQogICAgICAgICAgICBpZiAoICFiU2V0ICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5wb2ludGVyLmNzcyggJ2xlZnQnLCB0aGlzLnMuYW9UYXJnZXRzW3RoaXMucy5hb1RhcmdldHMubGVuZ3RoLTFdLnggKTsNCiAgICAgICAgICAgICAgICB0aGlzLnMubW91c2UudG9JbmRleCA9IHRoaXMucy5hb1RhcmdldHNbdGhpcy5zLmFvVGFyZ2V0cy5sZW5ndGgtMV0udG87DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFBlcmZvcm0gcmVvcmRlcmluZyBpZiByZWFsdGltZSB1cGRhdGluZyBpcyBvbiBhbmQgdGhlIGNvbHVtbiBoYXMgbW92ZWQNCiAgICAgICAgICAgIGlmICggdGhpcy5zLmluaXQuYlJlYWx0aW1lICYmIGxhc3RUb0luZGV4ICE9PSB0aGlzLnMubW91c2UudG9JbmRleCApIHsNCiAgICAgICAgICAgICAgICB0aGlzLnMuZHQub0luc3RhbmNlLmZuQ29sUmVvcmRlciggdGhpcy5zLm1vdXNlLmZyb21JbmRleCwgdGhpcy5zLm1vdXNlLnRvSW5kZXgsIGZhbHNlICk7DQogICAgICAgICAgICAgICAgdGhpcy5zLm1vdXNlLmZyb21JbmRleCA9IHRoaXMucy5tb3VzZS50b0luZGV4Ow0KICAgICAgICAgICAgICAgIHRoaXMuX2ZuUmVnaW9ucygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZpbmlzaCBvZmYgdGhlIG1vdXNlIGRyYWcgYW5kIGluc2VydCB0aGUgY29sdW1uIHdoZXJlIG5lZWRlZA0KICAgICAgICAgKiAgQG1ldGhvZCAgX2ZuTW91c2VVcA0KICAgICAgICAgKiAgQHBhcmFtICAgZXZlbnQgZSBNb3VzZSBldmVudA0KICAgICAgICAgKiAgQHJldHVybnMgdm9pZA0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5Nb3VzZVVwIjogZnVuY3Rpb24gKCBlICkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOw0KDQogICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoICcuQ29sUmVvcmRlcicgKTsNCg0KICAgICAgICAgICAgaWYgKCB0aGlzLmRvbS5kcmFnICE9PSBudWxsICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvKiBSZW1vdmUgdGhlIGd1aWRlIGVsZW1lbnRzICovDQogICAgICAgICAgICAgICAgdGhpcy5kb20uZHJhZy5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICB0aGlzLmRvbS5wb2ludGVyLnJlbW92ZSgpOw0KICAgICAgICAgICAgICAgIHRoaXMuZG9tLmRyYWcgPSBudWxsOw0KICAgICAgICAgICAgICAgIHRoaXMuZG9tLnBvaW50ZXIgPSBudWxsOw0KDQogICAgICAgICAgICAgICAgLyogQWN0dWFsbHkgZG8gdGhlIHJlb3JkZXIgKi8NCiAgICAgICAgICAgICAgICB0aGlzLnMuZHQub0luc3RhbmNlLmZuQ29sUmVvcmRlciggdGhpcy5zLm1vdXNlLmZyb21JbmRleCwgdGhpcy5zLm1vdXNlLnRvSW5kZXgsIHRydWUgKTsNCiAgICAgICAgICAgICAgICB0aGlzLl9mblNldENvbHVtbkluZGV4ZXMoKTsNCg0KICAgICAgICAgICAgICAgIC8qIFdoZW4gc2Nyb2xsaW5nIHdlIG5lZWQgdG8gcmVjYWxjdWxhdGUgdGhlIGNvbHVtbiBzaXplcyB0byBhbGxvdyBmb3IgdGhlIHNoaWZ0ICovDQogICAgICAgICAgICAgICAgaWYgKCB0aGlzLnMuZHQub1Njcm9sbC5zWCAhPT0gIiIgfHwgdGhpcy5zLmR0Lm9TY3JvbGwuc1kgIT09ICIiICkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucy5kdC5vSW5zdGFuY2UuZm5BZGp1c3RDb2x1bW5TaXppbmcoIGZhbHNlICk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLyogU2F2ZSB0aGUgc3RhdGUgKi8NCiAgICAgICAgICAgICAgICB0aGlzLnMuZHQub0luc3RhbmNlLm9BcGkuX2ZuU2F2ZVN0YXRlKCB0aGlzLnMuZHQgKTsNCg0KICAgICAgICAgICAgICAgIGlmICggdGhpcy5zLnJlb3JkZXJDYWxsYmFjayAhPT0gbnVsbCApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnMucmVvcmRlckNhbGxiYWNrLmNhbGwoIHRoaXMgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ2FsY3VsYXRlIGEgY2FjaGVkIGFycmF5IHdpdGggdGhlIHBvaW50cyBvZiB0aGUgY29sdW1uIGluc2VydHMsIGFuZCB0aGUNCiAgICAgICAgICogJ3RvJyBwb2ludHMNCiAgICAgICAgICogIEBtZXRob2QgIF9mblJlZ2lvbnMNCiAgICAgICAgICogIEByZXR1cm5zIHZvaWQNCiAgICAgICAgICogIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICAiX2ZuUmVnaW9ucyI6IGZ1bmN0aW9uICgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBhb0NvbHVtbnMgPSB0aGlzLnMuZHQuYW9Db2x1bW5zOw0KDQogICAgICAgICAgICB0aGlzLnMuYW9UYXJnZXRzLnNwbGljZSggMCwgdGhpcy5zLmFvVGFyZ2V0cy5sZW5ndGggKTsNCg0KICAgICAgICAgICAgdGhpcy5zLmFvVGFyZ2V0cy5wdXNoKCB7DQogICAgICAgICAgICAgICAgIngiOiAgJCh0aGlzLnMuZHQublRhYmxlKS5vZmZzZXQoKS5sZWZ0LA0KICAgICAgICAgICAgICAgICJ0byI6IDANCiAgICAgICAgICAgIH0gKTsNCg0KICAgICAgICAgICAgdmFyIGlUb1BvaW50ID0gMDsNCiAgICAgICAgICAgIHZhciB0b3RhbCA9IHRoaXMucy5hb1RhcmdldHNbMF0ueDsNCg0KICAgICAgICAgICAgZm9yICggdmFyIGk9MCwgaUxlbj1hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvKiBGb3IgdGhlIGNvbHVtbiAvIGhlYWRlciBpbiBxdWVzdGlvbiwgd2Ugd2FudCBpdCdzIHBvc2l0aW9uIHRvIHJlbWFpbiB0aGUgc2FtZSBpZiB0aGUNCiAgICAgICAgICAgICAgICAgKiBwb3NpdGlvbiBpcyBqdXN0IHRvIGl0J3MgaW1tZWRpYXRlIGxlZnQgb3IgcmlnaHQsIHNvIHdlIG9ubHkgaW5jcmVtZW50IHRoZSBjb3VudGVyIGZvcg0KICAgICAgICAgICAgICAgICAqIG90aGVyIGNvbHVtbnMNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICBpZiAoIGkgIT0gdGhpcy5zLm1vdXNlLmZyb21JbmRleCApDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpVG9Qb2ludCsrOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICggYW9Db2x1bW5zW2ldLmJWaXNpYmxlICYmIGFvQ29sdW1uc1tpXS5uVGguc3R5bGUuZGlzcGxheSAhPT0nbm9uZScgKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gJChhb0NvbHVtbnNbaV0ublRoKS5vdXRlcldpZHRoKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zLmFvVGFyZ2V0cy5wdXNoKCB7DQogICAgICAgICAgICAgICAgICAgICAgICAieCI6ICB0b3RhbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICJ0byI6IGlUb1BvaW50DQogICAgICAgICAgICAgICAgICAgIH0gKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIERpc2FsbG93IGNvbHVtbnMgZm9yIGJlaW5nIHJlb3JkZXJlZCBieSBkcmFnIGFuZCBkcm9wLCBjb3VudGluZyByaWdodCB0byBsZWZ0ICovDQogICAgICAgICAgICBpZiAoIHRoaXMucy5maXhlZFJpZ2h0ICE9PSAwICkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aGlzLnMuYW9UYXJnZXRzLnNwbGljZSggdGhpcy5zLmFvVGFyZ2V0cy5sZW5ndGggLSB0aGlzLnMuZml4ZWRSaWdodCApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvKiBEaXNhbGxvdyBjb2x1bW5zIGZvciBiZWluZyByZW9yZGVyZWQgYnkgZHJhZyBhbmQgZHJvcCwgY291bnRpbmcgbGVmdCB0byByaWdodCAqLw0KICAgICAgICAgICAgaWYgKCB0aGlzLnMuZml4ZWQgIT09IDAgKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRoaXMucy5hb1RhcmdldHMuc3BsaWNlKCAwLCB0aGlzLnMuZml4ZWQgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb3B5IHRoZSBUSCBlbGVtZW50IHRoYXQgaXMgYmVpbmcgZHJhZ3Mgc28gdGhlIHVzZXIgaGFzIHRoZSBpZGVhIHRoYXQgdGhleSBhcmUgYWN0dWFsbHkNCiAgICAgICAgICogbW92aW5nIGl0IGFyb3VuZCB0aGUgcGFnZS4NCiAgICAgICAgICogIEBtZXRob2QgIF9mbkNyZWF0ZURyYWdOb2RlDQogICAgICAgICAqICBAcmV0dXJucyB2b2lkDQogICAgICAgICAqICBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgIl9mbkNyZWF0ZURyYWdOb2RlIjogZnVuY3Rpb24gKCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHNjcm9sbGluZyA9IHRoaXMucy5kdC5vU2Nyb2xsLnNYICE9PSAiIiB8fCB0aGlzLnMuZHQub1Njcm9sbC5zWSAhPT0gIiI7DQoNCiAgICAgICAgICAgIHZhciBvcmlnQ2VsbCA9IHRoaXMucy5kdC5hb0NvbHVtbnNbIHRoaXMucy5tb3VzZS50YXJnZXRJbmRleCBdLm5UaDsNCiAgICAgICAgICAgIHZhciBvcmlnVHIgPSBvcmlnQ2VsbC5wYXJlbnROb2RlOw0KICAgICAgICAgICAgdmFyIG9yaWdUaGVhZCA9IG9yaWdUci5wYXJlbnROb2RlOw0KICAgICAgICAgICAgdmFyIG9yaWdUYWJsZSA9IG9yaWdUaGVhZC5wYXJlbnROb2RlOw0KICAgICAgICAgICAgdmFyIGNsb25lQ2VsbCA9ICQob3JpZ0NlbGwpLmNsb25lKCk7DQoNCiAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBzbGlnaHRseSBvZGQgY29tYmluYXRpb24gb2YgalF1ZXJ5IGFuZCBET00sIGJ1dCBpdCBpcyB0aGUNCiAgICAgICAgICAgIC8vIGZhc3Rlc3QgYW5kIGxlYXN0IHJlc291cmNlIGludGVuc2l2ZSB3YXkgSSBjb3VsZCB0aGluayBvZiBjbG9uaW5nDQogICAgICAgICAgICAvLyB0aGUgdGFibGUgd2l0aCBqdXN0IGEgc2luZ2xlIGhlYWRlciBjZWxsIGluIGl0Lg0KICAgICAgICAgICAgdGhpcy5kb20uZHJhZyA9ICQob3JpZ1RhYmxlLmNsb25lTm9kZShmYWxzZSkpDQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCAnRFRDUl9jbG9uZWRUYWJsZScgKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmQoDQogICAgICAgICAgICAgICAgICAgICQob3JpZ1RoZWFkLmNsb25lTm9kZShmYWxzZSkpLmFwcGVuZCgNCiAgICAgICAgICAgICAgICAgICAgICAgICQob3JpZ1RyLmNsb25lTm9kZShmYWxzZSkpLmFwcGVuZCgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9uZUNlbGxbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAuY3NzKCB7DQogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgICAgICAgICB0b3A6IDAsDQogICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsDQogICAgICAgICAgICAgICAgICAgIHdpZHRoOiAkKG9yaWdDZWxsKS5vdXRlcldpZHRoKCksDQogICAgICAgICAgICAgICAgICAgIGhlaWdodDogJChvcmlnQ2VsbCkub3V0ZXJIZWlnaHQoKQ0KICAgICAgICAgICAgICAgIH0gKQ0KICAgICAgICAgICAgICAgIC5hcHBlbmRUbyggJ2JvZHknICk7DQoNCiAgICAgICAgICAgIHRoaXMuZG9tLnBvaW50ZXIgPSAkKCc8ZGl2PjwvZGl2PicpDQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCAnRFRDUl9wb2ludGVyJyApDQogICAgICAgICAgICAgICAgLmNzcyggew0KICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICAgICAgICAgdG9wOiBzY3JvbGxpbmcgPw0KICAgICAgICAgICAgICAgICAgICAgICAgJCgnZGl2LmRhdGFUYWJsZXNfc2Nyb2xsJywgdGhpcy5zLmR0Lm5UYWJsZVdyYXBwZXIpLm9mZnNldCgpLnRvcCA6DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMucy5kdC5uVGFibGUpLm9mZnNldCgpLnRvcCwNCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IDogc2Nyb2xsaW5nID8NCiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Rpdi5kYXRhVGFibGVzX3Njcm9sbCcsIHRoaXMucy5kdC5uVGFibGVXcmFwcGVyKS5oZWlnaHQoKSA6DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMucy5kdC5uVGFibGUpLmhlaWdodCgpDQogICAgICAgICAgICAgICAgfSApDQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKCAnYm9keScgKTsNCiAgICAgICAgfSwNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBZGQgYSBkYXRhIGF0dHJpYnV0ZSB0byB0aGUgY29sdW1uIGhlYWRlcnMsIHNvIHdlIGtub3cgdGhlIGluZGV4IG9mDQogICAgICAgICAqIHRoZSByb3cgdG8gYmUgcmVvcmRlcmVkLiBUaGlzIGFsbG93cyBmYXN0IGRldGVjdGlvbiBvZiB0aGUgaW5kZXgsIGFuZA0KICAgICAgICAgKiBmb3IgdGhpcyBwbHVnLWluIHRvIHdvcmsgd2l0aCBGaXhlZEhlYWRlciB3aGljaCBjbG9uZXMgdGhlIG5vZGVzLg0KICAgICAgICAgKiAgQHByaXZhdGUNCiAgICAgICAgICovDQogICAgICAgICJfZm5TZXRDb2x1bW5JbmRleGVzIjogZnVuY3Rpb24gKCkNCiAgICAgICAgew0KICAgICAgICAgICAgJC5lYWNoKCB0aGlzLnMuZHQuYW9Db2x1bW5zLCBmdW5jdGlvbiAoaSwgY29sdW1uKSB7DQogICAgICAgICAgICAgICAgJChjb2x1bW4ublRoKS5hdHRyKCdkYXRhLWNvbHVtbi1pbmRleCcsIGkpOw0KICAgICAgICAgICAgfSApOw0KICAgICAgICB9LA0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEdldCBjdXJzb3IgcG9zaXRpb24gcmVnYXJkbGVzcyBvZiBtb3VzZSBvciB0b3VjaCBpbnB1dA0KICAgICAgICAgKiBAcGFyYW0gIHtFdmVudH0gIGUgICAgalF1ZXJ5IEV2ZW50DQogICAgICAgICAqIEBwYXJhbSAge3N0cmluZ30gcHJvcCBQcm9wZXJ0eSB0byBnZXQNCiAgICAgICAgICogQHJldHVybiB7bnVtYmVyfSAgICAgIFZhbHVlDQogICAgICAgICAqLw0KICAgICAgICBfZm5DdXJzb3JQb3NpdGlvbjogZnVuY3Rpb24gKCBlLCBwcm9wICkgew0KICAgICAgICAgICAgaWYgKCBlLnR5cGUuaW5kZXhPZigndG91Y2gnKSAhPT0gLTEgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdWyBwcm9wIF07DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZVsgcHJvcCBdOw0KICAgICAgICB9DQogICAgfSApOw0KDQoNCg0KDQoNCiAgICAvKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoNCiAgICAgKiBTdGF0aWMgcGFyYW1ldGVycw0KICAgICAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKi8NCg0KDQogICAgLyoqDQogICAgICogQ29sUmVvcmRlciBkZWZhdWx0IHNldHRpbmdzIGZvciBpbml0aWFsaXNhdGlvbg0KICAgICAqICBAbmFtZXNwYWNlDQogICAgICogIEBzdGF0aWMNCiAgICAgKi8NCiAgICBDb2xSZW9yZGVyLmRlZmF1bHRzID0gew0KICAgICAgICAvKioNCiAgICAgICAgICogUHJlZGVmaW5lZCBvcmRlcmluZyBmb3IgdGhlIGNvbHVtbnMgdGhhdCB3aWxsIGJlIGFwcGxpZWQgYXV0b21hdGljYWxseQ0KICAgICAgICAgKiBvbiBpbml0aWFsaXNhdGlvbi4gSWYgbm90IHNwZWNpZmllZCB0aGVuIHRoZSBvcmRlciB0aGF0IHRoZSBjb2x1bW5zIGFyZQ0KICAgICAgICAgKiBmb3VuZCB0byBiZSBpbiB0aGUgSFRNTCBpcyB0aGUgb3JkZXIgdXNlZC4NCiAgICAgICAgICogIEB0eXBlIGFycmF5DQogICAgICAgICAqICBAZGVmYXVsdCBudWxsDQogICAgICAgICAqICBAc3RhdGljDQogICAgICAgICAqLw0KICAgICAgICBhaU9yZGVyOiBudWxsLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZWRyYXcgdGhlIHRhYmxlJ3MgY29sdW1uIG9yZGVyaW5nIGFzIHRoZSBlbmQgdXNlciBkcmF3cyB0aGUgY29sdW1uDQogICAgICAgICAqIChgdHJ1ZWApIG9yIHdhaXQgdW50aWwgdGhlIG1vdXNlIGlzIHJlbGVhc2VkIChgZmFsc2VgIC0gZGVmYXVsdCkuIE5vdGUNCiAgICAgICAgICogdGhhdCB0aGlzIHdpbGwgcGVyZm9ybSBhIHJlZHJhdyBvbiBlYWNoIHJlb3JkZXJpbmcsIHdoaWNoIGludm9sdmVzIGFuDQogICAgICAgICAqIEFqYXggcmVxdWVzdCBlYWNoIHRpbWUgaWYgeW91IGFyZSB1c2luZyBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIGluDQogICAgICAgICAqIERhdGFUYWJsZXMuDQogICAgICAgICAqICBAdHlwZSBib29sZWFuDQogICAgICAgICAqICBAZGVmYXVsdCBmYWxzZQ0KICAgICAgICAgKiAgQHN0YXRpYw0KICAgICAgICAgKi8NCiAgICAgICAgYlJlYWx0aW1lOiB0cnVlLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbmRpY2F0ZSBob3cgbWFueSBjb2x1bW5zIHNob3VsZCBiZSBmaXhlZCBpbiBwb3NpdGlvbiAoY291bnRpbmcgZnJvbSB0aGUNCiAgICAgICAgICogbGVmdCkuIFRoaXMgd2lsbCB0eXBpY2FsbHkgYmUgMSBpZiB1c2VkLCBidXQgY2FuIGJlIGFzIGhpZ2ggYXMgeW91IGxpa2UuDQogICAgICAgICAqICBAdHlwZSBpbnQNCiAgICAgICAgICogIEBkZWZhdWx0IDANCiAgICAgICAgICogIEBzdGF0aWMNCiAgICAgICAgICovDQogICAgICAgIGlGaXhlZENvbHVtbnNMZWZ0OiAwLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBcyBgaUZpeGVkQ29sdW1uc1JpZ2h0YCBidXQgY291bnRpbmcgZnJvbSB0aGUgcmlnaHQuDQogICAgICAgICAqICBAdHlwZSBpbnQNCiAgICAgICAgICogIEBkZWZhdWx0IDANCiAgICAgICAgICogIEBzdGF0aWMNCiAgICAgICAgICovDQogICAgICAgIGlGaXhlZENvbHVtbnNSaWdodDogMCwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBmaXJlZCB3aGVuIGNvbHVtbnMgYXJlIHJlb3JkZXJlZC4gVGhlIGBjb2x1bW4tDQogICAgICAgICAqIHJlb3JkZXJgIGV2ZW50IGlzIHByZWZlcnJlZCBvdmVyIHRoaXMgY2FsbGJhY2sNCiAgICAgICAgICogIEB0eXBlIGZ1bmN0aW9uKCk6dm9pZA0KICAgICAgICAgKiAgQGRlZmF1bHQgbnVsbA0KICAgICAgICAgKiAgQHN0YXRpYw0KICAgICAgICAgKi8NCiAgICAgICAgZm5SZW9yZGVyQ2FsbGJhY2s6IG51bGwNCiAgICB9Ow0KDQoNCg0KICAgIC8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKg0KICAgICAqIENvbnN0YW50cw0KICAgICAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKi8NCg0KICAgIC8qKg0KICAgICAqIENvbFJlb3JkZXIgdmVyc2lvbg0KICAgICAqICBAY29uc3RhbnQgIHZlcnNpb24NCiAgICAgKiAgQHR5cGUgICAgICBTdHJpbmcNCiAgICAgKiAgQGRlZmF1bHQgICBBcyBjb2RlDQogICAgICovDQogICAgQ29sUmVvcmRlci52ZXJzaW9uID0gIjEuMy4zIjsNCg0KDQoNCiAgICAvKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoNCiAgICAgKiBEYXRhVGFibGVzIGludGVyZmFjZXMNCiAgICAgKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovDQoNCi8vIEV4cG9zZQ0KICAgICQuZm4uZGF0YVRhYmxlLkNvbFJlb3JkZXIgPSBDb2xSZW9yZGVyOw0KICAgICQuZm4uRGF0YVRhYmxlLkNvbFJlb3JkZXIgPSBDb2xSZW9yZGVyOw0KDQoNCi8vIFJlZ2lzdGVyIGEgbmV3IGZlYXR1cmUgd2l0aCBEYXRhVGFibGVzDQogICAgaWYgKCB0eXBlb2YgJC5mbi5kYXRhVGFibGUgPT0gImZ1bmN0aW9uIiAmJg0KICAgICAgICB0eXBlb2YgJC5mbi5kYXRhVGFibGVFeHQuZm5WZXJzaW9uQ2hlY2sgPT0gImZ1bmN0aW9uIiAmJg0KICAgICAgICAkLmZuLmRhdGFUYWJsZUV4dC5mblZlcnNpb25DaGVjaygnMS4xMC44JykgKQ0KICAgIHsNCiAgICAgICAgJC5mbi5kYXRhVGFibGVFeHQuYW9GZWF0dXJlcy5wdXNoKCB7DQogICAgICAgICAgICAiZm5Jbml0IjogZnVuY3Rpb24oIHNldHRpbmdzICkgew0KICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9IHNldHRpbmdzLm9JbnN0YW5jZTsNCg0KICAgICAgICAgICAgICAgIGlmICggISBzZXR0aW5ncy5fY29sUmVvcmRlciApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGR0SW5pdCA9IHNldHRpbmdzLm9Jbml0Ow0KICAgICAgICAgICAgICAgICAgICB2YXIgb3B0cyA9IGR0SW5pdC5jb2xSZW9yZGVyIHx8IGR0SW5pdC5vQ29sUmVvcmRlciB8fCB7fTsNCg0KICAgICAgICAgICAgICAgICAgICBuZXcgQ29sUmVvcmRlciggc2V0dGluZ3MsIG9wdHMgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRhYmxlLm9BcGkuX2ZuTG9nKCBzZXR0aW5ncywgMSwgIkNvbFJlb3JkZXIgYXR0ZW1wdGVkIHRvIGluaXRpYWxpc2UgdHdpY2UuIElnbm9yaW5nIHNlY29uZCIgKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgLyogTm8gbm9kZSBmb3IgRGF0YVRhYmxlcyB0byBpbnNlcnQgKi8NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAiY0ZlYXR1cmUiOiAiUiIsDQogICAgICAgICAgICAic0ZlYXR1cmUiOiAiQ29sUmVvcmRlciINCiAgICAgICAgfSApOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgYWxlcnQoICJXYXJuaW5nOiBDb2xSZW9yZGVyIHJlcXVpcmVzIERhdGFUYWJsZXMgMS4xMC44IG9yIGdyZWF0ZXIgLSB3d3cuZGF0YXRhYmxlcy5uZXQvZG93bmxvYWQiKTsNCiAgICB9DQoNCg0KLy8gQXR0YWNoIGEgbGlzdGVuZXIgdG8gdGhlIGRvY3VtZW50IHdoaWNoIGxpc3RlbnMgZm9yIERhdGFUYWJsZXMgaW5pdGlhbGlzYXRpb24NCi8vIGV2ZW50cyBzbyB3ZSBjYW4gYXV0b21hdGljYWxseSBpbml0aWFsaXNlDQogICAgJChkb2N1bWVudCkub24oICdwcmVJbml0LmR0LmNvbFJlb3JkZXInLCBmdW5jdGlvbiAoZSwgc2V0dGluZ3MpIHsNCiAgICAgICAgaWYgKCBlLm5hbWVzcGFjZSAhPT0gJ2R0JyApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBpbml0ID0gc2V0dGluZ3Mub0luaXQuY29sUmVvcmRlcjsNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gRGF0YVRhYmxlLmRlZmF1bHRzLmNvbFJlb3JkZXI7DQoNCiAgICAgICAgaWYgKCBpbml0IHx8IGRlZmF1bHRzICkgew0KICAgICAgICAgICAgdmFyIG9wdHMgPSAkLmV4dGVuZCgge30sIGluaXQsIGRlZmF1bHRzICk7DQoNCiAgICAgICAgICAgIGlmICggaW5pdCAhPT0gZmFsc2UgKSB7DQogICAgICAgICAgICAgICAgbmV3IENvbFJlb3JkZXIoIHNldHRpbmdzLCBvcHRzICApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSApOw0KDQoNCi8vIEFQSSBhdWdtZW50YXRpb24NCiAgICAkLmZuLmRhdGFUYWJsZS5BcGkucmVnaXN0ZXIoICdjb2xSZW9yZGVyLnJlc2V0KCknLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLml0ZXJhdG9yKCAndGFibGUnLCBmdW5jdGlvbiAoIGN0eCApIHsNCiAgICAgICAgICAgIGN0eC5fY29sUmVvcmRlci5mblJlc2V0KCk7DQogICAgICAgIH0gKTsNCiAgICB9ICk7DQoNCiAgICAkLmZuLmRhdGFUYWJsZS5BcGkucmVnaXN0ZXIoICdjb2xSZW9yZGVyLm9yZGVyKCknLCBmdW5jdGlvbiAoIHNldCwgb3JpZ2luYWwgKSB7DQogICAgICAgIGlmICggc2V0ICkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IoICd0YWJsZScsIGZ1bmN0aW9uICggY3R4ICkgew0KICAgICAgICAgICAgICAgIGN0eC5fY29sUmVvcmRlci5mbk9yZGVyKCBzZXQsIG9yaWdpbmFsICk7DQogICAgICAgICAgICB9ICk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpcy5jb250ZXh0Lmxlbmd0aCA/DQogICAgICAgICAgICB0aGlzLmNvbnRleHRbMF0uX2NvbFJlb3JkZXIuZm5PcmRlcigpIDoNCiAgICAgICAgICAgIG51bGw7DQogICAgfSApOw0KDQogICAgJC5mbi5kYXRhVGFibGUuQXBpLnJlZ2lzdGVyKCAnY29sUmVvcmRlci50cmFuc3Bvc2UoKScsIGZ1bmN0aW9uICggaWR4LCBkaXIgKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbnRleHQubGVuZ3RoICYmIHRoaXMuY29udGV4dFswXS5fY29sUmVvcmRlciA/DQogICAgICAgICAgICB0aGlzLmNvbnRleHRbMF0uX2NvbFJlb3JkZXIuZm5UcmFuc3Bvc2UoIGlkeCwgZGlyICkgOg0KICAgICAgICAgICAgaWR4Ow0KICAgIH0gKTsNCg0KDQogICAgcmV0dXJuIENvbFJlb3JkZXI7DQp9KSk7Ci8qIQ0KICAgQ29weXJpZ2h0IDIwMTctMjAxOSBTcHJ5TWVkaWEgTHRkLg0KDQogVGhpcyBzb3VyY2UgZmlsZSBpcyBmcmVlIHNvZnR3YXJlLCBhdmFpbGFibGUgdW5kZXIgdGhlIGZvbGxvd2luZyBsaWNlbnNlOg0KICAgTUlUIGxpY2Vuc2UgLSBodHRwOi8vZGF0YXRhYmxlcy5uZXQvbGljZW5zZS9taXQNCg0KIFRoaXMgc291cmNlIGZpbGUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0DQogV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkNCiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLg0KDQogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0DQogUm93R3JvdXAgMS4xLjENCiDCqTIwMTctMjAxOSBTcHJ5TWVkaWEgTHRkIC0gZGF0YXRhYmxlcy5uZXQvbGljZW5zZQ0KKi8NCnZhciAkanNjb21wPSRqc2NvbXB8fHt9OyRqc2NvbXAuc2NvcGU9e307JGpzY29tcC5maW5kSW50ZXJuYWw9ZnVuY3Rpb24oYSxkLGMpe2EgaW5zdGFuY2VvZiBTdHJpbmcmJihhPVN0cmluZyhhKSk7Zm9yKHZhciBlPWEubGVuZ3RoLGY9MDtmPGU7ZisrKXt2YXIgaD1hW2ZdO2lmKGQuY2FsbChjLGgsZixhKSlyZXR1cm57aTpmLHY6aH19cmV0dXJue2k6LTEsdjp2b2lkIDB9fTskanNjb21wLkFTU1VNRV9FUzU9ITE7JGpzY29tcC5BU1NVTUVfTk9fTkFUSVZFX01BUD0hMTskanNjb21wLkFTU1VNRV9OT19OQVRJVkVfU0VUPSExOyRqc2NvbXAuU0lNUExFX0ZST1VORF9QT0xZRklMTD0hMTsNCiRqc2NvbXAuZGVmaW5lUHJvcGVydHk9JGpzY29tcC5BU1NVTUVfRVM1fHwiZnVuY3Rpb24iPT10eXBlb2YgT2JqZWN0LmRlZmluZVByb3BlcnRpZXM/T2JqZWN0LmRlZmluZVByb3BlcnR5OmZ1bmN0aW9uKGEsZCxjKXthIT1BcnJheS5wcm90b3R5cGUmJmEhPU9iamVjdC5wcm90b3R5cGUmJihhW2RdPWMudmFsdWUpfTskanNjb21wLmdldEdsb2JhbD1mdW5jdGlvbihhKXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93PT09YT9hOiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsJiZudWxsIT1nbG9iYWw/Z2xvYmFsOmF9OyRqc2NvbXAuZ2xvYmFsPSRqc2NvbXAuZ2V0R2xvYmFsKHRoaXMpOw0KJGpzY29tcC5wb2x5ZmlsbD1mdW5jdGlvbihhLGQsYyxlKXtpZihkKXtjPSRqc2NvbXAuZ2xvYmFsO2E9YS5zcGxpdCgiLiIpO2ZvcihlPTA7ZTxhLmxlbmd0aC0xO2UrKyl7dmFyIGY9YVtlXTtmIGluIGN8fChjW2ZdPXt9KTtjPWNbZl19YT1hW2EubGVuZ3RoLTFdO2U9Y1thXTtkPWQoZSk7ZCE9ZSYmbnVsbCE9ZCYmJGpzY29tcC5kZWZpbmVQcm9wZXJ0eShjLGEse2NvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTpkfSl9fTskanNjb21wLnBvbHlmaWxsKCJBcnJheS5wcm90b3R5cGUuZmluZCIsZnVuY3Rpb24oYSl7cmV0dXJuIGE/YTpmdW5jdGlvbihhLGMpe3JldHVybiAkanNjb21wLmZpbmRJbnRlcm5hbCh0aGlzLGEsYykudn19LCJlczYiLCJlczMiKTsNCihmdW5jdGlvbihhKXsiZnVuY3Rpb24iPT09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoWyJqcXVlcnkiLCJkYXRhdGFibGVzLm5ldCJdLGZ1bmN0aW9uKGQpe3JldHVybiBhKGQsd2luZG93LGRvY3VtZW50KX0pOiJvYmplY3QiPT09dHlwZW9mIGV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9ZnVuY3Rpb24oZCxjKXtkfHwoZD13aW5kb3cpO2MmJmMuZm4uZGF0YVRhYmxlfHwoYz1yZXF1aXJlKCJkYXRhdGFibGVzLm5ldCIpKGQsYykuJCk7cmV0dXJuIGEoYyxkLGQuZG9jdW1lbnQpfTphKGpRdWVyeSx3aW5kb3csZG9jdW1lbnQpfSkoZnVuY3Rpb24oYSxkLGMsZSl7dmFyIGY9YS5mbi5kYXRhVGFibGUsaD1mdW5jdGlvbihiLGcpe2lmKCFmLnZlcnNpb25DaGVja3x8IWYudmVyc2lvbkNoZWNrKCIxLjEwLjgiKSl0aHJvdyJSb3dHcm91cCByZXF1aXJlcyBEYXRhVGFibGVzIDEuMTAuOCBvciBuZXdlciI7dGhpcy5jPWEuZXh0ZW5kKCEwLHt9LGYuZGVmYXVsdHMucm93R3JvdXAsDQpoLmRlZmF1bHRzLGcpO3RoaXMucz17ZHQ6bmV3IGYuQXBpKGIpfTt0aGlzLmRvbT17fTtiPXRoaXMucy5kdC5zZXR0aW5ncygpWzBdO2lmKGc9Yi5yb3dHcm91cClyZXR1cm4gZztiLnJvd0dyb3VwPXRoaXM7dGhpcy5fY29uc3RydWN0b3IoKX07YS5leHRlbmQoaC5wcm90b3R5cGUse2RhdGFTcmM6ZnVuY3Rpb24oYil7aWYoYj09PWUpcmV0dXJuIHRoaXMuYy5kYXRhU3JjO3ZhciBnPXRoaXMucy5kdDt0aGlzLmMuZGF0YVNyYz1iO2EoZy50YWJsZSgpLm5vZGUoKSkudHJpZ2dlckhhbmRsZXIoInJvd2dyb3VwLWRhdGFzcmMuZHQiLFtnLGJdKTtyZXR1cm4gdGhpc30sZGlzYWJsZTpmdW5jdGlvbigpe3RoaXMuYy5lbmFibGU9ITE7cmV0dXJuIHRoaXN9LGVuYWJsZTpmdW5jdGlvbihiKXtpZighMT09PWIpcmV0dXJuIHRoaXMuZGlzYWJsZSgpO3RoaXMuYy5lbmFibGU9ITA7cmV0dXJuIHRoaXN9LF9jb25zdHJ1Y3RvcjpmdW5jdGlvbigpe3ZhciBiPXRoaXMsYT10aGlzLnMuZHQ7YS5vbigiZHJhdy5kdHJnIiwNCmZ1bmN0aW9uKCl7Yi5jLmVuYWJsZSYmYi5fZHJhdygpfSk7YS5vbigiY29sdW1uLXZpc2liaWxpdHkuZHQuZHRyZyByZXNwb25zaXZlLXJlc2l6ZS5kdC5kdHJnIixmdW5jdGlvbigpe2IuX2FkanVzdENvbHNwYW4oKX0pO2Eub24oImRlc3Ryb3kiLGZ1bmN0aW9uKCl7YS5vZmYoIi5kdHJnIil9KTthLm9uKCJyZXNwb25zaXZlLXJlc2l6ZS5kdCIsZnVuY3Rpb24oKXtiLl9hZGp1c3RDb2xzcGFuKCl9KX0sX2FkanVzdENvbHNwYW46ZnVuY3Rpb24oKXthKCJ0ci4iK3RoaXMuYy5jbGFzc05hbWUsdGhpcy5zLmR0LnRhYmxlKCkuYm9keSgpKS5maW5kKCJ0ZCIpLmF0dHIoImNvbHNwYW4iLHRoaXMuX2NvbHNwYW4oKSl9LF9jb2xzcGFuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucy5kdC5jb2x1bW5zKCkudmlzaWJsZSgpLnJlZHVjZShmdW5jdGlvbihiLGEpe3JldHVybiBiK2F9LDApfSxfZHJhdzpmdW5jdGlvbigpe3ZhciBiPXRoaXMuX2dyb3VwKDAsdGhpcy5zLmR0LnJvd3Moe3BhZ2U6ImN1cnJlbnQifSkuaW5kZXhlcygpKTsNCnRoaXMuX2dyb3VwRGlzcGxheSgwLGIpfSxfZ3JvdXA6ZnVuY3Rpb24oYixnKXtmb3IodmFyIGM9YS5pc0FycmF5KHRoaXMuYy5kYXRhU3JjKT90aGlzLmMuZGF0YVNyYzpbdGhpcy5jLmRhdGFTcmNdLGQ9Zi5leHQub0FwaS5fZm5HZXRPYmplY3REYXRhRm4oY1tiXSksaD10aGlzLnMuZHQsbCxuLG09W10saz0wLHA9Zy5sZW5ndGg7azxwO2srKyl7dmFyIHE9Z1trXTtsPWgucm93KHEpLmRhdGEoKTtsPWQobCk7aWYobnVsbD09PWx8fGw9PT1lKWw9dGhpcy5jLmVtcHR5RGF0YUdyb3VwO2lmKG49PT1lfHxsIT09biltLnB1c2goe2RhdGFQb2ludDpsLHJvd3M6W119KSxuPWw7bVttLmxlbmd0aC0xXS5yb3dzLnB1c2gocSl9aWYoY1tiKzFdIT09ZSlmb3Ioaz0wLHA9bS5sZW5ndGg7azxwO2srKyltW2tdLmNoaWxkcmVuPXRoaXMuX2dyb3VwKGIrMSxtW2tdLnJvd3MpO3JldHVybiBtfSxfZ3JvdXBEaXNwbGF5OmZ1bmN0aW9uKGIsYSl7Zm9yKHZhciBjPXRoaXMucy5kdCxnLGQ9MCxmPQ0KYS5sZW5ndGg7ZDxmO2QrKyl7dmFyIGU9YVtkXSxoPWUuZGF0YVBvaW50LGs9ZS5yb3dzO3RoaXMuYy5zdGFydFJlbmRlciYmKGc9dGhpcy5jLnN0YXJ0UmVuZGVyLmNhbGwodGhpcyxjLnJvd3MoayksaCxiKSwoZz10aGlzLl9yb3dXcmFwKGcsdGhpcy5jLnN0YXJ0Q2xhc3NOYW1lLGIpKSYmZy5pbnNlcnRCZWZvcmUoYy5yb3coa1swXSkubm9kZSgpKSk7dGhpcy5jLmVuZFJlbmRlciYmKGc9dGhpcy5jLmVuZFJlbmRlci5jYWxsKHRoaXMsYy5yb3dzKGspLGgsYiksKGc9dGhpcy5fcm93V3JhcChnLHRoaXMuYy5lbmRDbGFzc05hbWUsYikpJiZnLmluc2VydEFmdGVyKGMucm93KGtbay5sZW5ndGgtMV0pLm5vZGUoKSkpO2UuY2hpbGRyZW4mJnRoaXMuX2dyb3VwRGlzcGxheShiKzEsZS5jaGlsZHJlbil9fSxfcm93V3JhcDpmdW5jdGlvbihiLGcsYyl7aWYobnVsbD09PWJ8fCIiPT09YiliPXRoaXMuYy5lbXB0eURhdGFHcm91cDtyZXR1cm4gYj09PWV8fG51bGw9PT1iP251bGw6KCJvYmplY3QiPT09DQp0eXBlb2YgYiYmYi5ub2RlTmFtZSYmInRyIj09PWIubm9kZU5hbWUudG9Mb3dlckNhc2UoKT9hKGIpOmIgaW5zdGFuY2VvZiBhJiZiLmxlbmd0aCYmInRyIj09PWJbMF0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKT9iOmEoIjx0ci8+IikuYXBwZW5kKGEoIjx0ZC8+IikuYXR0cigiY29sc3BhbiIsdGhpcy5fY29sc3BhbigpKS5hcHBlbmQoYikpKS5hZGRDbGFzcyh0aGlzLmMuY2xhc3NOYW1lKS5hZGRDbGFzcyhnKS5hZGRDbGFzcygiZHRyZy1sZXZlbC0iK2MpfX0pO2guZGVmYXVsdHM9e2NsYXNzTmFtZToiZHRyZy1ncm91cCIsZGF0YVNyYzowLGVtcHR5RGF0YUdyb3VwOiJObyBncm91cCIsZW5hYmxlOiEwLGVuZENsYXNzTmFtZToiZHRyZy1lbmQiLGVuZFJlbmRlcjpudWxsLHN0YXJ0Q2xhc3NOYW1lOiJkdHJnLXN0YXJ0IixzdGFydFJlbmRlcjpmdW5jdGlvbihiLGEpe3JldHVybiBhfX07aC52ZXJzaW9uPSIxLjEuMSI7YS5mbi5kYXRhVGFibGUuUm93R3JvdXA9aDthLmZuLkRhdGFUYWJsZS5Sb3dHcm91cD0NCmg7Zi5BcGkucmVnaXN0ZXIoInJvd0dyb3VwKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KTtmLkFwaS5yZWdpc3Rlcigicm93R3JvdXAoKS5kaXNhYmxlKCkiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihhKXthLnJvd0dyb3VwJiZhLnJvd0dyb3VwLmVuYWJsZSghMSl9KX0pO2YuQXBpLnJlZ2lzdGVyKCJyb3dHcm91cCgpLmVuYWJsZSgpIixmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5pdGVyYXRvcigidGFibGUiLGZ1bmN0aW9uKGIpe2Iucm93R3JvdXAmJmIucm93R3JvdXAuZW5hYmxlKGE9PT1lPyEwOmEpfSl9KTtmLkFwaS5yZWdpc3Rlcigicm93R3JvdXAoKS5kYXRhU3JjKCkiLGZ1bmN0aW9uKGEpe3JldHVybiBhPT09ZT90aGlzLmNvbnRleHRbMF0ucm93R3JvdXAuZGF0YVNyYygpOnRoaXMuaXRlcmF0b3IoInRhYmxlIixmdW5jdGlvbihiKXtiLnJvd0dyb3VwJiZiLnJvd0dyb3VwLmRhdGFTcmMoYSl9KX0pO2EoYykub24oInByZUluaXQuZHQuZHRyZyIsDQpmdW5jdGlvbihiLGMsZCl7ImR0Ij09PWIubmFtZXNwYWNlJiYoYj1jLm9Jbml0LnJvd0dyb3VwLGQ9Zi5kZWZhdWx0cy5yb3dHcm91cCxifHxkKSYmKGQ9YS5leHRlbmQoe30sZCxiKSwhMSE9PWImJm5ldyBoKGMsZCkpfSk7cmV0dXJuIGh9KTsNCgp2YXIgRm9ybVN0YXRlID0gZnVuY3Rpb24gKGZvcm1PYmosIGtleSkgewogICAgdmFyIGlucHV0cyA9ICdpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCc7CiAgICB2YXIgZXhjbHVkZWQgPSAnaW5wdXRbdHlwZT0iZmlsZSJdLCBpbnB1dFt0eXBlPSJoaWRkZW4iXSwgaW5wdXRbdHlwZT0ic3VibWl0Il0sIGlucHV0W3R5cGU9InJlc2V0Il0nOwogICAgdmFyIHBlcnNpc3RpbmdLZXkgPSAnLnBlcnNpc3RpbmcnOwogICAgdmFyIGZvcm1FbGVtZW50OwogICAgdmFyIHN0b3JhZ2VLZXk7CiAgICB2YXIgc29ydEVsZW1lbnRzQmFzZWRPbkV2ZW50cyA9IGZ1bmN0aW9uIChlbDEsIGVsMikgewogICAgICAgIHZhciAkZXZlbnRzQSA9ICQuX2RhdGEoZWwxLCAiZXZlbnRzIik7CiAgICAgICAgdmFyICRldmVudHNCID0gJC5fZGF0YShlbDIsICJldmVudHMiKTsKICAgICAgICB2YXIgZXZlbnRzQUNvdW50ID0gKHR5cGVvZiAkZXZlbnRzQSAhPT0gInVuZGVmaW5lZCIpID8gT2JqZWN0LmtleXMoJGV2ZW50c0EpLmxlbmd0aCA6IDA7CiAgICAgICAgdmFyIGV2ZW50c0JDb3VudCA9ICh0eXBlb2YgJGV2ZW50c0IgIT09ICJ1bmRlZmluZWQiKSA/IE9iamVjdC5rZXlzKCRldmVudHNCKS5sZW5ndGggOiAwOwogICAgICAgIGlmIChldmVudHNBQ291bnQgPT09IGV2ZW50c0JDb3VudCkgcmV0dXJuIDA7CiAgICAgICAgcmV0dXJuIGV2ZW50c0FDb3VudCA+IGV2ZW50c0JDb3VudCA/IDEgOiAtMTsKICAgIH07CgogICAgdGhpcy5nZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaXRlbXMgPSB7fTsKICAgICAgICAkKGZvcm1FbGVtZW50KS5maW5kKGlucHV0cykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBlbGVtID0gJCh0aGlzKTsKICAgICAgICAgICAgaWYgKGVsZW0uaXMoZXhjbHVkZWQpIHx8IGlzRmllbGRIaWRkZW4oZWxlbSwgZm9ybUVsZW1lbnQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHBhdGggPSBnZXRQYXRoKGVsZW0pOwogICAgICAgICAgICBpdGVtc1twYXRoXSA9IGdldFZhbChlbGVtKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoaXRlbXMpOwogICAgfTsKCiAgICB2YXIgZmluZEZpZWxkUGFyZW50ID0gZnVuY3Rpb24oZmllbGQsIGZvcm0pIHsKICAgICAgICB2YXIgaWQgPSBmaWVsZC5wYXJlbnQoKS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKGlkKSkgewogICAgICAgICAgICByZXR1cm4gZm9ybS5maW5kKCcjJyArIGlkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwoKICAgIHZhciBpc0ZpZWxkSGlkZGVuID0gZnVuY3Rpb24oZmllbGQsIGZvcm0pIHsKICAgICAgICB2YXIgcGFyZW50ID0gZmluZEZpZWxkUGFyZW50KGZpZWxkLCBmb3JtKTsKICAgICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgICAgIHJldHVybiBwYXJlbnQuaGFzQ2xhc3MoJ2hpZGUnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKCiAgICB0aGlzLmxvYWRWaXNpYmlsaXR5U3RhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZGF0YSA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oc3RvcmFnZUtleSk7CiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgdmFyIGl0ZW1zID0gSlNPTi5wYXJzZShkYXRhKTsKICAgICAgICAgICAgJChmb3JtRWxlbWVudCkuZmluZChpbnB1dHMpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHZhciBlbGVtID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbS5pcyhleGNsdWRlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IGdldFBhdGgoZWxlbSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IGZpbmRGaWVsZFBhcmVudChlbGVtLCBmb3JtRWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGggJiYgcGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXRlbXMuaGFzT3duUHJvcGVydHkocGF0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50Lmhhc0NsYXNzKCdoaWRlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRWxlbWVudC5maW5kKCIuIiArIHBhcmVudC5hdHRyKCdpZCcpKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5oYXNDbGFzcygnaGlkZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVsZW1lbnQuZmluZCgiLiIgKyBwYXJlbnQuYXR0cignaWQnKSkucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciB3aGlsZSBsb2FkaW5nIGZvcm0gc3RhdGUiLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIHRoaXMuc2F2ZVN0YXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUtleSwgdGhpcy5nZXRTdGF0ZSgpKTsKICAgIH07CgogICAgdGhpcy5jbGVhclN0YXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oc3RvcmFnZUtleSk7CiAgICB9OwoKICAgIHRoaXMuY2xlYXJTZWxlY3RpdmVseSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgc3RvcmVkVmFsdWUgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VLZXkpOwogICAgICAgIGlmIChzdG9yZWRWYWx1ZSkgewogICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2Uoc3RvcmVkVmFsdWUpOwogICAgICAgICAgICAkLmVhY2goZGF0YSwgZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZS5pbmRleE9mKHBlcnNpc3RpbmdLZXkpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgIH0KICAgIH07CgogICAgdGhpcy5sb2FkU3RhdGUgPSBmdW5jdGlvbiAocGFnZVR5cGUpIHsKICAgICAgICB2YXIgZGF0YSA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oc3RvcmFnZUtleSk7CiAgICAgICAgdGhpcy5sb2FkU3RhdGVGcm9tKGRhdGEscGFnZVR5cGUpOwogICAgfTsKCiAgICB0aGlzLmxvYWRTdGF0ZUZyb20gPSBmdW5jdGlvbiAoZGF0YSAscGFnZVR5cGUpIHsKICAgICAgICBpZiAoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiBkYXRhIHx8ICFkYXRhKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGl0ZW1zID0gSlNPTi5wYXJzZShkYXRhKTsKICAgICAgICAkKGZvcm1FbGVtZW50KS5maW5kKGlucHV0cykuc29ydChzb3J0RWxlbWVudHNCYXNlZE9uRXZlbnRzKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCQodGhpcykuaXMoZXhjbHVkZWQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0VmFsKCQodGhpcyksIGl0ZW1zLCBwYWdlVHlwZSkKICAgICAgICB9KTsKICAgIH07CgogICAgdGhpcy5jb25zdHJ1Y3QgPSBmdW5jdGlvbiAoZm9ybU9iaiwga2V5KSB7CiAgICAgICAgZm9ybUVsZW1lbnQgPSBmb3JtT2JqOwogICAgICAgIHN0b3JhZ2VLZXkgPSBrZXk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKICAgIHZhciBnZXRQYXRoID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICBpZiAoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiBlbGVtKSB7CiAgICAgICAgICAgIHJldHVybiBlbGVtOwogICAgICAgIH0KICAgICAgICBpZiAoZWxlbS5sZW5ndGggIT09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgcGF0aCA9ICcnCiAgICAgICAgICAgICwgZnVsbFBhdGggPSBlbGVtLmlzKCdpbnB1dFt0eXBlPWNoZWNrYm94XScpCiAgICAgICAgICAgICwgbm9kZSA9IGVsZW0KICAgICAgICAgICAgLCBwZXJtYW5lbnQgPSAhIWVsZW0uZGF0YSgnaXMtcGVybWFuZW50Jyk7CgogICAgICAgIHdoaWxlIChub2RlLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgcmVhbE5vZGUgPSBub2RlWzBdCiAgICAgICAgICAgICAgICAsIG5hbWUgPSByZWFsTm9kZS5ub2RlTmFtZTsKCiAgICAgICAgICAgIGlmICghbmFtZSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgogICAgICAgICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnQoKQogICAgICAgICAgICAgICAgLCBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbihuYW1lKTsKCiAgICAgICAgICAgIC8vIGRvbid0IG5lZWQgdG8gcG9sbHV0ZSBwYXRoIHdpdGggc2VsZWN0LCBmaWVsZHNldHMsIGRpdnMgYW5kIG90aGVyIG5vaXN5IGVsZW1lbnRzLAogICAgICAgICAgICAvLyBleGVwdCBmb3IgY2hlY2tib3hlcyB0aGF0IG5lZWQgZXhhY3QgcGF0aCwgY3V6IGhhdmUgc2FtZSBuYW1lIGFuZCBzb21ldGltZXMgc2FtZSBlcSgpIQogICAgICAgICAgICBpZiAoISQocmVhbE5vZGUpLmlzKCdmb3JtLCBpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScpICYmICFmdWxsUGF0aCkgewogICAgICAgICAgICAgICAgbm9kZSA9IHBhcmVudDsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzZXQgaW5wdXQgdHlwZSBhcyBuYW1lICsgbmFtZSBhdHRyIGlmIGV4aXN0cwogICAgICAgICAgICBuYW1lICs9ICQocmVhbE5vZGUpLmF0dHIoJ25hbWUnKSA/ICcuJyArICQocmVhbE5vZGUpLmF0dHIoJ25hbWUnKSA6ICcnOwoKICAgICAgICAgICAgLy8gaWYgaGFzIHNpYmlsaW5ncywgZ2V0IGVxKCksIGV4ZXB0IGZvciByYWRpbyBidXR0b25zCiAgICAgICAgICAgIGlmIChzaWJsaW5ncy5sZW5ndGggPiAxICYmICEkKHJlYWxOb2RlKS5pcygnaW5wdXRbdHlwZT1yYWRpb10nKSkgewogICAgICAgICAgICAgICAgbmFtZSArPSAnOmVxKCcgKyBzaWJsaW5ncy5pbmRleChyZWFsTm9kZSkgKyAnKSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGF0aCA9IG5hbWUgKyAoIHBhdGggPyAnPicgKyBwYXRoIDogJycgKTsKICAgICAgICAgICAgLy8gYnJlYWsgb25jZSB3ZSBjYW1lIHVwIHRvIGZvcm06ZXEoeCksIG5vIG5lZWQgdG8gZ28gZnVydGhlcgogICAgICAgICAgICBpZiAoJ2Zvcm0nID09PSByZWFsTm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBub2RlID0gcGFyZW50OwogICAgICAgIH0KICAgICAgICBpZiAocGVybWFuZW50KSB7CiAgICAgICAgICAgIHBhdGggPSBwYXRoICsgcGVyc2lzdGluZ0tleQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGF0aDsKICAgIH07CgogICAgdmFyIGdldFZhbCA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgcmV0dXJuICFlbGVtLmlzKCdpbnB1dFt0eXBlPWNoZWNrYm94XScpID8gZWxlbS52YWwoKSA6ICggZWxlbS5wcm9wKCdjaGVja2VkJykgPyAnY2hlY2tlZCcgOiAndW5jaGVja2VkJyApOwogICAgfTsKCiAgICB2YXIgc2V0VmFsID0gZnVuY3Rpb24gKGVsZW0sIGl0ZW1zLCBwYWdlVHlwZSkgewogICAgICAgIGlmICghaXRlbXMpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgcGF0aCA9IGdldFBhdGgoZWxlbSk7CiAgICAgICAgdmFyIHN0b3JlZFZhbHVlID0gaXRlbXNbcGF0aF07CgogICAgICAgIGlmICgndW5kZWZpbmVkJyAhPT0gdHlwZW9mIHN0b3JlZFZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3RvcmVkVmFsdWUgPT0gJ2Jvb2xlYW4nICYmIHN0b3JlZFZhbHVlID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGlucHV0W3R5cGU9Y2hlY2tib3hdIGFuZCBpbnB1dFt0eXBlPXJhZGlvXSBoYXZlIGEgc3BlY2lhbCBjaGVja2VkIC8gdW5jaGVja2VkIGJlaGF2aW9yCiAgICAgICAgICAgIGlmIChlbGVtLmlzKCdpbnB1dFt0eXBlPXJhZGlvXSwgaW5wdXRbdHlwZT1jaGVja2JveF0nKSkgewoKICAgICAgICAgICAgICAgIC8vIGZvciBjaGVja2JveGVzIGFuZCByYWRpb3MKICAgICAgICAgICAgICAgIGlmICgnY2hlY2tlZCcgPT09IHN0b3JlZFZhbHVlIHx8IGVsZW0udmFsKCkgPT09IHN0b3JlZFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0ucHJvcCgnY2hlY2tlZCcsIHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IG5lZWRlZCBmb3IgY2hlY2tib3hlcwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgndW5jaGVja2VkJyA9PT0gc3RvcmVkVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBlbGVtLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSBlbGVtLnZhbCgpOwogICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlID09PSBzdG9yZWRWYWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGZvciBpbnB1dFt0eXBlPXRleHRdLCBzZWxlY3QgYW5kIHRleHRhcmVhLCBqdXN0IHNldCB2YWwoKQogICAgICAgICAgICBpZiAocGFnZVR5cGUgPT09IHB2aV9mb3Jtcy5kdXBsaWNhdGVfc2VhcmNoKSB7CiAgICAgICAgICAgICAgICBpZiAocGF0aC5pbmNsdWRlcyhwZXJzaXN0aW5nS2V5KSkgewogICAgICAgICAgICAgICAgICAgIGVsZW0udmFsKHN0b3JlZFZhbHVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWxlbS52YWwoc3RvcmVkVmFsdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB0cmlnZ2VyIGFuIGlucHV0IGV2ZW50IGdpdmVuIHRoZSB2YWx1ZSBoYXMgYmVlbiBjaGFuZ2VkCiAgICAgICAgICAgIGlmIChlbGVtLmlzKCdpbnB1dCcpKSB7CiAgICAgICAgICAgICAgICBlbGVtLnRyaWdnZXIoJ2lucHV0Jyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbS5pcygnc2VsZWN0JykpIHsKICAgICAgICAgICAgICAgIGVsZW0udHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gdHJpZ2dlciBjdXN0b20gdXNlciBmdW5jdGlvbiB3aGVuIGRhdGEgaXMgcmV0cmlldmVkCiAgICAgICAgfQogICAgfTsKICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdChmb3JtT2JqLCBrZXkpOwp9Owp2YXIgcHZpID0gcHZpIHx8IHt9OwoKcHZpLnJkbCA9IHB2aS5yZGwgfHwge307CgpwdmkucmRsLm1hbmFnZVJlcG9ydERpc3RyaWJ1dGlvbiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHJkTW9kYWwgPSAkKCIjcmVwb3J0RGVzdGluYXRpb25Nb2RhbCIpOwogICAgdmFyIHJkVGFibGUgPSAkKCcjcmVwb3J0RGlzdFRhYmxlJyk7CiAgICB2YXIgcmVwb3J0TG9nVGFibGUgPSBudWxsOwogICAgdmFyIHJkVGFibGVCb2R5ID0gcmRUYWJsZS5maW5kKCd0Ym9keScpOwogICAgdmFyIGUyYkRldGFpbERpdiA9IHJkTW9kYWwuZmluZCgiLmUyYlhNTERldGFpbCIpOwogICAgdmFyIGJhY2tSZExvZ0RCdG4gPSByZE1vZGFsLmZpbmQoIi5iYWNrLXRvLXJkLWxpc3RpbmciKTsKICAgIHZhciBsaXN0Q2xvc2VCdG4gPSByZE1vZGFsLmZpbmQoIi5yZC1saXN0aW5nLWNsb3NlLWJ0biIpOwogICAgdmFyIHJkTG9nSGVhZGVyID0gcmRNb2RhbC5maW5kKCdoNC5yZExvZycpOwogICAgdmFyIHJlc3BSRExYbWwgPSBbXTsKCiAgICB2YXIgc2hvd0UyQkFja1hNTERldGFpbCA9IGZ1bmN0aW9uICh4bWxEYXRhLCBmaWxlTmFtZSwgc2hvd0UyQikgewogICAgICAgIGlmIChzaG93RTJCKSB7CiAgICAgICAgICAgIHJkTW9kYWwuZmluZCgnaDQuZTJiWG1sJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKS5maW5kKCcuZTJiRmlsZU5hbWUnKS50ZXh0KCIgKCIgKyBmaWxlTmFtZSArICIpIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmRNb2RhbC5maW5kKCdoNC5hY2tYbWwnKS5yZW1vdmVDbGFzcygnaGlkZScpLmZpbmQoJy5hY2tGaWxlTmFtZScpLnRleHQoIiAoIiArIGZpbGVOYW1lICsgIikiKTsKICAgICAgICB9CiAgICAgICAgcmRUYWJsZS5hZGQocmRMb2dIZWFkZXIpLmFkZChsaXN0Q2xvc2VCdG4pLmFkZENsYXNzKCJoaWRlIik7CiAgICAgICAgYmFja1JkTG9nREJ0bi5hZGQoZTJiRGV0YWlsRGl2KS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgIGUyYkRldGFpbERpdi5maW5kKCcueG1sQ29udGVudCcpLnRleHQodmtiZWF1dGlmeS54bWwoeG1sRGF0YSkpOwogICAgfTsKCiAgICB2YXIgaGlkZUUyQkFja1hNTERldGFpbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcuZTJiWG1sLC5hY2tYbWwnKS5hZGQoYmFja1JkTG9nREJ0bikuYWRkKGUyYkRldGFpbERpdikuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICByZExvZ0hlYWRlci5hZGQocmRUYWJsZSkuYWRkKGxpc3RDbG9zZUJ0bikucmVtb3ZlQ2xhc3MoImhpZGUiKTsKICAgICAgICBlMmJEZXRhaWxEaXYuZmluZCgnLnhtbENvbnRlbnQnKS50ZXh0KCcnKTsKICAgIH07CgogICAgdmFyIHBvcHVsYXRlRGF0YUluVGFibGUgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgZGF0YSA9IF8uaXNVbmRlZmluZWQoZGF0YSkgPyBbXSA6IGRhdGE7CiAgICAgICAgcmVzcFJETFhtbCA9IGRhdGE7CiAgICAgICAgdmFyIGN1cnJHcm91cCA9IDA7CiAgICAgICAgdmFyIGdyb3VwMVZhbHVlID0gbnVsbDsKCiAgICAgICAgcmVwb3J0TG9nVGFibGUgPSAkKHJkVGFibGUpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgIGRlc3Ryb3k6IHRydWUsCiAgICAgICAgICAgIHBhZ2luZzogZmFsc2UsCiAgICAgICAgICAgIHNlYXJjaGluZzogZmFsc2UsCiAgICAgICAgICAgIGluZm86IGZhbHNlLAogICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICBvcmRlcjogWwogICAgICAgICAgICAgICAgWzEsICdhc2MnXSwKICAgICAgICAgICAgICAgIFsyLCAnYXNjJ10KICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3JkZXJGaXhlZDogWwogICAgICAgICAgICAgICAgWzEsICdhc2MnXSwKICAgICAgICAgICAgICAgIFsyLCAnYXNjJ10KICAgICAgICAgICAgXSwKICAgICAgICAgICAgY29sdW1uczogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGRhdGE6ICdpZHgnLAogICAgICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB2aS51dGlsLmVuY29kZVRvSFRNTChkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGRhdGE6ICdkZXN0aW5hdGlvbk5hbWUnLAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1yZC1kZXN0aW5hdGlvbi1uYW1lIiwKICAgICAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdmkudXRpbC5lbmNvZGVUb0hUTUwoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiAndHlwZScsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXJkLXR5cGUiLAogICAgICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB2aS51dGlsLmVuY29kZVRvSFRNTChkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGRhdGE6ICdmcm9tU3RhdGUnLAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1yZC1mcm9tLXN0YXRlIiwKICAgICAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdmkudXRpbC5lbmNvZGVUb0hUTUwoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiAndG9TdGF0ZScsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXJkLXRvLXN0YXRlIiwKICAgICAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdmkudXRpbC5lbmNvZGVUb0hUTUwoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiAndGltZVN0YW1wJywKICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtcmQtdGltZS1zdGFtcCIsCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHZpLnV0aWwuZW5jb2RlVG9IVE1MKGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZGF0YTogJ2ljc3JJZCcsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXJkLWljc3ItaWQiLAogICAgICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB2aS51dGlsLmVuY29kZVRvSFRNTChkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGNvbHVtbkRlZnM6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRzOiBbMSwgMl0sCiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IFswLCAzLCA0LCA1LCA2XSwKICAgICAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHJvd0dyb3VwOiB7CiAgICAgICAgICAgICAgICBkYXRhU3JjOiBbJ2Rlc3RpbmF0aW9uTmFtZScsICd0eXBlJ10sCiAgICAgICAgICAgICAgICBzdGFydFJlbmRlcjogZnVuY3Rpb24ocm93cywgZ3JvdXApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyckdyb3VwID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwMVZhbHVlID0gZ3JvdXA7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJHcm91cCsrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJHcm91cCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGg1PjxiPicgKyBncm91cDFWYWx1ZSArICc8L2I+PC9oNT4nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjcmVhdGVkUm93OiBmdW5jdGlvbih0ciwgcm93LCBpbmRleCkgewogICAgICAgICAgICAgICAgdmFyIHNob3dBdHRhY2htZW50cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdmFyIHNob3dFMkJPckFjayA9ICcnOwogICAgICAgICAgICAgICAgdmFyIHJvd0RhdGEgPSAnJzsKICAgICAgICAgICAgICAgIGlmIChyb3cudG9TdGF0ZUlkID09PSBwdmlfaWNzcl9zdGF0ZS5HRU5FUkFURUQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocm93LnR5cGUgPT09IHB2aV9pY3NyX3R5cGUuUERGKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dFMkJPckFjayA9IGdldE1lc3NhZ2UoImljc3JfdHlwZV9wZGYiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJvdy50eXBlID09PSBwdmlfaWNzcl90eXBlLkUyQl9FWFQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0UyQk9yQWNrID0gZ2V0TWVzc2FnZSgiaWNzcl90eXBlX2UyYiIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dFMkJPckFjayA9IGdldE1lc3NhZ2UoImljc3JfdHlwZV9lMmJfcjMiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gc2hvd0UyQk9yQWNrID0gKHJvdy50eXBlID09PSBwdmlfaWNzcl90eXBlLlBERiA/IGdldE1lc3NhZ2UoImljc3JfdHlwZV9wZGYiKSA6IGdldE1lc3NhZ2UoImljc3JfdHlwZV9lMmIiKSk7CiAgICAgICAgICAgICAgICAgICAgc2hvd0F0dGFjaG1lbnRzID0gKHJvdy50eXBlID09PSBwdmlfaWNzcl90eXBlLlBERik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF8uY29udGFpbnMoW3B2aV9pY3NyX3N0YXRlLlBPU0lUSVZFX0FDSywgcHZpX2ljc3Jfc3RhdGUuTkVHQVRJVkVfQUNLXSwgcm93LnRvU3RhdGVJZCkpIHsKICAgICAgICAgICAgICAgICAgICBzaG93RTJCT3JBY2sgPSAiQWNrIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm93LnRvU3RhdGVJZCA9PT0gcHZpX2ljc3Jfc3RhdGUuVFJBTlNNSVRURUQgJiYgcm93LnR5cGUgPT09IHB2aV9pY3NyX3R5cGUuRTJCX1IzX0VYVCkgewogICAgICAgICAgICAgICAgICAgIHNob3dFMkJPckFjayA9ICJITDciOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHNob3dPckhpZGVNc2dJY29uID0gKCFfLmlzRW1wdHkocm93LnJlcG9ydE1lc3NhZ2UpICYmIF8uY29udGFpbnMoW3B2aV9pY3NyX3N0YXRlLlBPU0lUSVZFX0FDSywgcHZpX2ljc3Jfc3RhdGUuTkVHQVRJVkVfQUNLXSwgcm93LnRvU3RhdGVJZCkpID8gJycgOiAnaGlkZSc7CiAgICAgICAgICAgICAgICBpZiAoc2hvd0F0dGFjaG1lbnRzKSB7CiAgICAgICAgICAgICAgICAgICAgcm93RGF0YSArPSBjcmVhdGVQZGZBdHRhY2htZW50cyhyb3cuaWNzcklkLCByb3cuZmlsZXMsIHNob3dFMkJPckFjayk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJvd0RhdGEgKz0gJzxidXR0b24gdHlwZT0iYnV0dG9uIiBkYXRhLWluZGV4PSInK2luZGV4KyciIGNsYXNzPSJzaG93QWNrWE1MIGJ0biBidG4teHMgYnRuLWludmVyc2Ugd2F2ZXMtbGlnaHQgZHJvcGRvd24tdG9nZ2xlIG5vQWN0aW9uQWxsb3dlZCBub3QtY2xpY2thYmxlICcgKyBzaG93RTJCT3JBY2sgKyAnIj4nICsgc2hvd0UyQk9yQWNrICsgJzwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkKCd0ZDplcSgwKScsIHRyKS5hZGRDbGFzcygnc251bScpOwogICAgICAgICAgICAgICAgJCgndGQ6ZXEoMiknLCB0cikuaHRtbChyb3cudG9TdGF0ZSArICc8YSBocmVmPSIjIiBjbGFzcz0icHYtaWMtdmlld3F1ZXJ5IHJkbC1pYy1zaG93bXNnICcgKyBzaG93T3JIaWRlTXNnSWNvbiArICciPlxuPHNwYW4gY2xhc3M9ImZhIGZhLWluZm8tY2lyY2xlIG0tbC01Ij48L3NwYW4+XG48L2E+Jyk7CiAgICAgICAgICAgICAgICAkKCd0ZDplcSg0KScsIHRyKS5odG1sKHJvd0RhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaGlkZUUyQkFja1hNTERldGFpbCgpOwogICAgICAgIHJkTW9kYWwubW9kYWwoInNob3ciKTsKICAgIH07CgogICAgdmFyIGNyZWF0ZVBkZkF0dGFjaG1lbnRzID0gZnVuY3Rpb24gKGljc3JJZCwgZmlsZXMsIGxhYmVsKSB7CiAgICAgICAgdmFyIHNpbmdsZV9idXR0b24gPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWludmVyc2Ugd2F2ZXMtbGlnaHQiIGhyZWY9IicgKyBwdmlfdXJscy5pY3NyUGRmRG93bmxvYWQgKyAnP2lkPScgKyBpY3NySWQgKyAnJnR5cGU9aWNzciI+JyArIGxhYmVsICsgJzwvYT4nOwogICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApewogICAgICAgICAgICByZXR1cm4gc2luZ2xlX2J1dHRvbjsKICAgICAgICB9CiAgICAgICAgdmFyIGJ1dHRvbiA9ICc8ZGl2IGNsYXNzPSJkcm9wZG93biI+JyArCiAgICAgICAgICAgICcgPGRpdiBjbGFzcz0iYnRuLWdyb3VwIiByb2xlPSJncm91cCI+JyArCiAgICAgICAgICAgIHNpbmdsZV9idXR0b24gKwogICAgICAgICAgICAnPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW52ZXJzZSB3YXZlcy1saWdodCBkcm9wZG93bi10b2dnbGUiIGlkPSJkcm9wZG93bkF0dGFjaG1lbnRzIiB0eXBlPSJidXR0b24iIGRhdGEtdG9nZ2xlPSJkcm9wZG93biIgYXJpYS1oYXNwb3B1cD0idHJ1ZSIgPjxzcGFuIGNsYXNzPSJtZCBtZC1tZW51LWRvd24iPjwvc3Bhbj48L2J1dHRvbj4nICsKICAgICAgICAgICAgJzx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSBkcm9wZG93bi1tZW51LXJpZ2h0IiBhcmlhLWxhYmVsbGVkYnk9ImRyb3Bkb3duQXR0YWNobWVudHMiID4nOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYnV0dG9uICs9ICc8bGk+PGEgaHJlZj0iJyArIHB2aV91cmxzLmljc3JQZGZEb3dubG9hZCArICc/aWQ9JyArIGZpbGVzW2ldLmlkICsgJyZ0eXBlPWF0dGFjaG1lbnQiPicgKyBmaWxlc1tpXS5uYW1lICsgJzwvYT48L2xpPicKICAgICAgICB9CiAgICAgICAgYnV0dG9uICs9ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIGJ1dHRvbjsKICAgIH07CgogICAgdmFyIGJpbmRSZXBvcnREaXN0cmlidXRpb25FdmVudHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy9tb2RhbCBvbiBjbGljayBldmVudAogICAgICAgICQoZG9jdW1lbnQpLm9mZignY2xpY2snLCdhLnJlcG9ydFN0YXRlJykub24oJ2NsaWNrJywnYS5yZXBvcnRTdGF0ZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIGlkID0gJCh0aGlzKS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgIHZhciB1cmwgPSBwdmlfdXJscy5yZXBvcnRfZGlzdHJpYnV0aW9uX2xvZ191cmwgKyBpZDsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLAogICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlRGF0YUluVGFibGUoSlNPTi5wYXJzZShkYXRhKS5kYXRhKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgcmRUYWJsZUJvZHkudGV4dChlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICByZE1vZGFsLm1vZGFsKCJzaG93Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvL2Vycm9yIG1lc3NhZ2UgZXZlbnQgYmluZGluZwogICAgICAgICQoZG9jdW1lbnQpLm9mZigiY2xpY2siLCAiYS5yZGwtaWMtc2hvd21zZyIpLm9uKCJjbGljayIsICJhLnJkbC1pYy1zaG93bXNnIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgdHIgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciByb3cgPSByZXBvcnRMb2dUYWJsZS5yb3codHIpOwogICAgICAgICAgICBpZiAocm93LmNoaWxkLmlzU2hvd24oKSkgewogICAgICAgICAgICAgICAgcm93LmNoaWxkLmhpZGUoKTsKICAgICAgICAgICAgICAgIHRyLnJlbW92ZUNsYXNzKCdzaG93bicpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcm93LmNoaWxkKCAnPHA+JyArIHJvdy5kYXRhKCkucmVwb3J0TWVzc2FnZSArICc8L3A+Jykuc2hvdygpOwogICAgICAgICAgICAgICAgdHIuYWRkQ2xhc3MoJ3Nob3duJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy9zaG93IEUyQiBBQ0sgeG1sIGRldGFpbHMgZXZlbnQgYmluZGluZwogICAgICAgICQoZG9jdW1lbnQpLm9mZigiY2xpY2siLCAiLnNob3dBY2tYTUwiKS5vbigiY2xpY2siLCAiLnNob3dBY2tYTUwiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gZWxlbWVudC5hdHRyKCdkYXRhLWluZGV4Jyk7CiAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKHB2aV9pY3NyX3R5cGUuRTJCX0VYVCkgfHwgZWxlbWVudC5oYXNDbGFzcyhwdmlfaWNzcl90eXBlLkUyQl9SM19FWFQpKSB7CiAgICAgICAgICAgICAgICBzaG93RTJCQWNrWE1MRGV0YWlsKHJlc3BSRExYbWxbaW5kZXhdLmljc3JYbWwsIHJlc3BSRExYbWxbaW5kZXhdLmljc3JGaWxlTmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZihlbGVtZW50Lmhhc0NsYXNzKHB2aV9pY3NyX3R5cGUuSEw3X0VYVCkpIHsKICAgICAgICAgICAgICAgIHNob3dFMkJBY2tYTUxEZXRhaWwocmVzcFJETFhtbFtpbmRleF0ucjNJY3NyWG1sLCByZXNwUkRMWG1sW2luZGV4XS5pY3NyRmlsZU5hbWUsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuaGFzQ2xhc3MocHZpX2ljc3JfdHlwZS5FMkJfQUNLKSkgewogICAgICAgICAgICAgICAgc2hvd0UyQkFja1hNTERldGFpbChyZXNwUkRMWG1sW2luZGV4XS5hY2tYbWwsIHJlc3BSRExYbWxbaW5kZXhdLmFja0ZpbGVOYW1lLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy9oaWRlIEUyQiBBQ0sgeG1sIGRldGFpbHMgZXZlbnQgYmluZGluZwogICAgICAgICQoZG9jdW1lbnQpLm9mZigiY2xpY2siLCAiLmJhY2stdG8tcmQtbGlzdGluZyIpLm9uKCJjbGljayIsICIuYmFjay10by1yZC1saXN0aW5nIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBoaWRlRTJCQWNrWE1MRGV0YWlsKCk7CiAgICAgICAgfSk7CgogICAgICAgIC8vbW9kYWwgY2xvc2UgZXZlbnQKICAgICAgICByZE1vZGFsLm9mZignaGlkZS5icy5tb2RhbCcpLm9uKCdoaWRlLmJzLm1vZGFsJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBoaWRlRTJCQWNrWE1MRGV0YWlsKCk7CiAgICAgICAgfSk7CgogICAgfTsKCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBiaW5kUmVwb3J0RGlzdHJpYnV0aW9uRXZlbnRzKCk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgaW5pdDogaW5pdAogICAgfQp9KCk7CnZhciBhbGxDYXNlTGlzdFRhYmxlcyA9IFtdOwoKdmFyIGZvbGxvd1VwRnJvbUxpc3QgPSBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAkLmFqYXgoewogICAgICAgIHVybDogcGFyYW1zLnVybCwKICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgZGF0YTogewogICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICBpbml0aWFsQ2FzZUlkOiBwYXJhbXMuaW5pdGlhbENhc2VJZCwKICAgICAgICAgICAgICAgIGZvbGxvd1VwQ2FzZUlkOiBwYXJhbXMuZm9sbG93VXBDYXNlSWQsCiAgICAgICAgICAgICAgICBzYWZldHlDYXNlTnVtOiBwYXJhbXMuc2FmZXR5Q2FzZU51bQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBwdnVpLmNvbW1vbi5zaG93UFZMb2FkZXIoKTsKICAgICAgICB9LAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgIHZhciByZXNwID0gJC5wYXJzZUpTT04oZGF0YSk7CiAgICAgICAgICAgIGlmIChyZXNwLnN0YXR1cyA9PT0gcHZpX2NvbnN0YW50cy5zdGF0dXNfZmFpbCkgewogICAgICAgICAgICAgICAgcHZ1aS5jb21tb24uaGlkZVBWTG9hZGVyKCk7CiAgICAgICAgICAgICAgICAkKCcjbWVzc2FnZUJveCcpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAkKCcjZXJyb3JNZXNzYWdlJykudGV4dChyZXNwLm1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJCgiI3B2aU1vZGFsRm9sbG93VXAiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgcHZpLnV0aWwuZ290b1VSTChwdmlfdXJscy5zaG93X2Nhc2VfdXJsICsgcmVzcFsnY2FzZS1pZCddK3B2aV91cmxzLmNhc2VfZW50cnlfZGVmYXVsdF90ZW1wbGF0ZV9zdWZmaXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn07Cgp2YXIgcHZpID0gcHZpIHx8IHt9OwpwdmkubGlzdCA9IHB2aS5saXN0IHx8IHt9OwoKcHZpLmxpc3QuY29tbW9uRnVuY3Rpb25zID0gZnVuY3Rpb24gKCkgewoKICAgIHZhciBzZXRDb2x1bW5WaXNpYmlsaXR5ID0gZnVuY3Rpb24oY29sdW1uQ29uZmlncywgZGF0YVRhYmxlKXsKICAgICAgICBfLmVhY2goY29sdW1uQ29uZmlncywgZnVuY3Rpb24gKGNvbmZpZ09iaikgewogICAgICAgICAgICB2YXIgbmFtZSA9IGNvbmZpZ09iai5uYW1lOwogICAgICAgICAgICB2YXIgY29sID0gZGF0YVRhYmxlLmNvbHVtbnMobmFtZSArICI6bmFtZSIpOwogICAgICAgICAgICB2YXIgaXNWaXNpYmxlID0gKGNvbmZpZ09iai5jb250YWluZXJWaWV3ID09PSAxKTsKICAgICAgICAgICAgY29sLnZpc2libGUoaXNWaXNpYmxlLCBmYWxzZSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBwb3B1bGF0ZUVycm9ySW5FcnJvckNvbnRhaW5lciA9IGZ1bmN0aW9uIChtZXNzYWdlTGlzdCwgdGFyZ2V0Q29udGFpbmVyKSB7CiAgICAgICAgJCgiI21lc3NhZ2VBbGVydENvbnRhaW5lciIpLnJlbW92ZSgpOwogICAgICAgIHZhciBlcnJvck1lc3NhZ2VMaXN0ID0gIiI7CiAgICAgICAgdmFyIG1lc3NhZ2VMaXN0TGVuZ3RoID0gbWVzc2FnZUxpc3QubGVuZ3RoOwogICAgICAgIGZvciAodmFyIGNudCA9IDA7IGNudCA8IG1lc3NhZ2VMaXN0TGVuZ3RoOyBjbnQrKykgewogICAgICAgICAgICBlcnJvck1lc3NhZ2VMaXN0ICs9ICI8bGk+IiArIG1lc3NhZ2VMaXN0W2NudF0gKyAiPC9saT4iOwogICAgICAgIH0KICAgICAgICB2YXIgZXJyb3JEaXYgPSAnPGRpdiBjbGFzcz0iYWxlcnQgYWxlcnQtZGlzbWlzc2libGUgZm9yY2VMaW5lV3JhcCBhbGVydC1kYW5nZXIiIHJvbGU9ImFsZXJ0IiBpZD0ibWVzc2FnZUFsZXJ0Q29udGFpbmVyIj48L2Rpdj4nOwogICAgICAgICQoIiMiICsgdGFyZ2V0Q29udGFpbmVyKS5maW5kKCIuZGF0YVRhYmxlTGlzdCIpLmJlZm9yZShlcnJvckRpdik7CiAgICAgICAgJCgiI21lc3NhZ2VBbGVydENvbnRhaW5lciIpLmh0bWwoIjx1bCBpZD0nZXJyb3JMaXN0Jz4iK2Vycm9yTWVzc2FnZUxpc3QrIjwvdWw+Iik7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgc2V0Q29sdW1uVmlzaWJpbGl0eTogc2V0Q29sdW1uVmlzaWJpbGl0eSwKICAgICAgICBwb3B1bGF0ZUVycm9ySW5FcnJvckNvbnRhaW5lcjogcG9wdWxhdGVFcnJvckluRXJyb3JDb250YWluZXIKICAgIH07Cgp9KCk7CgpwdmkubGlzdC5kYXRhR3JpZCA9IGZ1bmN0aW9uIChjb250YWluZXJJZCwgdGFibGVJZCwgY29sdW1uc0JhcklkLCBzZWFyY2hGb3JtTmFtZSwgb3B0aW9ucykgewogICAgdmFyIGNvbnRhaW5lciA9ICQoIiMiICsgY29udGFpbmVySWQpOwogICAgdmFyIGRhdGFUYWJsZSA9IGNvbnRhaW5lci5maW5kKCIjIiArIHRhYmxlSWQpOwogICAgdmFyIGRhdGFUYWJsZU9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnMgPyBvcHRpb25zIDoge307CiAgICB9KCk7CiAgICB2YXIgaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgIHZhciBwYWdlU3RhcnQgPSAwOwogICAgdmFyIGNhc2VMaXN0VGFibGU7CiAgICB2YXIgY2FzZUxpc3RUYWJsZVJlZiA9IHtjYXNlTGlzdFRhYmxlOiB7fX07CiAgICB2YXIgaW5pdE9yZGVyID0gZmFsc2U7CiAgICB2YXIgcGFnZVR5cGVJZCA9IGNvbnRhaW5lci5maW5kKCJpbnB1dFtuYW1lPSdwYWdlVHlwZUlkJ10iKS52YWwoKTsKICAgIHZhciBpc09uRHVwbGljYXRlU2VhcmNoUGFnZSA9ICh0eXBlb2YgZHVwbGljYXRlU2VhcmNoUGFnZUlkICE9PSAndW5kZWZpbmVkJykgJiYgKHBhZ2VUeXBlSWQgPT09IGR1cGxpY2F0ZVNlYXJjaFBhZ2VJZC50b1N0cmluZygpKTsKICAgIHZhciBhY3Rpb25WaXNpYmxlID0gY29udGFpbmVyLmZpbmQoImlucHV0W25hbWU9J2FjdGlvblZpc2libGUnXSIpLnZhbCgpOwogICAgdmFyIGlzTG9hZGVkVmlhQmFjayA9IHB2aS51dGlsLmlzRnJvbUJhY2tCdXR0b25QYWdlKCk7CiAgICBkYXRhVGFibGVPcHRpb25zLmxvYWREYXRhID0gISFjb250YWluZXIuZmluZCgiaW5wdXRbbmFtZT0nbG9hZERhdGEnXSIpLmRhdGEoJ3ZhbHVlJykgfHwgaXNMb2FkZWRWaWFCYWNrOwogICAgdmFyIGRhdGFFbGVtZW50cyA9IGNvbnRhaW5lci5maW5kKCIjbGlzdC1kYXRhLWVsZW1lbnRzIik7CiAgICB2YXIgcGFnZUxlbmd0aCA9IGRhdGFFbGVtZW50cy5kYXRhKCdwYWdlLWxlbmd0aCcpOwogICAgdmFyIGNvbHVtbnNCYXIgPSBjb250YWluZXIuZmluZCgnIycgKyBjb2x1bW5zQmFySWQpOwogICAgdmFyIGNvbHVtblNpemU7CiAgICB2YXIgZm9jdXNPbkZpeGVkQ29sID0gZmFsc2U7CiAgICB2YXIgZml4ZWRGaWx0ZXJDb2xOYW1lID0gImludGFrZUNhc2VOdW1iZXIiOwogICAgdmFyIGlzRGFzaGJvYXJkUGFnZSA9ICQoJyNpc0Rhc2hib2FyZFBhZ2UnKS5sZW5ndGggPiAwOwogICAgdmFyIHNjcm9sbGFibGVTZWN0aW9uID0gY29udGFpbmVyLmZpbmQoIi5kYXRhVGFibGVzX3Njcm9sbEJvZHkiKTsKICAgIHZhciBzY3JvbGxhYmxlRml4ZWRDb2wgPSBjb250YWluZXIuZmluZCgiLkRURkNfTGVmdEJvZHlMaW5lciIpOwogICAgdmFyIGNvbHVtbkNvbmZpZ3MgPSBbXTsKCiAgICB2YXIgZ2V0U3RvcmFnZUtleSA9IGZ1bmN0aW9uIChwcmltYXJ5S2V5KSB7CiAgICAgICAgcmV0dXJuIHNlYXJjaEZvcm1OYW1lICsgJzonICsgcHJpbWFyeUtleTsKICAgIH07CgogICAgdmFyIHNlYXJjaEZvcm1TdGF0ZSA9IG5ldyBGb3JtU3RhdGUoJCgnZm9ybVtuYW1lPSInICsgc2VhcmNoRm9ybU5hbWUgKyAnIl0nKSwgYnJvd3NlclN0b3JhZ2UudXRpbHMuYXBwVXNlclN0b3JhZ2VLZXkgKyBnZXRTdG9yYWdlS2V5KCdGT1JNX1NUQVRFJykpOwoKICAgIHZhciBidWlsZEluY2x1ZGVFeGNsdWRlVmFsdWVzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzdGF0ZXNMaXN0ID0gXy5yZWR1Y2UoY29udGFpbmVyLmZpbmQoJ2lucHV0W2Nhc2VTdGF0ZV0nKSwgZnVuY3Rpb24gKG1lbW8sIGNoZWNrYm94KSB7CiAgICAgICAgICAgIHZhciBjaGVja2VkID0gY2hlY2tib3guY2hlY2tlZDsKICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHsKICAgICAgICAgICAgICAgIG1lbW8ucHVzaChjb250YWluZXIuZmluZChjaGVja2JveCkuYXR0cigndmFsdWUnKS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtZW1vOwogICAgICAgIH0sIFtdKTsKICAgICAgICBpZiAoc3RhdGVzTGlzdCAmJiBzdGF0ZXNMaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlc0xpc3Quam9pbigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjb250YWluZXIuZmluZCgnZGl2LnJlcG9ydC1kaXN0cmlidXRpb24gaW5wdXQnKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuICJ4eHh4eC1jcmF6eSI7IC8vUmV0dXJuIHNvbWV0aGluZyBjcmF6eQogICAgICAgIH0KICAgIH07CgogICAgLy8gSGFuZGxlIHNvdXJjZSBkYXRhYmFzZQogICAgdmFyIGdldFNvdXJjZURhdGFiYXNlcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgc291cmNlcyA9IFtdOwogICAgICAgIGNvbnRhaW5lci5maW5kKCcucHYtc291cmNlLWRhdGFiYXNlJykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgICAgICAgICBzb3VyY2VzLnB1c2goJCh0aGlzKS52YWwoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc291cmNlczsKICAgIH07CgogICAgLyoqCiAgICAgKiBGb3IgRlUvRFMsIG1ldGhvZCBzaG91bGQgdXNlIHRoZSB1c2VyIHNlbGVjdGlvbiwgZm9yIGludGFrZSBjYXNlIG9yIGNhc2UgbGlzdCwgbWV0aG9kIHdpbGwgcmV0dXJuIGRlZmF1bHQgaW50YWtlIGRiCiAgICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICAgKi8KICAgIHZhciBnZXRTb3VyY2VEYXRhYmFzZXNPckRlZmF1bHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIERFRkFVTFRfU09VUkNFX0RCID0gMTsKICAgICAgICB2YXIgc291cmNlcyA9IGdldFNvdXJjZURhdGFiYXNlcygpOwogICAgICAgIGlmIChzb3VyY2VzLmxlbmd0aCA8IDEpIHNvdXJjZXMucHVzaChERUZBVUxUX1NPVVJDRV9EQik7CiAgICAgICAgcmV0dXJuIHNvdXJjZXM7CiAgICB9OwoKICAgIHZhciBkYXRlUmFuZ2VRdWVyeT0gZnVuY3Rpb24oc3RhcnREYXRlLCBlbmREYXRlKXsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoeyJndGUiIDogc3RhcnREYXRlICwgImx0ZSIgOiAgZW5kRGF0ZSB9KTsKICAgIH07CgogICAgdmFyIGJ1aWxkTGFzdFhTZWFyY2hDb25kaXRpb24gPSBmdW5jdGlvbiAoeF9mYWN0b3IsIHVuaXQpIHsKICAgICAgICB2YXIgcmFuZ2UgPSBidWlsZExhc3RYU2VhcmNoQ29uZGl0aW9uSnNvbih4X2ZhY3RvciwgdW5pdCk7CiAgICAgICAgcmV0dXJuICBkYXRlUmFuZ2VRdWVyeShyYW5nZS5zdGFydFRpbWUsIHJhbmdlLmVuZFRpbWUpOwogICAgfTsKCiAgICBmdW5jdGlvbiBidWlsZExhc3RYRGF0ZVJhbmdlSnNvbihzdWJVbml0LCB1bml0LCB4X2ZhY3RvcikgewogICAgICAgIHZhciB0b2RheSA9IG1vbWVudCgpLnR6KGNvcnBvcmF0ZVRpbWV6b25lKTsKICAgICAgICB2YXIgbGFzdFggPSB0b2RheS5zdWJ0cmFjdChzdWJVbml0LCB1bml0KTsKICAgICAgICB2YXIgeE1vbnRoQWdhbyA9IGxhc3RYLmNsb25lKCkuc3VidHJhY3QoeF9mYWN0b3IgLSAxLCB1bml0KTsKICAgICAgICB2YXIgc3RhcnRUaW1lID0geE1vbnRoQWdhby5jbG9uZSgpLnN0YXJ0T2YodW5pdCkudXRjKCkuZm9ybWF0KCk7CiAgICAgICAgdmFyIGVuZFRpbWUgPSBsYXN0WC5jbG9uZSgpLmVuZE9mKHVuaXQpLnV0YygpLmZvcm1hdCgpOwoKICAgICAgICByZXR1cm4gZGF0ZVJhbmdlUXVlcnkoc3RhcnRUaW1lLCBlbmRUaW1lKTsKICAgIH0KCiAgICB2YXIgYnVpbGRMYXN0WFNlYXJjaENvbmRpdGlvbkpzb24gPSBmdW5jdGlvbiAoeF9mYWN0b3IsIHVuaXQpIHsKICAgICAgICB2YXIgc3ViVW5pdCA9IDE7CiAgICAgICAgaWYgKGlzSW5jbHVkZVRvZGF5SW5TZWFyY2hDcml0ZXJpYSA9PT0gInRydWUiIHx8IGlzSW5jbHVkZVRvZGF5SW5TZWFyY2hDcml0ZXJpYSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBzdWJVbml0ID0gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkTGFzdFhEYXRlUmFuZ2VKc29uKHN1YlVuaXQsIHVuaXQsIHhfZmFjdG9yKTsKICAgIH07CgogICAgdmFyIGdldERlZmF1bHREYXRlUmFuZ2UgPSBmdW5jdGlvbigpewogICAgICAgIHZhciBjcml0ZXJpYSA9IGJ1aWxkTGFzdFhTZWFyY2hDb25kaXRpb25Kc29uKGRlZmF1bHREYXRlUmFuZ2VWYWx1ZSwgJ2RheScpOwogICAgICAgIGNyaXRlcmlhLnJhbmdlID0gJ0xBU1RfWF9EQVlTJzsKICAgICAgICBjcml0ZXJpYS54ID0gZGVmYXVsdERhdGVSYW5nZVZhbHVlOwogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjcml0ZXJpYSk7CiAgICB9OwoKICAgIHZhciBjcmVhdGVEYXRlUmFuZ2VWYWx1ZSA9IGZ1bmN0aW9uIChyYW5nZSwgeF9mYWN0b3IpIHsKICAgICAgICB2YXIgdmFsdWUgPSBudWxsOwogICAgICAgIHN3aXRjaCAocmFuZ2UpIHsKICAgICAgICAgICAgY2FzZSAnVE9EQVknOgogICAgICAgICAgICAgICAgdmFyIGZpbHRlckRhdGVDbG9uZSA9IG1vbWVudCgpLnR6KGNvcnBvcmF0ZVRpbWV6b25lKS5jbG9uZSgpOwogICAgICAgICAgICAgICAgdmFyIHN0YXJ0T2ZUb2RheSA9IGZpbHRlckRhdGVDbG9uZS5zdGFydE9mKCdkYXknKS51dGMoKS5mb3JtYXQoKTsKICAgICAgICAgICAgICAgIHZhciBlbmRPZlRvZGF5ID0gZmlsdGVyRGF0ZUNsb25lLmVuZE9mKCdkYXknKS51dGMoKS5mb3JtYXQoKTsKICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0ZVJhbmdlUXVlcnkoc3RhcnRPZlRvZGF5LCBlbmRPZlRvZGF5KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdZRVNURVJEQVknOgogICAgICAgICAgICAgICAgdmFsdWUgPSBidWlsZExhc3RYRGF0ZVJhbmdlSnNvbigxLCAnZGF5JywxKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdMQVNUX1dFRUsnOgogICAgICAgICAgICAgICAgdmFsdWUgPSBidWlsZExhc3RYU2VhcmNoQ29uZGl0aW9uSnNvbigxLCAnd2VlaycpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0xBU1RfTU9OVEgnOgogICAgICAgICAgICAgICAgdmFsdWUgPSBidWlsZExhc3RYU2VhcmNoQ29uZGl0aW9uSnNvbigxLCAnbW9udGgnKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdMQVNUX1lFQVInOgogICAgICAgICAgICAgICAgdmFsdWUgPSBidWlsZExhc3RYU2VhcmNoQ29uZGl0aW9uSnNvbigxLCAneWVhcicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0xBU1RfWF9EQVlTJzoKICAgICAgICAgICAgICAgIHZhbHVlID0gaXNEaWdpdCh4X2ZhY3RvcikgPyBidWlsZExhc3RYU2VhcmNoQ29uZGl0aW9uSnNvbih4X2ZhY3RvciwgJ2RheScpIDogdmFsdWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnTEFTVF9YX1dFRUtTJzoKICAgICAgICAgICAgICAgIHZhbHVlID0gaXNEaWdpdCh4X2ZhY3RvcikgPyBidWlsZExhc3RYU2VhcmNoQ29uZGl0aW9uSnNvbih4X2ZhY3RvciwgJ3dlZWsnKSA6IHZhbHVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0xBU1RfWF9NT05USFMnOgogICAgICAgICAgICAgICAgdmFsdWUgPSBpc0RpZ2l0KHhfZmFjdG9yKSA/IGJ1aWxkTGFzdFhTZWFyY2hDb25kaXRpb25Kc29uKHhfZmFjdG9yLCAnbW9udGgnKSA6IHZhbHVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0xBU1RfWF9ZRUFSUyc6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGlzRGlnaXQoeF9mYWN0b3IpID8gYnVpbGRMYXN0WFNlYXJjaENvbmRpdGlvbkpzb24oeF9mYWN0b3IsICd5ZWFyJykgOiB2YWx1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdmFsdWUgPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9OwoKICAgIHZhciBpc0RpZ2l0ID0gZnVuY3Rpb24gKHhfZmFjdG9yKSB7CiAgICAgICAgdmFyIHJlZyA9IC9eXGQrJC87CiAgICAgICAgcmV0dXJuIHJlZy50ZXN0KHhfZmFjdG9yKTsKICAgIH07CgogICAgdmFyIGJ1aWxkU2ltcGxlU2VhcmNoQ3JpdGVyaWEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlYXJjaENyaXRlcmlhID0ge307CiAgICAgICAgdmFyIHNpbXBsZVNlYXJjaEZpZWxkID0gY29udGFpbmVyLmZpbmQoJyNzaW1wbGVTZWFyY2hGaWVsZCcpOwogICAgICAgIHZhciBpc1NpbXBsZVNlYXJjaEZpZWxkVmlzaWJsZSA9IHNpbXBsZVNlYXJjaEZpZWxkLmhhc0NsYXNzKCd2aXNpYmxlJyk7CiAgICAgICAgaWYgKGlzU2ltcGxlU2VhcmNoRmllbGRWaXNpYmxlKSB7CiAgICAgICAgICAgIHNlYXJjaENyaXRlcmlhWydzaW1wbGVTZWFyY2gnXSA9IHNpbXBsZVNlYXJjaEZpZWxkLnZhbCgpOwogICAgICAgIH0KICAgICAgICBidWlsZFNpbXBsZVNlYXJjaE90aGVyUHJvcGVydGllcyhzZWFyY2hDcml0ZXJpYSwgIWlzU2ltcGxlU2VhcmNoRmllbGRWaXNpYmxlKTsKCiAgICAgICAgdmFyIHR5cGUgPSBjb250YWluZXIuZmluZCgnI2RhdGUtcmFuZ2UtdHlwZScpLnZhbCgpOwogICAgICAgIHZhciByYW5nZSA9IGNvbnRhaW5lci5maW5kKCcjcHZpTGlzdERhdGVSYW5nZScpLnZhbCgpOwoKICAgICAgICBpZiAoKF8uaW5kZXhPZihvbmVDbGlja1R5cGVzLCByYW5nZSkgPiAtMSkgfHwgKF8uaW5kZXhPZih0d29DbGlja1R5cGVzLCByYW5nZSkgPiAtMSkpIHsKICAgICAgICAgICAgdmFyIHhfZmFjdG9yID0gY29udGFpbmVyLmZpbmQoJyNyYW5nZS1mYWN0b3ItZmllbGQnKS52YWwoKTsKICAgICAgICAgICAgdmFyIGRhdGVSYW5nZSA9IGNyZWF0ZURhdGVSYW5nZVZhbHVlKHJhbmdlLCB4X2ZhY3Rvcik7CiAgICAgICAgICAgIGlmICghZGF0ZVJhbmdlKSB7CiAgICAgICAgICAgICAgICBzd2FsKCIiLCBnZXRNZXNzYWdlKCJjb3JyZWN0X2RhdGVfcmFuZ2UiKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGF0ZVJhbmdlLnJhbmdlID0gcmFuZ2U7CiAgICAgICAgICAgIGRhdGVSYW5nZS54ID0geF9mYWN0b3I7CiAgICAgICAgICAgIHNlYXJjaENyaXRlcmlhW3R5cGVdID0gZGF0ZVJhbmdlOwogICAgICAgIH0gZWxzZSBpZiAocmFuZ2UgPT09ICdDVVNUT00nKSB7CiAgICAgICAgICAgIHZhciBkYXRlUmFuZ2VTZWFyY2hWYWx1ZSA9IGdldERhdGVSYW5nZVNlYXJjaFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChkYXRlUmFuZ2VTZWFyY2hWYWx1ZSkgewogICAgICAgICAgICAgICAgc2VhcmNoQ3JpdGVyaWFbdHlwZV0gPSBkYXRlUmFuZ2VTZWFyY2hWYWx1ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlYXJjaENyaXRlcmlhOwogICAgfTsKCiAgICB2YXIgYnVpbGRTaW1wbGVTZWFyY2hPdGhlclByb3BlcnRpZXMgPSBmdW5jdGlvbiAoc2VhcmNoQ3JpdGVyaWEsIGlzU2VjdGlvblZpc2libGUpIHsKCiAgICAgICAgaWYgKGlzU2VjdGlvblZpc2libGUpIHsKICAgICAgICAgICAgXy5lYWNoKGNvbnRhaW5lci5maW5kKCJpbnB1dFtkYXRhLXNlYXJjaC1maWVsZF06dmlzaWJsZSIpLCBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgICAgIGlucHV0ID0gJChpbnB1dCk7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbnB1dC52YWwoKTsKICAgICAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dFNlYXJjaEZpZWxkRGF0YSA9IGlucHV0LmRhdGEoInNlYXJjaC1maWVsZCIpOwogICAgICAgICAgICAgICAgICAgIHNlYXJjaENyaXRlcmlhW2lucHV0U2VhcmNoRmllbGREYXRhXSA9IGlucHV0Lmhhc0NsYXNzKCdnZW5lcmF0ZURhdGVSYW5nZScpID8gcHZpLnV0aWwuZ2VuZXJhdGVEYXRlUmFuZ2UodmFsdWUpIDogdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgXy5lYWNoKGNvbnRhaW5lci5maW5kKCJzZWxlY3RbZGF0YS1zZWFyY2gtZmllbGRdOnZpc2libGUiKSwgZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgICAgICBpbnB1dCA9ICQoaW5wdXQpOwogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcHZpLnV0aWwuZ2V0U2VsZWN0ZWRWYWx1ZUZyb21TZWxlY3QyKGlucHV0KTsKICAgICAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHNlYXJjaENyaXRlcmlhW2lucHV0LmRhdGEoInNlYXJjaC1maWVsZCIpXSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHNlYXJjaENyaXRlcmlhWydjYXNlU3RhdGVJZCddID0gYnVpbGRJbmNsdWRlRXhjbHVkZVZhbHVlcygpOwoKICAgICAgICB2YXIgbGlzdERhdGFDb250YWluZXJEaXYgPSBjb250YWluZXIuZmluZCgiI2xpc3QtZGF0YS1lbGVtZW50cyIpOwogICAgICAgIHZhciBpc09yT3BlcmF0aW9uID0gbGlzdERhdGFDb250YWluZXJEaXYuZGF0YSgiaXMtb3Itb3BlcmF0aW9uIik7CiAgICAgICAgdmFyIHNvcnRXaGlsZVNlYXJjaCA9IGxpc3REYXRhQ29udGFpbmVyRGl2LmRhdGEoInNvcnQtd2hpbGUtc2VhcmNoIik7CiAgICAgICAgdmFyIGNvdW50U2VhcmNoQ3JpdGVyaWEgPSBsaXN0RGF0YUNvbnRhaW5lckRpdi5kYXRhKCJjb3VudC1zZWFyY2gtY3JpdGVyaWEiKTsKICAgICAgICBzZWFyY2hDcml0ZXJpYVsnY29uZmlnJ10gPSAneyJpc09yT3BlcmF0aW9uIjogIicgKyBpc09yT3BlcmF0aW9uICsgJyIsICJzb3J0V2hpbGVTZWFyY2giOiAiJyArIHNvcnRXaGlsZVNlYXJjaCArICciLCAiY291bnRTZWFyY2hDcml0ZXJpYSI6ICInICsgY291bnRTZWFyY2hDcml0ZXJpYSArICcifSc7CgogICAgICAgIGlmIChsaXN0RGF0YUNvbnRhaW5lckRpdi5kYXRhKCJvbmx5LWxhdGVzdC12YWxpZC12ZXJzaW9uIikgPT09IHRydWUpIHsKICAgICAgICAgICAgc2VhcmNoQ3JpdGVyaWFbJ2lzTGF0ZXN0VmFsaWRWZXJzaW9uJ10gPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRhaW5lci5maW5kKCdkaXYucmVwb3J0LWRpc3RyaWJ1dGlvbiBpbnB1dCcpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgICAgIHNlYXJjaENyaXRlcmlhWydyZXBvcnREaXN0cmlidXRpb25UaHJlc2hvbGQnXSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIC8vIEhhbmRsZSBzb3VyY2UgZGF0YWJhc2UKICAgICAgICBzZWFyY2hDcml0ZXJpYVsnc291cmNlRGJJZCddID0gZ2V0U291cmNlRGF0YWJhc2VzT3JEZWZhdWx0KCkuam9pbigiLCIpOwogICAgfTsKCiAgICB2YXIgZ2V0RGF0ZVJhbmdlU2VhcmNoVmFsdWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHJhbmdlU3RhcnQgPSBjb250YWluZXIuZmluZCgnI2RhdGVwaWNrZXItcmFuZ2VTdGFydERhdGUnKS52YWwoKTsKICAgICAgICB2YXIgcmFuZ2VFbmQgPSBjb250YWluZXIuZmluZCgnI2RhdGVwaWNrZXItcmFuZ2VFbmREYXRlJykudmFsKCk7CgogICAgICAgIGlmICghKHJhbmdlU3RhcnQgfHwgcmFuZ2VFbmQpKSB7CiAgICAgICAgICAgIHB2aS51dGlsLnNob3dJbmZvKGdldE1lc3NhZ2UoImVudGVyX3N0YXJ0X2VuZF9kYXRlIikpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlmICghcmFuZ2VTdGFydCkgewogICAgICAgICAgICBzd2FsKCIiLCBnZXRNZXNzYWdlKCJlbnRlcl9zdGFydF9kYXRlIikpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlmICghcmFuZ2VFbmQpIHsKICAgICAgICAgICAgc3dhbCgiIiwgZ2V0TWVzc2FnZSgiZW50ZXJfZW5kX2RhdGUiKSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFwdmkudXRpbC5pc1ZhbGlkRGF0ZShyYW5nZVN0YXJ0KSkgewogICAgICAgICAgICBzd2FsKCIiLCBnZXRNZXNzYWdlKCJjb3JyZWN0X3N0YXJ0X2RhdGUiKSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFwdmkudXRpbC5pc1ZhbGlkRGF0ZShyYW5nZUVuZCkpIHsKICAgICAgICAgICAgc3dhbCgiIiwgZ2V0TWVzc2FnZSgiY29ycmVjdF9lbmRfZGF0ZSIpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciBzdXBwb3J0ZWREYXRlVGltZUZvcm1hdCA9IHB2aS51dGlsLnN1cHBvcnRlZERhdGVUaW1lRm9ybWF0OwoKICAgICAgICB2YXIgc2VhcmNoX3N0YXJ0ID0gbW9tZW50KHJhbmdlU3RhcnQsIHN1cHBvcnRlZERhdGVUaW1lRm9ybWF0KS50eihjb3Jwb3JhdGVUaW1lem9uZSwgdHJ1ZSkuc3RhcnRPZignZGF5JykudXRjKCk7CiAgICAgICAgdmFyIHNlYXJjaF9lbmQgPSBtb21lbnQocmFuZ2VFbmQsIHN1cHBvcnRlZERhdGVUaW1lRm9ybWF0KS50eihjb3Jwb3JhdGVUaW1lem9uZSwgdHJ1ZSkuZW5kT2YoJ2RheScpLnV0YygpOwogICAgICAgIHZhciB2YWx1ZSA9IG51bGw7CiAgICAgICAgaWYgKChyYW5nZVN0YXJ0ICYmIHJhbmdlRW5kKSAmJiAoc2VhcmNoX2VuZC5pc0FmdGVyKHNlYXJjaF9zdGFydCkpKSB7CiAgICAgICAgICAgIHZhbHVlID0gZGF0ZVJhbmdlUXVlcnkoc2VhcmNoX3N0YXJ0LmZvcm1hdCgpLCBzZWFyY2hfZW5kLmZvcm1hdCgpKTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCEocmFuZ2VTdGFydCAmJiByYW5nZUVuZCkpIHsKICAgICAgICAgICAgICAgIHN3YWwoIiIsIGdldE1lc3NhZ2UoImVudGVyX3N0YXJ0X2VuZF9kYXRlIikpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3dhbCgiIiwgZ2V0TWVzc2FnZSgic3RhcnRfZW5kX2NvbnN0cmFpbnQiKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKCiAgICB2YXIgb25lQ2xpY2tUeXBlcyA9IFsnVE9EQVknLCAnWUVTVEVSREFZJywgJ0xBU1RfV0VFSycsICdMQVNUX01PTlRIJywgJ0xBU1RfWUVBUiddOwogICAgdmFyIHR3b0NsaWNrVHlwZXMgPSBbJ0xBU1RfWF9EQVlTJywgJ0xBU1RfWF9XRUVLUycsICdMQVNUX1hfTU9OVEhTJywgJ0xBU1RfWF9ZRUFSUyddOwoKICAgIHZhciBzaG93V2FybmluZyA9IGZ1bmN0aW9uICh0aXRsZSwgdGV4dCwgY2FuY2VsQnRuVGV4dCwgY29uZmlybUJ0blRleHQsIGNhbGxCYWNrKSB7CiAgICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgdGV4dDogdGV4dCwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjREQ2QjU1IiwKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGNvbmZpcm1CdG5UZXh0LAogICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogdHJ1ZQogICAgICAgIH07CiAgICAgICAgaWYoY2FuY2VsQnRuVGV4dCl7CiAgICAgICAgICAgIG9wdGlvbnMuc2hvd0NhbmNlbEJ1dHRvbiA9IHRydWU7CiAgICAgICAgICAgIG9wdGlvbnMuY2FuY2VsQnV0dG9uVGV4dCA9IGNhbmNlbEJ0blRleHQ7CiAgICAgICAgfQogICAgICAgIHN3YWwob3B0aW9ucywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY2FsbEJhY2soKTsKICAgICAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBhc3NpZ25lZFRvVXNlck9wdGlvbnM7CgogICAgdmFyIGJpbmREcm9wZG93bkZpbHRlcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgYXNzaWduZWRUb1VzZXJPcHRpb25zID0gZ2V0VXNlckxpc3QoKTsKICAgICAgICBhc3NpZ25lZFRvVXNlck9wdGlvbnMuc3BsaWNlKDAsMCx7aWQ6Jy0xJyx0ZXh0OiBnZXRNZXNzYWdlKCJzZWxlY3RfYmxhbmtfb3B0aW9uIil9KTsKICAgICAgICBjb250YWluZXIuZmluZCgnI2Fzc2lnbmVlLWZpbHRlcicpLnNlbGVjdDIoewogICAgICAgICAgICBkYXRhOiBhc3NpZ25lZFRvVXNlck9wdGlvbnMsCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBnZXRNZXNzYWdlKCJzZWxlY3RfZGVmYXVsdF90ZXh0IiksCiAgICAgICAgICAgIGFsbG93Q2xlYXI6IHRydWUKICAgICAgICB9KTsKICAgICAgICB2YXIgYXNzaWduZWRVc2VybmFtZSA9IGNhc2VMaXN0VGFibGVSZWYuY2FzZUxpc3RUYWJsZS5jb2x1bW4oJ2Fzc2lnbmVkVG9Vc2VybmFtZTpuYW1lJykuc2VhcmNoKCk7CiAgICAgICAgaWYgKGFzc2lnbmVkVXNlcm5hbWUgPT09IHVuZGVmaW5lZCB8fCBhc3NpZ25lZFVzZXJuYW1lID09PSBsb2dpblVzZXIpewogICAgICAgICAgICBjb250YWluZXIuZmluZCgnI2Fzc2lnbmVlLWZpbHRlcicpLnZhbChsb2dpblVzZXIpLnRyaWdnZXIoImNoYW5nZS5zZWxlY3QyIik7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgZ2V0VXNlckxpc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHVzZXJMaXN0ID0gcHZpLnV0aWwuZmV0Y2hVc2Vyc1JlZmVyZW5jZURhdGEoKTsKICAgICAgICBfLmVhY2godXNlckxpc3QgLGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgICAgb2JqLmlkID0gb2JqLnRleHQ7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHVzZXJMaXN0OwogICAgfTsKCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgdmFyIG5vQWN0aW9uQWxsb3dlZEJ1dHRvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5wdi1saXN0LXRhYmxlJykub24oJ2NsaWNrJywgJ2J1dHRvbi5ub0FjdGlvbkFsbG93ZWQnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgc3dhbCgiIiwgZ2V0TWVzc2FnZSgnbm9fYWN0aW9uX3N0YXRlJykgKyBjb250YWluZXIuZmluZCh0aGlzKS5hdHRyKCJkYXRhLWNhc2Utc3RhdGUiKSArICIgU3RhdGUiLCAiIik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHZhciBub0J1bGtBY3Rpb25BbGxvd2VkQnV0dG9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb250YWluZXIuZmluZCgnLmdyaWQtdG9wLWhlYWQnKS5vbignY2xpY2snLCAnYnV0dG9uLm5vQnVsa0FjdGlvbkFsbG93ZWQnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgc3dhbCgiIiwgZ2V0TWVzc2FnZSgnbm9fYnVsa19hY3Rpb25fc3RhdGUnKSwgIiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICB2YXIgYnVsa0FjdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHBhcmFtcyx0YXJnZXRDb250YWluZXIpIHsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogcHZpX3VybHMuYnVsa19jaGFuZ2VfY2FzZV9zdGF0ZSwKICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkczogcGFyYW1zLmlkcywKICAgICAgICAgICAgICAgICAgICAgICAgdG9TdGF0ZUlkOiBwYXJhbXMudG9TdGF0ZUlkLAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25QZXJmb3JtZWQ6IHBhcmFtcy5hY3Rpb24KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBwdnVpLmNvbW1vbi5zaG93UFZMb2FkZXIoKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHZhciByZXNwID1KU09OLnBhcnNlKGRhdGEpOwogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChyZXNwLnN0YXR1cykgPT09IDQyMil7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2aS5saXN0LmNvbW1vbkZ1bmN0aW9ucy5wb3B1bGF0ZUVycm9ySW5FcnJvckNvbnRhaW5lcihyZXNwLnRleHQuZXJyb3JzLHRhcmdldENvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VMaXN0VGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHZ1aS5jb21tb24uaGlkZVBWTG9hZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VMaXN0VGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLmhpZGVQVkxvYWRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuc2hvd0Zsb2F0aW5nTm90aWZpY2F0aW9uLnN1Y2Nlc3NNZXNzYWdlKHJlc3AubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGJ1bGtBY3Rpb25DYWxsYmFja1dpdGhKdXN0aWZpY2F0aW9uID0gZnVuY3Rpb24gKHBhcmFtcywgY29udGVudCkgewoKICAgICAgICAgICAgdmFyIHBhc3N3b3JkID0gJCgiI2p1c3RpZmljYXRpb25QYXNzd29yZCIpLnZhbCgpOwoKICAgICAgICAgICAgcHZpLnV0aWwuc2hvd1NwaW5EbGcoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IHB2aV91cmxzLmJ1bGtfY2hhbmdlX2Nhc2Vfc3RhdGUsCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkczogcGFyYW1zLmlkcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvU3RhdGVJZDogcGFyYW1zLnRvU3RhdGVJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzOiBjb250ZW50LmNvbW1lbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uUGVyZm9ybWVkOiBwYXJhbXMuYWN0aW9uUGVyZm9ybWVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBjb250ZW50LnRpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZVRvU2F2ZVByZWZlcmVuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLmhpZGVQVkxvYWRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcCA9IEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKF8uaGFzKHJlc3AsICJjYXNlU3RhdGVDaGFuZ2VkIikgJiYgIXJlc3AuY2FzZVN0YXRlQ2hhbmdlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuaGFuZGxlQ2FzZVN0YXRlQ2hhbmdlUmVqZWN0aW9uKHJlc3ApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI3B2LWp1c3RpZmljYXRpb24tbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VMaXN0VGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdmkudXRpbC5zaG93RmxvYXRpbmdOb3RpZmljYXRpb24uc3VjY2Vzc01lc3NhZ2UocmVzcC5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHZhciBpbml0aWFsaXplQnVsa0FjdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5ncmlkLXRvcC1oZWFkJykub24oJ2NsaWNrJywgJ3VsLmJ1bGstYWN0aW9uLWxpc3Q+bGkuYnVsay1hY3Rpb24nLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgdmFyIGlkcyA9IF8uY29sbGVjdChfLmZpbHRlcihjb250YWluZXIuZmluZCgnLmxpc3Qtcm93LWNoZWNrYm94OmNoZWNrZWQnKSksIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQoaXRlbSkuYXR0cignZGF0YS1pZCcpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHZlbmRvcklkcyA9IFtdOwogICAgICAgICAgICAgICAgdmFyIHByb2R1Y3RJZHMgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBjb3VudHJ5SWRzID0gW107CiAgICAgICAgICAgICAgICB2YXIgc3R1ZHlJZHMgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBhc3NpZ25Ub0lkcyA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGlzQ2xpbmljYWxUcmlhbCA9IFtdOwogICAgICAgICAgICAgICAgXy5lYWNoKGNvbnRhaW5lci5maW5kKCcubGlzdC1yb3ctY2hlY2tib3g6Y2hlY2tlZCcpLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIHZhciByb3dEYXRhID0gJChpdGVtKS5kYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocm93RGF0YS52ZW5kb3JJZCkKICAgICAgICAgICAgICAgICAgICAgICAgdmVuZG9ySWRzLnB1c2gocm93RGF0YS52ZW5kb3JJZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvd0RhdGEucHJvZHVjdGlkcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4ocm93RGF0YS5wcm9kdWN0aWRzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHJvd0RhdGEucHJvZHVjdGlkcy5zcGxpdCgiLCIpLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZhbCkgJiYgdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RJZHMucHVzaChwYXJzZUludCh2YWwpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RJZHMucHVzaChyb3dEYXRhLnByb2R1Y3RpZHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHJvd0RhdGEuY291bnRyeWlkKQogICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJ5SWRzLnB1c2gocm93RGF0YS5jb3VudHJ5aWQpOwogICAgICAgICAgICAgICAgICAgIGlmKHJvd0RhdGEuc3R1ZHlpZCkKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZHlJZHMucHVzaChyb3dEYXRhLnN0dWR5aWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChyb3dEYXRhLmFzc2lnbnRvaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnblRvSWRzLnB1c2gocm93RGF0YS5hc3NpZ250b2lkKTsKICAgICAgICAgICAgICAgICAgICBpc0NsaW5pY2FsVHJpYWwucHVzaChyb3dEYXRhLmlzY2xpbmljYWx0cmlhbCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uVGFyZ2V0ID0gJCh0aGlzKS5maW5kKCJhIik7CiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gYWN0aW9uVGFyZ2V0LmRhdGEoImFjdGlvbiIpOwogICAgICAgICAgICAgICAgdmFyIHRhcmdldENvbnRhaW5lciA9IGFjdGlvblRhcmdldC5kYXRhKCJjb250YWluZXIiKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBhY3RpdmVTdGF0ZUlkOgogICAgICAgICAgICAgICAgICAgICAgICBidWxrQWN0aW9uQ2FsbGJhY2soe3RvU3RhdGVJZDogYWN0aXZlU3RhdGVJZCwgYWN0aW9uOiBhY3Rpb24sIGlkczogaWRzfSx0YXJnZXRDb250YWluZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHJlamVjdGVkU3RhdGVJZDoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHthY3Rpb25QZXJmb3JtZWQ6IGFjdGlvbiwgdG9TdGF0ZUlkOiByZWplY3RlZFN0YXRlSWQsIGlkczogaWRzfTsKICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuanVzdGlmaWNhdGlvbk1vZHVsZSgpLnNob3dKdXN0aWZpY2F0aW9uTW9kYWwoIm1hcmtfcmVqZWN0IiwgcGFyYW1zLCBidWxrQWN0aW9uQ2FsbGJhY2tXaXRoSnVzdGlmaWNhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgZmluYWxTdGF0ZUlkOgogICAgICAgICAgICAgICAgICAgICAgICBzaG93V2FybmluZygiIiwgZ2V0TWVzc2FnZSgnc3VibWl0X2J0bicpLCBwdmlfY29uc3RhbnRzLmNhbmNlbF9idG5fbGFiZWwsIHB2aV9jb25zdGFudHMuc3VjY2Vzc19idG5fbGFiZWwsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1bGtBY3Rpb25DYWxsYmFjayh7dG9TdGF0ZUlkOiBmaW5hbFN0YXRlSWQsIGFjdGlvbjogYWN0aW9uLCBpZHM6IGlkc30sdGFyZ2V0Q29udGFpbmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoYWN0aW9uVGFyZ2V0LnBhcmVudCgpLmhhc0NsYXNzKCdhc3NpZ25BbGwnKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBkYXRhTWFwID0ge307CiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbmVlTGlzdCA9ICAkKCIjYXNzaWduZWVVc2VyTGlzdCIpOwogICAgICAgICAgICAgICAgICAgIGFzc2lnbmVlTGlzdC5zZWxlY3QyKHtkcm9wZG93blBhcmVudDogcHZpLnV0aWwuY2FzZUp1c3RpZmljYXRpb24uanVzdGlmaWNhdGlvbk1vZGFsfSk7CiAgICAgICAgICAgICAgICAgICAgZGF0YU1hcC5jb3VudHJ5SWRzID0gXy51bmlxdWUoY291bnRyeUlkcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2R1Y3RJZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhTWFwLnByb2R1Y3RJZHMgPSBfLnVuaXF1ZShwcm9kdWN0SWRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHN0dWR5SWRzKSAmJiBzdHVkeUlkcykgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhTWFwLnN0dWR5SWRzID0gXy51bmlxdWUoc3R1ZHlJZHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkYXRhTWFwLmlzQ2xpbmljYWxUcmlhbCA9IF8udW5pcXVlKGlzQ2xpbmljYWxUcmlhbCk7CgogICAgICAgICAgICAgICAgICAgIGlmKHZlbmRvcklkcykgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhTWFwLnZlbmRvcklkcyA9IF8udW5pcXVlKHZlbmRvcklkcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ub0lkcykgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhTWFwLmFzc2lnblRvSWRzID0gXy51bmlxdWUoYXNzaWduVG9JZHMpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBwdmlfdXJscy5jYXNlX2Fzc2lnbmVlX3VzZXJfbGlzdF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtkYXRhOkpTT04uc3RyaW5naWZ5KGRhdGFNYXApfSwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZUxpc3QuaHRtbCgnJykuYXBwZW5kKG5ldyBPcHRpb24oZ2V0TWVzc2FnZSgic2VsZWN0X2RlZmF1bHRfdGV4dCIpLCAwLCB0cnVlLCB0cnVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24ob2JqKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbmVlTGlzdC5hcHBlbmQobmV3IE9wdGlvbihvYmoudXNlcm5hbWUsIG9iai5pZCwgZmFsc2UsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwubWFuYWdlVXNlckFzc2lnbi51c2VyQ2FzZUFzc2lnbm1lbnRMb2dpYyhlLCBhc3NpZ25lZUxpc3QsIGFzc2lnbmVlTGlzdCwgYWN0aW9uVGFyZ2V0LCBudWxsLCBpZHMsICQoIiNhc3NpZ25lZVVzZXJMaXN0IDpzZWxlY3RlZCIpLnZhbCgpLCB0YXJnZXRDb250YWluZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHZhciBpbml0RmlsdGVyQnV0dG9uID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJyNmaWx0ZXItYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGlmKCFhc3NpZ25lZFRvVXNlck9wdGlvbnMpewogICAgICAgICAgICAgICAgICAgIGJpbmREcm9wZG93bkZpbHRlcnMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHB2dWkuZ3JpZC5tYW5hZ2VVSVdyYXBwZXIudG9nZ2xlR3JpZEZpbHRlcihjb250YWluZXIsIHtkYXRlRm9ybWF0OigocHZpLnV0aWwuZ2V0RGF0ZUZvcm1hdHMubGlzdERhdGVGb3JtYXQpLnRvVXBwZXJDYXNlKCkpfSk7CiAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgidGhlYWQuZmlsdGVyLWhlYWQiKS50b2dnbGVDbGFzcygicHYtZmlsdGVyLWFjdGl2ZSIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIuYnRuLXNlbGVjdC1hbGwtY2hlY2tsaXN0IGlucHV0IikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoIi5wdi1pbmNsdWRlLWNhc2VzLWxpc3QgaW5wdXQiKS5wcm9wKCdjaGVja2VkJywgJCh0aGlzKS5wcm9wKCJjaGVja2VkIikpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIucHYtaW5jbHVkZS1jYXNlcy1saXN0IGlucHV0Iikub24oImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIuYnRuLXNlbGVjdC1hbGwtY2hlY2tsaXN0IGlucHV0IikucHJvcCgiY2hlY2tlZCIsIGNoZWNrSXNTZWxlY3RlZEFsbCgpKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgY2hlY2tJc1NlbGVjdGVkQWxsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGNoZWNrZWRMZW5ndGggPSBjb250YWluZXIuZmluZCgiLnB2LWluY2x1ZGUtY2FzZXMtbGlzdCBpbnB1dFtjYXNlU3RhdGVdOmNoZWNrZWQiKS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgdG90YWxDaGVja0JveGVzID0gY29udGFpbmVyLmZpbmQoIi5wdi1pbmNsdWRlLWNhc2VzLWxpc3QgaW5wdXRbY2FzZVN0YXRlXSIpLmxlbmd0aDsKICAgICAgICAgICAgICAgIHJldHVybiAoY2hlY2tlZExlbmd0aCA9PT0gdG90YWxDaGVja0JveGVzKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIjcmFuZ2UtZmFjdG9yLWZpZWxkIikua2V5ZG93bihmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgdmFyIGtleXNDb2xsZWN0aW9uID0gWzQ2LCA4LCA5LCAyNywgMTMsIDExMCwgMTkwXTsKICAgICAgICAgICAgICAgIC8vIEFsbG93OiBiYWNrc3BhY2UsIGRlbGV0ZSwgdGFiLCBlc2NhcGUsIGVudGVyIGFuZCAuCiAgICAgICAgICAgICAgICBpZiAoa2V5c0NvbGxlY3Rpb24uaW5kZXhPZihlLmtleUNvZGUpICE9PSAtMSB8fAogICAgICAgICAgICAgICAgICAgIC8vIEFsbG93OiBDdHJsL2NtZCtBCiAgICAgICAgICAgICAgICAgICAgKGUua2V5Q29kZSA9PT0gNjUgJiYgKGUuY3RybEtleSA9PT0gdHJ1ZSB8fCBlLm1ldGFLZXkgPT09IHRydWUpKSB8fAogICAgICAgICAgICAgICAgICAgIC8vIEFsbG93OiBDdHJsL2NtZCtDCiAgICAgICAgICAgICAgICAgICAgKGUua2V5Q29kZSA9PT0gNjcgJiYgKGUuY3RybEtleSA9PT0gdHJ1ZSB8fCBlLm1ldGFLZXkgPT09IHRydWUpKSB8fAogICAgICAgICAgICAgICAgICAgIC8vIEFsbG93OiBDdHJsL2NtZCtYCiAgICAgICAgICAgICAgICAgICAgKGUua2V5Q29kZSA9PT0gODggJiYgKGUuY3RybEtleSA9PT0gdHJ1ZSB8fCBlLm1ldGFLZXkgPT09IHRydWUpKSB8fAogICAgICAgICAgICAgICAgICAgIC8vIEFsbG93OiBob21lLCBlbmQsIGxlZnQsIHJpZ2h0CiAgICAgICAgICAgICAgICAgICAgKGUua2V5Q29kZSA+PSAzNSAmJiBlLmtleUNvZGUgPD0gMzkpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbGV0IGl0IGhhcHBlbiwgZG9uJ3QgZG8gYW55dGhpbmcKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgdGhhdCBpdCBpcyBhIG51bWJlciBhbmQgc3RvcCB0aGUga2V5cHJlc3MKICAgICAgICAgICAgICAgIGlmICgoZS5zaGlmdEtleSB8fCAoZS5rZXlDb2RlIDwgNDggfHwgZS5rZXlDb2RlID4gNTcpKSAmJiAoZS5rZXlDb2RlIDwgOTYgfHwgZS5rZXlDb2RlID4gMTA1KSkgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb250YWluZXIuZmluZCgnI3JhbmdlLWZhY3Rvci1maWVsZCcpLmtleXByZXNzKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChldmVudC53aGljaCAhPT0gMTMpOyAgLy8gcmV0dXJuaW5nIGZhbHNlIHdpbGwgcHJldmVudCB0aGUgZXZlbnQgZnJvbSBidWJibGluZyB1cC4KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb250YWluZXIuZmluZCgnI3NpbXBsZVNlYXJjaEZpZWxkJykua2V5dXAoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaENyaXRlcmlhID0gYnVpbGRTaW1wbGVTZWFyY2hDcml0ZXJpYSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHNlYXJjaENyaXRlcmlhKQogICAgICAgICAgICAgICAgICAgICAgICBkb1NpbXBsZVNlYXJjaChKU09OLnN0cmluZ2lmeShzZWFyY2hDcml0ZXJpYSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb250YWluZXIuZmluZCgnI3B2aUxpc3REYXRlUmFuZ2U+b3B0aW9uW3ZhbHVlPScgKyBkZWZhdWx0RGF0ZVJhbmdlS2V5ICsgJ10nKS5wcm9wKCdzZWxlY3RlZCcsIHRydWUpOyAgLy90aGlzIHZhbHVlIGlzIHBpY2tlZCB1cCBmcm9tIGxpc3QuZ3NwIChkZWZhdWx0RGF0ZVJhbmdlS2V5KQogICAgICAgICAgICBjb250YWluZXIuZmluZCgnI3B2aUxpc3REYXRlUmFuZ2UnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJyNyYW5nZS1mYWN0b3ItZmllbGQnKS52YWwoZGVmYXVsdERhdGVSYW5nZVZhbHVlKTsgLy90aGlzIHZhbHVlIGlzIHBpY2tlZCB1cCBmcm9tIGxpc3QuZ3NwIChkZWZhdWx0RGF0ZVJhbmdlVmFsdWUpCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGRvU2ltcGxlU2VhcmNoID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBjb2x1bW4gPSBjYXNlTGlzdFRhYmxlLmNvbHVtbignc2ltcGxlU2VhcmNoOm5hbWUnKTsKICAgICAgICAgICAgaWYgKGRhdGFFbGVtZW50cy5kYXRhKCJzYXZlLWZvcm0tc3RhdGUiKSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgc2VhcmNoRm9ybVN0YXRlLnNhdmVTdGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIHB2aS51c2VyLnN0YXRlLnNhdmVTdGF0ZShzZWFyY2hGb3JtU3RhdGUuZ2V0U3RhdGUoKSwgc2VhcmNoRm9ybU5hbWUsIHB2aV9wYWdlX3NlY3Rpb25fbmFtZS5mb3JtX3NlY3Rpb24pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWFyY2hGb3JtU3RhdGUuY2xlYXJTdGF0ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbHVtbi5zZWFyY2goKHZhbHVlID8gdmFsdWUgOiBudWxsKSk7CiAgICAgICAgICAgIGRhdGFUYWJsZU9wdGlvbnMubG9hZERhdGEgPSB0cnVlOwogICAgICAgICAgICBpbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgICAgIGRyYXdUYWJsZSgpOwogICAgICAgIH07CgogICAgICAgIHZhciBkcmF3VGFibGUgPSBmdW5jdGlvbihwYWdpbmcpewogICAgICAgICAgICBpZihkYXRhVGFibGVPcHRpb25zLmxvYWREYXRhKSB7CiAgICAgICAgICAgICAgICBpc0Rhc2hib2FyZFBhZ2UgPyBwdnVpLmNvbW1vbi5wdldpZGdldExvYWRlci5oaWRlTG9hZGVyKGNvbnRhaW5lcikgOiBwdnVpLmNvbW1vbi5oaWRlUFZMb2FkZXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihfLmlzVW5kZWZpbmVkKHBhZ2luZykpewogICAgICAgICAgICAgICAgY2FzZUxpc3RUYWJsZS5kcmF3KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjYXNlTGlzdFRhYmxlLmRyYXcocGFnaW5nKTsKICAgICAgICAgICAgICAgIGlmKCFkYXRhVGFibGVPcHRpb25zLmxvYWREYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcHZ1aS5jb21tb24uaGlkZVBWTG9hZGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjb250YWluZXIub24oJ2xpc3QuZGF0YS50YWJsZS5jbGVhci5yb3dzJyxmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGRhdGFUYWJsZU9wdGlvbnMubG9hZERhdGEgPSBmYWxzZTsKICAgICAgICAgICAgZHJhd1RhYmxlKCk7CiAgICAgICAgICAgIGRhdGFUYWJsZU9wdGlvbnMubG9hZERhdGEgPSB0cnVlOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgaW5pdERpc3BsYXlMZW5ndGggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcuaW5wLWRpc3BsYXktcmVjb3JkJykuY2hhbmdlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBkaXNwbGF5TGVuZ3RoID0gY29udGFpbmVyLmZpbmQoJy5pbnAtZGlzcGxheS1yZWNvcmQnKS52YWwoKTsKICAgICAgICAgICAgICAgIGNhc2VMaXN0VGFibGUucGFnZS5sZW4oZGlzcGxheUxlbmd0aCk7CiAgICAgICAgICAgICAgICBkcmF3VGFibGUoZmFsc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICB2YXIgaGFuZGxlX2luY2x1ZGUgPSBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgc2hvd1JhbmdlRmFjdG9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJyNyYW5nZS1mYWN0b3ItZmllbGQtY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgIGhpZGVDdXN0b21SYW5nZUZhY3RvcigpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5maW5kKCcjcmFuZ2UtZmFjdG9yLWZpZWxkJykudmFsKCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgaGlkZVJhbmdlRmFjdG9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJyNyYW5nZS1mYWN0b3ItZmllbGQtY29udGFpbmVyJykuYWRkQ2xhc3MoJ2hpZGUnKS5maW5kKCdpbnB1dCcpLnZhbCgnJyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgc2hvd0N1c3RvbVJhbmdlRmFjdG9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaGlkZVJhbmdlRmFjdG9yKCk7CiAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnI3B2aUxpc3RDdXN0b21EYXRlcmFuZ2UnKS5yZW1vdmVDbGFzcygnaGlkZScpLmZpbmQoImlucHV0IikudmFsKCcnKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBoaWRlQ3VzdG9tUmFuZ2VGYWN0b3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnI3B2aUxpc3RDdXN0b21EYXRlcmFuZ2UnKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIHR5cGUgPSBjb250YWluZXIuZmluZCgnI2RhdGUtcmFuZ2UtdHlwZScpLnZhbCgpOwogICAgICAgICAgICB2YXIgcmFuZ2UgPSBjb250YWluZXIuZmluZCgnI3B2aUxpc3REYXRlUmFuZ2UnKS52YWwoKTsKCiAgICAgICAgICAgIGhpZGVSYW5nZUZhY3RvcigpOwogICAgICAgICAgICBoaWRlQ3VzdG9tUmFuZ2VGYWN0b3IoKTsKCiAgICAgICAgICAgIGlmIChvbmVDbGlja1R5cGVzLmluZGV4T2YocmFuZ2UpID4gLTEpIHsKICAgICAgICAgICAgICAgIGhpZGVSYW5nZUZhY3RvcigpOwogICAgICAgICAgICAgICAgaGlkZUN1c3RvbVJhbmdlRmFjdG9yKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHdvQ2xpY2tUeXBlcy5pbmRleE9mKHJhbmdlKSA+IC0xKSB7CiAgICAgICAgICAgICAgICBzaG93UmFuZ2VGYWN0b3IoKTsKICAgICAgICAgICAgICAgIGhpZGVDdXN0b21SYW5nZUZhY3RvcigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmdlID09PSAnQ1VTVE9NJykgewogICAgICAgICAgICAgICAgaGlkZVJhbmdlRmFjdG9yKCk7CiAgICAgICAgICAgICAgICBzaG93Q3VzdG9tUmFuZ2VGYWN0b3IoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBpbml0QWxsQ2FzZXNCdXR0b24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcuYWxsQ2FzZXNCdXR0b24nKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgY29sdW1uID0gY2FzZUxpc3RUYWJsZS5jb2x1bW4oJ2Fzc2lnbmVkVG9Vc2VybmFtZTpuYW1lJyk7CiAgICAgICAgICAgICAgICBjb2x1bW4uc2VhcmNoKCcnKTsKICAgICAgICAgICAgICAgICQoY29sdW1uLmhlYWRlcigpKS5maW5kKCcjYXNzaWduZWUtZmlsdGVyJykudmFsKCcnKS50cmlnZ2VyKCdjaGFuZ2Uuc2VsZWN0MicpOwogICAgICAgICAgICAgICAgaGlnaGxpZ2h0VGFiKCk7CiAgICAgICAgICAgICAgICBkcmF3VGFibGUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgY29udGFpbmVyLmZpbmQoJyNkYXRlLXJhbmdlLXR5cGUsICNwdmlMaXN0RGF0ZVJhbmdlJykub24oJ2NoYW5nZScsIGhhbmRsZV9pbmNsdWRlKTsKCiAgICAgICAgdmFyIGlzQW55Q2FzZUNoZWNrZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAoY29udGFpbmVyLmZpbmQoJ2Rpdi5wdi1pbmNsdWRlLWNhc2VzLWxpc3QgaW5wdXQ6Y2hlY2tib3g6Y2hlY2tlZCcpLmxlbmd0aCA+IDApOwogICAgICAgIH07CgogICAgICAgIGNvbnRhaW5lci5maW5kKCcucHYtc291cmNlLWRhdGFiYXNlJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmICghJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgICAgICAgICAgaWYgKGdldFNvdXJjZURhdGFiYXNlcygpLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgICAgICAgICBzd2FsKCIiLCBnZXRNZXNzYWdlKCJzb3VyY2VfZGJfd2FybmluZ19tc2ciKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja2VkID0gIXRoaXMuY2hlY2tlZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBIYW5kbGluZyBzZWFyY2ggaGVyZQogICAgICAgIHZhciBoYW5kbGVTZWFyY2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmKGlzQW55Q2FzZUNoZWNrZWQoKSl7CiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoQ3JpdGVyaWEgPSBidWlsZFNpbXBsZVNlYXJjaENyaXRlcmlhKCk7CiAgICAgICAgICAgICAgICBpZiAoIV8uaXNFbXB0eShzZWFyY2hDcml0ZXJpYSkpIHsKICAgICAgICAgICAgICAgICAgICBkb1NpbXBsZVNlYXJjaChKU09OLnN0cmluZ2lmeShzZWFyY2hDcml0ZXJpYSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2hvd1dhcm5pbmcoIiIsIGdldE1lc3NhZ2UoJ3NlbGVjdF9hX2Nhc2UnKSwgIiIsIHB2aV9jb25zdGFudHMuc3VjY2Vzc19idG5fbGFiZWwsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBzd2FsLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBoYW5kbGVMaXN0RXhwb3J0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgICAgICAgICAgdXJsOiBwdmlfdXJscy5saXN0X2V4cG9ydF91cmwgKyBwYWdlVHlwZUlkLAogICAgICAgICAgICAgICAgZGF0YTogY2FzZUxpc3RUYWJsZS5hamF4LnBhcmFtcygpLAogICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLnNob3dQVkxvYWRlcigpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBleHBvcnRMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgICAgIGV4cG9ydExpbmsuaHJlZiA9IHB2aV91cmxzLmxpc3RfZXhwb3J0X3JlcG9ydF9kb3dubG9hZF91cmwgKyByZXNwb25zZS5maWxlbmFtZTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGV4cG9ydExpbmspOwogICAgICAgICAgICAgICAgICAgIGV4cG9ydExpbmsuY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICBwdnVpLmNvbW1vbi5oaWRlUFZMb2FkZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgY29udGFpbmVyLmZpbmQoJy5zZWFyY2gtYnV0dG9uJykuY2xpY2soaGFuZGxlU2VhcmNoKTsKICAgICAgICBjb250YWluZXIuZmluZCgnI2V4cG9ydC1leGNlbC1idXR0b24nKS5jbGljayhoYW5kbGVMaXN0RXhwb3J0KTsKCiAgICAgICAgY29udGFpbmVyLmZpbmQoJyNwdmlDYXNlU2VhcmNoSWNvbicpLmNsaWNrKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJyNwdmlDYXNlU3JjU2VjJykudG9nZ2xlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgJCgiYm9keSIpLnRvZ2dsZUNsYXNzKCJ0b3Atc2VhcmNoLWVuYWJsZWQiKTsKICAgICAgICAgICAgcHZ1aS5ncmlkLnV0aWxzLnNldEdyaWRIZWlnaHQoY29udGFpbmVyKTsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGluaXRNeUNhc2VzQnV0dG9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb250YWluZXIuZmluZCgnLm15Q2FzZXNCdXR0b24nKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgY29sdW1uID0gY2FzZUxpc3RUYWJsZS5jb2x1bW4oJ2Fzc2lnbmVkVG9Vc2VybmFtZTpuYW1lJyk7CiAgICAgICAgICAgICAgICBjb2x1bW4uc2VhcmNoKGxvZ2luVXNlcik7CiAgICAgICAgICAgICAgICAkKGNvbHVtbi5oZWFkZXIoKSkuZmluZCgnI2Fzc2lnbmVlLWZpbHRlcicpLnZhbChsb2dpblVzZXIpLnRyaWdnZXIoImNoYW5nZS5zZWxlY3QyIik7CiAgICAgICAgICAgICAgICBoaWdobGlnaHRUYWIoKTsKICAgICAgICAgICAgICAgIGRyYXdUYWJsZSgpOwogICAgICAgICAgICB9KQogICAgICAgIH07CgogICAgICAgIHZhciBzYXZlQ29sdW1ucyA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHZhciBidWlsZENvbHVtbkNvbmZpZ0xpc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgb3JkZXIgPSAwOwogICAgICAgICAgICAgICAgdmFyIHNlY29uZE9yZGVyID0gMDsKICAgICAgICAgICAgICAgIF8uZWFjaChjb2x1bW5Db25maWdzLCBmdW5jdGlvbiAoZWxlKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlLmxpc3RPcmRlciA9IDk5OTk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfLmVhY2gobGlzdENvbHVtbnMocHZpX2xpc3RfY29sdW1uc192aWV3LnByaW1hcnlDb2xzKSwgZnVuY3Rpb24gKGVsZSkgewogICAgICAgICAgICAgICAgICAgIGVsZS5saXN0T3JkZXIgPSBvcmRlcisrOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgXy5lYWNoKGxpc3RDb2x1bW5zKHB2aV9saXN0X2NvbHVtbnNfdmlldy5zZWNvbmRhcnlDb2xzKSwgZnVuY3Rpb24gKGVsZSkgewogICAgICAgICAgICAgICAgICAgIGVsZS5saXN0T3JkZXIgPSBzZWNvbmRPcmRlcisrOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGNvbHVtbkNvbmZpZ3M7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgY29sTGlzdCA9IGJ1aWxkQ29sdW1uQ29uZmlnTGlzdCgpOwogICAgICAgICAgICBjb2xSZW9yZGVyQ2FzZUxpc3QoKTsKICAgICAgICAgICAgZHJhd1RhYmxlKHRydWUpOwogICAgICAgICAgICBiaW5kTGlzdEZpbHRlckV2ZW50TGlzdGVuZXJzKCk7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiBjcmVhdGVVUkwocHZpX3VybHMuY2FzZV9saXN0X3VwZGF0ZV9jb2x1bW5zX3VybCksCiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGNvbExpc3QpLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICBwdnVpLmNvbW1vbi5zaG93UFZMb2FkZXIoKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgcHZ1aS5jb21tb24uaGlkZVBWTG9hZGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaXRlbURyYWdnZWQgPSBmYWxzZTsKICAgICAgICB9OwoKICAgICAgICB2YXIgaW5pdERyYWdnYWJsZVBhbmVsID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgdmFyIGJ1aWxkX2NvbHVtbl9saXN0ID0gZnVuY3Rpb24gKHBhcmVudENvbXAsIGNvbnRhaW5lck51bWJlciwgZGVmYXVsdFZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgbGlzdE9yZGVyID0gMDsKCiAgICAgICAgICAgICAgICB2YXIgc2V0U2VxID0gZnVuY3Rpb24gKGVsZU5hbWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gXy5maW5kKGRlZmF1bHRWYWx1ZSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4ubmFtZSA9PT0gZWxlTmFtZTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqLnNlcTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgcmV0dXJuIF8ucmVkdWNlKHBhcmVudENvbXAuY2hpbGRyZW4oImEubGlzdC1ncm91cC1pdGVtIiksIGZ1bmN0aW9uIChtZW1vLCBlbGUpIHsKICAgICAgICAgICAgICAgICAgICBlbGUgPSAkKGVsZSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gZWxlLmh0bWwoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGVsZS5hdHRyKCdkYXRhLWZpZWxkJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9OwogICAgICAgICAgICAgICAgICAgIG9iai5sYWJlbCA9IGxhYmVsOwogICAgICAgICAgICAgICAgICAgIG9iai5uYW1lID0gbmFtZTsKICAgICAgICAgICAgICAgICAgICBvYmouY29udGFpbmVyVmlldyA9IGNvbnRhaW5lck51bWJlcjsKICAgICAgICAgICAgICAgICAgICBvYmouc2VxID0gc2V0U2VxKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIG9iai5saXN0T3JkZXIgPSBsaXN0T3JkZXIrKzsKICAgICAgICAgICAgICAgICAgICBtZW1vLnB1c2gob2JqKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVtbzsKICAgICAgICAgICAgICAgIH0sIFtdKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcjY29uZmlnLXZpZXctYnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBwdnVpLmdyaWQudXRpbHMubWFuYWdlTGlzdGluZ1VJLnNob3dTZXR0aW5nUGFuZWwoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgaGlkZUZpZWxkID0gZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcubGlzdC1maWx0ZXInKS5zaG93KCk7CiAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnLnNlbGVjdDItY29udGFpbmVyJykuc2hvdygpOwogICAgICAgICAgICAgICAgcHZ1aS5ncmlkLm1hbmFnZVVJV3JhcHBlci50b2dnbGVHcmlkRmlsdGVyKGNvbnRhaW5lciwge2RhdGVGb3JtYXQ6KChwdmkudXRpbC5nZXREYXRlRm9ybWF0cy5saXN0RGF0ZUZvcm1hdCkudG9VcHBlckNhc2UoKSl9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBwcm9jZXNzTGlzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGhpZGVGaWVsZCgpOwogICAgICAgICAgICAgICAgdmFyIHRtcENvbmZpZ3MgPSBidWlsZF9jb2x1bW5fbGlzdChjb250YWluZXIuZmluZCgnLmxpc3QtZ3JvdXAtcHJpbWFyeScpLCAxLCBjb2x1bW5Db25maWdzKTsKICAgICAgICAgICAgICAgIHRtcENvbmZpZ3MgPSB0bXBDb25maWdzLmNvbmNhdChidWlsZF9jb2x1bW5fbGlzdChjb250YWluZXIuZmluZCgnLmxpc3QtZ3JvdXAtc2Vjb25kYXJ5JyksIDIsIGNvbHVtbkNvbmZpZ3MpKTsKICAgICAgICAgICAgICAgIHRtcENvbmZpZ3MgPSB0bXBDb25maWdzLmNvbmNhdChidWlsZF9jb2x1bW5fbGlzdChjb250YWluZXIuZmluZCgnLmxpc3QtZ3JvdXAtb3B0aW9uYWwnKSwgMywgY29sdW1uQ29uZmlncykpOwogICAgICAgICAgICAgICAgY29sdW1uQ29uZmlncyA9IHRtcENvbmZpZ3M7CiAgICAgICAgICAgICAgICBwdmkubGlzdC5jb21tb25GdW5jdGlvbnMuc2V0Q29sdW1uVmlzaWJpbGl0eShjb2x1bW5Db25maWdzLCBjYXNlTGlzdFRhYmxlKTsKICAgICAgICAgICAgICAgIHNhdmVDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBzZXRDYXNlR3JpZFNlY29uZGFyeVN0eWxlKCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb250YWluZXIuZmluZCgiI2J0blNhdmVMaXN0Q29uZmlnIikudW5iaW5kKCdjbGljaycpLm9uKCdjbGljaycsZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGlmIChpdGVtRHJhZ2dlZCkgewogICAgICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLnNob3dQVkxvYWRlcigpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2dWkuZ3JpZC51dGlscy5tYW5hZ2VMaXN0aW5nVUkuaGlkZVNldHRpbmdQYW5lbCgpOwogICAgICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwdnVpLmdyaWQudXRpbHMubWFuYWdlTGlzdGluZ1VJLmhpZGVTZXR0aW5nUGFuZWwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb250YWluZXIuZmluZCgiLmRpc3BsYXktY29uZmlnLWZpZWxkLCAuZGlzcGxheS1jb25maWctZmllbGQyLCAuZGlzcGxheS1jb25maWctZmllbGQzIikuc29ydGFibGUoewogICAgICAgICAgICAgICAgY29ubmVjdFdpdGg6ICIuc2hvcnQtZmllbGQiCiAgICAgICAgICAgIH0pLmRpc2FibGVTZWxlY3Rpb24oKTsKCiAgICAgICAgICAgIHZhciBpbml0aWFsID0gW107CgogICAgICAgICAgICBjb250YWluZXIuZmluZCgnLmRpc3BsYXktY29uZmlnLWZpZWxkLCAuZGlzcGxheS1jb25maWctZmllbGQyLCAuZGlzcGxheS1jb25maWctZmllbGQzJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGFuY2hvcikgewogICAgICAgICAgICAgICAgaW5pdGlhbC5wdXNoKGFuY2hvci5pbm5lckhUTUwpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzaG93V2FybmluZ09uQXJyYW5naW5nRmllbGRzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2hvd1dhcm5pbmcoZ2V0TWVzc2FnZSgiY2xvc2VfYnRuX3dhcm5pbmdfdGl0bGUiKSwgZ2V0TWVzc2FnZSgiY2xvc2VfYnRuIiksICJObyIsICJZZXMiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5kaXNwbGF5LWNvbmZpZy1maWVsZCwgLmRpc3BsYXktY29uZmlnLWZpZWxkMiwgLmRpc3BsYXktY29uZmlnLWZpZWxkMycpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBhbmNob3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yLmlubmVySFRNTCA9IGluaXRpYWxbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGl0ZW1EcmFnZ2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgcHZ1aS5ncmlkLnV0aWxzLm1hbmFnZUxpc3RpbmdVSS5oaWRlU2V0dGluZ1BhbmVsKCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbHVtbnNCYXIub24oImNsaWNrIiwgKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIHB2dWkuZ3JpZC5tYW5hZ2VVSVdyYXBwZXIuY2xvc2VTZXR0aW5nUGFuZWwoc2hvd1dhcm5pbmdPbkFycmFuZ2luZ0ZpZWxkcywgY29udGFpbmVyLmZpbmQoIiNidG5DbG9zZUxpc3RDb25maWciKSk7CiAgICAgICAgICAgIHB2dWkuZ3JpZC5tYW5hZ2VVSVdyYXBwZXIuY2xvc2VTZXR0aW5nUGFuZWwoc2hvd1dhcm5pbmdPbkFycmFuZ2luZ0ZpZWxkcyk7CgogICAgICAgIH07CgogICAgICAgIGluaXRGaWx0ZXJCdXR0b24oKTsKICAgICAgICBpZighaXNEYXNoYm9hcmRQYWdlKSB7CiAgICAgICAgICAgIHB2aS51dGlsLmJpbmREYXRlUGlja2VycygpOwogICAgICAgIH0KICAgICAgICBwdmkudXRpbC5zZWxlY3QyRmllbGRzKCk7CiAgICAgICAgaW5pdF9jYXNlX2xpc3QoKTsKCiAgICAgICAgdmFyIGJpbmRMaXN0RmlsdGVyRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNhc2VMaXN0VGFibGUuY29sdW1ucygpLmV2ZXJ5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJEZWxheSA9IHBhcnNlSW50KGdldENvbmZpZygndHlwZUFoZWFkLmxpc3RGaWx0ZXJEZWxheScpKTsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCQodGhhdC5oZWFkZXIoKSkpLm9uKCdpbnB1dCBjaGFuZ2UnLCcubGlzdC1maWx0ZXInLCAkLmRlYm91bmNlKGZpbHRlckRlbGF5LCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZ0LnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbHRlck5hbWUgPSB0YXJnZXQuYXR0cignZGF0YS1maWVsZCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBzZWFyY2hWYWx1ZSA9IHRhcmdldC52YWwoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKCdkYXRlLXRpbWUtZmlsdGVyJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoVmFsdWUgPSBwdmkudXRpbC5nZW5lcmF0ZURhdGVSYW5nZShzZWFyY2hWYWx1ZSwgZmlsdGVyTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRhdGFUYWJsZS5EYXRhVGFibGUoKS5jb2x1bW4oZmlsdGVyTmFtZSArICI6bmFtZSIpLnNlYXJjaChzZWFyY2hWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgZHJhd1RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYoZmlsdGVyTmFtZSA9PT0gZml4ZWRGaWx0ZXJDb2xOYW1lKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNPbkZpeGVkQ29sID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJCh0aGF0LmhlYWRlcigpKSkub24oJ2NsaWNrJywgJy5saXN0LWZpbHRlciwgLmRyb3Bkb3duLWxpc3QtZmlsdGVyJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJCh0aGF0LmhlYWRlcigpKSkub24oJ2tleXByZXNzJywgJy5saXN0LWZpbHRlcicsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoZS5rZXlDb2RlID09PSAxMyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGJpbmRMaXN0RmlsdGVyRXZlbnRMaXN0ZW5lcnMoKTsKICAgICAgICBpbml0QWxsQ2FzZXNCdXR0b24oKTsKICAgICAgICBpbml0TXlDYXNlc0J1dHRvbigpOwogICAgICAgIGluaXREcmFnZ2FibGVQYW5lbCgpOwogICAgICAgIGluaXREaXNwbGF5TGVuZ3RoKCk7CiAgICAgICAgaW5pdGlhbGl6ZUJ1bGtBY3Rpb24oKTsKICAgICAgICBub0FjdGlvbkFsbG93ZWRCdXR0b24oKTsKICAgICAgICBub0J1bGtBY3Rpb25BbGxvd2VkQnV0dG9uKCk7CiAgICAgICAgY29sUmVvcmRlckNhc2VMaXN0KCk7CiAgICAgICAgaW5pdGlhbGl6ZWQgPSAoaXNPbkR1cGxpY2F0ZVNlYXJjaFBhZ2UgJiYgIWRhdGFUYWJsZU9wdGlvbnMuY2FzZUlkQXZhaWxhYmxlKSA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICBkcmF3VGFibGUoZmFsc2UpOwogICAgICAgIHB2dWkuZ3JpZC51dGlscy5odG1sT3ZlcmZsb3dZSGlkZGVuKCk7CiAgICB9OwoKICAgIHZhciBzZWNvbmRhcnlDb2x1bW5zRXhpc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF8uZmluZChjb2x1bW5Db25maWdzLCBmdW5jdGlvbiAoY29sKSB7CiAgICAgICAgICAgIHJldHVybiBjb2wuY29udGFpbmVyVmlldyA9PT0gMjsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIHNldENhc2VHcmlkU2Vjb25kYXJ5U3R5bGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYoc2Vjb25kYXJ5Q29sdW1uc0V4aXN0KCkpewogICAgICAgICAgICBkYXRhVGFibGUucmVtb3ZlQ2xhc3MoJ25vLXNlY29uZGFyeScpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZGF0YVRhYmxlLmFkZENsYXNzKCduby1zZWNvbmRhcnknKTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBsaXN0Q29sdW1ucyA9IGZ1bmN0aW9uIChjb250YWluZXJWaWV3T2JqLCBzb3J0KSB7CiAgICAgICAgdmFyIGxpc3RDb2x1bW5zID0gXy5maWx0ZXIoY29sdW1uQ29uZmlncywgZnVuY3Rpb24gKGVsZSkgewogICAgICAgICAgICByZXR1cm4gZWxlLmNvbnRhaW5lclZpZXcgPT09IGNvbnRhaW5lclZpZXdPYmouY0lkOwogICAgICAgIH0pOwogICAgICAgIGlmIChzb3J0KSB7CiAgICAgICAgICAgIGxpc3RDb2x1bW5zID0gbGlzdENvbHVtbnMuc29ydChmdW5jdGlvbihhLGIpIHsKICAgICAgICAgICAgICAgIHZhciB2YXJBID0gYVtjb250YWluZXJWaWV3T2JqLnNvcnRCeVByb3BdOwogICAgICAgICAgICAgICAgdmFyIHZhckIgPSBiW2NvbnRhaW5lclZpZXdPYmouc29ydEJ5UHJvcF07CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhckEgPT09ICdzdHJpbmcnIHx8IHZhckEgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFyQS5sb2NhbGVDb21wYXJlKHZhckIsIHVuZGVmaW5lZCwge3NlbnNpdGl2aXR5OiAnYmFzZScgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YXJBID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YXJBIC0gdmFyQjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsaXN0Q29sdW1uczsKICAgIH07CgogICAgdmFyIG1hbmFnZUJ1bGtBY3Rpb24gPSAoZnVuY3Rpb24gKCkgewoKICAgICAgICB2YXIgZ2V0Rmlyc3RTZWxlY3RlZFN0YXRlRm9yQnVsa09wcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5maW5kKCIubGlzdC1yb3ctY2hlY2tib3g6Y2hlY2tlZCIpLmVxKDApLmRhdGEoImNhc2Utc3RhdGUiKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgaXNTYW1lU3RhdGVTZWxlY3RlZCA9IGZ1bmN0aW9uIChpbml0aWFsU3RhdGUpIHsKICAgICAgICAgICAgdmFyIGlzU2FtZVN0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoIi5saXN0LXJvdy1jaGVja2JveDpjaGVja2VkIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCJjYXNlLXN0YXRlIikgIT09IGluaXRpYWxTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgIGlzU2FtZVN0YXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGlzU2FtZVN0YXRlOwogICAgICAgIH07CgogICAgICAgIHZhciBzaG93SGlkZUJ1bGtBY3Rpb25CdXR0b24gPSBmdW5jdGlvbiAoc2hvdykgewogICAgICAgICAgICB2YXIgYnVsa0FjdGlvbkJ0biA9IGNvbnRhaW5lci5maW5kKCIuYnRuLWNhc2VsaXN0LWFjdGlvbi1hbGwiKTsKICAgICAgICAgICAgYnVsa0FjdGlvbkJ0bi5yZW1vdmVDbGFzcygibm9CdWxrQWN0aW9uQWxsb3dlZCIpOwogICAgICAgICAgICB2YXIgc2VsZWN0ZWRTdGF0ZSA9IHNob3cgPyBnZXRGaXJzdFNlbGVjdGVkU3RhdGVGb3JCdWxrT3BzKCk6IGZhbHNlOwogICAgICAgICAgICB2YXIgaXNTYW1lU3RhdGUgPSBzaG93ID8gaXNTYW1lU3RhdGVTZWxlY3RlZChzZWxlY3RlZFN0YXRlKTogZmFsc2U7CgogICAgICAgICAgICBpZihzaG93KSB7CiAgICAgICAgICAgICAgICBidWxrQWN0aW9uQnRuLnJlbW92ZUNsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0ge3RtcGxOYW1lOiAnYnVsa0FjdGlvbicsIHBhZ2VJZDogcGFnZVR5cGVJZCwgZGF0YU9iajoge2Nhc2VTdGF0ZUlkOiBzZWxlY3RlZFN0YXRlLGNvbnRhaW5lcklkOiBjb250YWluZXJJZH19OwogICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlU3RyaW5nID0gcHZpLnV0aWwubWFuYWdlQWN0aW9uVmlld3MoKS5pbml0QnVsayhwYXJhbXMpOwogICAgICAgICAgICAgICAgaWYgKHRlbXBsYXRlU3RyaW5nID09PSAnJykgewogICAgICAgICAgICAgICAgICAgIGJ1bGtBY3Rpb25CdG4uYWRkQ2xhc3MoIm5vQnVsa0FjdGlvbkFsbG93ZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBidWxrQWN0aW9uQ29udGFpbmVyID0gY29udGFpbmVyLmZpbmQoIiNidWxrQWN0aW9uQ29udGFpbmVyIik7CiAgICAgICAgICAgICAgICBidWxrQWN0aW9uQ29udGFpbmVyLmZpbmQoInVsIikucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICBidWxrQWN0aW9uQ29udGFpbmVyLmh0bWwoYnVsa0FjdGlvbkNvbnRhaW5lci5odG1sKCkgKyB0ZW1wbGF0ZVN0cmluZyk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzaG93ICYmICFpc1NhbWVTdGF0ZSkgewogICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgiLmJ1bGstYWN0aW9uLWxpc3QiKS5maW5kKCJsaS5idWxrLWFjdGlvbjpub3QoLmFzc2lnbkFsbCkiKS5hZGRDbGFzcygiaGlkZSIpOwogICAgICAgICAgICB9ZWxzZSBpZighc2hvdykgewogICAgICAgICAgICAgICAgYnVsa0FjdGlvbkJ0bi5hZGRDbGFzcygiaGlkZSIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoc2hvd0J0bikgewogICAgICAgICAgICBzaG93SGlkZUJ1bGtBY3Rpb25CdXR0b24oc2hvd0J0bik7CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaW5pdDogaW5pdAogICAgICAgIH0KCiAgICB9KSgpOwoKICAgIHZhciB1bmNoZWNrU2VsZWN0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29udGFpbmVyLmZpbmQoJy5wdi1jYXNlbGlzdC1jaGVja2FsbCcpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7CiAgICB9OwoKICAgIHZhciByZUluaXRCdXR0b25zQWZ0ZXJSZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29udGFpbmVyLm9uKCdjaGFuZ2UnLCAnI2J1bGstc2VsZWN0LWJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB2YXIgaXNNdWx0aXBsZUNoZWNrZWQgPSAkKHRoaXMpLmlzKCc6Y2hlY2tlZCcpOwogICAgICAgICAgICBjb250YWluZXIuZmluZCgnLmxpc3Qtcm93LWNoZWNrYm94JykucHJvcCgnY2hlY2tlZCcsIGlzTXVsdGlwbGVDaGVja2VkKTsKICAgICAgICAgICAgbWFuYWdlQnVsa0FjdGlvbi5pbml0KGlzTXVsdGlwbGVDaGVja2VkKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgaW5pdF9jYXNlX2xpc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpc3REYXRhQ29udGFpbmVyRGl2ID0gY29udGFpbmVyLmZpbmQoIiNsaXN0LWRhdGEtZWxlbWVudHMiKTsKICAgICAgICB2YXIgb3JkZXJCeURlZmF1bHQgPSBsaXN0RGF0YUNvbnRhaW5lckRpdi5kYXRhKCJvcmRlci1ieS1kZWZhdWx0Iik7CiAgICAgICAgdmFyIHBhZ2luZyA9IGxpc3REYXRhQ29udGFpbmVyRGl2LmRhdGEoInBhZ2luZyIpOwogICAgICAgIHZhciBsZW5ndGhDaGFuZ2UgPSBsaXN0RGF0YUNvbnRhaW5lckRpdi5kYXRhKCdsZW5ndGgtY2hhbmdlJyk7CiAgICAgICAgdmFyIHNob3dJbmZvID0gbGlzdERhdGFDb250YWluZXJEaXYuZGF0YSgnc2hvdy1pbmZvJyk7CiAgICAgICAgdmFyIGlzV2lkZ2V0ID0gbGlzdERhdGFDb250YWluZXJEaXYuZGF0YSgiaXMtd2lkZ2V0Iik7CiAgICAgICAgdmFyIGNsZWFyQ2FjaGVPblJlZnJlc2ggPSBsaXN0RGF0YUNvbnRhaW5lckRpdi5kYXRhKCJjbGVhci1jYWNoZS1vbi1yZWZyZXNoIik7CgogICAgICAgIHZhciB2aXNpYmxlID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIHYgPSBfLmZpbmQoY29sdW1uQ29uZmlncywgZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIChvYmoubmFtZSA9PT0gbmFtZSAmJiBvYmouY29udGFpbmVyVmlldyA9PT0gMSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gISBfLmlzRW1wdHkodik7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHJlbmRlclZhbHVlTG9va3VwID0gZnVuY3Rpb24gKGRhdGEsIGVuY29kZVRvSFRNTCkgewogICAgICAgICAgICB2YXIgcmVzID0gIiI7CiAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEudmFsdWUpIHsKICAgICAgICAgICAgICAgIHJlcyA9ICh0eXBlb2YgZW5jb2RlVG9IVE1MICE9PSAidW5kZWZpbmVkIiAmJiAhZW5jb2RlVG9IVE1MKSA/IGRhdGEudmFsdWU6IHB2aS51dGlsLmVuY29kZVRvSFRNTChkYXRhLnZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH07CgogICAgICAgIHZhciByZW5kZXJOYW1lTG9va3VwID0gZnVuY3Rpb24gKGRhdGEsIGVuY29kZVRvSFRNTCkgewogICAgICAgICAgICB2YXIgcmVzID0gIiI7CiAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEubmFtZSkgewogICAgICAgICAgICAgICAgcmVzID0gKHR5cGVvZiBlbmNvZGVUb0hUTUwgIT09ICJ1bmRlZmluZWQiICYmICFlbmNvZGVUb0hUTUwpID8gZGF0YS5uYW1lOiBwdmkudXRpbC5lbmNvZGVUb0hUTUwoZGF0YS5uYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH07CgogICAgICAgIHZhciByZW5kZXJMYWJlbFdpdGhPcHRpb25zID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgdmFyIHJlcyA9ICIiOwogICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgdmFyIGluZm9JY29uID0gXy5pc0VtcHR5KGRhdGEucmVwb3J0TWVzc2FnZSkgPyAiIiA6ICImbmJzcCA8aSBjbGFzcz0nZmEgZmEtaW5mby1jaXJjbGUgbW9yZS1vcHRpb24gcmVwb3J0U3RhdGVNZXNzYWdlJyBkYXRhLWNvbnRlbnQ9JyIgKyAiPHA+IiArIGRlZmF1bHRSZW5kZXIoZGF0YS5yZXBvcnRNZXNzYWdlKSArICI8L3A+IiArICInPjwvaT4iOwogICAgICAgICAgICAgICAgcmVzID0gIjxzcGFuIGNsYXNzPSdsYmwtZWxpcHNpcyBsYmwtZWxpcHNpcy1pbmxpbmUnPjxhIGhyZWY9J2phdmFzY3JpcHQ6dm9pZCgwKScgZGF0YS1pZD0iICsgZGF0YS5pZCArICIgY2xhc3M9J3JlcG9ydFN0YXRlJz4iICsgZGVmYXVsdFJlbmRlcihkYXRhLnRyYW5zbWlzc2lvblN0YXR1cykgKyAiPC9hPiIgKyBpbmZvSWNvbiArJzwvc3Bhbj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGtleVZhbHVlUGFpciA9IHsKICAgICAgICAgICAgJ2NsYXNzJzogJ2F0dGFjaG1lbnRSb3cnLAogICAgICAgICAgICAnZGF0YS1maWxlbmFtZSc6ICduYW1lJywKICAgICAgICAgICAgJ2RhdGEtc3RvcmFnZWlkJzogJ2lkJywKICAgICAgICAgICAgJ2RhdGEtcmVkYWN0JzoncmVkYWN0JwogICAgICAgIH07CgogICAgICAgIHZhciBhcHBlbmRMaW5rID0gZnVuY3Rpb24gKG5hbWUsIGRhdGFzLCBmaWVsZE5hbWUsIG5ld1Byb3BlcnR5TmFtZSkgewogICAgICAgICAgICB2YXIgZGF0YUxlbmd0aCA9IGRhdGFzLmxlbmd0aDsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhID0gZGF0YXNbaV07CiAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlcyA9ICcnOwogICAgICAgICAgICAgICAgdmFyIGFuY2hvckxpbmsgPSAnJzsKICAgICAgICAgICAgICAgIGZvciAocHJvcCBpbiBrZXlWYWx1ZVBhaXIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBuZXdEYXRhW2tleVZhbHVlUGFpcltwcm9wXV07CiAgICAgICAgICAgICAgICAgICAgaWYgKF8uY29udGFpbnMoWydjbGFzcyddLCBwcm9wKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGtleVZhbHVlUGFpcltwcm9wXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYocHJvcCA9PT0gJ2RhdGEtcmVkYWN0JyAmJiBuZXdEYXRhWydpc1JlZGFjdEV4aXN0cyddID09PSB0cnVlKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzICs9IHByb3AgKyAiPSciICsgdmFsdWUgKyAiJyAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYobmV3RGF0YVsnaXNQcm90ZWN0ZWQnXSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChuZXdEYXRhWydpc1JlZGFjdEV4aXN0cyddID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvckxpbmsgPSAiPHNwYW4gY2xhc3M9J3B2LWljLXJlZGFjdCBpYy1zbSc+PGkgY2xhc3M9J21kIG1kLWFscGhhLXItYm94LW91dGxpbmUnPjwvaT4gPC9zcGFuPjxhIGhyZWY9J2phdmFzY3JpcHQ6dm9pZCgwKScgIiArIGF0dHJpYnV0ZXMgKyAiPiIgKyBuZXdEYXRhW2ZpZWxkTmFtZV0gKyAiPC9hPiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzW2ldW25ld1Byb3BlcnR5TmFtZV0gPSBhbmNob3JMaW5rOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvckxpbmsgPSAiPGEgaHJlZj0namF2YXNjcmlwdDp2b2lkKDApJyBjbGFzcz0ncGlpIHNob3dVbmF1dGhvcmlzZWRNZXNzYWdlJz4iICsgbmV3RGF0YVtmaWVsZE5hbWVdICsgIjwvYT4iOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc1tpXVtuZXdQcm9wZXJ0eU5hbWVdID0gYW5jaG9yTGluazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBhbmNob3JMaW5rID0gIjxhIGhyZWY9J2phdmFzY3JpcHQ6dm9pZCgwKScgIiArIGF0dHJpYnV0ZXMgKyAiPiIgKyBuZXdEYXRhW2ZpZWxkTmFtZV0gKyAiPC9hPiI7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNbaV1bbmV3UHJvcGVydHlOYW1lXSA9IGFuY2hvckxpbms7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGRhdGFzOwogICAgICAgIH07CgogICAgICAgIHZhciByZW5kZXJXaXRoTW9yZU9wdGlvbnNGb3JTdHJpbmcgPSBmdW5jdGlvbiAobmFtZSwgZGF0YXMpIHsKICAgICAgICAgICAgdmFyIHJlcyA9ICIiOwogICAgICAgICAgICBpZiAoZGF0YXMgJiYgZGF0YXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZGF0YXMgPSBkYXRhcy50cmltKCkucmVwbGFjZSgvLCAvZywgJywnKS5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgdmFyIG1vcmVEYXRhID0gW107CiAgICAgICAgICAgICAgICB2YXIgZGF0YUxlbmd0aCA9IGRhdGFzLmxlbmd0aDsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFzW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vcmVEYXRhLnB1c2ggKGRhdGFzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtb3JlRGF0YSA9IG1vcmVEYXRhLmpvaW4oIiwgIik7CiAgICAgICAgICAgICAgICB2YXIgaHRtbEVuY29kZWREYXRhID0gcHZpLnV0aWwuZW5jb2RlVG9IVE1MKG1vcmVEYXRhKTsKICAgICAgICAgICAgICAgIHZhciBxdW90ZXNDb252ZXJ0ZWREYXRhID0gaHRtbEVuY29kZWREYXRhLnJlcGxhY2UoLyIvZywgIiciKTsKICAgICAgICAgICAgICAgIHJlcyA9ICc8c3BhbiBjbGFzcz0ib25lLXJvdy1lbGlwc2lzIHB2anNfb3V0ZXItbW9yZS1ib3giIGRhdGEtbmFtZT0iJytuYW1lKyciIGRhdGEtbW9yZT0iJysKICAgICAgICAgICAgICAgICAgICBxdW90ZXNDb252ZXJ0ZWREYXRhKyciPjxzcGFuIGNsYXNzPSJwdmpzX2lubmVyLW1vcmUtYm94Ij4nICsgaHRtbEVuY29kZWREYXRhICsgJzwvc3Bhbj48L3NwYW4+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH07CgogICAgICAgIHZhciByZW5kZXJXaXRoTW9yZU9wdGlvbnMgPSBmdW5jdGlvbiAobmFtZSwgZGF0YXMsIGZpZWxkTmFtZSwgZW5jb2RlVG9IVE1MKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSAiIjsKICAgICAgICAgICAgaWYgKGRhdGFzICYmIGRhdGFzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHZhciBtb3JlRGF0YSA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGRhdGFMZW5ndGggPSBkYXRhcy5sZW5ndGg7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGFMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmKGRhdGFzW2ldKQogICAgICAgICAgICAgICAgICAgICAgICBtb3JlRGF0YS5wdXNoIChkYXRhc1tpXVtmaWVsZE5hbWVdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1vcmVEYXRhID0gbW9yZURhdGEuam9pbigiLCAiKTsKICAgICAgICAgICAgICAgIHZhciBodG1sRW5jb2RlZERhdGE7CiAgICAgICAgICAgICAgICB2YXIgcXVvdGVzQ29udmVydGVkRGF0YTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZW5jb2RlVG9IVE1MICE9PSAidW5kZWZpbmVkIiAmJiAhZW5jb2RlVG9IVE1MKSB7CiAgICAgICAgICAgICAgICAgICAgaHRtbEVuY29kZWREYXRhID0gbW9yZURhdGE7CiAgICAgICAgICAgICAgICAgICAgcXVvdGVzQ29udmVydGVkRGF0YSA9IG1vcmVEYXRhOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBodG1sRW5jb2RlZERhdGEgPSBwdmkudXRpbC5lbmNvZGVUb0hUTUwobW9yZURhdGEpOwogICAgICAgICAgICAgICAgICAgIHF1b3Rlc0NvbnZlcnRlZERhdGEgPSBwdmkudXRpbC5jb252ZXJ0VG9TaW5nbGVRdW90ZShodG1sRW5jb2RlZERhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0ID0gJzxzcGFuIGNsYXNzPSJvbmUtcm93LWVsaXBzaXMgcHZqc19vdXRlci1tb3JlLWJveCIgZGF0YS1uYW1lPSInKyBkZWZhdWx0UmVuZGVyKG5hbWUsIHRydWUpICsnIiBkYXRhLW1vcmU9IicrCiAgICAgICAgICAgICAgICAgICAgcXVvdGVzQ29udmVydGVkRGF0YSArJyI+JyArJzxzcGFuIGNsYXNzPSInKyhmaWVsZE5hbWUgPT09ICdsaW5rJyA/ICdwdmpzX2lubmVyLW1vcmUtYm94IGRpc2FibGVIdG1sRW5jb2RlJyA6ICdwdmpzX2lubmVyLW1vcmUtYm94JykrJyI+JwogICAgICAgICAgICAgICAgICAgICsgaHRtbEVuY29kZWREYXRhICsgJzwvc3Bhbj48L3NwYW4+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH07CgogICAgICAgIHZhciBkZWZhdWx0UmVuZGVyID0gZnVuY3Rpb24gKHN0ciwgY29udmVydFRvU2luZ2xlUXVvdGUpIHsKICAgICAgICAgICAgdmFyIHJlcyA9IHB2aS51dGlsLmVuY29kZVRvSFRNTChzdHIpOwogICAgICAgICAgICBpZiAodHlwZW9mICBjb252ZXJ0VG9TaW5nbGVRdW90ZSAhPT0gInVuZGVmaW5lZCIgJiYgY29udmVydFRvU2luZ2xlUXVvdGUpIHsKICAgICAgICAgICAgICAgIHJlcyA9IHB2aS51dGlsLmNvbnZlcnRUb1NpbmdsZVF1b3RlKHJlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9OwoKICAgICAgICB2YXIgcmVuZGVyT25seUlmSW50YWtlQ2FzZSA9IGZ1bmN0aW9uIChzb3VyY2VEYklkLCBkYXRhLCBlbmNvZGVUb0hUTUwpIHsKICAgICAgICAgICAgdmFyIHJlcyA9ICh0eXBlb2YgIGVuY29kZVRvSFRNTCAhPT0gInVuZGVmaW5lZCIgJiYgIWVuY29kZVRvSFRNTCkgPyBkYXRhIDogZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgcmV0dXJuIChzb3VyY2VEYklkID09PSAxKSA/ICghXy5pc0VtcHR5KHJlcykgPyByZXMgOiAnJykgOiAnJzsKICAgICAgICB9OwoKICAgICAgICB2YXIgZ3JpZENvbHMgPSBbCiAgICAgICAgICAgIHsgLy8wCiAgICAgICAgICAgICAgICBkYXRhOiAic2VsZWN0ZWQiLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByb2R1Y3RJRHMgPSByb3cucHJvZHVjdHMubWFwKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGEuaWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB2YXIgaW50YWtlQ2FzZU51bSA9ICAocm93LnNvdXJjZURiSWQgPT09IHB2aV9jb25zdGFudHMuc291cmNlX2RiX3NhZmV0eSkgPyAnJyA6IHJvdy5pbnRha2VDYXNlTnVtYmVyIDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9InRkLWJveCI+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSAibGlzdFJvd0NoZWNrYm94IiBjbGFzcz0ibGlzdC1yb3ctY2hlY2tib3giIGRhdGEtaWQ9JyArIGRlZmF1bHRSZW5kZXIocm93LmlkLHRydWUpICsKICAgICAgICAgICAgICAgICAgICAgICAgJyBjbGFzcz0iY29weS1zZWxlY3QiIGRhdGEtaW50YWtlLWNhc2UtbnVtPSInICsgZGVmYXVsdFJlbmRlcihpbnRha2VDYXNlTnVtLCB0cnVlKSArICciJysKICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtaXNDbGluaWNhbFRyaWFsPSInICsgKHJvdy5zb3VyY2VUeXBlID8gZGVmYXVsdFJlbmRlcihyb3cuc291cmNlVHlwZS5pc0NsaW5pY2FsVHJpYWwsIHRydWUpIDogKCEhcm93LnN0dWR5SWQpKSArICciICcgKwogICAgICAgICAgICAgICAgICAgICAgICAnZGF0YS1zYWZldHktY2FzZS1udW09IicgKyBkZWZhdWx0UmVuZGVyKHJvdy5zYWZldHlDYXNlTnVtYmVyLCB0cnVlKSArICciJyArICcgZGF0YS1jYXNlLXN0YXRlPSInICsgZGVmYXVsdFJlbmRlcihyb3cuY2FzZVN0YXRlSWQsIHRydWUpICsgJyInICsgJyBkYXRhLWludGFrZS1jYXNlLXZlcnNpb249IicgKyBkZWZhdWx0UmVuZGVyKHJvdy52ZXJzaW9uLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICArICciJysnIGRhdGEtdmVuZG9yLWlkPSInICsgZGVmYXVsdFJlbmRlcihyb3cudmVuZG9ySWQsIHRydWUpICsKICAgICAgICAgICAgICAgICAgICAgICAgJyIgZGF0YS1jb3VudHJ5SWQ9IicgKyAocm93LmNhc2VDb3VudHJ5P2RlZmF1bHRSZW5kZXIocm93LmNhc2VDb3VudHJ5LmlkLCB0cnVlKToiIikgKyAgJyIgZGF0YS1zdHVkeUlkPSInICsgZGVmYXVsdFJlbmRlcihyb3cuc3R1ZHlJZCwgdHJ1ZSkgKyAnIiBkYXRhLWFzc2lnblRvSWQ9IicgKyBkZWZhdWx0UmVuZGVyKHJvdy5hc3NpZ25lZFRvLCB0cnVlKSArICciJysgJyIgZGF0YS1wcm9kdWN0SWRzPSInICsgZGVmYXVsdFJlbmRlcihwcm9kdWN0SURzLCB0cnVlKSArICciJyArICc+PC9kaXY+JzsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgbmFtZTogJ3NlbGVjdGVkJywKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInNudW0iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8xCiAgICAgICAgICAgICAgICBkYXRhOiAnaW50YWtlQ2FzZU51bWJlcicsCiAgICAgICAgICAgICAgICBuYW1lOiAnaW50YWtlQ2FzZU51bWJlcicsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWludGFrZS1jYXNlIiwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iIyIgY2xhc3M9ImxpbmstdG8tZmNlIicrJyBkYXRhLXNvdXJjZS1kYiA9IicKICAgICAgICAgICAgICAgICAgICAgICAgKyBkZWZhdWx0UmVuZGVyKHJvdy5zb3VyY2VEYklkLCB0cnVlKSArJyInKycgZGF0YS1pZD0nCiAgICAgICAgICAgICAgICAgICAgICAgICsgZGVmYXVsdFJlbmRlcihyb3cuaWQsIHRydWUpICsgJz4nICsgKGRhdGEgPyBkZWZhdWx0UmVuZGVyKGRhdGEpIDogJycpICsgJzwvYT4nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8yCiAgICAgICAgICAgICAgICBkYXRhOiAnY2FzZVZlcnNpb24nLAogICAgICAgICAgICAgICAgbmFtZTogJ2Nhc2VWZXJzaW9uJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2Nhc2VWZXJzaW9uJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2FzZS12ZXJzaW9uIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzMKICAgICAgICAgICAgICAgIGRhdGE6ICdmaXJzdFJlY2VpcHREYXRlU3RyaW5nJywKICAgICAgICAgICAgICAgIG5hbWU6ICdmaXJzdFJlY2VpcHREYXRlJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2ZpcnN0UmVjZWlwdERhdGUnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1maXJzdC1yZGF0ZSIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy80CiAgICAgICAgICAgICAgICBkYXRhOiAncmVwb3J0ZXJRdWFsaWZpY2F0aW9uJywKICAgICAgICAgICAgICAgIG5hbWU6ICdyZXBvcnRlcnMucXVhbGlmaWNhdGlvblZhbHVlJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3JlcG9ydGVycy5xdWFsaWZpY2F0aW9uVmFsdWUnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1yZXBvcnRlci10eXBlIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAocm93LnJlcG9ydGVyUXVhbGlmaWNhdGlvbikgPyAgZGVmYXVsdFJlbmRlcihyb3cucmVwb3J0ZXJRdWFsaWZpY2F0aW9uLnZhbHVlKSA6ICIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vNQogICAgICAgICAgICAgICAgZGF0YTogJ2V2ZW50cycsCiAgICAgICAgICAgICAgICBuYW1lOiAnZXZlbnRzLmV2ZW50TmFtZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdldmVudHMuZXZlbnROYW1lJyksCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWNhc2UtZXZlbnRzIiwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyV2l0aE1vcmVPcHRpb25zKCdldmVudHMnLCBkYXRhLCAnZXZlbnROYW1lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy82CiAgICAgICAgICAgICAgICBkYXRhOiAncHJvZHVjdHMnLAogICAgICAgICAgICAgICAgbmFtZTogJ3Byb2R1Y3RzLm5hbWUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgncHJvZHVjdHMubmFtZScpLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1jYXNlLXByb2R1Y3RzIiwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyV2l0aE1vcmVPcHRpb25zKCdwcm9kdWN0cycsIGRhdGEsICduYW1lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy83CiAgICAgICAgICAgICAgICBkYXRhOiAnY2FzZVNlcmlvdXNuZXNzJywKICAgICAgICAgICAgICAgIG5hbWU6ICdjYXNlU2VyaW91c25lc3MuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnY2FzZVNlcmlvdXNuZXNzLmNhdGVnb3J5JyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2FzZS1zZXIiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhID8gZGVmYXVsdFJlbmRlcihkYXRhKSA6ICIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vOAogICAgICAgICAgICAgICAgZGF0YTogJ3ByaW9yaXR5JywKICAgICAgICAgICAgICAgIG5hbWU6ICdwcmlvcml0eS52YWx1ZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdwcmlvcml0eS52YWx1ZScpLAogICAgICAgICAgICAgICAgc1dpZHRoOiAiNDBweCIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2FzZS1wcmlvcml0eSIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSAiIjsKICAgICAgICAgICAgICAgICAgICBpZihyb3cuc291cmNlRGJJZCA9PT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJlbmRlclZhbHVlTG9va3VwKGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJpb3JpdGllc1NlbGVjdFZpZXcgPSBwdmkudXRpbC5tYW5hZ2VDYXNlUHJpb3JpdHkuZ2V0U2VsZWN0Vmlldyhyb3cuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcEp1c3RpZmljYXRpb25Db21tZW50cyA9IHJvdy5wcmlvcml0eUp1c3RpZmljYXRpb24gPyByb3cucHJpb3JpdHlKdXN0aWZpY2F0aW9uIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uQ2xhc3NlcyA9ICJtb3JlLW9wdGlvbiBtZCBtZC1pbmZvcm1hdGlvbiBwdi1wcmlvcml0eS1sb2cgYWxsb3ctdGV4dCIgKyAocEp1c3RpZmljYXRpb25Db21tZW50cyA/ICIiIDogIiBoaWRkZW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9JY29uID0gJyZuYnNwIDxpIGlkPSJwcmlvcml0eUxvZyIgY2xhc3M9IicrIGljb25DbGFzc2VzICsgJyIgZGF0YS1tb3JlZGF0YT0iJyArIGRlZmF1bHRSZW5kZXIocEp1c3RpZmljYXRpb25Db21tZW50cywgdHJ1ZSkgKyAnIiBkYXRhLWlkPSInK2RlZmF1bHRSZW5kZXIocm93LmlkLHRydWUpKyciPjwvaT4nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHB2aV9jb25zdGFudHMuY2FzZV9ub19wcmlvcml0eV9zZWxlY3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGlvbkNsYXNzZXMgPSBwdmkudXRpbC5tYW5hZ2VDYXNlUHJpb3JpdHkuZ2V0Q2xhc3Nlcyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9ICI8c3BhbiBjbGFzcz0nIitzZWxlY3Rpb25DbGFzc2VzKyInPjxzcGFuIGNsYXNzPSdtb3JlLW9wdGlvbiBwdi1pYy1wcmlvcml0eScgZGF0YS1wcmlvcml0eS1zZWxlY3QtaWQ9JyIrZGVmYXVsdFJlbmRlcihyb3cuaWQsIHRydWUpKyInIGRhdGEtdGFyZ2V0LWV2ZW50PSdjbGljaycgZGF0YS1jb250ZW50PSciICsgcHJpb3JpdGllc1NlbGVjdFZpZXcgKyAiJz4iK3ZhbHVlKyI8L3NwYW4+IitpbmZvSWNvbisiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy85CiAgICAgICAgICAgICAgICBkYXRhOiAnYXR0YWNobWVudHMnLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAncHYtY29sLWF0dGFjaG1lbnQnLAogICAgICAgICAgICAgICAgbmFtZTogJ2F0dGFjaG1lbnRzLm5hbWUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnYXR0YWNobWVudHMubmFtZScpLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgIV8uaXNFbXB0eShkYXRhWzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3RGF0YSA9IGFwcGVuZExpbmsoJ2F0dGFjaG1lbnRzJywgZGF0YSwgJ25hbWUnLCAnbGluaycpOwogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSByZW5kZXJXaXRoTW9yZU9wdGlvbnMoJ2F0dGFjaG1lbnRzJywgbmV3RGF0YSwgJ2xpbmsnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8xMAogICAgICAgICAgICAgICAgZGF0YTogJ2R1ZURhdGVTdHJpbmcnLAogICAgICAgICAgICAgICAgbmFtZTogJ2R1ZURhdGUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnZHVlRGF0ZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWR1ZS1kYXRlIiwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSAiIjsKICAgICAgICAgICAgICAgICAgICBpZihyb3cuc291cmNlRGJJZCA9PT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3B1cCA9IChyb3cuZHVlRGF0ZUp1c3RpZmljYXRpb24gPyAnPGkgY2xhc3M9ImZhIGZhLWluZm8tY2lyY2xlIG1vcmUtb3B0aW9uIG0tbC01IGFsbG93LXRleHQiIGRhdGEtbW9yZWRhdGE9IicrIGRlZmF1bHRSZW5kZXIocm93LmR1ZURhdGVKdXN0aWZpY2F0aW9uLHRydWUpICsgJyI+PC9pPicgOiAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9ICc8c3BhbiBjbGFzcz0iZmxleC1ib3giPicrICc8c3BhbiBjbGFzcz0ibGJsLWVsaXBzaXMgbGJsLWVsaXBzaXMtaW5saW5lIj4nKyhyb3cuZHVlRGF0ZVN0cmluZyA/IHJvdy5kdWVEYXRlU3RyaW5nIDogIiIpICsgJzwvc3Bhbj4nKyBwb3B1cCArICc8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzExCiAgICAgICAgICAgICAgICBkYXRhOiAnaXNSZWxhdGVkJywKICAgICAgICAgICAgICAgIG5hbWU6ICdpc1JlbGF0ZWQnLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWlzLXJlbGF0ZWQiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnaXNSZWxhdGVkJyksCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8xMgogICAgICAgICAgICAgICAgZGF0YTogJ2Fzc2lnbmVkVG9Vc2VybmFtZScsCiAgICAgICAgICAgICAgICBuYW1lOiAnYXNzaWduZWRUb1VzZXJuYW1lJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2Fzc2lnbmVkVG9Vc2VybmFtZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAicHYtY29sLWVkaXRhYmxlIGNvbC1hc3NpZ25lZC10byIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5zb3VyY2VEYklkID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25lZFVzZXJuYW1lID0gcHZpLnV0aWwubWFuYWdlVXNlckFzc2lnbi5hc3NpZ25lZFVzZXJOYW1lKGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mb0ljb24gPSByb3cuaXNBc3NpZ25tZW50SGlzdG9yeSA/ICImbmJzcCA8aSBpZD0nYXNzaWduZWRUb0xvZycgY2xhc3M9J2ZhIGZhLWluZm8tY2lyY2xlIHB2LWNhc2VBc3NpZ24tbG9nICcgZGF0YS1pZD0nIitkZWZhdWx0UmVuZGVyKHJvdy5pZCkrIic+PC9pPiIgOiAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy51c2VyUm9sZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBhc3NpZ25lZFVzZXJuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2R1Y3RJRHMgPSByb3cucHJvZHVjdHMubWFwKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYS5pZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gJzxzcGFuIGNsYXNzPSJhc3NpZ24tdXNlci1ib3giPjxhIGhyZWY9IiMiIGRhdGEtdHlwZT0ic2VsZWN0MiIgZGF0YS1jb3VudHJ5SWQ9ICInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBkZWZhdWx0UmVuZGVyKHJvdy5jYXNlQ291bnRyeSA/IHJvdy5jYXNlQ291bnRyeS5pZDoiIiwgdHJ1ZSkgKyAnIiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGF0YS1wcm9kdWN0SWRzPSInICsgcHJvZHVjdElEcyArICciICcgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXBrPSInICsgZGVmYXVsdFJlbmRlcihyb3cuaWQsIHRydWUpICsgJyIgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtYXNzaW5nZWVJZD0iJyArIGRlZmF1bHRSZW5kZXIocm93LmFzc2lnbmVkVG8sIHRydWUpICsgJyIgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtaXNDbGluaWNhbFRyaWFsPSInICsgKHJvdy5zb3VyY2VUeXBlID8gZGVmYXVsdFJlbmRlcihyb3cuc291cmNlVHlwZS5pc0NsaW5pY2FsVHJpYWwsIHRydWUpIDogKCEhcm93LnN0dWR5SWQpKSArICciICcgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXN0dWR5SWQ9IicgKyBkZWZhdWx0UmVuZGVyKHJvdy5zdHVkeUlkLCB0cnVlKSArICciICcgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXZlbmRvcklkPSInICsgZGVmYXVsdFJlbmRlcihyb3cudmVuZG9ySWQsIHRydWUpICsgJyIgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtdXJsPSInICsgcHZpX3VybHMuY2FzZV9hc3NpZ25lZV91c2VyX2xpc3RfdXJsICsgJyIgZGF0YS12YWx1ZT0icnUiIGRhdGEtdGl0bGU9IlNlbGVjdCBVc2VyIiBjbGFzcz0iYXNzaWduVXNlciBtYW5hZ2VBc3NpZ25Vc2VyIGxibC1lbGlwc2lzIGxibC1lbGlwc2lzLWlubGluZSI+JyArIGRlZmF1bHRSZW5kZXIoYXNzaWduZWRVc2VybmFtZSkgKyAnPC9hPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c2VsZWN0IGNsYXNzPSJmb3JtLWNvbnRyb2wgc2VsZWN0MiBoaWRlIGRpc3BsYXlVc2VyTGlzdCIgZGlzYWJsZWQ+PC9zZWxlY3Q+JytpbmZvSWNvbisnPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzEzCiAgICAgICAgICAgICAgICBkYXRhOiAnc2FmZXR5Q2FzZU51bWJlcicsCiAgICAgICAgICAgICAgICBuYW1lOiAnc2FmZXR5Q2FzZU51bWJlcicsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtc2FmZXR5LWNudW1iZXIiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnc2FmZXR5Q2FzZU51bWJlcicpLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSAocm93LnNvdXJjZURiSWQgPT09IHB2aV9jb25zdGFudHMuc291cmNlX2RiX3NhZmV0eSB8fCByb3cuc2FmZXR5Q2FzZUV4aXN0cykgPyAic2FmZXR5LWxpbmstdG8tZmNlIiA6ICJzYWZldHktbGluay10by1mY2Ugc2FmZXR5LWxpbmstbm90LWV4aXN0cyIgOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAgJzxhIGhyZWY9IiMiIGNsYXNzPSAiJysgY2xhc3NlcyArJyIgZGF0YS1zb3VyY2UtZGI9IicrIGRlZmF1bHRSZW5kZXIocm93LnNvdXJjZURiSWQsIHRydWUpICsgJyIgZGF0YS1pZD0nICsgZGVmYXVsdFJlbmRlcihyb3cuaWQsIHRydWUpICsgJz4nICsgKGRhdGEgPyBkZWZhdWx0UmVuZGVyKGRhdGEpIDogJycpICsgJzwvYT4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMTQKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnRUeXBlJywKICAgICAgICAgICAgICAgIG5hbWU6ICdyZXBvcnRUeXBlJywKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1yZXBvcnQtdHlwZSIsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzE1CiAgICAgICAgICAgICAgICBkYXRhOiAncGF0aWVudEFnZScsCiAgICAgICAgICAgICAgICBuYW1lOiAncGF0aWVudEFnZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdwYXRpZW50QWdlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtcGF0aWVudC1hZ2UiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzE2CiAgICAgICAgICAgICAgICBkYXRhOiAnZ2VuZGVyJywKICAgICAgICAgICAgICAgIG5hbWU6ICdnZW5kZXIudmFsdWUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnZ2VuZGVyLnZhbHVlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtbGlzdC1nZW5kZXIiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJWYWx1ZUxvb2t1cChkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzE3CiAgICAgICAgICAgICAgICBkYXRhOiAnZGVzdGluYXRpb24nLAogICAgICAgICAgICAgICAgbmFtZTogJ2ljc3IuZGVzdGluYXRpb24nLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWxpc3QtZGVzdGluYXRpb24iLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnaWNzci5kZXN0aW5hdGlvbicpLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlck9ubHlJZkludGFrZUNhc2Uocm93LnNvdXJjZURiSWQsIGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMTgKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnREdWVEYXRlU3RyaW5nJywKICAgICAgICAgICAgICAgIG5hbWU6ICdpY3NyLmR1ZURhdGUnLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXJlcG9ydC1kdWVkYXRlIiwKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2ljc3IuZHVlRGF0ZScpLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlck9ubHlJZkludGFrZUNhc2Uocm93LnNvdXJjZURiSWQsIGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMTkKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnRlckNvbW1lbnRzJywKICAgICAgICAgICAgICAgIG5hbWU6ICdyZXBvcnRlckNvbW1lbnRzJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3JlcG9ydGVyQ29tbWVudHMnKSwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtcmVwb3J0ZXItY29tbWVudHMiLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9Im9uZS1yb3ctZWxpcHNpcyBwdmpzX291dGVyLW1vcmUtYm94IiBkYXRhLW1vcmU9IicgKyBkZWZhdWx0UmVuZGVyKGRhdGEsIHRydWUpICsgJyI+JwogICAgICAgICAgICAgICAgICAgICAgICArICc8c3BhbiBjbGFzcz0icHZqc19pbm5lci1tb3JlLWJveCI+JyArIGRlZmF1bHRSZW5kZXIoZGF0YSkgKyAnPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8yMAogICAgICAgICAgICAgICAgZGF0YTogJ3JlcG9ydGVycycsCiAgICAgICAgICAgICAgICBuYW1lOiAncmVwb3J0ZXJzLm5hbWUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgncmVwb3J0ZXJzLm5hbWUnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1yZXBvcnRlci1uYW1lIiwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyV2l0aE1vcmVPcHRpb25zKCdyZXBvcnRlcnMnLCBkYXRhLCAnbmFtZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMjEKICAgICAgICAgICAgICAgIGRhdGE6ICdzZW5kZXJUeXBlJywKICAgICAgICAgICAgICAgIG5hbWU6ICdzZW5kZXJUeXBlLnZhbHVlJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3NlbmRlclR5cGUudmFsdWUnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1zZW5kZXItdHlwZSIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyT25seUlmSW50YWtlQ2FzZShyb3cuc291cmNlRGJJZCwgcmVuZGVyVmFsdWVMb29rdXAoZGF0YSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzIyCiAgICAgICAgICAgICAgICBkYXRhOiAnc2VuZGVyTmFtZScsCiAgICAgICAgICAgICAgICBuYW1lOiAnc2VuZGVyTmFtZScsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtc2VuZGVyLW5hbWUiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnc2VuZGVyTmFtZScpLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlck9ubHlJZkludGFrZUNhc2Uocm93LnNvdXJjZURiSWQsIGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMjMKICAgICAgICAgICAgICAgIGRhdGE6ICdldmVudENvdW50cnknLAogICAgICAgICAgICAgICAgbmFtZTogJ2V2ZW50Q291bnRyeS5uYW1lJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2V2ZW50Q291bnRyeS5uYW1lJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtZXZlbnQtY291bnRyeSIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlck5hbWVMb29rdXAoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8yNAogICAgICAgICAgICAgICAgZGF0YTogJ3JlcG9ydFZlcnNpb24nLAogICAgICAgICAgICAgICAgbmFtZTogJ2ljc3IucmVwb3J0VmVyc2lvbicsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtcmVwb3J0LXZlcnNpb24iLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnaWNzci5yZXBvcnRWZXJzaW9uJyksCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyT25seUlmSW50YWtlQ2FzZShyb3cuc291cmNlRGJJZCwgZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8yNQogICAgICAgICAgICAgICAgZGF0YTogJ2ljc3InLAogICAgICAgICAgICAgICAgbmFtZTogJ2ljc3IudHJhbnNtaXNzaW9uU3RhdHVzJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2ljc3IudHJhbnNtaXNzaW9uU3RhdHVzJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJwdi1jb2wtZWRpdGFibGUgY29sLWljc3ItdHJhbnMiLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYocm93LnNvdXJjZURiSWQgPT09IDEpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyTGFiZWxXaXRoT3B0aW9ucyhkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzI2CiAgICAgICAgICAgICAgICBkYXRhOiAnc3RhdGVUaW1lc3RhbXBTdHJpbmcnLAogICAgICAgICAgICAgICAgbmFtZTogJ2ljc3Iuc3RhdGVUaW1lc3RhbXAnLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXN0YXRlLXRpbWVzdGFtcCIsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdpY3NyLnN0YXRlVGltZXN0YW1wJyksCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyT25seUlmSW50YWtlQ2FzZShyb3cuc291cmNlRGJJZCwgZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8yNwogICAgICAgICAgICAgICAgZGF0YTogJ3JlcG9ydE1lc3NhZ2UnLAogICAgICAgICAgICAgICAgbmFtZTogJ2ljc3IucmVwb3J0TWVzc2FnZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdpY3NyLnJlcG9ydE1lc3NhZ2UnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1yZXBvcnQtbWVzc2FnZSIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbihkYXRhLHR5cGUscm93KXsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gcmVuZGVyT25seUlmSW50YWtlQ2FzZShyb3cuc291cmNlRGJJZCwgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0ib25lLXJvdy1lbGlwc2lzIHB2anNfb3V0ZXItbW9yZS1ib3giPjxzcGFuIGNsYXNzPSJwdmpzX2lubmVyLW1vcmUtYm94IiBkYXRhLXR5cGUtc3RyaW5nPSJ0cnVlIj4nICsgZGF0YSArICc8L3NwYW4+PC9zcGFuPicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzI4CiAgICAgICAgICAgICAgICBkYXRhOiAnZXZlbnROYW1lJywKICAgICAgICAgICAgICAgIG5hbWU6ICdldmVudE5hbWUnLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWV2ZW50LW5hbWUiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnZXZlbnROYW1lJyksCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8yOQogICAgICAgICAgICAgICAgZGF0YTogJ2V2ZW50U3RhcnREYXRlJywKICAgICAgICAgICAgICAgIG5hbWU6ICdldmVudFN0YXJ0RGF0ZScsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtZXZlbnQtc3RhcnRkYXRlIiwKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2V2ZW50U3RhcnREYXRlJyksCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8zMAogICAgICAgICAgICAgICAgZGF0YTogJ291dGNvbWUnLAogICAgICAgICAgICAgICAgbmFtZTogJ291dGNvbWUudmFsdWUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnb3V0Y29tZS52YWx1ZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWxpc3Qtb3V0Y29tZSIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlclZhbHVlTG9va3VwKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMzEKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnRlckNvdW50cnknLAogICAgICAgICAgICAgICAgbmFtZTogJ3JlcG9ydGVycy5jb3VudHJ5TmFtZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdyZXBvcnRlcnMuY291bnRyeU5hbWUnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1yZXBvcnRlci1jb3VudHJ5IiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHJvdy5yZXBvcnRlckNvdW50cnkpID8gIGRlZmF1bHRSZW5kZXIocm93LnJlcG9ydGVyQ291bnRyeS5uYW1lKSA6ICIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMzIKICAgICAgICAgICAgICAgIGRhdGE6ICdyZWxhdGVkbmVzc1N0cmluZycsCiAgICAgICAgICAgICAgICBuYW1lOiAncmVsYXRlZG5lc3NTdHJpbmcnLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXJlbGF0ZWRuZXNzLXN0ciIsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdyZWxhdGVkbmVzc1N0cmluZycpLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmVuZGVyKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vMzMKICAgICAgICAgICAgICAgIGRhdGE6ICdzb3VyY2VUeXBlJywKICAgICAgICAgICAgICAgIG5hbWU6ICdzb3VyY2VUeXBlLnR5cGUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnc291cmNlVHlwZS50eXBlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtc291cmNlLXR5cGUiLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YSAmJiBkYXRhLnR5cGUpID8gZGVmYXVsdFJlbmRlcihkYXRhLnR5cGUpIDogIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8zNAogICAgICAgICAgICAgICAgZGF0YTogJ2NhdGVnb3JpZXMnLAogICAgICAgICAgICAgICAgbmFtZTogJ2NhdGVnb3JpZXMudmFsdWUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnY2F0ZWdvcmllcy52YWx1ZScpLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1saXN0LWNhdGVnb3JpZXMiLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgcm93LnNvdXJjZURiSWQgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICBfLmNvbGxlY3QoZGF0YSwgZnVuY3Rpb24gKGVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICBlbGUudmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgfSkuam9pbigiLCAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlcldpdGhNb3JlT3B0aW9ucygnY2F0ZWdvcmllcycsIGRhdGEsICd2YWx1ZScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8zNQogICAgICAgICAgICAgICAgbURhdGE6ICdtb3N0UmVjZW50UmVjZWlwdERhdGVTdHJpbmcnLAogICAgICAgICAgICAgICAgbmFtZTogJ21vc3RSZWNlbnRSZWNlaXB0RGF0ZScsCiAgICAgICAgICAgICAgICBzV2lkdGg6ICI0MHB4IiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1tb3N0LXJyZGF0ZSIsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdtb3N0UmVjZW50UmVjZWlwdERhdGUnKSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmVuZGVyKGRhdGEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzM2CiAgICAgICAgICAgICAgICBkYXRhOiAncHJvZHVjdE5hbWUnLAogICAgICAgICAgICAgICAgbmFtZTogJ3Byb2R1Y3ROYW1lJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3Byb2R1Y3ROYW1lJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtcHJvZHVjdC1uYW1lIiwKICAgICAgICAgICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8zNwogICAgICAgICAgICAgICAgZGF0YTogJ3N1YnN0YW5jZXMnLAogICAgICAgICAgICAgICAgbmFtZTogJ3N1YnN0YW5jZXMubmFtZVZhbHVlJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3N1YnN0YW5jZXMubmFtZVZhbHVlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtbGlzdC1zdWJzdGFuY2VzIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlcldpdGhNb3JlT3B0aW9ucygnc3Vic3RhbmNlcycsIGRhdGEsICduYW1lVmFsdWUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzM4CiAgICAgICAgICAgICAgICBkYXRhOiAnc3R1ZHlOdW1iZXInLAogICAgICAgICAgICAgICAgbmFtZTogJ3N0dWR5TnVtYmVyJywKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1zdHVkeS1udW1iZXIiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnc3R1ZHlOdW1iZXInKSwKICAgICAgICAgICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vIDM5CiAgICAgICAgICAgICAgICBkYXRhOiAnY2FzZVN0YXRlJywKICAgICAgICAgICAgICAgIG5hbWU6ICdjYXNlU3RhdGUnLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWNhc2Utc3RhdGUiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnY2FzZVN0YXRlJyksCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzID0gIiI7CiAgICAgICAgICAgICAgICAgICAgIGlmKHJvdy5zb3VyY2VEYklkID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tbWVudCA9IHJvdy5zdGF0ZUNoYW5nZUNvbW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50ID0gXy5pc1VuZGVmaW5lZChjb21tZW50KSB8fCAhY29tbWVudCA/ICcnIDogY29tbWVudC5yZXBsYWNlKC8nL2csICImIzM5OyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9JY29uID0gIWNvbW1lbnQgPyAiIiA6ICImbmJzcCA8aSBjbGFzcz0nZmEgZmEtaW5mby1jaXJjbGUgbW9yZS1vcHRpb24gYWxsb3ctdGV4dCBzdGF0ZUNoYW5nZUNvbW1lbnQnIGRhdGEtY29udGVudD0nIisgY29tbWVudCArICInPjwvaT4iOwogICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gJzxkaXY+JytkYXRhK2luZm9JY29uKyc8L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy80MAogICAgICAgICAgICAgICAgZGF0YTogJ3ZlcnNpb25UeXBlJywKICAgICAgICAgICAgICAgIG5hbWU6ICd2ZXJzaW9uVHlwZS52YWx1ZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC12ZXJzaW9uLXR5cGUiLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJWYWx1ZUxvb2t1cChkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLyA0MQogICAgICAgICAgICAgICAgZGF0YTogJ3JlY2VpcHREYXRlU3RyaW5nJywKICAgICAgICAgICAgICAgIG5hbWU6ICdyZWNlaXB0RGF0ZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdyZWNlaXB0RGF0ZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXJlY2VpcHQtZGF0ZSIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgcmVuZGVyIDogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLyA0MgogICAgICAgICAgICAgICAgZGF0YTogJ29uc2V0RGF0ZScsCiAgICAgICAgICAgICAgICBuYW1lOiAnb25zZXREYXRlJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ29uc2V0RGF0ZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLW9uc2V0LWRhdGUiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyIDogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vIDQzCiAgICAgICAgICAgICAgICBkYXRhOiAnc3VibWlzc2lvbkRhdGUnLAogICAgICAgICAgICAgICAgbmFtZTogJ3N1Ym1pc3Npb25EYXRlJywKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1zdWJtaXNzaW9uLWRhdGUiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICByZW5kZXIgOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmVuZGVyKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7Ly8gNDQKICAgICAgICAgICAgICAgIGRhdGE6ICdkb3NhZ2VGb3JtJywKICAgICAgICAgICAgICAgIG5hbWU6ICdkb3NhZ2VGb3JtLnZhbHVlJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2Rvc2FnZUZvcm0udmFsdWUnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1kb3NhZ2UtZm9ybSIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlclZhbHVlTG9va3VwKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7Ly8gNDUKICAgICAgICAgICAgICAgIGRhdGE6ICdjYXNlVmVyc2lvblR5cGUnLAogICAgICAgICAgICAgICAgbmFtZTogJ2Nhc2VWZXJzaW9uVHlwZScsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2FzZS12dHlwZSIsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vIDQ2CiAgICAgICAgICAgICAgICBkYXRhOiAnaWNzclR5cGUnLAogICAgICAgICAgICAgICAgbmFtZTogJ2ljc3IudHlwZScsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtaWNzci10eXBlIiwKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ2ljc3IudHlwZScpLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmVuZGVyKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7Ly8gNDcKICAgICAgICAgICAgICAgIGRhdGE6ICdzdHVkeVR5cGUnLAogICAgICAgICAgICAgICAgbmFtZTogJ3N0dWR5VHlwZS52YWx1ZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdzdHVkeVR5cGUudmFsdWUnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1zdHVkeS10eXBlIiwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyVmFsdWVMb29rdXAoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsvLzQ4CiAgICAgICAgICAgICAgICBkYXRhOiAncGF0aWVudE5hbWUnLAogICAgICAgICAgICAgICAgbmFtZTogJ3BhdGllbnROYW1lJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3BhdGllbnROYW1lJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtcGF0aWVudC1uYW1lIiwKICAgICAgICAgICAgICAgIHJlbmRlcjpmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmVuZGVyKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7Ly80OQogICAgICAgICAgICAgICAgZGF0YTogJ3NlcmlvdXNuZXNzJywKICAgICAgICAgICAgICAgIG5hbWU6ICdzZXJpb3VzbmVzc1N0cmluZycsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdzZXJpb3VzbmVzc1N0cmluZycpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWxpc3Qtc2VyIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlcldpdGhNb3JlT3B0aW9ucygnc2VyaW91c25lc3MnLCBkYXRhLCAnc2hvcnROYW1lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsvLzUwCiAgICAgICAgICAgICAgICBkYXRhOiAnY2FzZUNvdW50cnknLAogICAgICAgICAgICAgICAgbmFtZTogJ2Nhc2VDb3VudHJ5Lm5hbWUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnY2FzZUNvdW50cnkubmFtZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWNhc2UtY291bnRyeSIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlck5hbWVMb29rdXAoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsvLzUxCiAgICAgICAgICAgICAgICBkYXRhOiAnYWxsUmVmZXJlbmNlcycsCiAgICAgICAgICAgICAgICBuYW1lOiAnYWxsUmVmZXJlbmNlcycsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdhbGxSZWZlcmVuY2VzJyksCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWFsbC1yZWYiLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYocm93LnNvdXJjZURiSWQgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJXaXRoTW9yZU9wdGlvbnNGb3JTdHJpbmcoImFsbFJlZmVyZW5jZXMiLGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vNTIKICAgICAgICAgICAgICAgIGRhdGE6ICdwYXRpZW50SWQnLAogICAgICAgICAgICAgICAgbmFtZTogJ3BhdGllbnRJZCcsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtcGF0aWVudC1pZCIsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdwYXRpZW50SWQnKSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vNTMKICAgICAgICAgICAgICAgIGRhdGE6ICdkb2JTdHJpbmcnLAogICAgICAgICAgICAgICAgbmFtZTogJ2RvYicsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtbGlzdC1kb2IiLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnZG9iJyksCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vNTQKICAgICAgICAgICAgICAgIGRhdGE6ICdtYXRjaFNjb3JlJywKICAgICAgICAgICAgICAgIG5hbWU6ICdtYXRjaFNjb3JlJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ21hdGNoU2NvcmUnKSwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogIm1hdGNoU2NvcmUgY29sLW1hdGNoLXNjb3JlIiwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vIDU1CiAgICAgICAgICAgICAgICBkYXRhOiAnc2ltcGxlU2VhcmNoJywKICAgICAgICAgICAgICAgIG5hbWU6ICdzaW1wbGVTZWFyY2gnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtc2ltcGxlLXNlYXJjaCIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy8gNTYKICAgICAgICAgICAgICAgIGRhdGE6ICdkYXRlUmFuZ2VTZWFyY2gnLAogICAgICAgICAgICAgICAgbmFtZTogJ2RhdGVSYW5nZVNlYXJjaCcsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtZGF0ZXJhbmdlLXNlYXJjaCIsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vNTcKICAgICAgICAgICAgICAgIGRhdGE6ICdzb3VyY2VEYicsCiAgICAgICAgICAgICAgICBuYW1lOiAnc291cmNlRGInLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnc291cmNlRGInKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1zb3VyY2UtZGIiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmVuZGVyKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7Ly81OAogICAgICAgICAgICAgICAgZGF0YTogJ3NhZmV0eVdGU3RhdGUnLAogICAgICAgICAgICAgICAgbmFtZTogJ3NhZmV0eVdGU3RhdGUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnc2FmZXR5V0ZTdGF0ZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXNhZmV0eS13ZnN0YXRlIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzU5CiAgICAgICAgICAgICAgICBkYXRhOiAnY2VudHJhbFJlY2VpcHREYXRlU3RyaW5nJywKICAgICAgICAgICAgICAgIG5hbWU6ICdjZW50cmFsUmVjZWlwdERhdGUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnY2VudHJhbFJlY2VpcHREYXRlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2VudHJhbC1yZWNlaXB0LWRhdGUiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy82MAogICAgICAgICAgICAgICAgZGF0YTogJ2xvY2FsU3VibWlzc2lvbkRhdGVTdHJpbmcnLAogICAgICAgICAgICAgICAgbmFtZTogJ2xvY2FsU3VibWlzc2lvbkRhdGUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnbG9jYWxTdWJtaXNzaW9uRGF0ZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWxvY2FsLXN1Ym1pc3Npb24tZGF0ZSIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzYxCiAgICAgICAgICAgICAgICBkYXRhOiAnbG9jYWxTdWJtaXNzaW9uRHVlRGF0ZVN0cmluZycsCiAgICAgICAgICAgICAgICBuYW1lOiAnbG9jYWxTdWJtaXNzaW9uRHVlRGF0ZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdsb2NhbFN1Ym1pc3Npb25EdWVEYXRlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtbG9jYWwtc3VibWlzc2lvbi1kdWUtZGF0ZSIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UmVuZGVyKGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vNjIKICAgICAgICAgICAgICAgIGRhdGE6ICdsYXRlc3RBc3NpZ25tZW50Q29tbWVudCcsCiAgICAgICAgICAgICAgICBuYW1lOiAnbGF0ZXN0QXNzaWdubWVudENvbW1lbnQnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnbGF0ZXN0QXNzaWdubWVudENvbW1lbnQnKSwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtYXNzaWdubWVudC1jb21tZW50cyIsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWxFbmNvZGVkRGF0YSA9ICIiOwogICAgICAgICAgICAgICAgICAgIHZhciBxdW90ZXNDb252ZXJ0ZWREYXRhID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWxFbmNvZGVkRGF0YSA9IHB2aS51dGlsLmh0bWxFbmNvZGUoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICBxdW90ZXNDb252ZXJ0ZWREYXRhID0gcHZpLnV0aWwuY29udmVydFRvU2luZ2xlUXVvdGUoaHRtbEVuY29kZWREYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0ib25lLXJvdy1lbGlwc2lzIHB2anNfb3V0ZXItbW9yZS1ib3giIGRhdGEtbW9yZT0iJyArIHF1b3Rlc0NvbnZlcnRlZERhdGEgKyAnIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPSJwdmpzX2lubmVyLW1vcmUtYm94Ij4nICsgaHRtbEVuY29kZWREYXRhICsgJzwvc3Bhbj48L3NwYW4+JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vNjMKICAgICAgICAgICAgICAgIGRhdGE6ICd2ZW5kb3InLAogICAgICAgICAgICAgICAgbmFtZTogJ3ZlbmRvcicsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCd2ZW5kb3InKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1jYXNlLXZlbmRvciIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy82NAogICAgICAgICAgICAgICAgZGF0YTogJ3JlcGxhY2VtZW50UmVxdWlyZWQnLAogICAgICAgICAgICAgICAgbmFtZTogJ3JlcGxhY2VtZW50UmVxdWlyZWQnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgncmVwbGFjZW1lbnRSZXF1aXJlZCcpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXJlcGxhY2VtZW50LXJlcXVpcmVkIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyAvLzY1CiAgICAgICAgICAgICAgICBkYXRhOiAnY2FzZUNyZWF0ZWREYXRlJywKICAgICAgICAgICAgICAgIG5hbWU6ICdjYXNlQ3JlYXRlZERhdGUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgnY2FzZUNyZWF0ZWREYXRlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2FzZS1kYXRlLWNyZWF0ZWQiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy82NgogICAgICAgICAgICAgICAgZGF0YTogJ3JlcG9ydGVycycsCiAgICAgICAgICAgICAgICBuYW1lOiAncmVwb3J0ZXJzLm9yZ2FuaXphdGlvbicsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdyZXBvcnRlcnMub3JnYW5pemF0aW9uJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2FzZS1yZXBvcnRlci1vcmdhbml6YXRpb24iLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyIDogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyV2l0aE1vcmVPcHRpb25zKCdyZXBvcnRlcnMnLCBkYXRhLCAnb3JnYW5pemF0aW9uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy82NwogICAgICAgICAgICAgICAgZGF0YTogJ3JlcG9ydGVycycsCiAgICAgICAgICAgICAgICBuYW1lOiAncmVwb3J0ZXJzLmRlcGFydG1lbnQnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgncmVwb3J0ZXJzLmRlcGFydG1lbnQnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1jYXNlLXJlcG9ydGVyLWRlcGFydG1lbnQiLAogICAgICAgICAgICAgICAgb3JkZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgcmVuZGVyIDogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyV2l0aE1vcmVPcHRpb25zKCdyZXBvcnRlcnMnLCBkYXRhLCAnZGVwYXJ0bWVudCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vNjgKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnRlcnMnLAogICAgICAgICAgICAgICAgbmFtZTogJ3JlcG9ydGVycy5hZGRyZXNzJywKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3JlcG9ydGVycy5hZGRyZXNzJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJjb2wtY2FzZS1yZXBvcnRlci1hZGRyZXNzIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyV2l0aE1vcmVPcHRpb25zKCdyZXBvcnRlcnMnLCBkYXRhLCAnYWRkcmVzcycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vNjkKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnRlcnMnLAogICAgICAgICAgICAgICAgbmFtZTogJ3JlcG9ydGVycy50ZWxlcGhvbmUnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgncmVwb3J0ZXJzLnRlbGVwaG9uZScpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWNhc2UtcmVwb3J0ZXItdGVsZXBob25lIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlcldpdGhNb3JlT3B0aW9ucygncmVwb3J0ZXJzJywgZGF0YSwgJ3RlbGVwaG9uZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vNzAKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnRlcnMnLAogICAgICAgICAgICAgICAgbmFtZTogJ3JlcG9ydGVycy5mYXhOdW1iZXInLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgncmVwb3J0ZXJzLmZheE51bWJlcicpLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLWNhc2UtcmVwb3J0ZXItZmF4IiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlcldpdGhNb3JlT3B0aW9ucygncmVwb3J0ZXJzJywgZGF0YSwgJ2ZheE51bWJlcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vNzEKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXBvcnRlcnMnLAogICAgICAgICAgICAgICAgbmFtZTogJ3JlcG9ydGVycy5lbWFpbCcsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdyZXBvcnRlcnMuZW1haWwnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1jYXNlLXJlcG9ydGVyLWVtYWlsIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlcldpdGhNb3JlT3B0aW9ucygncmVwb3J0ZXJzJywgZGF0YSwgJ2VtYWlsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy83MgogICAgICAgICAgICAgICAgZGF0YTogJ3BxY0Nhc2VOdW1iZXInLAogICAgICAgICAgICAgICAgbmFtZTogJ3BxY0Nhc2VOdW1iZXInLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiY29sLXBxYy1jbnVtYmVyIiwKICAgICAgICAgICAgICAgIHZpc2libGU6IHZpc2libGUoJ3BxY0Nhc2VOdW1iZXInKSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vNzMKICAgICAgICAgICAgICAgIGRhdGE6ICdyZXR1cm5SZXF1aXJlZCcsCiAgICAgICAgICAgICAgICBuYW1lOiAncmV0dXJuUmVxdWlyZWQnLAogICAgICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZSgncmV0dXJuUmVxdWlyZWQnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1jYXNlLXJldHVyblJlcXVpcmVkIiwKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgey8vNzQKICAgICAgICAgICAgICAgIGRhdGE6ICdyZWZ1bmRSZXF1ZXN0ZWQnLAogICAgICAgICAgICAgICAgbmFtZTogJ3JlZnVuZFJlcXVlc3RlZCcsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdyZWZ1bmRSZXF1ZXN0ZWQnKSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImNvbC1jYXNlLXJlZnVuZFJlcXVlc3RlZCIsCiAgICAgICAgICAgICAgICBvcmRlcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZW5kZXIoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsgLy83NQogICAgICAgICAgICAgICAgZGF0YTogJ3JlcG9ydGVycycsCiAgICAgICAgICAgICAgICBuYW1lOiAncmVwb3J0ZXJzLmNvbnRhY3RUeXBlcy52YWx1ZScsCiAgICAgICAgICAgICAgICB2aXNpYmxlOiB2aXNpYmxlKCdyZXBvcnRlcnMuY29udGFjdFR5cGVzLnZhbHVlJyksCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtY2FzZS1yZXBvcnRlci1jb250YWN0LXR5cGVzJywKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBpZihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSAgXy5jb2xsZWN0KGRhdGFbMF0uY29udGFjdFR5cGVzLCBmdW5jdGlvbiAoZWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFJlbmRlcihlbGUudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCIsICIpOwogICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJXaXRoTW9yZU9wdGlvbnNGb3JTdHJpbmcoJ2NvbnRhY3RUeXBlcycsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7IC8vIDc2CiAgICAgICAgICAgICAgICBkYXRhOiAnYWN0aW9uJywKICAgICAgICAgICAgICAgIG9yZGVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJwdi10YWJsZS1hY3Rpb24iLAogICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcm93Wydpc0xpc3QnXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcm93Wydjb250YWluZXJJZCddID0gY29udGFpbmVySWQ7CiAgICAgICAgICAgICAgICAgICAgcm93WydhY3Rpb25WaXNpYmxlJ10gPSBhY3Rpb25WaXNpYmxlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwdmkudXRpbC5tYW5hZ2VBY3Rpb25WaWV3cygpLmluaXQoewogICAgICAgICAgICAgICAgICAgICAgICB0bXBsTmFtZTogJ3ZpZXdBY3Rpb24nLAogICAgICAgICAgICAgICAgICAgICAgICBwYWdlSWQ6IHBhZ2VUeXBlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFPYmo6IHJvdwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgXTsKCiAgICAgICAgdmFyIGdyaWRTZWFyY2hDb2xzID0gWwogICAgICAgICAgICBudWxsLCAvLzAKICAgICAgICAgICAgbnVsbCwgLy8xCiAgICAgICAgICAgIG51bGwsIC8vMgogICAgICAgICAgICBudWxsLCAvLzMKICAgICAgICAgICAgbnVsbCwgLy80CiAgICAgICAgICAgIG51bGwsIC8vNQogICAgICAgICAgICBudWxsLCAvLzYKICAgICAgICAgICAgbnVsbCwgLy83CiAgICAgICAgICAgIG51bGwsIC8vOAogICAgICAgICAgICBudWxsLCAvLzkKICAgICAgICAgICAgbnVsbCwgLy8xMAogICAgICAgICAgICBudWxsLCAvLzExCiAgICAgICAgICAgIHsgLy8gMTIKICAgICAgICAgICAgICAgIHNlYXJjaDogbG9naW5Vc2VyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG51bGwsIC8vMTMKICAgICAgICAgICAgbnVsbCwgLy8xNAogICAgICAgICAgICBudWxsLCAvLzE1CiAgICAgICAgICAgIG51bGwsIC8vMTYKICAgICAgICAgICAgbnVsbCwgLy8xNwogICAgICAgICAgICBudWxsLCAvLzE4CiAgICAgICAgICAgIG51bGwsIC8vMTkKICAgICAgICAgICAgbnVsbCwgLy8yMAogICAgICAgICAgICBudWxsLCAvLzIxCiAgICAgICAgICAgIG51bGwsIC8vMjIKICAgICAgICAgICAgbnVsbCwgLy8yMwogICAgICAgICAgICBudWxsLCAvLzI0CiAgICAgICAgICAgIG51bGwsIC8vMjUKICAgICAgICAgICAgbnVsbCwgLy8yNgogICAgICAgICAgICBudWxsLCAvLzI3CiAgICAgICAgICAgIG51bGwsIC8vMjgKICAgICAgICAgICAgbnVsbCwgLy8yOQogICAgICAgICAgICBudWxsLCAvLzMwCiAgICAgICAgICAgIG51bGwsIC8vMzEKICAgICAgICAgICAgbnVsbCwgLy8zMgogICAgICAgICAgICBudWxsLCAvLzMzCiAgICAgICAgICAgIG51bGwsIC8vMzQKICAgICAgICAgICAgbnVsbCwgLy8zNQogICAgICAgICAgICBudWxsLCAvLzM2CiAgICAgICAgICAgIG51bGwsIC8vMzcKICAgICAgICAgICAgbnVsbCwgLy8zOAogICAgICAgICAgICBudWxsLCAvLzM5CiAgICAgICAgICAgIG51bGwsIC8vNDAKICAgICAgICAgICAgbnVsbCwgLy80MQogICAgICAgICAgICBudWxsLCAvLzQyCiAgICAgICAgICAgIG51bGwsIC8vNDMKICAgICAgICAgICAgbnVsbCwgLy80NAogICAgICAgICAgICBudWxsLCAvLzQ1CiAgICAgICAgICAgIG51bGwsIC8vNDYKICAgICAgICAgICAgbnVsbCwgLy80NwogICAgICAgICAgICBudWxsLCAvLzQ4CiAgICAgICAgICAgIG51bGwsIC8vNDkKICAgICAgICAgICAgbnVsbCwgLy81MAogICAgICAgICAgICBudWxsLCAvLzUxCiAgICAgICAgICAgIG51bGwsIC8vNTIKICAgICAgICAgICAgbnVsbCwgLy81MwogICAgICAgICAgICBudWxsLCAvLzU0CiAgICAgICAgICAgIHsgICAgIC8vNTUKICAgICAgICAgICAgICAgIHNlYXJjaDogJ3sgImZpcnN0UmVjZWlwdERhdGUiIDogJyArIGdldERlZmF1bHREYXRlUmFuZ2UoKSArICcsICJjYXNlU3RhdGVJZCIgOiAiJyArIGJ1aWxkSW5jbHVkZUV4Y2x1ZGVWYWx1ZXMoKSArICciLCAic291cmNlRGJJZCIgOiAiJyArIGdldFNvdXJjZURhdGFiYXNlc09yRGVmYXVsdCgpLmpvaW4oIiwiKSArICcifScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbnVsbCwgLy81NgogICAgICAgICAgICBudWxsLCAvLzU3CiAgICAgICAgICAgIG51bGwsIC8vNTgKICAgICAgICAgICAgbnVsbCwgLy81OQogICAgICAgICAgICBudWxsLCAvLzYwCiAgICAgICAgICAgIG51bGwsIC8vNjEKICAgICAgICAgICAgbnVsbCwgLy82MgogICAgICAgICAgICBudWxsLCAvLzYzCiAgICAgICAgICAgIG51bGwsIC8vNjQKICAgICAgICAgICAgbnVsbCwgLy82NQogICAgICAgICAgICBudWxsLCAvLzY2CiAgICAgICAgICAgIG51bGwsIC8vNjcKICAgICAgICAgICAgbnVsbCwgLy82OAogICAgICAgICAgICBudWxsLCAvLzY5CiAgICAgICAgICAgIG51bGwsIC8vNzAKICAgICAgICAgICAgbnVsbCwgLy83MQogICAgICAgICAgICBudWxsLCAvLzcyCiAgICAgICAgICAgIG51bGwsIC8vNzMKICAgICAgICAgICAgbnVsbCwgLy83NAogICAgICAgICAgICBudWxsIC8vNzUgLSBBY3Rpb24vVmlldwogICAgICAgIF07CgogICAgICAgIGNvbHVtblNpemUgPSBncmlkQ29scy5sZW5ndGg7CiAgICAgICAgdmFyIGRhdGFUYWJsZVN0b3JhZ2VLZXkgPSBnZXRTdG9yYWdlS2V5KCdEYXRhVGFibGUnKTsKCiAgICAgICAgdmFyIHNldFN0dWR5QW5kUGF0aWVudFZpc2liaWxpdHkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjbGluaWNhbFRyaWFscyA9IHB2aS5yZWZlcmVuY2VEYXRhVXRpbC5tYW5hZ2VSZWZlcmVuY2VEYXRhLmdldExpc3RSZWZlcmVuY2VEYXRhKCJjbGluaWNhbC10cmlhbHMiKTsKICAgICAgICAgICAgdmFyIHZhbCA9ICQoIiNkdXBsaWNhdGVTZWFyY2hGb3JtIHNlbGVjdFtuYW1lPSdzYWZldHlEYXRhLnNvdXJjZVR5cGUuaWQnXSIpLnZhbCgpOwogICAgICAgICAgICB2YXIgc3R1ZHlGaWVsZHMgPSAkKCJpbnB1dFtuYW1lXj0nc2FmZXR5RGF0YS5zdHVkeSddIikuY2xvc2VzdCgiLnRlbXBsYXRlLWNvbnRyb2wiKTsKICAgICAgICAgICAgaWYoY2xpbmljYWxUcmlhbHMpIHsKICAgICAgICAgICAgICAgIGlmIChjbGluaWNhbFRyaWFscy5pbmRleE9mKHBhcnNlSW50KHZhbCkpID49IDApIHsKICAgICAgICAgICAgICAgICAgICBzdHVkeUZpZWxkcy5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICQoIiNzdHVkeU5hbWUiKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICQoJyNwYXRpZW50UGF0aWVudElkJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKS5maW5kKCdpbnB1dCcpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdHVkeUZpZWxkcy5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICQoJyNwYXRpZW50UGF0aWVudElkJykuYWRkQ2xhc3MoJ2hpZGUnKS5maW5kKCdpbnB1dCcpLmFkZENsYXNzKCdoaWRlJykudmFsKCIiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBoYW5kbGVTaG93SGlkZUZpZWxkRm9yRHVwU2VhcmNoID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvKnRvZG8gcmVmYWN0b3IgYmVsb3cgY29kZSB0aGUgcmVtb3ZlIGhhcmQgZGVwZW5kZW5jeSovCiAgICAgICAgICAgIHZhciBkcm9wZG93bklkTGlzdCA9IFtdOwogICAgICAgICAgICBfLmVhY2goJCgiZGl2LnB2LWhlYWQtY29uZmlnIikuZmluZCgiaW5wdXQ6Y2hlY2tib3giKSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmKGl0ZW0uY2hlY2tlZCl7CiAgICAgICAgICAgICAgICAgICAgZHJvcGRvd25JZExpc3QucHVzaCgkKGl0ZW0pLmRhdGEoJ2lkJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgXy5lYWNoKCQoIiNkdXBsaWNhdGVTZWFyY2hGb3JtIikuZmluZCgiLnRlbXBsYXRlLWNvbnRyb2wiKSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGl0ZW0gPSAkKGl0ZW0pOwogICAgICAgICAgICAgICAgdmFyIHNlY3Rpb25JZCA9IGl0ZW0uYXR0cigiaWQiKTsKICAgICAgICAgICAgICAgIGlmKGRyb3Bkb3duSWRMaXN0Lmxlbmd0aCA+IDAgICYmIGRyb3Bkb3duSWRMaXN0LmluZGV4T2Yoc2VjdGlvbklkKSA8IDAgfHwgZHJvcGRvd25JZExpc3QubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgICAgICAgICBpdGVtLmFkZENsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZXRTdHVkeUFuZFBhdGllbnRWaXNpYmlsaXR5KCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGNsZWFyUGFnZVN0YXRlSGlzdG9yeUlmTmVlZGVkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBsb2FkaW5nIGhlcmUgdG8gc2hvdy9oaWRlIGZpZWxkcwogICAgICAgICAgICBzZWFyY2hGb3JtU3RhdGUubG9hZFZpc2liaWxpdHlTdGF0ZSgpOwogICAgICAgICAgICAkKCJsaS5maWVsZC12aXNpYmxlIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBsaSA9ICQodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoIWxpLmhhc0NsYXNzKCJjbGljay1kaXNhYmxlZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrYm94ID0gbGkuZmluZCgiOmNoZWNrYm94IilbMF07CiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gbGkuZGF0YSgnaWQnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNEdXBsaWNhdGVGaWVsZElkID0gJChjaGVja2JveCkuZGF0YSgnY2xhc3MnKS5pbmRleE9mKHB2aV9jb25zdGFudHMuZHVwbGljYXRlRmllbGRJZENsYXNzKSA+IC0xOwogICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50U2VsZWN0b3I7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRHVwbGljYXRlRmllbGRJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50U2VsZWN0b3IgPSBwdmkudXRpbC5pbmNsdWRlRHVwbGljYXRlRmllbGRzKGlkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50U2VsZWN0b3IgPSBwdmkudXRpbC5leGNsdWRlRHVwbGljYXRlRmllbGQoaWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjaGVja2JveC5jaGVja2VkID0gIWVsZW1lbnRTZWxlY3Rvci5oYXNDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGlzT25EdXBsaWNhdGVTZWFyY2hQYWdlKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVTaG93SGlkZUZpZWxkRm9yRHVwU2VhcmNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFpc0xvYWRlZFZpYUJhY2sgJiYgY2xlYXJDYWNoZU9uUmVmcmVzaCkgewogICAgICAgICAgICAgICAgLy9jbGVhciBjb21wbGV0ZWx5IG9ubHkgZm9yIGR1cCBzZWFyY2gKICAgICAgICAgICAgICAgIHNlYXJjaEZvcm1TdGF0ZS5jbGVhclNlbGVjdGl2ZWx5KCk7CiAgICAgICAgICAgICAgICBtYW5hZ2VTZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGRhdGFUYWJsZVN0b3JhZ2VLZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlYXJjaEZvcm1TdGF0ZS5sb2FkU3RhdGUoc2VhcmNoRm9ybU5hbWUpOwogICAgICAgIH07CgogICAgICAgIHZhciBnZXREYXRlVmFsdWVGcm9tUmFuZ2UgPSBmdW5jdGlvbiAoZGF0YSwgZGF0ZUZvcm1hdCkgewogICAgICAgICAgICBpZighZGF0YSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGpzb24gPSBKU09OLnBhcnNlKGRhdGEpOwogICAgICAgICAgICBpZiAoanNvbiAmJiBqc29uLmd0ZSAmJiBkYXRlRm9ybWF0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0Yyhqc29uLmd0ZSkuZm9ybWF0KGRhdGVGb3JtYXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9OwoKICAgICAgICB2YXIgaGFuZGxlRml4Q29sdW1uRm9jdXMgPSBmdW5jdGlvbigpewogICAgICAgICAgICBpZihmb2N1c09uRml4ZWRDb2wpIHsKICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gY29udGFpbmVyLmZpbmQoImlucHV0W2RhdGEtZmllbGQ9JyIrZml4ZWRGaWx0ZXJDb2xOYW1lKyInXTp2aXNpYmxlIik7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnZhbCgpOwogICAgICAgICAgICAgICAgZWxlbWVudC52YWwoIiIpLnZhbCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBmb2N1c09uRml4ZWRDb2wgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciB1cGRhdGVHcmlkVUkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHB2dWkuZ3JpZC51dGlscy5zZXRHcmlkSGVpZ2h0KGNvbnRhaW5lcik7CiAgICAgICAgICAgIGNhc2VMaXN0VGFibGUuZml4ZWRDb2x1bW5zKCkudXBkYXRlKCk7CiAgICAgICAgICAgIGhhbmRsZUZpeENvbHVtbkZvY3VzKCk7CiAgICAgICAgfTsKCiAgICAgICAgY29udGFpbmVyLm9uKHsKICAgICAgICAgICAgJ3Nob3duLmJzLmNvbGxhcHNlJyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHVwZGF0ZUdyaWRVSSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICAnaGlkZGVuLmJzLmNvbGxhcHNlJyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHVwZGF0ZUdyaWRVSSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwnI2FjY29yZGlvbi1zZWFyY2hjYXNlJyk7CgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcucGRmVmlldycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHBkZkxpbmtIcmVmID0gJCh0aGlzKS5maW5kKCdhJykuYXR0cignaHJlZicpOwogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHB2aS51dGlsLnVwZGF0ZVVybFF1ZXJ5U3RyaW5nUGFyYW1ldGVyKHBkZkxpbmtIcmVmLCAndGVtcGxhdGVJZCcsICIiKTsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIHVwZGF0ZUdyaWRTY3JvbGxiYXJPblNwbGl0VmlldyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJChkb2N1bWVudCkub24oImNoYW5nZSIsICIjZWFzdFBhbmVsVG9nZ2xlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcHZ1aS5ncmlkLm1hbmFnZVVJV3JhcHBlci51cGRhdGVQZXJmZWN0U2Nyb2xsYmFyKGNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICB1cGRhdGVHcmlkVUkoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgY2xlYXJQYWdlU3RhdGVIaXN0b3J5SWZOZWVkZWQoKTsKCiAgICAgICAgZGF0YVRhYmxlLm9uKCdkcmF3LmR0JywgZnVuY3Rpb24gKCkgeyAvL05lZWRlZCBiZWZvcmUgdGFibGUgaW5pdGlhbGl6YXRpb24gZm9yIGVuYWJsaW5nL2Rpc2FibGluZyBBc3NpZ25lZFRvIENvbHVtbkZpbHRlci4KICAgICAgICAgICAgICAgIGhpZ2hsaWdodFRhYigpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgdmFyIGRlZmVycmVkRGF0YVNvdXJjZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgaWYgKCFpbml0aWFsaXplZCkgewogICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHNUb3RhbDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15UmVjb3Jkc1RvdGFsOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkc0ZpbHRlcmVkOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge30KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXBhZ2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVGFibGVPcHRpb25zLmxlbmd0aCA9IHBhZ2VMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRhdGFUYWJsZU9wdGlvbnMubG9hZERhdGEgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIF8uZXh0ZW5kKGRhdGEsIGRhdGFUYWJsZU9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogY3JlYXRlVVJMKHB2aV91cmxzLmNhc2VfbGlzdF9kYXRhX3VybCksCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpc0Rhc2hib2FyZFBhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdnVpLmNvbW1vbi5wdldpZGdldExvYWRlci5zaG93TG9hZGVyKGNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHZ1aS5jb21tb24uc2hvd1BWTG9hZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGpzb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToganNvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUYWJsZU9wdGlvbnMubG9hZERhdGEgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRGFzaGJvYXJkUGFnZSA/IHB2dWkuY29tbW9uLnB2V2lkZ2V0TG9hZGVyLmhpZGVMb2FkZXIoY29udGFpbmVyKSA6IHB2dWkuY29tbW9uLmhpZGVQVkxvYWRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGNhc2VMaXN0VGFibGUgPSBkYXRhVGFibGUuRGF0YVRhYmxlKHsKICAgICAgICAgICAgb3JkZXJpbmc6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaGluZzogdHJ1ZSwKICAgICAgICAgICAgc3RhdGVTYXZlOiB0cnVlLAogICAgICAgICAgICBzdGF0ZUR1cmF0aW9uOiAtMSwKICAgICAgICAgICAgc2VydmVyU2lkZTogdHJ1ZSwKICAgICAgICAgICAgcHJvY2Vzc2luZzogdHJ1ZSwKICAgICAgICAgICAgZG9tOiAncnRpcCcsCiAgICAgICAgICAgIHNjcm9sbENvbGxhcHNlOiB0cnVlLAogICAgICAgICAgICByZW5kZXJlcjogImJvb3RzdHJhcCIsCiAgICAgICAgICAgIHNjcm9sbFg6IHRydWUsCiAgICAgICAgICAgIGZpeGVkQ29sdW1uczogewogICAgICAgICAgICAgICAgbGVmdENvbHVtbnM6IDIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2Nyb2xsWTogcHZ1aS5ncmlkLnV0aWxzLmdldEdyaWRIZWlnaHQoY29udGFpbmVyKSwKICAgICAgICAgICAgY29sUmVvcmRlcjogewogICAgICAgICAgICAgICAgcmVhbHRpbWU6IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9yZGVyOiBvcmRlckJ5RGVmYXVsdCwgLy9kZWZhdWx0IHNvcnRpbmcgaXMgYnkgRmlyc3QgUmVjZWlwdCBkYXRlIGRlc2MKICAgICAgICAgICAgcGFnaW5nOiBwYWdpbmcsCiAgICAgICAgICAgIGxlbmd0aENoYW5nZTogbGVuZ3RoQ2hhbmdlLAogICAgICAgICAgICBwYWdlTGVuZ3RoOiBwYWdlTGVuZ3RoID8gcGFnZUxlbmd0aCA6IDI1LAogICAgICAgICAgICBkaXNwbGF5U3RhcnQ6IHBhZ2VTdGFydCwKICAgICAgICAgICAgaW5mbzogc2hvd0luZm8sCiAgICAgICAgICAgICdwYWdpbmdUeXBlJzogJ2Z1bGxfbnVtYmVyc19ub19lbGxpcHNlcycsCiAgICAgICAgICAgIGZuSW5pdENvbXBsZXRlOiB1cGRhdGVHcmlkU2Nyb2xsYmFyT25TcGxpdFZpZXcsCiAgICAgICAgICAgIGxlbmd0aE1lbnU6IFsyNSwgNTAsIDEwMCwgMjUwXSwKICAgICAgICAgICAgInN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChzZXR0aW5ncywgZGF0YSkgewogICAgICAgICAgICAgICAgc2VhcmNoRm9ybVN0YXRlLmxvYWRTdGF0ZShzZWFyY2hGb3JtTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpc0Zyb21CYWNrQnV0dG9uID0gKGlzTG9hZGVkVmlhQmFjayAmJiAhaXNXaWRnZXQpOwogICAgICAgICAgICAgICAgICAgIGlmICghaXNGcm9tQmFja0J1dHRvbikgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9yZGVyQnlEZWZhdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm9yZGVyID0gb3JkZXJCeURlZmF1bHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2luZyAmJiBkYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnLmlucC1kaXNwbGF5LXJlY29yZCcpLnZhbChkYXRhLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChpc1dpZGdldCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmxlbmd0aCA9IHBhZ2VMZW5ndGggPyBwYWdlTGVuZ3RoIDogNTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGFydCA9IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVRhYmxlLmZpbmQoInRoZWFkIHRoIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sSW5kZXggPSB0aGF0LmRhdGEoJ2lkeCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNGcm9tQmFja0J1dHRvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YUZpZWxkID0gdGhhdC5hdHRyKCdkYXRhLWZpZWxkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZGF0YUZpZWxkICE9PSAnc2ltcGxlU2VhcmNoJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuY29sdW1uc1tjb2xJbmRleF0uc2VhcmNoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbHVtbnNbY29sSW5kZXhdLnNlYXJjaCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YUZpZWxkID09PSAnYXNzaWduZWRUb1VzZXJuYW1lJyAmJiAoZGF0YS5jb2x1bW5zW2NvbEluZGV4XS5zZWFyY2guc2VhcmNoID09PSBsb2dpblVzZXIgfHwgZGF0YS5jb2x1bW5zW2NvbEluZGV4XS5zZWFyY2guc2VhcmNoID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5jb2x1bW5zW2NvbEluZGV4XS5zZWFyY2guc2VhcmNoID0gbG9naW5Vc2VyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbHVtbnNbY29sSW5kZXhdLnNlYXJjaC5zZWFyY2ggPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaW1wbGVTZWFyY2hKc29uID0gSlNPTi5wYXJzZShkYXRhLmNvbHVtbnNbY29sSW5kZXhdLnNlYXJjaC5zZWFyY2gpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VUeXBlSWQgPT0gIjQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ltcGxlU2VhcmNoSnNvbiA9IGJ1aWxkU2ltcGxlU2VhcmNoQ3JpdGVyaWEoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goWydmaXJzdFJlY2VpcHREYXRlJywgJ21vc3RSZWNlbnRSZWNlaXB0RGF0ZScsICdzdWJtaXNzaW9uRGF0ZSddLCBmdW5jdGlvbiAoaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNpbXBsZVNlYXJjaEpzb25baXRdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2VKc29uID0gdHlwZW9mIHNpbXBsZVNlYXJjaEpzb25baXRdID09PSAic3RyaW5nIj8gSlNPTi5wYXJzZShzaW1wbGVTZWFyY2hKc29uW2l0XSk6c2ltcGxlU2VhcmNoSnNvbltpdF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFuZ2VKc29uLnJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gY3JlYXRlRGF0ZVJhbmdlVmFsdWUocmFuZ2VKc29uLnJhbmdlLCByYW5nZUpzb24ueCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2VKc29uLmd0ZSA9IHJhbmdlLmd0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUpzb24ubHRlID0gcmFuZ2UubHRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbXBsZVNlYXJjaEpzb25baXRdID0gSlNPTi5zdHJpbmdpZnkocmFuZ2VKc29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5jb2x1bW5zW2NvbEluZGV4XS5zZWFyY2guc2VhcmNoID0gSlNPTi5zdHJpbmdpZnkoc2ltcGxlU2VhcmNoSnNvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaFZhbHVlID0gZGF0YS5jb2x1bW5zW2NvbEluZGV4XS5zZWFyY2guc2VhcmNoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VhcmNoVmFsdWUgPT09ICdzdHJpbmcnIHx8IHNlYXJjaFZhbHVlIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dEZpZWxkID0gdGhhdC5maW5kKCdpbnB1dCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRGaWVsZC5oYXNDbGFzcygnZGF0ZS10aW1lLWZpbHRlcicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dEZpZWxkLnZhbChnZXREYXRlVmFsdWVGcm9tUmFuZ2Uoc2VhcmNoVmFsdWUsIGlucHV0RmllbGQuYXR0cignZGF0YS1wcmVjaXNpb24nKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0RmllbGQudmFsKHNlYXJjaFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICAic3RhdGVTYXZlQ2FsbGJhY2siOiBmdW5jdGlvbiAoc2V0dGluZ3MsIGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmIChpc1dpZGdldCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgYnJvd3NlclN0b3JhZ2UudXRpbHMuYWRkVG9TdG9yYWdlKGRhdGFUYWJsZVN0b3JhZ2VLZXksdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHB2aS51c2VyLnN0YXRlLnNhdmVTdGF0ZSh2YWx1ZSwgc2VhcmNoRm9ybU5hbWUsIHB2aV9wYWdlX3NlY3Rpb25fbmFtZS5kYXRhdGFibGVfc2VjdGlvbik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzdGF0ZUxvYWRDYWxsYmFjayI6IGZ1bmN0aW9uIChzZXR0aW5ncykgewogICAgICAgICAgICAgICAgdmFyIHN0b3JhZ2VEYXRhID0gYnJvd3NlclN0b3JhZ2UudXRpbHMuZ2V0RnJvbVN0b3JhZ2UoZGF0YVRhYmxlU3RvcmFnZUtleSk7CiAgICAgICAgICAgICAgICBpZihfLmlzRW1wdHkoc3RvcmFnZURhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZURhdGEgPSAocHZpLnVzZXIuc3RhdGUubG9hZFN0YXRlKHNlYXJjaEZvcm1OYW1lLHB2aV9wYWdlX3NlY3Rpb25fbmFtZS5kYXRhdGFibGVfc2VjdGlvbikpLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICBkYXRhVGFibGUuZmluZCgidGhlYWQgdGhbZGF0YS1maWVsZD0nYXNzaWduZWRUb1VzZXJuYW1lJ10gc2VsZWN0IikudmFsKGxvZ2luVXNlcikudHJpZ2dlcigiY2hhbmdlLnNlbGVjdDIiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAoc3RvcmFnZURhdGEgPyBKU09OLnBhcnNlKHN0b3JhZ2VEYXRhKSA6IG51bGwpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBhamF4OiBmdW5jdGlvbihkYXRhLCBjYWxsYmFjaywgc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIGRlZmVycmVkRGF0YVNvdXJjZShkYXRhKS5kb25lKGZ1bmN0aW9uIChfZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHZhciBkYXRhSnNvbiA9IF9kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJyNteS1jYXNlcy1jb3VudCcpLnRleHQoZGF0YUpzb24ubXlSZWNvcmRzVG90YWwpOwogICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaGluZ1JlY29yZFRvdGFsID0gZGF0YUpzb24ubWF0Y2hpbmdSZWNvcmRzVG90YWwgPT09IDAgPyBkYXRhSnNvbi5teVJlY29yZHNUb3RhbCA6ICBkYXRhSnNvbi5tYXRjaGluZ1JlY29yZHNUb3RhbDsKICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hDYXNlQ291bnRUZXh0ID0gbWF0Y2hpbmdSZWNvcmRUb3RhbDsKICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hpbmdSZWNvcmRUb3RhbCAmJiBtYXRjaGluZ1JlY29yZFRvdGFsID4gcGFnZUxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaENhc2VDb3VudFRleHQgPSBnZXRNZXNzYWdlKCdtb3JlX3RoYW5fbWF0Y2hpbmdfbXNnJywge3BhZ2VMZW46IHBhZ2VMZW5ndGh9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJyNtYXRjaGluZy1jYXNlcy1jb3VudCcpLnRleHQobWF0Y2hDYXNlQ291bnRUZXh0KTsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnI2FsbC1jYXNlcy1jb3VudCcpLnRleHQoZGF0YUpzb24ucmVjb3Jkc1RvdGFsKTsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhSnNvbik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29sdW1uczogZ3JpZENvbHMsCiAgICAgICAgICAgIHNlYXJjaENvbHM6IGdyaWRTZWFyY2hDb2xzCiAgICAgICAgfSk7CgogICAgICAgIGNhc2VMaXN0VGFibGVSZWYuY2FzZUxpc3RUYWJsZSA9IGNhc2VMaXN0VGFibGU7CiAgICAgICAgYWxsQ2FzZUxpc3RUYWJsZXMucHVzaChjYXNlTGlzdFRhYmxlKTsKCiAgICAgICAgdmFyIGhpZ2hMaWdodFJvd3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNhc2VMaXN0VGFibGUucm93cygpLmV2ZXJ5KGZ1bmN0aW9uIChyb3dJZHgpIHsKICAgICAgICAgICAgICAgIHZhciByb3cgPSBjYXNlTGlzdFRhYmxlLnJvdyhyb3dJZHgpOwogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSByb3cuZGF0YSgpOwogICAgICAgICAgICAgICAgdmFyIG5vZGUgPSByb3cubm9kZSgpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEucGFzc0R1ZSAmJiAhKF8uY29udGFpbnMoW3B2aV9jYXNlX3N0YXRlX25hbWVzLlNVQ0NFU1NGVUwsIHB2aV9jYXNlX3N0YXRlX25hbWVzLlJFSkVDVEVEXSwgZGF0YS5jYXNlU3RhdGUpKSkgewogICAgICAgICAgICAgICAgICAgICQobm9kZSkuYWRkQ2xhc3MoInB2LWNhc2Utb3ZlcmR1ZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICB2YXIgbWFza1BJSUZpZWxkcyA9IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGRhdGFUYWJsZS5maW5kKCJ0ZCIpLmVhY2goZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBlbGUgPSAkKHRoaXMpOwogICAgICAgICAgICAgICAgaWYoZWxlLnRleHQoKSA9PT0gUElJTWFza1BhdHRlcm4pewogICAgICAgICAgICAgICAgICAgIGVsZS5hZGRDbGFzcygicHYtcGlpIikudGV4dChQSUlNYXNrU3RyaW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGhhbmRsZUFjdGlvbkRyb3Bkb3duID0gZnVuY3Rpb24gKGV2dCwgYWN0aW9uLCBjYXNlSWQsIHRlbXBsYXRlSWQsIGludGFrZUNhc2VOdW1iZXIsIGNhc2VTdGF0ZSwgdGFyZ2V0Q29udGFpbmVyLCBpbnRha2VDYXNlVmVyc2lvbikgewogICAgICAgICAgICB2YXIganVzdGlmaWNhdGlvbk1vZGFsID0gJCgiI3B2LWp1c3RpZmljYXRpb24tbW9kYWwiKTsKCiAgICAgICAgICAgIHZhciBjaGFuZ2VDYXNlU3RhdGVXaXRoSnVzdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICh0YXJnZXRTdGF0ZSwgcGFyYW1zKSB7CiAgICAgICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSAkKCIjanVzdGlmaWNhdGlvblBhc3N3b3JkIikudmFsKCk7CiAgICAgICAgICAgICAgICBwdmkudXRpbC5zaG93U3BpbkRsZyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBwdmlfdXJscy5jYXNlX3N0YXRlX2NoYW5nZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcGFyc2VJbnQoY2FzZUlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1N0YXRlSWQ6IHRhcmdldFN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvblBlcmZvcm1lZDogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzOiBwYXJhbXMuY29tbWVudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBwYXJhbXMudGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZVRvU2F2ZVByZWZlcmVuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHZ1aS5jb21tb24uaGlkZVBWTG9hZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcCA9IEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXy5oYXMocmVzcCwgImNhc2VTdGF0ZUNoYW5nZWQiKSAmJiAhcmVzcC5jYXNlU3RhdGVDaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuaGFuZGxlQ2FzZVN0YXRlQ2hhbmdlUmVqZWN0aW9uKHJlc3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganVzdGlmaWNhdGlvbk1vZGFsLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChhbGxDYXNlTGlzdFRhYmxlcywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuc2hvd0Zsb2F0aW5nTm90aWZpY2F0aW9uLnN1Y2Nlc3NNZXNzYWdlKHJlc3AubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIGNoYW5nZUNhc2VTdGF0ZSA9IGZ1bmN0aW9uICh0YXJnZXRTdGF0ZSkgewogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IHB2aV91cmxzLmNhc2Vfc3RhdGVfY2hhbmdlLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBwYXJzZUludChjYXNlSWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9TdGF0ZUlkOiB0YXJnZXRTdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvblBlcmZvcm1lZDogYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLnNob3dQVkxvYWRlcigpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3AgPUpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwLnN0YXR1cyA9PSA0MjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB2aS5saXN0LmNvbW1vbkZ1bmN0aW9ucy5wb3B1bGF0ZUVycm9ySW5FcnJvckNvbnRhaW5lcihyZXNwLnRleHQuZXJyb3JzLHRhcmdldENvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlTGlzdFRhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdnVpLmNvbW1vbi5oaWRlUFZMb2FkZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goYWxsQ2FzZUxpc3RUYWJsZXMsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB2dWkuY29tbW9uLmhpZGVQVkxvYWRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuc2hvd0Zsb2F0aW5nTm90aWZpY2F0aW9uLnN1Y2Nlc3NNZXNzYWdlKHJlc3AubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJChldnQudGFyZ2V0KTsKICAgICAgICAgICAgaWYodGFyZ2V0LnBhcmVudCgnbGk6Zmlyc3QnKS5oYXNDbGFzcygndGFzaycpKXsKICAgICAgICAgICAgICAgIHZhciBjYWxsQmFjayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2FzZUNvdW50cnlJZCA9IHRhcmdldC5kYXRhKCJjYXNlLWNvdW50cnktaWQiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgdmVuZG9ySWQgPSB0YXJnZXQuZGF0YSgidmVuZG9yLUlkIik7CiAgICAgICAgICAgICAgICAgICAgdGFza0FjdGlvbi5jb21tb25NZXRob2QuYWRkVGFzayhjYXNlSWQsIGludGFrZUNhc2VOdW1iZXIsIGludGFrZUNhc2VWZXJzaW9uLCBudWxsLCBjYXNlQ291bnRyeUlkLCB2ZW5kb3JJZCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcHZpLnV0aWwuY2hlY2tFZGl0TG9jayhjYXNlSWQsIGNhbGxCYWNrKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmKHRhcmdldC5wYXJlbnQoJ2xpOmZpcnN0JykuaGFzQ2xhc3MoJ2ZvbGxvd1VwUXVlcnknKSl7CiAgICAgICAgICAgICAgICB2YXIgY2FsbEJhY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgZm9sbG93VXBRdWVyeS5jb21tb25NZXRob2QuYWRkRm9sbG93VXBRdWVyeShjYXNlSWQsIGludGFrZUNhc2VOdW1iZXIsIGludGFrZUNhc2VWZXJzaW9uKTsKICAgICAgICAgICAgICAgICAgICBwdmkudXRpbC5nZXRDYXNlRGF0YShjYXNlSWQpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHB2aS51dGlsLmNoZWNrRWRpdExvY2soY2FzZUlkLCBjYWxsQmFjayk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAodGFyZ2V0LnBhcmVudCgnbGk6Zmlyc3QnKS5oYXNDbGFzcygnZHVwbGljYXRlU2VhcmNoJykpIHsKICAgICAgICAgICAgICAgIHZhciBnb3RvRHVwU2VhcmNoID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHB2aS51dGlsLmdvdG9VUkwocHZpX3VybHMuZHVwbGljYXRlX3NlYXJjaF91cmwgKyB0YXJnZXQuZGF0YSgnY2FzZS1pZCcpKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBwdmkudXRpbC5jaGVja0VkaXRMb2NrKGNhc2VJZCwgZ290b0R1cFNlYXJjaCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAgICAgICAgIGNhc2UgYWN0aXZlU3RhdGVJZDoKICAgICAgICAgICAgICAgICAgICBpZiAoJCh0YXJnZXQpLnBhcmVudCgpLmhhc0NsYXNzKCdmb2xsb3dVcCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY2NlcHRGb2xsb3dVcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHB2aV91cmxzLmZvbGxvd191cF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9sbG93VXBDYXNlSWQ6IGNhc2VJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB2aS51dGlsLnNob3dGb2xsb3dVcE1vZGFsLmluaXQocGFyYW1zLCBmb2xsb3dVcEZyb21MaXN0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuY2hlY2tFZGl0TG9jayhjYXNlSWQsIGFjY2VwdEZvbGxvd1VwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2aS51dGlsLmNoZWNrRWRpdExvY2soY2FzZUlkLCBjaGFuZ2VDYXNlU3RhdGUsIGFjdGl2ZVN0YXRlSWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgZmluYWxTdGF0ZUlkOgogICAgICAgICAgICAgICAgICAgIHZhciBzdWJtaXRIYW5kbGVyID0gZnVuY3Rpb24gKGZpbmFsU3RhdGVJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBzaG93V2FybmluZygiIiwgZ2V0TWVzc2FnZSgnc3VibWl0X2J0bicpLCBwdmlfY29uc3RhbnRzLmNhbmNlbF9idG5fbGFiZWwsIHB2aV9jb25zdGFudHMuc3VjY2Vzc19idG5fbGFiZWwsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUNhc2VTdGF0ZShmaW5hbFN0YXRlSWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHB2aS51dGlsLmNoZWNrRWRpdExvY2soY2FzZUlkLCBzdWJtaXRIYW5kbGVyLGZpbmFsU3RhdGVJZCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHJlamVjdGVkU3RhdGVJZDoKICAgICAgICAgICAgICAgICAgICB2YXIgcmVqZWN0Q2FzZSA9IGZ1bmN0aW9uKHJlamVjdGVkU3RhdGVJZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2aS51dGlsLmp1c3RpZmljYXRpb25Nb2R1bGUoKS5zaG93SnVzdGlmaWNhdGlvbk1vZGFsKCJtYXJrX3JlamVjdCIsIHJlamVjdGVkU3RhdGVJZCwgY2hhbmdlQ2FzZVN0YXRlV2l0aEp1c3RpZmljYXRpb24pOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcHZpLnV0aWwuY2hlY2tFZGl0TG9jayhjYXNlSWQsIHJlamVjdENhc2UsIHJlamVjdGVkU3RhdGVJZCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGNsb3NlZFN0YXRlSWQ6CiAgICAgICAgICAgICAgICAgICAgdmFyIGNsb3NlQ2FzZSA9IGZ1bmN0aW9uKGNsb3NlZFN0YXRlSWQpewogICAgICAgICAgICAgICAgICAgICAgICBwdmkudXRpbC5qdXN0aWZpY2F0aW9uTW9kdWxlKCkuc2hvd0p1c3RpZmljYXRpb25Nb2RhbCgibWFya19jbG9zZWQiLCBjbG9zZWRTdGF0ZUlkLCBjaGFuZ2VDYXNlU3RhdGVXaXRoSnVzdGlmaWNhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBwdmkudXRpbC5jaGVja0VkaXRMb2NrKGNhc2VJZCwgY2xvc2VDYXNlLCBjbG9zZWRTdGF0ZUlkKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2Z1bGxDYXNlVmlldyc6CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBmY2VVcmwgKyAiLyIgKyBjYXNlSWQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdjYXNlRW50cnknOgogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gY2FzZUVudHJ5VXJsICsgIj90ZW1wbGF0ZUlkPSIgKyB0ZW1wbGF0ZUlkICsgIiZpZD0iICsgY2FzZUlkOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnY2FzZSc6CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtczsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcGxhdGVJZCA9PT0gcHZpX2NvbnN0YW50cy5hY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gZ2VuZXJhdGVQYXJhbXMocHZpX3VybHMueG1sX3JlcG9ydF91cmwsIHB2aV9jb25zdGFudHMuYWNrLCBjYXNlSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBwdmkudXRpbC5nZXRYTUxSZXBvcnQocGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlbXBsYXRlSWQgPT09IHB2aV9jb25zdGFudHMuZTJiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNbJ3htbFR5cGUnXSA9IHB2aV9jb25zdGFudHMuZTJiOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBnZW5lcmF0ZVBhcmFtcyhwdmlfdXJscy54bWxfcmVwb3J0X3VybCwgcHZpX2NvbnN0YW50cy5lMmIsIGNhc2VJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2aS51dGlsLmdldFhNTFJlcG9ydChwYXJhbXMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGVJZCA9PT0gcHZpX2NvbnN0YW50cy5mdV9kaWZmX3ZpZXcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gZ2VuZXJhdGVQYXJhbXMocHZpX3VybHMudmFsaWRhdGVfZnVfZGlmZl92aWV3X3VybCwgcHZpX2NvbnN0YW50cy5mdV9kaWZmX3ZpZXcsIGNhc2VJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHB2aS51dGlsLnZhbGlkYXRlRnVEaWZmVmlldyhwYXJhbXMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9OwoKICAgICAgICB2YXIgZ2VuZXJhdGVQYXJhbXMgPSBmdW5jdGlvbiAodXJsLCB4bWxUeXBlLCBjYXNlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICd1cmwnOiB1cmwsCiAgICAgICAgICAgICAgICAneG1sVHlwZSc6IHhtbFR5cGUsCiAgICAgICAgICAgICAgICAnY2FzZUlkJzogY2FzZUlkCiAgICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgc2V0Q2FzZUdyaWRTZWNvbmRhcnlTdHlsZSgpOwoKICAgICAgICB2YXIgbWFuYWdlU2Vjb25kYXJ5VmlldyA9IChmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgZ2V0RGF0YUtleSA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lLmluZGV4T2YoJy4nKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWUuc3BsaXQoJy4nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUuZW5kc1dpdGgoJ0xvdycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbbmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5pbmRleE9mKCdMb3cnKSldOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZS5lbmRzV2l0aCgnV2l0aE9yZGVyJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtuYW1lLnN1YnN0cmluZygwLCBuYW1lLmluZGV4T2YoJ1dpdGhPcmRlcicpKV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbbmFtZV0gPT09IG51bGwgPyAiIiA6IFtuYW1lXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZ1bmN0aW9uIHRvIGJ1aWxkIHRoZSBzZWNvbmRhcnkgdmlldwogICAgICAgICAgICB2YXIgYnVpbGRTZWNvbmRhcnlWaWV3Rm9yQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbk5hbWUsIGxhYmVsLCBkYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BlY2lhbEZpZWxkcyA9IHsic2VyaW91c25lc3NTdHJpbmciOiAic2VyaW91c25lc3Muc2hvcnROYW1lIiwiZHVlRGF0ZSIgOiAiZHVlRGF0ZVN0cmluZyIsImNhc2VTZXJpb3VzbmVzcy5jYXRlZ29yeSI6ImNhc2VTZXJpb3VzbmVzcyIsImxvY2FsU3VibWlzc2lvbkR1ZURhdGUiOiJsb2NhbFN1Ym1pc3Npb25EdWVEYXRlU3RyaW5nIiwiY2VudHJhbFJlY2VpcHREYXRlIjoiY2VudHJhbFJlY2VpcHREYXRlU3RyaW5nIiwibG9jYWxTdWJtaXNzaW9uRGF0ZSI6ImxvY2FsU3VibWlzc2lvbkRhdGVTdHJpbmciLCAiZG9iIjogImRvYlN0cmluZyIsICJyZXBvcnRlcnMucXVhbGlmaWNhdGlvblZhbHVlIjogInJlcG9ydGVyUXVhbGlmaWNhdGlvbi52YWx1ZSIsICJyZXBvcnRlcnMuY291bnRyeU5hbWUiOiJyZXBvcnRlckNvdW50cnkubmFtZSJ9OwogICAgICAgICAgICAgICAgLy9kYXRlIGZvcm1hdCBwYXR0ZXJuIHRvIGJlIGNvbXBhdGlibGUgd2l0aCBJRQogICAgICAgICAgICAgICAgdmFyIGRhdGVGb3JtYXRQYXR0ZXJuID0gLyhcZHs0fS1bMDFdXGQtWzAtM11cZFRbMC0yXVxkOlswLTVdXGQ6WzAtNV1cZFwuXGQrKFsrLV1bMC0yXVxkOlswLTVdXGR8WikpfChcZHs0fS1bMDFdXGQtWzAtM11cZFRbMC0yXVxkOlswLTVdXGQ6WzAtNV1cZChbKy1dWzAtMl1cZDpbMC01XVxkfFopKXwoXGR7NH0tWzAxXVxkLVswLTNdXGRUWzAtMl1cZDpbMC01XVxkKFsrLV1bMC0yXVxkOlswLTVdXGR8WikpLzsKICAgICAgICAgICAgICAgIGlmKHNwZWNpYWxGaWVsZHNbY29sdW1uTmFtZV0pewogICAgICAgICAgICAgICAgICAgIGNvbHVtbk5hbWUgPSBzcGVjaWFsRmllbGRzW2NvbHVtbk5hbWVdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGhpZGVGaWVsZERhdGFGb3JTYWZldHlDYXNlcyA9IFsiY2FzZVN0YXRlIiwgImFzc2lnbmVkVG9Vc2VybmFtZSIsICJpY3NyLnJlcG9ydFZlcnNpb24iLCAiaWNzci5yZXBvcnRNZXNzYWdlIiwgImljc3IuZGVzdGluYXRpb24iLCAiY2F0ZWdvcmllcy52YWx1ZSIsICJpY3NyLnN0YXRlVGltZXN0YW1wIiwgInNlbmRlclR5cGUudmFsdWUiLCAiaWNzci50eXBlIiwgImljc3IuZHVlRGF0ZSIsICJhdHRhY2htZW50cy5uYW1lIiwgInNlbmRlck5hbWUiLCAiZHVlRGF0ZVN0cmluZyIsICJpY3NyLnRyYW5zbWlzc2lvblN0YXR1cyJdOwogICAgICAgICAgICAgICAgaWYoZGF0YS5zb3VyY2VEYklkID09PSAyICYmIGhpZGVGaWVsZERhdGFGb3JTYWZldHlDYXNlcy5pbmRleE9mKGNvbHVtbk5hbWUpID49MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGRhdGFLZXkgPSBnZXREYXRhS2V5KGNvbHVtbk5hbWUpOwogICAgICAgICAgICAgICAgdmFyIHRoZVZhbHVlID0gIiI7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgbG9va3VwCiAgICAgICAgICAgICAgICBpZiAoZGF0YUtleS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpcnN0S2V5ID0gZGF0YUtleVswXTsKICAgICAgICAgICAgICAgICAgICB2YXIgc2Vjb25kS2V5ID0gZ2V0RGF0YUtleShkYXRhS2V5WzFdKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZmlyc3RWYWx1ZSA9IGRhdGFbZmlyc3RLZXldOwogICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLmlzQXJyYXkoZmlyc3RWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZVZhbHVlID0gZmlyc3RWYWx1ZS5tYXAoZnVuY3Rpb24oZWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGVsZVtzZWNvbmRLZXldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLmlzQXJyYXkodmFsKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhS2V5WzJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KHZhbCwgZnVuY3Rpb24gKGVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZVtkYXRhS2V5WzJdXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oIiwgIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwuam9pbignLCAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oIiwgIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVWYWx1ZSA9IGZpcnN0VmFsdWVbc2Vjb25kS2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoZVZhbHVlID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGVWYWx1ZSA9IGRhdGFbZGF0YUtleV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5pc051bGwodGhlVmFsdWUpIHx8IF8uaXNVbmRlZmluZWQodGhlVmFsdWUpIHx8IF8uaXNOYU4odGhlVmFsdWUpIHx8IHRoZVZhbHVlID09PSAiICIpewogICAgICAgICAgICAgICAgICAgIHRoZVZhbHVlID0gIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihkYXRlRm9ybWF0UGF0dGVybi50ZXN0KHRoZVZhbHVlKSl7CiAgICAgICAgICAgICAgICAgICAgdGhlVmFsdWUgPSBtb21lbnQodGhlVmFsdWUpLmZvcm1hdCgocHZpLnV0aWwuZ2V0RGF0ZUZvcm1hdHMubGlzdERhdGVGb3JtYXQpLnRvVXBwZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBmb290YWJsZUNvbENsYXNzID0gdGhlVmFsdWUubGVuZ3RoIDwgNTAgPyAiZm9vdGFibGUtcm93LWRldGFpbC1jb2wtbWQiIDogImZvb3RhYmxlLXJvdy1kZXRhaWwtY29sLWxnIjsKICAgICAgICAgICAgICAgIHB2dWkuZ3JpZC51dGlscy5zZXRHcmlkSGVpZ2h0KGNvbnRhaW5lcik7IC8vVG8gRml4IERhc2hib2FyZCBXaWRnZXQgRHluYW1pYyBIZWlnaHQgSXNzdWVzCiAgICAgICAgICAgICAgICAkKCIucHYtYWN0aW9uLWRyb3Bkb3duIikuaGlkZSgpOyAvL1RoaXMgaXMgdG8gZml4IGlzc3VlIGZvciBvcGVuZWQgZHJvcGRvd24gbm90IGJlaW5nIGNsb3NlZCBjbGlja2luZyBvbiByb3cKICAgICAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KHRoZVZhbHVlKSAmJiB0aGVWYWx1ZSA9PT0gUElJTWFza1BhdHRlcm4pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iZm9vdGFibGUtcm93LWRldGFpbC1jb2wgJyArIGZvb3RhYmxlQ29sQ2xhc3MgKyAnIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImZvb3RhYmxlLXJvdy1kZXRhaWwtbmFtZSI+JyArIGxhYmVsICsgJyA8L2Rpdj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImZvb3RhYmxlLXJvdy1kZXRhaWwtdmFsdWUgcHYtcGlpIj4nICsgUElJTWFza1N0cmluZyArICc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmKCFfLmlzRW1wdHkodGhlVmFsdWUpKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9ImZvb3RhYmxlLXJvdy1kZXRhaWwtY29sICcgKyBmb290YWJsZUNvbENsYXNzICsgJyI+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJmb290YWJsZS1yb3ctZGV0YWlsLW5hbWUiPicgKyBsYWJlbCArICcgPC9kaXY+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJmb290YWJsZS1yb3ctZGV0YWlsLXZhbHVlIj4nICsgcHZpLnV0aWwuZW5jb2RlVG9IVE1MKHRoZVZhbHVlKSArICc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgZ2VuZXJhdGVTZWNvbmRhcnlWaWV3SFRNTCA9IGZ1bmN0aW9uIChyb3dEYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAocm93RGF0YSkgewogICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVdyYXBwZXJXaWR0aCA9IGNvbnRhaW5lci5maW5kKCIuRFRGQ19TY3JvbGxXcmFwcGVyIikud2lkdGgoKSAtIDE1OwogICAgICAgICAgICAgICAgICAgIHZhciBncmlkU2Nyb2xsZWRMZWZ0ID0gY29udGFpbmVyLmZpbmQoIi5kYXRhVGFibGVzX3Njcm9sbEJvZHkiKS5nZXQoMCkuc2Nyb2xsTGVmdDsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNBbnlEYXRhQXZhaWxhYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgLy8gcm93RGF0YSBpcyB0aGUgb3JpZ2luYWwgZGF0YSBvYmplY3QgZm9yIHRoZSByb3cKICAgICAgICAgICAgICAgICAgICB2YXIgYnVpbGRTZWNvbmRhcnlWaWV3ID0gYnVpbGRTZWNvbmRhcnlWaWV3Rm9yQ29sdW1uOwogICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSAnPGRpdiBjbGFzcz0iZm9vdGFibGUtcm93LWRldGFpbC1pbm5lciIgc3R5bGU9IndpZHRoOicgKyB0YWJsZVdyYXBwZXJXaWR0aCArICdweDsgbWFyZ2luLWxlZnQ6JytncmlkU2Nyb2xsZWRMZWZ0ICsncHgiPic7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbERhdGEgPSBfLnJlZHVjZShsaXN0Q29sdW1ucyhwdmlfbGlzdF9jb2x1bW5zX3ZpZXcuc2Vjb25kYXJ5Q29scywgdHJ1ZSksIGZ1bmN0aW9uIChtZW1vLCBlbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbERhdGEgPSBidWlsZFNlY29uZGFyeVZpZXcoZWxlLm5hbWUsIGVsZS5sYWJlbCwgcm93RGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2xEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQW55RGF0YUF2YWlsYWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lbW8gKyBjb2xEYXRhICsgIlxuIjsKICAgICAgICAgICAgICAgICAgICB9LCAiIik7CiAgICAgICAgICAgICAgICAgICAgY29sRGF0YSA9IGVsZSArJzxkaXYgY2xhc3M9ImZvb3RhYmxlLXJvdy1kZXRhaWwtcm93Ij4nKyBjb2xEYXRhOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0FueURhdGFBdmFpbGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbERhdGEgKyAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlICsnPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIiPicgKyBnZXRNZXNzYWdlKCdub19kYXRhX3NlY29uZGFyeV92aWV3JykgKyAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBoaWRlU2Vjb25kYXJ5VmlldyA9IGZ1bmN0aW9uICh0ciwgcm93KSB7CiAgICAgICAgICAgICAgICB0ci5yZW1vdmVDbGFzcygnZGV0YWlscycpOwogICAgICAgICAgICAgICAgcm93LmNoaWxkLmhpZGUoKTsKICAgICAgICAgICAgICAgIHZhciBmaXhlZENvbHVtblJvdyA9IGNvbnRhaW5lci5maW5kKCcuRFRGQ19DbG9uZWQgdGJvZHkgdHJbZGF0YS1kdC1yb3c9JyArIHJvdy5pbmRleCgpICsgJ11bY2xhc3MqPSJwYWRkaW5nIl0nKTsKICAgICAgICAgICAgICAgIGZpeGVkQ29sdW1uUm93LnJlbW92ZSgpOwogICAgICAgICAgICAgICAgcHZ1aS5ncmlkLm1hbmFnZVVJV3JhcHBlci51cGRhdGVQZXJmZWN0U2Nyb2xsYmFyKGNvbnRhaW5lcik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgc2hvd1NlY29uZGFyeVZpZXcgPSBmdW5jdGlvbiAodHIsIHJvdykgewogICAgICAgICAgICAgICAgdmFyIGlkeCA9IHJvdy5pbmRleCgpOwogICAgICAgICAgICAgICAgdmFyIHNlY29uZGFyeVZpZXdIVE1MID0gZ2VuZXJhdGVTZWNvbmRhcnlWaWV3SFRNTChyb3cuZGF0YSgpKTsKICAgICAgICAgICAgICAgIHRyLmFkZENsYXNzKCdkZXRhaWxzJyk7CiAgICAgICAgICAgICAgICB2YXIgc2Vjb25kYXJ5UGFuZWwgPSByb3cuY2hpbGQoc2Vjb25kYXJ5Vmlld0hUTUwpOwogICAgICAgICAgICAgICAgdmFyIHAgPSBzZWNvbmRhcnlQYW5lbC5zaG93KCk7CiAgICAgICAgICAgICAgICB2YXIgdGRIZWlnaHQgPSB0ci5uZXh0KCkuYWRkQ2xhc3MoJ3B2LWNhc2VsaXN0LXNlY29kYXJ5LXZpZXcnKS5maW5kKCIuZm9vdGFibGUtcm93LWRldGFpbC1pbm5lciIpLmhlaWdodCgpOwogICAgICAgICAgICAgICAgdHIubmV4dCgpLmZpbmQoInRkIikuY3NzKHsiaGVpZ2h0IjogdGRIZWlnaHQgKyAicHgifSk7CiAgICAgICAgICAgICAgICB2YXIgcm93SGVpZ2h0ID0gJChwLmNoaWxkKCkpLmhlaWdodCgpOwogICAgICAgICAgICAgICAgdmFyIGZpeGVkQ29sdW1uUm93ID0gY29udGFpbmVyLmZpbmQoJy5EVEZDX0Nsb25lZCB0Ym9keSB0cltkYXRhLWR0LXJvdz0nICsgaWR4ICsgJ10nKTsKICAgICAgICAgICAgICAgIGZpeGVkQ29sdW1uUm93LmFmdGVyKCI8dHIgY2xhc3M9J3BhZGRpbmcnIGRhdGEtZHQtcm93PSciICsgaWR4ICsgIicgc3R5bGU9J2hlaWdodDoiICsgcm93SGVpZ2h0ICsgInB4Jz48dGQgY29sc3Bhbj0nMic+PC90ZD48L3RyPiIpOwogICAgICAgICAgICAgICAgcHZ1aS5ncmlkLm1hbmFnZVVJV3JhcHBlci51cGRhdGVQZXJmZWN0U2Nyb2xsYmFyKGNvbnRhaW5lcik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgICAgICAgICAgICAgIHZhciB0cklkeCA9ICQodGFyZ2V0KS5jbG9zZXN0KCJ0ciIpLmluZGV4KCkrMTsKICAgICAgICAgICAgICAgIHZhciB0ciA9IGNvbnRhaW5lci5maW5kKCIuZGF0YVRhYmxlc19zY3JvbGxCb2R5PnRhYmxlPnRib2R5PnRyOm50aC1jaGlsZCgiK3RySWR4KyIpIik7CiAgICAgICAgICAgICAgICB2YXIgcm93ID0gY2FzZUxpc3RUYWJsZS5yb3codHIpOwogICAgICAgICAgICAgICAgaWYgKHJvdy5jaGlsZC5pc1Nob3duKCkpIHsKICAgICAgICAgICAgICAgICAgICBoaWRlU2Vjb25kYXJ5Vmlldyh0ciwgcm93KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzZWNvbmRhcnlDb2x1bW5zRXhpc3QoKSkgewogICAgICAgICAgICAgICAgICAgIHNob3dTZWNvbmRhcnlWaWV3KHRyLCByb3cpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGluaXQ6IGluaXQKICAgICAgICAgICAgfTsKICAgICAgICB9KSgpOwoKICAgICAgICB2YXIgaW5pdGlhbGl6ZVBvcG92ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF8uZWFjaChjb250YWluZXIuZmluZCgnLm1vcmUtb3B0aW9uJyksIGZ1bmN0aW9uIChlbGUpIHsKICAgICAgICAgICAgICAgIGVsZSA9ICQoZWxlKTsKICAgICAgICAgICAgICAgIHZhciBtb3JlRGF0YUNvbnRhaW5lciA9IGVsZS5jbG9zZXN0KCIucHZqc19pbm5lci1tb3JlLWJveCIpOwogICAgICAgICAgICAgICAgdmFyIG1vcmVEYXRhOwogICAgICAgICAgICAgICAgaWYgKG1vcmVEYXRhQ29udGFpbmVyLmhhc0NsYXNzKCdkaXNhYmxlSHRtbEVuY29kZScpKSB7CiAgICAgICAgICAgICAgICAgICAgbW9yZURhdGEgPSBlbGUuZGF0YSgnbW9yZWRhdGEnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbW9yZURhdGEgPSBwdmkudXRpbC5lbmNvZGVUb0hUTUwoZWxlLmRhdGEoJ21vcmVkYXRhJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGlzSWNvblZpZXcgPSBlbGUuZGF0YSgnaWNvbnZpZXctcG9wb3ZlcicpOwogICAgICAgICAgICAgICAgdmFyIGN1cnJWYWwgPSBpc0ljb25WaWV3PyBlbGUudGV4dCgpOiAnJzsKICAgICAgICAgICAgICAgIHZhciB0YXJnZXRFdmVudCA9IGVsZS5kYXRhKCd0YXJnZXQtZXZlbnQnKTsKICAgICAgICAgICAgICAgIHZhciBiaW5kRXZlbnQgPSB0YXJnZXRFdmVudCA/IHRhcmdldEV2ZW50IDogJ2hvdmVyJzsKICAgICAgICAgICAgICAgIGVsZS53ZWJ1aVBvcG92ZXIoewogICAgICAgICAgICAgICAgICAgIGh0bWw6ICFlbGUuaGFzQ2xhc3MoJ2FsbG93LXRleHQnKSwKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiBiaW5kRXZlbnQsCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZihfLmlzRW1wdHkobW9yZURhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3JlRGF0YSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aGVEYXRhID0gXy5maWx0ZXIobW9yZURhdGEuc3BsaXQoJywnKSwgZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIV8uaXNFbXB0eShpdC50cmltKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RDb250YWluZXIgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIShfLmlzRW1wdHkodGhlRGF0YSkpICYmICFtb3JlRGF0YUNvbnRhaW5lci5kYXRhKCJ0eXBlLXN0cmluZyIpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzSWNvblZpZXcpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RDb250YWluZXIgPSAkKCI8dWwgY2xhc3M9J2ljb24tbGlzdCcvPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VySWQgPSAkKGVsZSkuZGF0YSgncGsnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoZURhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZUNsYXNzID0gKHRoZURhdGFbaV0gPT09IGN1cnJWYWwpID8gImFjdGl2ZSI6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gJCgiPGxpPjxhIGRhdGEtcGs9JyIrdXNlcklkKyInIGNsYXNzPSciKyBhY3RpdmVDbGFzcyArIiBwb3AtaWMiKyB0aGVEYXRhW2ldICsgIic+IiArIHRoZURhdGFbaV0gKyAiPC9hPjwvbGk+Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuYXBwZW5kVG8obGlzdENvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0Q29udGFpbmVyID0gJCgiPHVsIGNsYXNzPSd0ZXh0LWxpc3QnLz4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoZURhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoZURhdGFbal0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9ICQoIjxsaT4iICsgdGhlRGF0YVtqXSArICI8L2xpPiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuYXBwZW5kVG8obGlzdENvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdENvbnRhaW5lciA9IG1vcmVEYXRhQ29udGFpbmVyLnRleHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdENvbnRhaW5lcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgY2FzZUxpc3RUYWJsZS5vbignY2xpY2snLCcuc2hvd1VuYXV0aG9yaXNlZE1lc3NhZ2UnLGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcHZpLnV0aWwuc2hvd0luZm8oZ2V0TWVzc2FnZSgicGlpX2F0dGFjaG1lbnRfd2FybmluZyIpKTsKICAgICAgICB9KTsKCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy53ZWJ1aS1wb3BvdmVyLWNvbnRlbnQgLnNob3dVbmF1dGhvcmlzZWRNZXNzYWdlJywgZnVuY3Rpb24gKCkge3B2aS51dGlsLnNob3dJbmZvKGdldE1lc3NhZ2UoInBpaV9hdHRhY2htZW50X3dhcm5pbmciKSl9KTsKCiAgICAgICAgY2FzZUxpc3RUYWJsZS5vbignY2xpY2snLCAnLmxpc3Qtcm93LWNoZWNrYm94JywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgIHZhciBpc0NoZWNrZWQgPSB0YXJnZXQuaXMoIjpjaGVja2VkIik7CiAgICAgICAgICAgIGlmICghaXNDaGVja2VkKSB7CiAgICAgICAgICAgICAgICB1bmNoZWNrU2VsZWN0QWxsQ2hlY2tib3goKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihpc0NoZWNrZWQgJiYgaXNPbkR1cGxpY2F0ZVNlYXJjaFBhZ2UpewogICAgICAgICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3hbbmFtZT0nIiArIHRhcmdldC5wcm9wKCJuYW1lIikgKyAiJ10iKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgdGFyZ2V0LnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgc2hvd0J1bGtBY3Rpb25CdXR0b24gPSAgKGNvbnRhaW5lci5maW5kKCIubGlzdC1yb3ctY2hlY2tib3g6Y2hlY2tlZCIpLmxlbmd0aCA+IDEpOwogICAgICAgICAgICBtYW5hZ2VCdWxrQWN0aW9uLmluaXQoc2hvd0J1bGtBY3Rpb25CdXR0b24pOwogICAgICAgIH0pOwoKICAgICAgICBjYXNlTGlzdFRhYmxlLm9uKCdjbGljaycsICcubGluay10by1mY2UnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRFbGVtZW50ID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIHNvdXJjZURiSWQgPSBjdXJyZW50RWxlbWVudC5kYXRhKCJzb3VyY2UtZGIiKTsKICAgICAgICAgICAgaWYoc291cmNlRGJJZCA9PT0gcHZpX2NvbnN0YW50cy5zb3VyY2VfZGJfaW50YWtlKXsKICAgICAgICAgICAgICAgIHB2aS51dGlsLmdvdG9VUkwocHZpX3VybHMuc2hvd19jYXNlX3VybCArIGN1cnJlbnRFbGVtZW50LmF0dHIoJ2RhdGEtaWQnKSArIHB2aV91cmxzLm9wZW5fYWNjb3JkaW9uKTsKICAgICAgICAgICAgfSBlbHNlIGlmKHNvdXJjZURiSWQgPT09IHB2aV9jb25zdGFudHMuc291cmNlX2RiX3NhZmV0eSl7CiAgICAgICAgICAgICAgICAvL2ZpbmQgaWQgb2YgbGF0ZXN0IHZhbGlkIHZlcnNpb24gdXNpbmcgaW50YWtlIGNhc2UKICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgICAgICAgICAgICAgc291cmNlQ2FzZU51bTogY3VycmVudEVsZW1lbnQudGV4dCgpLAogICAgICAgICAgICAgICAgICAgIHNvdXJjZURiSWQ6IHNvdXJjZURiSWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBwdmkudXRpbC5mZXRjaExpbmtlZENhc2VzRGV0YWlscyhwYXJhbXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGNhc2VMaXN0VGFibGUub24oJ2NsaWNrJywgJy5zYWZldHktbGluay10by1mY2UnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRFbGVtZW50ID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIHNvdXJjZURiSWQgPSBjdXJyZW50RWxlbWVudC5kYXRhKCJzb3VyY2UtZGIiKTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRFbGVtZW50Lmhhc0NsYXNzKCJzYWZldHktbGluay1ub3QtZXhpc3RzIikpIHsKICAgICAgICAgICAgICAgIHN3YWwoIldhcm5pbmciLCBnZXRNZXNzYWdlKCdzYWZldHlfY2FzZV9ub3RfbGlua2VkJykpOwogICAgICAgICAgICB9IGVsc2UgaWYoc291cmNlRGJJZCA9PT0gcHZpX2NvbnN0YW50cy5zb3VyY2VfZGJfc2FmZXR5KSB7CiAgICAgICAgICAgICAgICBwdmkudXRpbC5nb3RvVVJMKHB2aV91cmxzLnNob3dfY2FzZV91cmwgKyBjdXJyZW50RWxlbWVudC5hdHRyKCdkYXRhLWlkJykgKyBwdmlfdXJscy5vcGVuX2FjY29yZGlvbik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc291cmNlRGJJZCA9PT0gcHZpX2NvbnN0YW50cy5zb3VyY2VfZGJfaW50YWtlKSB7CiAgICAgICAgICAgICAgICAvL2ZpbmQgc2FmZXR5IGNhc2UgaWQgdXNpbmcgc2FmZXR5IGNhc2UgbnVtCiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgIHNvdXJjZUNhc2VOdW06IGN1cnJlbnRFbGVtZW50LnRleHQoKSwKICAgICAgICAgICAgICAgICAgICBzb3VyY2VEYklkOiBzb3VyY2VEYklkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcHZpLnV0aWwuZmV0Y2hMaW5rZWRDYXNlc0RldGFpbHMocGFyYW1zKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjYXNlTGlzdFRhYmxlLm9uKCdjbGljaycsICcubm90LWNsaWNrYWJsZScsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBzd2FsKCJ3YXJuaW5nIiwgZ2V0TWVzc2FnZSgnbm9fYWN0aW9uX3N0YXRlJykgKyAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1jYXNlLXN0YXRlJykgKyAiIFN0YXRlIik7CiAgICAgICAgfSk7CgogICAgICAgIGNhc2VMaXN0VGFibGUub24oJ21vdXNlZW50ZXInLCAnc3Bhbi5zdGF0ZS1jb21tZW50JywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS50b29sdGlwKCk7CiAgICAgICAgfSk7CgogICAgICAgIHB2aS51dGlsLm1hbmFnZVVzZXJBc3NpZ24uaW5pdChzY3JvbGxhYmxlU2VjdGlvbiwgc2Nyb2xsYWJsZUZpeGVkQ29sKTsKICAgICAgICBwdmkudXRpbC5tYW5hZ2VDYXNlUHJpb3JpdHkuaW5pdCgpOwogICAgICAgIGNhc2VMaXN0VGFibGUub24oJ2NsaWNrJywgJ3RyIHRkJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHRhcmdldEVsZW1lbnQgPSBlLnRhcmdldC50YWdOYW1lOwogICAgICAgICAgICBpZih0YXJnZXRFbGVtZW50ID09PSAiVEQiKXsKICAgICAgICAgICAgICAgIG1hbmFnZVNlY29uZGFyeVZpZXcuaW5pdChlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBtb3ZlZCBvdXQgYWN0aW9uIGRyb3Bkb3duIGh5cGVybGluayBjbGljayBmdW5jdGlvbgogICAgICAgICQoZG9jdW1lbnQpLm9uKCJjbGljayIsICIucHYtYWN0aW9uLWRyb3Bkb3duIGEiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmKGUuaGFuZGxlZCAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS50YXJnZXQpLAogICAgICAgICAgICAgICAgICAgIGNhc2VJZCA9IHRhcmdldC5hdHRyKCdkYXRhLWNhc2UtaWQnKSwKICAgICAgICAgICAgICAgICAgICBpbnRha2VDYXNlTnVtYmVyID0gdGFyZ2V0LmF0dHIoJ2RhdGEtaW50YWtlLWNhc2UtbnVtJyksCiAgICAgICAgICAgICAgICAgICAgaW50YWtlQ2FzZVZlcnNpb24gPSB0YXJnZXQuYXR0cignZGF0YS1pbnRha2UtY2FzZS12ZXJzaW9uJyksCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gdGFyZ2V0LmRhdGEoJ2FjdGlvbicpLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlSWQgPSB0YXJnZXQuYXR0cignZGF0YS10ZW1wbGF0ZUlkJyksCiAgICAgICAgICAgICAgICAgICAgY2FzZVN0YXRlID0gdGFyZ2V0LmRhdGEoJ2Nhc2Utc3RhdGUnKSwKICAgICAgICAgICAgICAgICAgICB0YXJnZXRDb250YWluZXIgPSB0YXJnZXQuZGF0YSgnY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICBoYW5kbGVBY3Rpb25Ecm9wZG93bihlLCBhY3Rpb24sIGNhc2VJZCwgdGVtcGxhdGVJZCwgaW50YWtlQ2FzZU51bWJlciwgY2FzZVN0YXRlLHRhcmdldENvbnRhaW5lciwgaW50YWtlQ2FzZVZlcnNpb24pOwogICAgICAgICAgICAgICAgZS5oYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjYXNlTGlzdFRhYmxlLm9uKCdkcmF3LmR0ZmMnLCBmdW5jdGlvbigpewogICAgICAgICAgICB2YXIgaW5wdXRzID0gY29udGFpbmVyLmZpbmQoImRpdi5EVEZDX1Njcm9sbFdyYXBwZXIgaW5wdXRbZGF0YS1maWVsZD0iK2ZpeGVkRmlsdGVyQ29sTmFtZSsiXSIpOwogICAgICAgICAgICBpZihpbnB1dHMubGVuZ3RoID09PSAzKXsgLy9maXhlZCBjb2xzIGNyZWF0ZXMgdGhyZWUgaW5zdGFuY2VzIG9mIHRoZSBmaWx0ZXIgaW5wdXRzIGluc3RlYWQgb2YgMgogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJChpbnB1dHNbMl0pLnZhbCgpOwogICAgICAgICAgICAgICAgJChpbnB1dHNbMF0pLnZhbCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAkKGlucHV0c1sxXSkudmFsKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjYXNlTGlzdFRhYmxlLm9uKCdkcmF3LmR0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBoaWdoTGlnaHRSb3dzKCk7CiAgICAgICAgICAgIGhpZGVDYXNlTGlzdEFjdGlvbkFsbEJ1dHRvbigpOwogICAgICAgICAgICB1bmNoZWNrU2VsZWN0QWxsQ2hlY2tib3goKTsKICAgICAgICAgICAgY29sUmVvcmRlckNhc2VMaXN0KCk7CiAgICAgICAgICAgIHB2dWkuZ3JpZC5tYW5hZ2VVSVdyYXBwZXIuc2V0UGVyZmVjdFNjcm9sbGJhcihjb250YWluZXIpOwogICAgICAgICAgICBwdnVpLmdyaWQubWFuYWdlVUlXcmFwcGVyLmhhbmRsZURyYWdEcm9wRXZlbnQoY29udGFpbmVyKTsKICAgICAgICAgICAgdXBkYXRlR3JpZFVJKCk7CiAgICAgICAgICAgIHB2dWkuZ3JpZC51dGlscy51cGRhdGVHcmlkT25SZXNpemUoY29udGFpbmVyKTsKICAgICAgICAgICAgcHZ1aS5jb21tb24uaGlkZVBWTG9hZGVyKCk7CiAgICAgICAgICAgIHB2dWkuZ3JpZC5tYW5hZ2VVSVdyYXBwZXIucHJldmVudFNjcm9sbGluZ0VtcHR5R3JpZChjb250YWluZXIsIHNjcm9sbGFibGVTZWN0aW9uKTsKICAgICAgICAgICAgcHZ1aS5ncmlkLm1hbmFnZVVJV3JhcHBlci5oYW5kbGVSb3dNb3VzZU92ZXJFdmVudChjb250YWluZXIpOwogICAgICAgICAgICBwdnVpLmdyaWQubWFuYWdlVUlXcmFwcGVyLmJpbmRJY29uSG92ZXJFdmVudHMoY29udGFpbmVyKTsKICAgICAgICAgICAgcHZ1aS5ncmlkLm1hbmFnZVVJV3JhcHBlci5oYW5kbGVHcmlkSG9yaXpvbnRhbFNjcm9sbChjb250YWluZXIpOwogICAgICAgICAgICBtYXNrUElJRmllbGRzKCk7CiAgICAgICAgICAgIHB2dWkuZ3JpZC5tYW5hZ2VVSVdyYXBwZXIuc2V0TW9yZU9wdGlvbihjb250YWluZXIpOwogICAgICAgICAgICBpbml0aWFsaXplUG9wb3ZlcigpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBjYXNlTGlzdFRhYmxlOwogICAgfTsKCiAgICB2YXIgY3VycmVudENvbE9yZGVyID0gW107CgogICAgdmFyIGNvbFJlb3JkZXJDYXNlTGlzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbmV3T3JkZXIgPSBidWlsZENvbHVtbk9yZGVyKCk7CiAgICAgICAgaWYgKCFfLmlzRXF1YWwoY3VycmVudENvbE9yZGVyLCBuZXdPcmRlcikpIHsKICAgICAgICAgICAgY2FzZUxpc3RUYWJsZS5jb2xSZW9yZGVyLm9yZGVyKG5ld09yZGVyLCB0cnVlKTsKICAgICAgICAgICAgY3VycmVudENvbE9yZGVyID0gbmV3T3JkZXI7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgaGlkZUNhc2VMaXN0QWN0aW9uQWxsQnV0dG9uID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnRhaW5lci5maW5kKCIuYnRuLWNhc2VsaXN0LWFjdGlvbi1hbGwiKS5hZGRDbGFzcygiaGlkZSIpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgIGNvbnRhaW5lci5maW5kKCIuZ3JpZC10b3AtaGVhZCAuZHJvcGRvd24tbWVudSIpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdvcGVuJyk7CiAgICB9OwoKICAgIHZhciBzaG93Q29uZmlnQ29scyA9IGZ1bmN0aW9uIChjb2xzKSB7CiAgICAgICAgdmFyIGxpc3RPcmRlciA9IDA7CiAgICAgICAgcmV0dXJuIF8ucmVkdWNlKGNvbHMsIGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBjb2wpIHsKICAgICAgICAgICAgaWYgKCFfLmhhcyhjb2wsICdsaXN0T3JkZXInKSl7CiAgICAgICAgICAgICAgICBjb2wubGlzdE9yZGVyID0gbGlzdE9yZGVyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb24gKyAnPGEgaHJlZj0iIyIgY2xhc3M9Imxpc3QtZ3JvdXAtaXRlbSIgZGF0YS1maWVsZD0iJyArIGNvbC5uYW1lICsgJyI+JyArIGNvbC5sYWJlbCArICc8L2E+JyArICJcbiI7CiAgICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uOwogICAgICAgIH0sICIiKTsKICAgIH07CgogICAgdmFyIHByZV9sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogY3JlYXRlVVJMKHB2aV91cmxzLmNhc2VfbGlzdF9jb2x1bW5zX3VybCksCiAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbkNvbmZpZ3MgPSBfLmNvbGxlY3QoZGF0YSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNmZyA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBjZmcubmFtZSA9IGl0ZW0ubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmxhYmVsID0gaXRlbS5sYWJlbDsKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNlcSA9IGl0ZW0uc2VxOwogICAgICAgICAgICAgICAgICAgICAgICBjZmcubGlzdE9yZGVyID0gaXRlbS5saXN0T3JkZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5jb250YWluZXJWaWV3ID0gaXRlbS5jb250YWluZXJWaWV3OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2ZnOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5saXN0LWdyb3VwLXByaW1hcnknKS5odG1sKHNob3dDb25maWdDb2xzKGxpc3RDb2x1bW5zKHB2aV9saXN0X2NvbHVtbnNfdmlldy5wcmltYXJ5Q29scywgdHJ1ZSkpKTsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcubGlzdC1ncm91cC1zZWNvbmRhcnknKS5odG1sKHNob3dDb25maWdDb2xzKGxpc3RDb2x1bW5zKHB2aV9saXN0X2NvbHVtbnNfdmlldy5zZWNvbmRhcnlDb2xzLCB0cnVlKSkpOwogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5saXN0LWdyb3VwLW9wdGlvbmFsJykuaHRtbChzaG93Q29uZmlnQ29scyhsaXN0Q29sdW1ucyhwdmlfbGlzdF9jb2x1bW5zX3ZpZXcub3B0aW9uYWxDb2xzLCB0cnVlKSkpOwogICAgICAgICAgICAgICAgaW5pdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBjcmVhdGVVUkwgPSBmdW5jdGlvbiAodXJsKSB7CiAgICAgICAgaWYgKCF1cmwuZW5kc1dpdGgoIi8iKSkgdXJsID0gdXJsICsgIi8iOwogICAgICAgIHJldHVybiB1cmwgKyBwYWdlVHlwZUlkOwogICAgfTsKCiAgICB2YXIgYnVpbGRDb2x1bW5PcmRlciA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgdmFyIGdldFByZURlZk9yZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY3VycmVudEhlYWRlciA9IGRhdGFUYWJsZS5maW5kKCd0aGVhZCB0aCcpOwogICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KGN1cnJlbnRIZWFkZXIsIGZ1bmN0aW9uIChlbGUpIHsKICAgICAgICAgICAgICAgIGVsZSA9ICQoZWxlKTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWR4OiBlbGUuZGF0YSgnaWR4JyksCiAgICAgICAgICAgICAgICAgICAgbmFtZTogZWxlLmF0dHIoJ2RhdGEtZmllbGQnKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGJ1aWxkTmV3T3JkZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBwcmVEZWZPcmRlciA9IGdldFByZURlZk9yZGVyKCk7CiAgICAgICAgICAgIHZhciBuZXdPcmRlciA9IFtdOwogICAgICAgICAgICB2YXIgc29ydGVkUHJpbWFyeUNvbHMgPSBsaXN0Q29sdW1ucyhwdmlfbGlzdF9jb2x1bW5zX3ZpZXcucHJpbWFyeUNvbHMsIHRydWUpOwogICAgICAgICAgICBpZiAoaW5pdE9yZGVyKSB7CiAgICAgICAgICAgICAgICBpbml0T3JkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF8uZWFjaChzb3J0ZWRQcmltYXJ5Q29scywgZnVuY3Rpb24gKGNmZykgewogICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IF8uZmluZChwcmVEZWZPcmRlciwgZnVuY3Rpb24gKHBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoY2ZnLm5hbWUgPT09IHBkLm5hbWUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCkKICAgICAgICAgICAgICAgICAgICAgICAgbmV3T3JkZXIucHVzaChmb3VuZC5pZHgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3T3JkZXI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXdPcmRlciA9IF8uY29sbGVjdChzb3J0ZWRQcmltYXJ5Q29scywgZnVuY3Rpb24gKGNvbENmZykgewogICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IF8uZmluZChwcmVEZWZPcmRlciwgZnVuY3Rpb24gKGVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGNvbENmZy5zZXEgPT09IGVsZS5pZHgpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3VuZCA/IGZvdW5kLmlkeCA6IDA7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXdPcmRlcjsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY29sdW1ucyA9IF8ucmFuZ2UoMCwgY29sdW1uU2l6ZSk7CiAgICAgICAgICAgIHZhciBuZXdPcmRlciA9IGJ1aWxkTmV3T3JkZXIoKTsKICAgICAgICAgICAgdmFyIHJlc3RDb2x1bW5zID0gXy5maWx0ZXIoY29sdW1ucywgZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhXy5jb250YWlucyhuZXdPcmRlciwgaSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgZmluYWxPcmRlciA9IG5ld09yZGVyLmNvbmNhdChyZXN0Q29sdW1ucyk7CiAgICAgICAgICAgIGZpbmFsT3JkZXIgPSBfLndpdGhvdXQoZmluYWxPcmRlciwgMCwgMSwgY29sdW1uU2l6ZSAtIDEpOwogICAgICAgICAgICBmaW5hbE9yZGVyLnB1c2goY29sdW1uU2l6ZSAtIDEpOwogICAgICAgICAgICBmaW5hbE9yZGVyLnVuc2hpZnQoMSk7CiAgICAgICAgICAgIGZpbmFsT3JkZXIudW5zaGlmdCgwKTsKICAgICAgICAgICAgcmV0dXJuIGZpbmFsT3JkZXI7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gaW5pdCgpOwogICAgfTsKCiAgICB2YXIgcmVzZXRQcm9jZXNzaW5nTWVzc2FnZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgJC5leHRlbmQoICQuZm4uZGF0YVRhYmxlLmRlZmF1bHRzLCB7CiAgICAgICAgICAgIGxhbmd1YWdlOiB7CiAgICAgICAgICAgICAgICAicHJvY2Vzc2luZyI6ICIiCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGluaXRMaXN0UGFnZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXNldFByb2Nlc3NpbmdNZXNzYWdlKCk7CiAgICAgICAgcHJlX2xvYWQoKTsKICAgICAgICByZUluaXRCdXR0b25zQWZ0ZXJSZWRyYXcoKTsKICAgICAgICBwdnVpLmdyaWQudXRpbHMuYXBwZW5kRHJvcGRvd25PdXRzaWRlQ29udGFpbmVyKGNvbnRhaW5lciwnLnRkLWJveD4uZHJvcGRvd24nKTsKICAgICAgICBwdmkucmRsLm1hbmFnZVJlcG9ydERpc3RyaWJ1dGlvbi5pbml0KCk7CiAgICAgICAgaWYoJCgnI2lzRGFzaGJvYXJkUGFnZScpLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgcHZpLnV0aWwuYmluZEZpbGVVcGxvYWRlckV2ZW50KCk7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgaGlnaGxpZ2h0VGFiID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChpbml0aWFsaXplZCkgewogICAgICAgICAgICB2YXIgY29sdW1uID0gY2FzZUxpc3RUYWJsZVJlZi5jYXNlTGlzdFRhYmxlLmNvbHVtbignYXNzaWduZWRUb1VzZXJuYW1lOm5hbWUnKTsKICAgICAgICAgICAgdmFyIGFzc2lnbmVkVXNlcm5hbWUgPSBjb2x1bW4uc2VhcmNoKCk7CiAgICAgICAgICAgIHZhciB0YWJDbGFzc05hbWUgPSAibXlDYXNlc0J1dHRvbiI7CiAgICAgICAgICAgIGlmKCh0eXBlb2YgZHVwbGljYXRlU2VhcmNoUGFnZUlkICE9PSAndW5kZWZpbmVkJykgJiYgKHBhZ2VUeXBlSWQgPT09IGR1cGxpY2F0ZVNlYXJjaFBhZ2VJZC50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAvL2lmIGR1cGxpY2F0ZSBzZWFyY2ggdGhlbiBzZWFyY2ggZm9yIGFsbCBjYXNlcyBhbmQgbWFyayBhc3NpZ25UbyBmaWVsZCByZWFkIG9ubHkKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIjYXNzaWduZWUtZmlsdGVyIikucHJvcCgncmVhZG9ubHknLCB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbHVtbi5zZWFyY2goJycpOwogICAgICAgICAgICAgICAgJChjb2x1bW4uaGVhZGVyKCkpLmZpbmQoJ2lucHV0Lmxpc3QtZmlsdGVyJykudmFsKCcnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NpZ25lZFVzZXJuYW1lID09PSB1bmRlZmluZWQgfHwgYXNzaWduZWRVc2VybmFtZSA9PT0gbG9naW5Vc2VyKSB7CiAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgiI2Fzc2lnbmVlLWZpbHRlciIpLnByb3AoeydyZWFkb25seSc6IHRydWUsICdkaXNhYmxlZCc6IHRydWV9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIjYXNzaWduZWUtZmlsdGVyIikucHJvcCh7J3JlYWRvbmx5JzogZmFsc2UsICdkaXNhYmxlZCc6IGZhbHNlfSk7CiAgICAgICAgICAgICAgICB0YWJDbGFzc05hbWUgPSAiYWxsQ2FzZXNCdXR0b24iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcubXlDYXNlc0J1dHRvbiwgLmFsbENhc2VzQnV0dG9uJykucmVtb3ZlQ2xhc3MoJ2J0bi1wb2ludGVkJyk7CiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIuIiArIHRhYkNsYXNzTmFtZSkuYWRkQ2xhc3MoJ2J0bi1wb2ludGVkJyk7CiAgICAgICAgfQogICAgfTsKCiAgICBpbml0TGlzdFBhZ2UoKTsKCn07CgokLmZuLkRhdGFUYWJsZS5leHQucGFnZXIuZnVsbF9udW1iZXJzX25vX2VsbGlwc2VzID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2VzKSB7CiAgICB2YXIgbnVtYmVycyA9IFtdOwogICAgJC5mbi5EYXRhVGFibGUuZXh0LnBhZ2VyLm51bWJlcnNfbGVuZ3RoID0gNTsKICAgIHZhciBidXR0b25zID0gJC5mbi5EYXRhVGFibGUuZXh0LnBhZ2VyLm51bWJlcnNfbGVuZ3RoOwogICAgdmFyIGhhbGYgPSBNYXRoLmZsb29yKGJ1dHRvbnMgLyAyKTsKICAgIHZhciBfcmFuZ2UgPSBmdW5jdGlvbiAobGVuLCBzdGFydCkgewogICAgICAgIHZhciBlbmQ7CiAgICAgICAgaWYgKHR5cGVvZiBzdGFydCA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgc3RhcnQgPSAwOwogICAgICAgICAgICBlbmQgPSBsZW47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgICAgICAgIHN0YXJ0ID0gbGVuOwogICAgICAgIH0KICAgICAgICB2YXIgb3V0ID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgICAgICAgb3V0LnB1c2goaSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvdXQ7CiAgICB9OwogICAgaWYgKHBhZ2VzIDw9IGJ1dHRvbnMpIHsKICAgICAgICBudW1iZXJzID0gX3JhbmdlKDAsIHBhZ2VzKTsKICAgIH0gZWxzZSBpZiAocGFnZSA8PSBoYWxmKSB7CiAgICAgICAgbnVtYmVycyA9IF9yYW5nZSgwLCBidXR0b25zKTsKICAgIH0gZWxzZSBpZiAocGFnZSA+PSBwYWdlcyAtIDEgLSBoYWxmKSB7CiAgICAgICAgbnVtYmVycyA9IF9yYW5nZShwYWdlcyAtIGJ1dHRvbnMsIHBhZ2VzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbnVtYmVycyA9IF9yYW5nZShwYWdlIC0gaGFsZiwgcGFnZSArIGhhbGYgKyAxKTsKICAgIH0KICAgIG51bWJlcnMuRFRfZWwgPSAnc3Bhbic7CiAgICByZXR1cm4gWydmaXJzdCcsICdwcmV2aW91cycsIG51bWJlcnMsICduZXh0JywgJ2xhc3QnXTsKfTsKCi8qCiAqIEZpbGU6ICAgICAgICBzcGVlY2hSZWNvZ1NlYXJjaC5qcwogKiBEZXNjcmlwdGlvbjogVGhpcyBmaWxlIGlzIHVzZWQgZm9yIHNwZWVjaCByZWNvZ25pdGlvbiBpbiBTZWFyY2ggQ2FzZXMgaW5wdXQgaW4gY2FzZSBsaXN0IHNjcmVlbgogKiBBdXRob3I6ICAgICAgR2F1dGFtIE1hbGhvdHJhLCBQYXJ2ZWVuIFNvbmkgUnhMb2dpeAogKiBEYXRlOiAgICAgICAgMzEtSnVseS0yMDE3CiAqIFVzYWdlOiAgICAgICBUbyByZWNvcmQgdXNlciBzcGVlY2ggYXMgdGV4dCBpbnB1dCBmb3Igc2VhcmNoIGNyaXRlcmlhIGluIGNhc2UgbGlzdCBzY3JlZW4KICogQ29weXJpZ2h0OiAgIFJ4TG9naXggQ29ycG9yYXRpb24KICogVmVyc2lvbjogICAgIGluaXRpYWwgcmVsZWFzZSAwLjEKICogcmVxdWlyZTogICAgIGpRdWVyeQogKgogKiBDaGFuZ2UgTWFuYWdlbWVudDoKICogTmFtZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiAgICAgQXV0aG9yICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uCiAqIHNwZWVjaFJlY29nU2VhcmNoLmpzICAgICAgICAgICAgIDAuMSAgICAgICAgIEdhdXRhbSBNYWxob3RyYSwgUGFydmVlbiBTb25pICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbml0aWFsIFZlcnNpb24KICoKICovCgooZnVuY3Rpb24oKXsKICAgIHZhciBmaW5hbF90cmFuc2NyaXB0ID0gJyc7CiAgICB2YXIgcmVjb2duaXppbmcgPSBmYWxzZTsKICAgIHZhciByZWNvZ25pdGlvbjsKICAgIHZhciBtaWNFbGVtZW50ID0gJCgnI21pYycpOwogICAgdHJ5IHsKICAgICAgICBpZighJ3dlYmtpdFNwZWVjaFJlY29nbml0aW9uJyBpbiB3aW5kb3cpewogICAgICAgICAgICByZWNvZ25pdGlvbj0gbmV3ICh3aW5kb3cuU3BlZWNoUmVjb2duaXRpb24gfHwgd2luZG93Lm1velNwZWVjaFJlY29nbml0aW9uIHx8IHdpbmRvdy5tc1NwZWVjaFJlY29nbml0aW9uKSgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmVjb2duaXRpb24gPSBuZXcgd2Via2l0U3BlZWNoUmVjb2duaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoZSkgewogICAgICAgIHJlY29nbml0aW9uID0ge307CiAgICB9CiAgICByZWNvZ25pdGlvbi5jb250aW51b3VzID0gdHJ1ZTsKICAgIHJlY29nbml0aW9uLmludGVyaW1SZXN1bHRzID0gdHJ1ZTsKICAgIHJlY29nbml0aW9uLm9uc3RhcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZWNvZ25pemluZyA9IHRydWU7CiAgICB9OwoKICAgIHJlY29nbml0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbihldmVudCkgewogICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmVycm9yKTsKICAgIH07CgogICAgcmVjb2duaXRpb24ub25lbmQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZWNvZ25pemluZyA9IGZhbHNlOwogICAgICAgICQoJy5zZWFyY2gtYnV0dG9uJykudHJpZ2dlcignY2xpY2snKTsKICAgIH07CgogICAgcmVjb2duaXRpb24ub25yZXN1bHQgPSBmdW5jdGlvbihldmVudCkgewogICAgICAgIHZhciBpbnRlcmltX3RyYW5zY3JpcHQgPSAnJzsKICAgICAgICBmb3IgKHZhciBpID0gZXZlbnQucmVzdWx0SW5kZXg7IGkgPCBldmVudC5yZXN1bHRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChldmVudC5yZXN1bHRzW2ldLmlzRmluYWwpIHsKICAgICAgICAgICAgICAgIGZpbmFsX3RyYW5zY3JpcHQgKz0gZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0OwogICAgICAgICAgICAgICAgLy9hZGQgdm9pY2UgdGV4dCB0byB0aGUgc2VhcmNoIGZpZWxkCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2ltcGxlU2VhcmNoRmllbGQiKS52YWx1ZSA9IGZpbmFsX3RyYW5zY3JpcHQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbnRlcmltX3RyYW5zY3JpcHQgKz0gZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsX3RyYW5zY3JpcHQgPSBjYXBpdGFsaXplKGZpbmFsX3RyYW5zY3JpcHQpOwogICAgICAgIGZpbmFsX3NwYW4uaW5uZXJIVE1MID0gbGluZWJyZWFrKGZpbmFsX3RyYW5zY3JpcHQpOwogICAgICAgIGludGVyaW1fc3Bhbi5pbm5lckhUTUwgPSBsaW5lYnJlYWsoaW50ZXJpbV90cmFuc2NyaXB0KTsKCiAgICB9OwoKICAgIHZhciB0d29fbGluZSA9IC9cblxuL2c7CiAgICB2YXIgb25lX2xpbmUgPSAvXG4vZzsKICAgIGZ1bmN0aW9uIGxpbmVicmVhayhzKSB7CiAgICAgICAgcmV0dXJuIHMucmVwbGFjZSh0d29fbGluZSwgJzxwPjwvcD4nKS5yZXBsYWNlKG9uZV9saW5lLCAnPGJyPicpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhcGl0YWxpemUocykgewogICAgICAgIHJldHVybiBzLnJlcGxhY2Uocy5zdWJzdHIoMCwxKSwgZnVuY3Rpb24obSkgeyByZXR1cm4gbS50b1VwcGVyQ2FzZSgpOyB9KTsKICAgIH0KCiAgICBtaWNFbGVtZW50LmNsaWNrKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGlmIChyZWNvZ25pemluZykgewogICAgICAgICAgICByZWNvZ25pdGlvbi5zdG9wKCk7CiAgICAgICAgICAgIG1pY0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZhLW1pY3JvcGhvbmUnKTsKICAgICAgICAgICAgbWljRWxlbWVudC5hZGRDbGFzcygnZmEtbWljcm9waG9uZS1zbGFzaCcpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIG1pY0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZhLW1pY3JvcGhvbmUtc2xhc2gnKTsKICAgICAgICBtaWNFbGVtZW50LmFkZENsYXNzKCdmYS1taWNyb3Bob25lJyk7CiAgICAgICAgZmluYWxfdHJhbnNjcmlwdCA9ICcnOwogICAgICAgIHJlY29nbml0aW9uLmxhbmcgPSAnZW4tVVMnOwogICAgICAgIHJlY29nbml0aW9uLmludGVyaW1SZXN1bHRzID0gZmFsc2U7CiAgICAgICAgcmVjb2duaXRpb24uc3RhcnQoKTsKICAgICAgICBmaW5hbF9zcGFuLmlubmVySFRNTCA9ICcnOwogICAgICAgIGludGVyaW1fc3Bhbi5pbm5lckhUTUwgPSAnJzsKICAgIH0pOwp9KSgpOwoKLy8gVGhpcyBpcyBhIG1hbmlmZXN0IGZpbGUgdGhhdCdsbCBiZSBjb21waWxlZCBpbnRvIGRhc2hib2FyZC1tYW5pZmVzdC5qcy4KLy8KLy8gQW55IEphdmFTY3JpcHQgZmlsZSB3aXRoaW4gdGhpcyBkaXJlY3RvcnkgY2FuIGJlIHJlZmVyZW5jZWQgaGVyZSB1c2luZyBhIHJlbGF0aXZlIHBhdGguCi8vCi8vIFlvdSdyZSBmcmVlIHRvIGFkZCBhcHBsaWNhdGlvbi13aWRlIEphdmFTY3JpcHQgdG8gdGhpcyBmaWxlLCBidXQgaXQncyBnZW5lcmFsbHkgYmV0dGVyCi8vIHRvIGNyZWF0ZSBzZXBhcmF0ZSBKYXZhU2NyaXB0IGZpbGVzIGFzIG5lZWRlZC4KLy8KLy89IHJlcXVpcmUgdmVuZG9yVWkvZ3JpZHN0YWNrL2dyaWRzdGFjay5taW4KLy89IHJlcXVpcmUgdmVuZG9yVWkvZ3JpZHN0YWNrL2dyaWRzdGFjay5qUXVlcnlVSS5taW4KLy89IHJlcXVpcmUgdmVuZG9yVWkvY291bnRlcnVwL2pxdWVyeS5jb3VudGVydXAubWluCi8vPSByZXF1aXJlIGFwcC9kYXNoYm9hcmQvZGFzaGJvYXJkCi8vPSByZXF1aXJlIGFwcC9saXN0L2xpc3QtbWFuaWZlc3QK</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="407173515" offset="0" length="4096" />
        <PacketInfo time="407173531" offset="4096" length="16384" />
        <PacketInfo time="407173531" offset="20480" length="16384" />
        <PacketInfo time="407173546" offset="36864" length="16384" />
        <PacketInfo time="407173546" offset="53248" length="16384" />
        <PacketInfo time="407173562" offset="69632" length="16384" />
        <PacketInfo time="407173562" offset="86016" length="13484" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>