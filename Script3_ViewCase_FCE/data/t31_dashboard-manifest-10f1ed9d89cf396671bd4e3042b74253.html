/**
 * gridstack.js 0.3.0-dev
 * http://troolee.github.io/gridstack.js/
 * (c) 2014-2016 Pavel Reznikov, Dylan Weiss
 * gridstack.js may be freely distributed under the MIT license.
 * @preserve
*/
!function(a){if("function"==typeof define&&define.amd)define(["jquery","lodash"],a);else if("undefined"!=typeof exports){try{jQuery=require("jquery")}catch(a){}try{_=require("lodash")}catch(a){}a(jQuery,_)}else a(jQuery,_)}(function(a,b){
// jscs:enable requireCamelCaseOrUpperCaseIdentifiers
/**
    * @class GridStackDragDropPlugin
    * Base class for drag'n'drop plugin.
    */
function c(a){this.grid=a}var d=window,e=function(a,b,c){var d=function(){return console.warn("gridstack.js: Function `"+b+"` is deprecated as of v0.2.5 and has been replaced with `"+c+"`. It will be **completely** removed in v1.0."),a.apply(this,arguments)};return d.prototype=a.prototype,d},f=function(a,b){console.warn("gridstack.js: Option `"+a+"` is deprecated as of v0.2.5 and has been replaced with `"+b+"`. It will be **completely** removed in v1.0.")},g={isIntercepted:function(a,b){return!(a.x+a.width<=b.x||b.x+b.width<=a.x||a.y+a.height<=b.y||b.y+b.height<=a.y)},sort:function(a,c,d){return d=d||b.chain(a).map(function(a){return a.x+a.width}).max().value(),c=c!=-1?1:-1,b.sortBy(a,function(a){return c*(a.x+a.y*d)})},createStylesheet:function(a){var b=document.createElement("style");return b.setAttribute("type","text/css"),b.setAttribute("data-gs-style-id",a),b.styleSheet?b.styleSheet.cssText="":b.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(b),b.sheet},removeStylesheet:function(b){a("STYLE[data-gs-style-id="+b+"]").remove()},insertCSSRule:function(a,b,c,d){"function"==typeof a.insertRule?a.insertRule(b+"{"+c+"}",d):"function"==typeof a.addRule&&a.addRule(b,c,d)},toBool:function(a){return"boolean"==typeof a?a:"string"==typeof a?(a=a.toLowerCase(),!(""===a||"no"==a||"false"==a||"0"==a)):Boolean(a)},_collisionNodeCheck:function(a){return a!=this.node&&g.isIntercepted(a,this.nn)},_didCollide:function(a){return g.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},a)},_isAddNodeIntercepted:function(a){return g.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},a)},parseHeight:function(a){var c=a,d="px";if(c&&b.isString(c)){var e=c.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw)?$/);if(!e)throw new Error("Invalid height");d=e[2]||"px",c=parseFloat(e[1])}return{height:c,unit:d}}};
// jscs:disable requireCamelCaseOrUpperCaseIdentifiers
g.is_intercepted=e(g.isIntercepted,"is_intercepted","isIntercepted"),g.create_stylesheet=e(g.createStylesheet,"create_stylesheet","createStylesheet"),g.remove_stylesheet=e(g.removeStylesheet,"remove_stylesheet","removeStylesheet"),g.insert_css_rule=e(g.insertCSSRule,"insert_css_rule","insertCSSRule"),c.registeredPlugins=[],c.registerPlugin=function(a){c.registeredPlugins.push(a)},c.prototype.resizable=function(a,b){return this},c.prototype.draggable=function(a,b){return this},c.prototype.droppable=function(a,b){return this},c.prototype.isDroppable=function(a){return!1},c.prototype.on=function(a,b,c){return this};var h=0,i=function(a,b,c,d,e){this.width=a,this.float=c||!1,this.height=d||0,this.nodes=e||[],this.onchange=b||function(){},this._updateCounter=0,this._float=this.float,this._addedNodes=[],this._removedNodes=[]};i.prototype.batchUpdate=function(){this._updateCounter=1,this.float=!0},i.prototype.commit=function(){0!==this._updateCounter&&(this._updateCounter=0,this.float=this._float,this._packNodes(),this._notify())},
// For Meteor support: https://github.com/troolee/gridstack.js/pull/272
i.prototype.getNodeDataByDOMEl=function(a){return b.find(this.nodes,function(b){return a.get(0)===b.el.get(0)})},i.prototype._fixCollisions=function(a){this._sortNodes(-1);var c=a,d=Boolean(b.find(this.nodes,function(a){return a.locked}));for(this.float||d||(c={x:0,y:a.y,width:this.width,height:a.height});;){var e=b.find(this.nodes,b.bind(g._collisionNodeCheck,{node:a,nn:c}));if("undefined"==typeof e)return;this.moveNode(e,e.x,a.y+a.height,e.width,e.height,!0)}},i.prototype.isAreaEmpty=function(a,c,d,e){var f={x:a||0,y:c||0,width:d||1,height:e||1},h=b.find(this.nodes,b.bind(function(a){return g.isIntercepted(a,f)},this));return null===h||"undefined"==typeof h},i.prototype._sortNodes=function(a){this.nodes=g.sort(this.nodes,a,this.width)},i.prototype._packNodes=function(){this._sortNodes(),this.float?b.each(this.nodes,b.bind(function(a,c){if(!a._updating&&"undefined"!=typeof a._origY&&a.y!=a._origY)for(var d=a.y;d>=a._origY;){var e=b.chain(this.nodes).find(b.bind(g._didCollide,{n:a,newY:d})).value();e||(a._dirty=!0,a.y=d),--d}},this)):b.each(this.nodes,b.bind(function(a,c){if(!a.locked)for(;a.y>0;){var d=a.y-1,e=0===c;if(c>0){var f=b.chain(this.nodes).take(c).find(b.bind(g._didCollide,{n:a,newY:d})).value();e="undefined"==typeof f}if(!e)break;a._dirty=a.y!=d,a.y=d}},this))},i.prototype._prepareNode=function(a,c){return a=b.defaults(a||{},{width:1,height:1,x:0,y:0}),a.x=parseInt(""+a.x),a.y=parseInt(""+a.y),a.width=parseInt(""+a.width),a.height=parseInt(""+a.height),a.autoPosition=a.autoPosition||!1,a.noResize=a.noResize||!1,a.noMove=a.noMove||!1,a.width>this.width?a.width=this.width:a.width<1&&(a.width=1),a.height<1&&(a.height=1),a.x<0&&(a.x=0),a.x+a.width>this.width&&(c?a.width=this.width-a.x:a.x=this.width-a.width),a.y<0&&(a.y=0),a},i.prototype._notify=function(){var a=Array.prototype.slice.call(arguments,0);if(a[0]="undefined"==typeof a[0]?[]:[a[0]],a[1]="undefined"==typeof a[1]||a[1],!this._updateCounter){var b=a[0].concat(this.getDirtyNodes());this.onchange(b,a[1])}},i.prototype.cleanNodes=function(){this._updateCounter||b.each(this.nodes,function(a){a._dirty=!1})},i.prototype.getDirtyNodes=function(){return b.filter(this.nodes,function(a){return a._dirty})},i.prototype.addNode=function(a,c){if(a=this._prepareNode(a),"undefined"!=typeof a.maxWidth&&(a.width=Math.min(a.width,a.maxWidth)),"undefined"!=typeof a.maxHeight&&(a.height=Math.min(a.height,a.maxHeight)),"undefined"!=typeof a.minWidth&&(a.width=Math.max(a.width,a.minWidth)),"undefined"!=typeof a.minHeight&&(a.height=Math.max(a.height,a.minHeight)),a._id=++h,a._dirty=!0,a.autoPosition){this._sortNodes();for(var d=0;;++d){var e=d%this.width,f=Math.floor(d/this.width);if(!(e+a.width>this.width||b.find(this.nodes,b.bind(g._isAddNodeIntercepted,{x:e,y:f,node:a})))){a.x=e,a.y=f;break}}}return this.nodes.push(a),"undefined"!=typeof c&&c&&this._addedNodes.push(b.clone(a)),this._fixCollisions(a),this._packNodes(),this._notify(),a},i.prototype.removeNode=function(a,c){c="undefined"==typeof c||c,this._removedNodes.push(b.clone(a)),a._id=null,this.nodes=b.without(this.nodes,a),this._packNodes(),this._notify(a,c)},i.prototype.canMoveNode=function(c,d,e,f,g){if(!this.isNodeChangedPosition(c,d,e,f,g))return!1;var h=Boolean(b.find(this.nodes,function(a){return a.locked}));if(!this.height&&!h)return!0;var j,k=new i(this.width,null,this.float,0,b.map(this.nodes,function(b){return b==c?j=a.extend({},b):a.extend({},b)}));if("undefined"==typeof j)return!0;k.moveNode(j,d,e,f,g);var l=!0;return h&&(l&=!Boolean(b.find(k.nodes,function(a){return a!=j&&Boolean(a.locked)&&Boolean(a._dirty)}))),this.height&&(l&=k.getGridHeight()<=this.height),l},i.prototype.canBePlacedWithRespectToHeight=function(c){if(!this.height)return!0;var d=new i(this.width,null,this.float,0,b.map(this.nodes,function(b){return a.extend({},b)}));return d.addNode(c),d.getGridHeight()<=this.height},i.prototype.isNodeChangedPosition=function(a,b,c,d,e){return"number"!=typeof b&&(b=a.x),"number"!=typeof c&&(c=a.y),"number"!=typeof d&&(d=a.width),"number"!=typeof e&&(e=a.height),"undefined"!=typeof a.maxWidth&&(d=Math.min(d,a.maxWidth)),"undefined"!=typeof a.maxHeight&&(e=Math.min(e,a.maxHeight)),"undefined"!=typeof a.minWidth&&(d=Math.max(d,a.minWidth)),"undefined"!=typeof a.minHeight&&(e=Math.max(e,a.minHeight)),a.x!=b||a.y!=c||a.width!=d||a.height!=e},i.prototype.moveNode=function(a,b,c,d,e,f){if(!this.isNodeChangedPosition(a,b,c,d,e))return a;if("number"!=typeof b&&(b=a.x),"number"!=typeof c&&(c=a.y),"number"!=typeof d&&(d=a.width),"number"!=typeof e&&(e=a.height),"undefined"!=typeof a.maxWidth&&(d=Math.min(d,a.maxWidth)),"undefined"!=typeof a.maxHeight&&(e=Math.min(e,a.maxHeight)),"undefined"!=typeof a.minWidth&&(d=Math.max(d,a.minWidth)),"undefined"!=typeof a.minHeight&&(e=Math.max(e,a.minHeight)),a.x==b&&a.y==c&&a.width==d&&a.height==e)return a;var g=a.width!=d;return a._dirty=!0,a.x=b,a.y=c,a.width=d,a.height=e,a.lastTriedX=b,a.lastTriedY=c,a.lastTriedWidth=d,a.lastTriedHeight=e,a=this._prepareNode(a,g),this._fixCollisions(a),f||(this._packNodes(),this._notify()),a},i.prototype.getGridHeight=function(){return b.reduce(this.nodes,function(a,b){return Math.max(a,b.y+b.height)},0)},i.prototype.beginUpdate=function(a){b.each(this.nodes,function(a){a._origY=a.y}),a._updating=!0},i.prototype.endUpdate=function(){b.each(this.nodes,function(a){a._origY=a.y});var a=b.find(this.nodes,function(a){return a._updating});a&&(a._updating=!1)};var j=function(d,e){var g,h,j=this;e=e||{},this.container=a(d),
// jscs:disable requireCamelCaseOrUpperCaseIdentifiers
"undefined"!=typeof e.handle_class&&(e.handleClass=e.handle_class,f("handle_class","handleClass")),"undefined"!=typeof e.item_class&&(e.itemClass=e.item_class,f("item_class","itemClass")),"undefined"!=typeof e.placeholder_class&&(e.placeholderClass=e.placeholder_class,f("placeholder_class","placeholderClass")),"undefined"!=typeof e.placeholder_text&&(e.placeholderText=e.placeholder_text,f("placeholder_text","placeholderText")),"undefined"!=typeof e.cell_height&&(e.cellHeight=e.cell_height,f("cell_height","cellHeight")),"undefined"!=typeof e.vertical_margin&&(e.verticalMargin=e.vertical_margin,f("vertical_margin","verticalMargin")),"undefined"!=typeof e.min_width&&(e.minWidth=e.min_width,f("min_width","minWidth")),"undefined"!=typeof e.static_grid&&(e.staticGrid=e.static_grid,f("static_grid","staticGrid")),"undefined"!=typeof e.is_nested&&(e.isNested=e.is_nested,f("is_nested","isNested")),"undefined"!=typeof e.always_show_resize_handle&&(e.alwaysShowResizeHandle=e.always_show_resize_handle,f("always_show_resize_handle","alwaysShowResizeHandle")),
// jscs:enable requireCamelCaseOrUpperCaseIdentifiers
e.itemClass=e.itemClass||"grid-stack-item";var k=this.container.closest("."+e.itemClass).length>0;if(this.opts=b.defaults(e||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:60,verticalMargin:20,auto:!0,minWidth:768,float:!1,staticGrid:!1,_class:"grid-stack-instance-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,alwaysShowResizeHandle:e.alwaysShowResizeHandle||!1,resizable:b.defaults(e.resizable||{},{autoHide:!e.alwaysShowResizeHandle,handles:"se"}),draggable:b.defaults(e.draggable||{},{handle:(e.handleClass?"."+e.handleClass:e.handle?e.handle:"")||".grid-stack-item-content",scroll:!1,appendTo:"body"}),disableDrag:e.disableDrag||!1,disableResize:e.disableResize||!1,rtl:"auto",removable:!1,removeTimeout:2e3,verticalMarginUnit:"px",cellHeightUnit:"px",oneColumnModeClass:e.oneColumnModeClass||"grid-stack-one-column-mode",ddPlugin:null}),this.opts.ddPlugin===!1?this.opts.ddPlugin=c:null===this.opts.ddPlugin&&(this.opts.ddPlugin=b.first(c.registeredPlugins)||c),this.dd=new this.opts.ddPlugin(this),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===this.container.css("direction")),this.opts.rtl&&this.container.addClass("grid-stack-rtl"),this.opts.isNested=k,h="auto"===this.opts.cellHeight,h?j.cellHeight(j.cellWidth(),!0):this.cellHeight(this.opts.cellHeight,!0),this.verticalMargin(this.opts.verticalMargin,!0),this.container.addClass(this.opts._class),this._setStaticClass(),k&&this.container.addClass("grid-stack-nested"),this._initStyles(),this.grid=new i(this.opts.width,function(a,c){c="undefined"==typeof c||c;var d=0;b.each(a,function(a){c&&null===a._id?a.el&&a.el.remove():(a.el.attr("data-gs-x",a.x).attr("data-gs-y",a.y).attr("data-gs-width",a.width).attr("data-gs-height",a.height),d=Math.max(d,a.y+a.height))}),j._updateStyles(d+10)},this.opts.float,this.opts.height),this.opts.auto){var l=[],m=this;this.container.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each(function(b,c){c=a(c),l.push({el:c,i:parseInt(c.attr("data-gs-x"))+parseInt(c.attr("data-gs-y"))*m.opts.width})}),b.chain(l).sortBy(function(a){return a.i}).each(function(a){j._prepareElement(a.el)}).value()}if(this.setAnimation(this.opts.animate),this.placeholder=a('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'"><div class="placeholder-content">'+this.opts.placeholderText+"</div></div>").hide(),this._updateContainerHeight(),this._updateHeightsOnResize=b.throttle(function(){j.cellHeight(j.cellWidth(),!1)},100),this.onResizeHandler=function(){if(h&&j._updateHeightsOnResize(),j._isOneColumnMode()){if(g)return;j.container.addClass(j.opts.oneColumnModeClass),g=!0,j.grid._sortNodes(),b.each(j.grid.nodes,function(a){j.container.append(a.el),j.opts.staticGrid||((a.noMove||j.opts.disableDrag)&&j.dd.draggable(a.el,"disable"),(a.noResize||j.opts.disableResize)&&j.dd.resizable(a.el,"disable"),a.el.trigger("resize"))})}else{if(!g)return;if(j.container.removeClass(j.opts.oneColumnModeClass),g=!1,j.opts.staticGrid)return;b.each(j.grid.nodes,function(a){a.noMove||j.opts.disableDrag||j.dd.draggable(a.el,"enable"),a.noResize||j.opts.disableResize||j.dd.resizable(a.el,"enable"),a.el.trigger("resize")})}},a(window).resize(this.onResizeHandler),this.onResizeHandler(),!j.opts.staticGrid&&"string"==typeof j.opts.removable){var n=a(j.opts.removable);this.dd.isDroppable(n)||this.dd.droppable(n,{accept:"."+j.opts.itemClass}),this.dd.on(n,"dropover",function(b,c){var d=a(c.draggable),e=d.data("_gridstack_node");e._grid===j&&j._setupRemovingTimeout(d)}).on(n,"dropout",function(b,c){var d=a(c.draggable),e=d.data("_gridstack_node");e._grid===j&&j._clearRemovingTimeout(d)})}if(!j.opts.staticGrid&&j.opts.acceptWidgets){var o=null,p=function(a,b){var c=o,d=c.data("_gridstack_node"),e=j.getCellFromPixel(b.offset,!0),f=Math.max(0,e.x),g=Math.max(0,e.y);if(d._added){if(!j.grid.canMoveNode(d,f,g))return;j.grid.moveNode(d,f,g),j._updateContainerHeight()}else d._added=!0,d.el=c,d.x=f,d.y=g,j.grid.cleanNodes(),j.grid.beginUpdate(d),j.grid.addNode(d),j.container.append(j.placeholder),j.placeholder.attr("data-gs-x",d.x).attr("data-gs-y",d.y).attr("data-gs-width",d.width).attr("data-gs-height",d.height).show(),d.el=j.placeholder,d._beforeDragX=d.x,d._beforeDragY=d.y,j._updateContainerHeight()};this.dd.droppable(j.container,{accept:function(b){b=a(b);var c=b.data("_gridstack_node");return(!c||c._grid!==j)&&b.is(j.opts.acceptWidgets===!0?".grid-stack-item":j.opts.acceptWidgets)}}).on(j.container,"dropover",function(b,c){var d=(j.container.offset(),a(c.draggable)),e=j.cellWidth(),f=j.cellHeight(),g=d.data("_gridstack_node"),h=g?g.width:Math.ceil(d.outerWidth()/e),i=g?g.height:Math.ceil(d.outerHeight()/f);o=d;var k=j.grid._prepareNode({width:h,height:i,_added:!1,_temporary:!0});d.data("_gridstack_node",k),d.data("_gridstack_node_orig",g),d.on("drag",p)}).on(j.container,"dropout",function(b,c){var d=a(c.draggable);d.unbind("drag",p);var e=d.data("_gridstack_node");e.el=null,j.grid.removeNode(e),j.placeholder.detach(),j._updateContainerHeight(),d.data("_gridstack_node",d.data("_gridstack_node_orig"))}).on(j.container,"drop",function(b,c){j.placeholder.detach();var d=a(c.draggable).data("_gridstack_node");d._grid=j;var e=a(c.draggable).clone(!1);e.data("_gridstack_node",d),a(c.draggable).remove(),d.el=e,j.placeholder.hide(),e.attr("data-gs-x",d.x).attr("data-gs-y",d.y).attr("data-gs-width",d.width).attr("data-gs-height",d.height).addClass(j.opts.itemClass).removeAttr("style").enableSelection().removeData("draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled").unbind("drag",p),j.container.append(e),j._prepareElementsByNode(e,d),j._updateContainerHeight(),j._triggerChangeEvent(),j.grid.endUpdate()})}};
// jscs:disable requireCamelCaseOrUpperCaseIdentifiers
// jscs:enable requireCamelCaseOrUpperCaseIdentifiers
return j.prototype._triggerChangeEvent=function(a){var b=this.grid.getDirtyNodes(),c=!1,d=[];b&&b.length&&(d.push(b),c=!0),(c||a===!0)&&this.container.trigger("change",d)},j.prototype._triggerAddEvent=function(){this.grid._addedNodes&&this.grid._addedNodes.length>0&&(this.container.trigger("added",[b.map(this.grid._addedNodes,b.clone)]),this.grid._addedNodes=[])},j.prototype._triggerRemoveEvent=function(){this.grid._removedNodes&&this.grid._removedNodes.length>0&&(this.container.trigger("removed",[b.map(this.grid._removedNodes,b.clone)]),this.grid._removedNodes=[])},j.prototype._initStyles=function(){this._stylesId&&g.removeStylesheet(this._stylesId),this._stylesId="gridstack-style-"+(1e5*Math.random()).toFixed(),this._styles=g.createStylesheet(this._stylesId),null!==this._styles&&(this._styles._max=0)},j.prototype._updateStyles=function(a){if(null!==this._styles&&"undefined"!=typeof this._styles){var b,c="."+this.opts._class+" ."+this.opts.itemClass,d=this;if("undefined"==typeof a&&(a=this._styles._max,this._initStyles(),this._updateContainerHeight()),this.opts.cellHeight&&!(0!==this._styles._max&&a<=this._styles._max)&&(b=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(a,b){return a&&b?"calc("+(d.opts.cellHeight*a+d.opts.cellHeightUnit)+" + "+(d.opts.verticalMargin*b+d.opts.verticalMarginUnit)+")":d.opts.cellHeight*a+d.opts.verticalMargin*b+d.opts.cellHeightUnit}:function(a,b){return d.opts.cellHeight*a+d.opts.verticalMargin*b+d.opts.cellHeightUnit},0===this._styles._max&&g.insertCSSRule(this._styles,c,"min-height: "+b(1,0)+";",0),a>this._styles._max)){for(var e=this._styles._max;e<a;++e)g.insertCSSRule(this._styles,c+'[data-gs-height="'+(e+1)+'"]',"height: "+b(e+1,e)+";",e),g.insertCSSRule(this._styles,c+'[data-gs-min-height="'+(e+1)+'"]',"min-height: "+b(e+1,e)+";",e),g.insertCSSRule(this._styles,c+'[data-gs-max-height="'+(e+1)+'"]',"max-height: "+b(e+1,e)+";",e),g.insertCSSRule(this._styles,c+'[data-gs-y="'+e+'"]',"top: "+b(e,e)+";",e);this._styles._max=a}}},j.prototype._updateContainerHeight=function(){if(!this.grid._updateCounter){var a=this.grid.getGridHeight();this.container.attr("data-gs-current-height",a),this.opts.cellHeight&&(this.opts.verticalMargin?this.opts.cellHeightUnit===this.opts.verticalMarginUnit?this.container.css("height",a*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit):this.container.css("height","calc("+(a*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(a*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")"):this.container.css("height",a*this.opts.cellHeight+this.opts.cellHeightUnit))}},j.prototype._isOneColumnMode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.minWidth},j.prototype._setupRemovingTimeout=function(b){var c=this,d=a(b).data("_gridstack_node");!d._removeTimeout&&c.opts.removable&&(d._removeTimeout=setTimeout(function(){b.addClass("grid-stack-item-removing"),d._isAboutToRemove=!0},c.opts.removeTimeout))},j.prototype._clearRemovingTimeout=function(b){var c=a(b).data("_gridstack_node");c._removeTimeout&&(clearTimeout(c._removeTimeout),c._removeTimeout=null,b.removeClass("grid-stack-item-removing"),c._isAboutToRemove=!1)},j.prototype._prepareElementsByNode=function(b,c){if("undefined"!=typeof a.ui){var d,e,f=this,g=function(a,g){var h,i,j=Math.round(g.position.left/d),k=Math.floor((g.position.top+e/2)/e);if("drag"!=a.type&&(h=Math.round(g.size.width/d),i=Math.round(g.size.height/e)),"drag"==a.type)j<0||j>=f.grid.width||k<0?(f.opts.removable===!0&&f._setupRemovingTimeout(b),j=c._beforeDragX,k=c._beforeDragY,f.placeholder.detach(),f.placeholder.hide(),f.grid.removeNode(c),f._updateContainerHeight(),c._temporaryRemoved=!0):(f._clearRemovingTimeout(b),c._temporaryRemoved&&(f.grid.addNode(c),f.placeholder.attr("data-gs-x",j).attr("data-gs-y",k).attr("data-gs-width",h).attr("data-gs-height",i).show(),f.container.append(f.placeholder),c.el=f.placeholder,c._temporaryRemoved=!1));else if("resize"==a.type&&j<0)return;
// width and height are undefined if not resizing
var l="undefined"!=typeof h?h:c.lastTriedWidth,m="undefined"!=typeof i?i:c.lastTriedHeight;!f.grid.canMoveNode(c,j,k,h,i)||c.lastTriedX===j&&c.lastTriedY===k&&c.lastTriedWidth===l&&c.lastTriedHeight===m||(c.lastTriedX=j,c.lastTriedY=k,c.lastTriedWidth=h,c.lastTriedHeight=i,f.grid.moveNode(c,j,k,h,i),f._updateContainerHeight())},h=function(g,h){f.container.append(f.placeholder);var i=a(this);f.grid.cleanNodes(),f.grid.beginUpdate(c),d=f.cellWidth();var j=Math.ceil(i.outerHeight()/i.attr("data-gs-height"));e=f.container.height()/parseInt(f.container.attr("data-gs-current-height")),f.placeholder.attr("data-gs-x",i.attr("data-gs-x")).attr("data-gs-y",i.attr("data-gs-y")).attr("data-gs-width",i.attr("data-gs-width")).attr("data-gs-height",i.attr("data-gs-height")).show(),c.el=f.placeholder,c._beforeDragX=c.x,c._beforeDragY=c.y,f.dd.resizable(b,"option","minWidth",d*(c.minWidth||1)),f.dd.resizable(b,"option","minHeight",j*(c.minHeight||1)),"resizestart"==g.type&&i.find(".grid-stack-item").trigger("resizestart")},i=function(d,e){var g=a(this);if(g.data("_gridstack_node")){var h=!1;f.placeholder.detach(),c.el=g,f.placeholder.hide(),c._isAboutToRemove?(h=!0,b.removeData("_gridstack_node"),b.remove()):(f._clearRemovingTimeout(b),c._temporaryRemoved?(g.attr("data-gs-x",c._beforeDragX).attr("data-gs-y",c._beforeDragY).attr("data-gs-width",c.width).attr("data-gs-height",c.height).removeAttr("style"),c.x=c._beforeDragX,c.y=c._beforeDragY,f.grid.addNode(c)):g.attr("data-gs-x",c.x).attr("data-gs-y",c.y).attr("data-gs-width",c.width).attr("data-gs-height",c.height).removeAttr("style")),f._updateContainerHeight(),f._triggerChangeEvent(h),f.grid.endUpdate();var i=g.find(".grid-stack");i.length&&"resizestop"==d.type&&(i.each(function(b,c){a(c).data("gridstack").onResizeHandler()}),g.find(".grid-stack-item").trigger("resizestop"))}};this.dd.draggable(b,{start:h,stop:i,drag:g}).resizable(b,{start:h,stop:i,resize:g}),(c.noMove||this._isOneColumnMode()||this.opts.disableDrag)&&this.dd.draggable(b,"disable"),(c.noResize||this._isOneColumnMode()||this.opts.disableResize)&&this.dd.resizable(b,"disable"),b.attr("data-gs-locked",c.locked?"yes":null)}},j.prototype._prepareElement=function(b,c){c="undefined"!=typeof c&&c;var d=this;b=a(b),b.addClass(this.opts.itemClass);var e=d.grid.addNode({x:b.attr("data-gs-x"),y:b.attr("data-gs-y"),width:b.attr("data-gs-width"),height:b.attr("data-gs-height"),maxWidth:b.attr("data-gs-max-width"),minWidth:b.attr("data-gs-min-width"),maxHeight:b.attr("data-gs-max-height"),minHeight:b.attr("data-gs-min-height"),autoPosition:g.toBool(b.attr("data-gs-auto-position")),noResize:g.toBool(b.attr("data-gs-no-resize")),noMove:g.toBool(b.attr("data-gs-no-move")),locked:g.toBool(b.attr("data-gs-locked")),el:b,id:b.attr("data-gs-id"),_grid:d},c);b.data("_gridstack_node",e),this._prepareElementsByNode(b,e)},j.prototype.setAnimation=function(a){a?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},j.prototype.addWidget=function(b,c,d,e,f,g,h,i,j,k,l){return b=a(b),"undefined"!=typeof c&&b.attr("data-gs-x",c),"undefined"!=typeof d&&b.attr("data-gs-y",d),"undefined"!=typeof e&&b.attr("data-gs-width",e),"undefined"!=typeof f&&b.attr("data-gs-height",f),"undefined"!=typeof g&&b.attr("data-gs-auto-position",g?"yes":null),"undefined"!=typeof h&&b.attr("data-gs-min-width",h),"undefined"!=typeof i&&b.attr("data-gs-max-width",i),"undefined"!=typeof j&&b.attr("data-gs-min-height",j),"undefined"!=typeof k&&b.attr("data-gs-max-height",k),"undefined"!=typeof l&&b.attr("data-gs-id",l),this.container.append(b),this._prepareElement(b,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),b},j.prototype.makeWidget=function(b){return b=a(b),this._prepareElement(b,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),b},j.prototype.willItFit=function(a,b,c,d,e){var f={x:a,y:b,width:c,height:d,autoPosition:e};return this.grid.canBePlacedWithRespectToHeight(f)},j.prototype.removeWidget=function(b,c){c="undefined"==typeof c||c,b=a(b);var d=b.data("_gridstack_node");
// For Meteor support: https://github.com/troolee/gridstack.js/pull/272
d||(d=this.grid.getNodeDataByDOMEl(b)),this.grid.removeNode(d,c),b.removeData("_gridstack_node"),this._updateContainerHeight(),c&&b.remove(),this._triggerChangeEvent(!0),this._triggerRemoveEvent()},j.prototype.removeAll=function(a){b.each(this.grid.nodes,b.bind(function(b){this.removeWidget(b.el,a)},this)),this.grid.nodes=[],this._updateContainerHeight()},j.prototype.destroy=function(b){a(window).off("resize",this.onResizeHandler),this.disable(),"undefined"==typeof b||b?this.container.remove():(this.removeAll(!1),this.container.removeData("gridstack")),g.removeStylesheet(this._stylesId),this.grid&&(this.grid=null)},j.prototype.resizable=function(b,c){var d=this;return b=a(b),b.each(function(b,e){e=a(e);var f=e.data("_gridstack_node");"undefined"!=typeof f&&null!==f&&"undefined"!=typeof a.ui&&(f.noResize=!c,f.noResize||d._isOneColumnMode()?d.dd.resizable(e,"disable"):d.dd.resizable(e,"enable"))}),this},j.prototype.movable=function(b,c){var d=this;return b=a(b),b.each(function(b,e){e=a(e);var f=e.data("_gridstack_node");"undefined"!=typeof f&&null!==f&&"undefined"!=typeof a.ui&&(f.noMove=!c,f.noMove||d._isOneColumnMode()?(d.dd.draggable(e,"disable"),e.removeClass("ui-draggable-handle")):(d.dd.draggable(e,"enable"),e.addClass("ui-draggable-handle")))}),this},j.prototype.enableMove=function(a,b){this.movable(this.container.children("."+this.opts.itemClass),a),b&&(this.opts.disableDrag=!a)},j.prototype.enableResize=function(a,b){this.resizable(this.container.children("."+this.opts.itemClass),a),b&&(this.opts.disableResize=!a)},j.prototype.disable=function(){this.movable(this.container.children("."+this.opts.itemClass),!1),this.resizable(this.container.children("."+this.opts.itemClass),!1),this.container.trigger("disable")},j.prototype.enable=function(){this.movable(this.container.children("."+this.opts.itemClass),!0),this.resizable(this.container.children("."+this.opts.itemClass),!0),this.container.trigger("enable")},j.prototype.locked=function(b,c){return b=a(b),b.each(function(b,d){d=a(d);var e=d.data("_gridstack_node");"undefined"!=typeof e&&null!==e&&(e.locked=c||!1,d.attr("data-gs-locked",e.locked?"yes":null))}),this},j.prototype.maxHeight=function(b,c){return b=a(b),b.each(function(b,d){d=a(d);var e=d.data("_gridstack_node");"undefined"!=typeof e&&null!==e&&(isNaN(c)||(e.maxHeight=c||!1,d.attr("data-gs-max-height",c)))}),this},j.prototype.minHeight=function(b,c){return b=a(b),b.each(function(b,d){d=a(d);var e=d.data("_gridstack_node");"undefined"!=typeof e&&null!==e&&(isNaN(c)||(e.minHeight=c||!1,d.attr("data-gs-min-height",c)))}),this},j.prototype.maxWidth=function(b,c){return b=a(b),b.each(function(b,d){d=a(d);var e=d.data("_gridstack_node");"undefined"!=typeof e&&null!==e&&(isNaN(c)||(e.maxWidth=c||!1,d.attr("data-gs-max-width",c)))}),this},j.prototype.minWidth=function(b,c){return b=a(b),b.each(function(b,d){d=a(d);var e=d.data("_gridstack_node");"undefined"!=typeof e&&null!==e&&(isNaN(c)||(e.minWidth=c||!1,d.attr("data-gs-min-width",c)))}),this},j.prototype._updateElement=function(b,c){b=a(b).first();var d=b.data("_gridstack_node");if("undefined"!=typeof d&&null!==d){var e=this;e.grid.cleanNodes(),e.grid.beginUpdate(d),c.call(this,b,d),e._updateContainerHeight(),e._triggerChangeEvent(),e.grid.endUpdate()}},j.prototype.resize=function(a,b,c){this._updateElement(a,function(a,d){b=null!==b&&"undefined"!=typeof b?b:d.width,c=null!==c&&"undefined"!=typeof c?c:d.height,this.grid.moveNode(d,d.x,d.y,b,c)})},j.prototype.move=function(a,b,c){this._updateElement(a,function(a,d){b=null!==b&&"undefined"!=typeof b?b:d.x,c=null!==c&&"undefined"!=typeof c?c:d.y,this.grid.moveNode(d,b,c,d.width,d.height)})},j.prototype.update=function(a,b,c,d,e){this._updateElement(a,function(a,f){b=null!==b&&"undefined"!=typeof b?b:f.x,c=null!==c&&"undefined"!=typeof c?c:f.y,d=null!==d&&"undefined"!=typeof d?d:f.width,e=null!==e&&"undefined"!=typeof e?e:f.height,this.grid.moveNode(f,b,c,d,e)})},j.prototype.verticalMargin=function(a,b){if("undefined"==typeof a)return this.opts.verticalMargin;var c=g.parseHeight(a);this.opts.verticalMarginUnit===c.unit&&this.opts.height===c.height||(this.opts.verticalMarginUnit=c.unit,this.opts.verticalMargin=c.height,b||this._updateStyles())},j.prototype.cellHeight=function(a,b){if("undefined"==typeof a){if(this.opts.cellHeight)return this.opts.cellHeight;var c=this.container.children("."+this.opts.itemClass).first();return Math.ceil(c.outerHeight()/c.attr("data-gs-height"))}var d=g.parseHeight(a);this.opts.cellHeightUnit===d.heightUnit&&this.opts.height===d.height||(this.opts.cellHeightUnit=d.unit,this.opts.cellHeight=d.height,b||this._updateStyles())},j.prototype.cellWidth=function(){return Math.round(this.container.outerWidth()/this.opts.width)},j.prototype.getCellFromPixel=function(a,b){var c="undefined"!=typeof b&&b?this.container.offset():this.container.position(),d=a.left-c.left,e=a.top-c.top,f=Math.floor(this.container.width()/this.opts.width),g=Math.floor(this.container.height()/parseInt(this.container.attr("data-gs-current-height")));return{x:Math.floor(d/f),y:Math.floor(e/g)}},j.prototype.batchUpdate=function(){this.grid.batchUpdate()},j.prototype.commit=function(){this.grid.commit(),this._updateContainerHeight()},j.prototype.isAreaEmpty=function(a,b,c,d){return this.grid.isAreaEmpty(a,b,c,d)},j.prototype.setStatic=function(a){this.opts.staticGrid=a===!0,this.enableMove(!a),this.enableResize(!a),this._setStaticClass()},j.prototype._setStaticClass=function(){var a="grid-stack-static";this.opts.staticGrid===!0?this.container.addClass(a):this.container.removeClass(a)},j.prototype._updateNodeWidths=function(a,b){this.grid._sortNodes(),this.grid.batchUpdate();for(var c={},d=0;d<this.grid.nodes.length;d++)c=this.grid.nodes[d],this.update(c.el,Math.round(c.x*b/a),void 0,Math.round(c.width*b/a),void 0);this.grid.commit()},j.prototype.setGridWidth=function(a,b){this.container.removeClass("grid-stack-"+this.opts.width),b!==!0&&this._updateNodeWidths(this.opts.width,a),this.opts.width=a,this.grid.width=a,this.container.addClass("grid-stack-"+a)},i.prototype.batch_update=e(i.prototype.batchUpdate),i.prototype._fix_collisions=e(i.prototype._fixCollisions,"_fix_collisions","_fixCollisions"),i.prototype.is_area_empty=e(i.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),i.prototype._sort_nodes=e(i.prototype._sortNodes,"_sort_nodes","_sortNodes"),i.prototype._pack_nodes=e(i.prototype._packNodes,"_pack_nodes","_packNodes"),i.prototype._prepare_node=e(i.prototype._prepareNode,"_prepare_node","_prepareNode"),i.prototype.clean_nodes=e(i.prototype.cleanNodes,"clean_nodes","cleanNodes"),i.prototype.get_dirty_nodes=e(i.prototype.getDirtyNodes,"get_dirty_nodes","getDirtyNodes"),i.prototype.add_node=e(i.prototype.addNode,"add_node","addNode, "),i.prototype.remove_node=e(i.prototype.removeNode,"remove_node","removeNode"),i.prototype.can_move_node=e(i.prototype.canMoveNode,"can_move_node","canMoveNode"),i.prototype.move_node=e(i.prototype.moveNode,"move_node","moveNode"),i.prototype.get_grid_height=e(i.prototype.getGridHeight,"get_grid_height","getGridHeight"),i.prototype.begin_update=e(i.prototype.beginUpdate,"begin_update","beginUpdate"),i.prototype.end_update=e(i.prototype.endUpdate,"end_update","endUpdate"),i.prototype.can_be_placed_with_respect_to_height=e(i.prototype.canBePlacedWithRespectToHeight,"can_be_placed_with_respect_to_height","canBePlacedWithRespectToHeight"),j.prototype._trigger_change_event=e(j.prototype._triggerChangeEvent,"_trigger_change_event","_triggerChangeEvent"),j.prototype._init_styles=e(j.prototype._initStyles,"_init_styles","_initStyles"),j.prototype._update_styles=e(j.prototype._updateStyles,"_update_styles","_updateStyles"),j.prototype._update_container_height=e(j.prototype._updateContainerHeight,"_update_container_height","_updateContainerHeight"),j.prototype._is_one_column_mode=e(j.prototype._isOneColumnMode,"_is_one_column_mode","_isOneColumnMode"),j.prototype._prepare_element=e(j.prototype._prepareElement,"_prepare_element","_prepareElement"),j.prototype.set_animation=e(j.prototype.setAnimation,"set_animation","setAnimation"),j.prototype.add_widget=e(j.prototype.addWidget,"add_widget","addWidget"),j.prototype.make_widget=e(j.prototype.makeWidget,"make_widget","makeWidget"),j.prototype.will_it_fit=e(j.prototype.willItFit,"will_it_fit","willItFit"),j.prototype.remove_widget=e(j.prototype.removeWidget,"remove_widget","removeWidget"),j.prototype.remove_all=e(j.prototype.removeAll,"remove_all","removeAll"),j.prototype.min_height=e(j.prototype.minHeight,"min_height","minHeight"),j.prototype.min_width=e(j.prototype.minWidth,"min_width","minWidth"),j.prototype._update_element=e(j.prototype._updateElement,"_update_element","_updateElement"),j.prototype.cell_height=e(j.prototype.cellHeight,"cell_height","cellHeight"),j.prototype.cell_width=e(j.prototype.cellWidth,"cell_width","cellWidth"),j.prototype.get_cell_from_pixel=e(j.prototype.getCellFromPixel,"get_cell_from_pixel","getCellFromPixel"),j.prototype.batch_update=e(j.prototype.batchUpdate,"batch_update","batchUpdate"),j.prototype.is_area_empty=e(j.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),j.prototype.set_static=e(j.prototype.setStatic,"set_static","setStatic"),j.prototype._set_static_class=e(j.prototype._setStaticClass,"_set_static_class","_setStaticClass"),d.GridStackUI=j,d.GridStackUI.Utils=g,d.GridStackUI.Engine=i,d.GridStackUI.GridStackDragDropPlugin=c,a.fn.gridstack=function(b){return this.each(function(){var c=a(this);c.data("gridstack")||c.data("gridstack",new j(this,b))})},d.GridStackUI});
//# sourceMappingURL=gridstack.min.map
/**
 * gridstack.js 0.3.0-dev
 * http://troolee.github.io/gridstack.js/
 * (c) 2014-2016 Pavel Reznikov, Dylan Weiss
 * gridstack.js may be freely distributed under the MIT license.
 * @preserve
*/
!function(a){if("function"==typeof define&&define.amd)define(["jquery","lodash","gridstack","jquery-ui/data","jquery-ui/disable-selection","jquery-ui/focusable","jquery-ui/form","jquery-ui/ie","jquery-ui/keycode","jquery-ui/labels","jquery-ui/jquery-1-7","jquery-ui/plugin","jquery-ui/safe-active-element","jquery-ui/safe-blur","jquery-ui/scroll-parent","jquery-ui/tabbable","jquery-ui/unique-id","jquery-ui/version","jquery-ui/widget","jquery-ui/widgets/mouse","jquery-ui/widgets/draggable","jquery-ui/widgets/droppable","jquery-ui/widgets/resizable"],a);else if("undefined"!=typeof exports){try{jQuery=require("jquery")}catch(a){}try{_=require("lodash")}catch(a){}try{GridStackUI=require("gridstack")}catch(a){}a(jQuery,_,GridStackUI)}else a(jQuery,_,GridStackUI)}(function(a,b,c){/**
    * @class JQueryUIGridStackDragDropPlugin
    * jQuery UI implementation of drag'n'drop gridstack plugin.
    */
function d(a){c.GridStackDragDropPlugin.call(this,a)}window;return c.GridStackDragDropPlugin.registerPlugin(d),d.prototype=Object.create(c.GridStackDragDropPlugin.prototype),d.prototype.constructor=d,d.prototype.resizable=function(c,d){if(c=a(c),"disable"===d||"enable"===d)c.resizable(d);else if("option"===d){var e=arguments[2],f=arguments[3];c.resizable(d,e,f)}else c.resizable(b.extend({},this.grid.opts.resizable,{start:d.start||function(){},stop:d.stop||function(){},resize:d.resize||function(){}}));return this},d.prototype.draggable=function(c,d){return c=a(c),"disable"===d||"enable"===d?c.draggable(d):c.draggable(b.extend({},this.grid.opts.draggable,{containment:this.grid.opts.isNested?this.grid.container.parent():null,start:d.start||function(){},stop:d.stop||function(){},drag:d.drag||function(){}})),this},d.prototype.droppable=function(b,c){return b=a(b),"disable"===c||"enable"===c?b.droppable(c):b.droppable({accept:c.accept}),this},d.prototype.isDroppable=function(b,c){return b=a(b),Boolean(b.data("droppable"))},d.prototype.on=function(b,c,d){return a(b).on(c,d),this},d});
//# sourceMappingURL=gridstack.min.map
/*!
* jquery.counterup.js 1.0
*
* Copyright 2013, Benjamin Intal http://gambit.ph @bfintal
* Released under the GPL v2 License
*
* Date: Nov 26, 2013
*/(function(e){"use strict";e.fn.counterUp=function(t){var n=e.extend({time:400,delay:10},t);return this.each(function(){var t=e(this),r=n,i=function(){var e=[],n=r.time/r.delay,i=t.text(),s=/[0-9]+,[0-9]+/.test(i);i=i.replace(/,/g,"");var o=/^[0-9]+$/.test(i),u=/^[0-9]+\.[0-9]+$/.test(i),a=u?(i.split(".")[1]||[]).length:0;for(var f=n;f>=1;f--){var l=parseInt(i/n*f);u&&(l=parseFloat(i/n*f).toFixed(a));if(s)while(/(\d+)(\d{3})/.test(l.toString()))l=l.toString().replace(/(\d+)(\d{3})/,"$1,$2");e.unshift(l)}t.data("counterup-nums",e);t.text("0");var c=function(){t.text(t.data("counterup-nums").shift());if(t.data("counterup-nums").length)setTimeout(t.data("counterup-func"),r.delay);else{delete t.data("counterup-nums");t.data("counterup-nums",null);t.data("counterup-func",null)}};t.data("counterup-func",c);setTimeout(t.data("counterup-func"),r.delay)};t.waypoint(i,{offset:"100%",triggerOnce:!0})})}})(jQuery);
var pvi  = pvi || {};

pvi.dashboard = (function () {

    var gridstackOptions = {
        width: 12,
        resizable: {autoHide: true, handles: 'all'},
        verticalMargin: 10,
        animate: true,
        draggable: {
            handle: '.pv-sec-heading',
            scroll: true
        }
    };

    var saveWidgets = function() {
        var serializedData = _.map($('.grid-stack > .grid-stack-item:visible'), function (el) {
            var node = $(el).data('_gridstack_node');
            return {
                id: node.id,
                x: node.x,
                y: node.y,
                width: node.width,
                height: node.height
            };
        }, this);

        $.ajax({
            type: "POST",
            url: CONFIGURATION.updateWidgetsUrl,
            dataType: "json",
            data: {
                items: JSON.stringify(serializedData, null, '    ')
            }
        });
    };

    var dashboardEventBinding = function () {

        //remove widget event binding
        $(document).on('click','.remove-widget', function () {
            var elementSelector = $(this);
            var widget = elementSelector.closest(".grid-stack-item");
            var url = elementSelector.data("url");
            var params = elementSelector.data("params");
            var widgetId = elementSelector.data("widgetid");
            if (CONFIGURATION[url]) {
                $.ajax({
                    type: "POST",
                    url: CONFIGURATION[url],
                    dataType: "json",
                    data: params,
                    success: function (data) {
                        var grid = $('.grid-stack').data('gridstack');
                        grid.removeWidget(widget);
                        $(".rx-widget-menu-content li[data-widgetid=" + widgetId + "]").find("input[type='checkbox']").removeAttr('checked');
                    }
                });
            }
        });

        //event binding for widget list dropdown
        $(document).on("click", ".rx-widget-menu-content li", function () {
            var elementSelector = $(this);
            var url = elementSelector.data("url");
            var params = elementSelector.data("params");
            if (CONFIGURATION[url]) {
                window.location.href = CONFIGURATION[url] + "?" + $.param(params);
            }
        });

        //event binding for dashboard reset button
        $(document).on('click', "#resetButton", function () {
            var url = $(this).data("url");
            pvi.util.showWarning(getMessage("widget_refresh_message"), "Cancel", "Ok", function yes() {
                window.location.href = CONFIGURATION[url];
            })
        });

        $('.grid-stack').gridstack(gridstackOptions);

        $(document).on('change','.grid-stack', function () {
            saveWidgets();
        });

        $(document).ready(function () {
            $('.counter').counterUp({
                delay: 100,
                time: 1200
            });
        });

    };

    var loadData = function () {
        $.ajax({
            url: pvi_urls.personal_stats_url,
            async: false,
            type: 'GET',
            beforeSend: function () {
                pvui.common.showPVLoader();
            },
            success: function (data) {
                var personalStats = data.result.personalStats;
                var dataLength = personalStats.length;
                var personalStateCountainer = $(".pv-widget-personal-stats");
                for (var i = 0; i < dataLength; i++) {
                    var personalStat = personalStats[i];
                    personalStateCountainer.find("." + personalStat.elementName).text(personalStat.count);
                }
                pvui.common.hidePVLoader();
            }
        });
    };

    var init = function () {
        dashboardEventBinding();
        pvi.util.bindDatePickers();
        pvi.util.bindFileUploaderEvent();
    };

    return {
        init: init,
        loadData: loadData
    }

})();

pvi.dashboard.init();
// This is a manifest file that'll be compiled into list-manifest.js.
//
// Any JavaScript file within this directory can be referenced here using a relative path.
//
// You're free to add application-wide JavaScript to this file, but it's generally better
// to create separate JavaScript files as needed.
//
//= require_self
//= require grid
//= require vendorUi/datatables/datatable.colsReorder.min
//= require vendorUi/datatables/dataTables.rowGroup.min
//= require app/list/list-form-state-save
//= require app/list/report-distribution-log
//= require app/list/list
//= require app/list/speech-recog-search

/*todo refactor below code*/
taskAction.commonMethod.init(function(){},pvui.common.showPVLoader,pvui.common.hidePVLoader,pvi.util.showFloatingNotification.successMessage,pvi.util.showFloatingNotification.errorMessage,pvi.util.showWarning);

followUpQuery.commonMethod.init(function(){},pvui.common.showPVLoader,pvui.common.hidePVLoader,pvi.util.showFloatingNotification.successMessage,pvi.util.showFloatingNotification.errorMessage,pvi.util.showWarning);
/*!
 DataTables 1.10.16
 ©2008-2017 SpryMedia Ltd - datatables.net/license
*/
(function(h){"function"===typeof define&&define.amd?define(["jquery"],function(E){return h(E,window,document)}):"object"===typeof exports?module.exports=function(E,G){E||(E=window);G||(G="undefined"!==typeof window?require("jquery"):require("jquery")(E));return h(G,E,E.document)}:h(jQuery,window,document)})(function(h,E,G,k){function X(a){var b,c,d={};h.each(a,function(e){if((b=e.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(b[1]+" "))c=e.replace(b[0],b[2].toLowerCase()),
    d[c]=e,"o"===b[1]&&X(a[e])});a._hungarianMap=d}function I(a,b,c){a._hungarianMap||X(a);var d;h.each(b,function(e){d=a._hungarianMap[e];if(d!==k&&(c||b[d]===k))"o"===d.charAt(0)?(b[d]||(b[d]={}),h.extend(!0,b[d],b[e]),I(a[d],b[d],c)):b[d]=b[e]})}function Ca(a){var b=m.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&(c&&"No data available in table"===b.sEmptyTable)&&F(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&(c&&"Loading..."===b.sLoadingRecords)&&F(a,a,"sZeroRecords","sLoadingRecords");
    a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&cb(a)}function db(a){A(a,"ordering","bSort");A(a,"orderMulti","bSortMulti");A(a,"orderClasses","bSortClasses");A(a,"orderCellsTop","bSortCellsTop");A(a,"order","aaSorting");A(a,"orderFixed","aaSortingFixed");A(a,"paging","bPaginate");A(a,"pagingType","sPaginationType");A(a,"pageLength","iDisplayLength");A(a,"searching","bFilter");"boolean"===typeof a.sScrollX&&(a.sScrollX=a.sScrollX?"100%":"");"boolean"===typeof a.scrollX&&(a.scrollX=
    a.scrollX?"100%":"");if(a=a.aoSearchCols)for(var b=0,c=a.length;b<c;b++)a[b]&&I(m.models.oSearch,a[b])}function eb(a){A(a,"orderable","bSortable");A(a,"orderData","aDataSort");A(a,"orderSequence","asSorting");A(a,"orderDataType","sortDataType");var b=a.aDataSort;"number"===typeof b&&!h.isArray(b)&&(a.aDataSort=[b])}function fb(a){if(!m.__browser){var b={};m.__browser=b;var c=h("<div/>").css({position:"fixed",top:0,left:-1*h(E).scrollLeft(),height:1,width:1,overflow:"hidden"}).append(h("<div/>").css({position:"absolute",
    top:1,left:1,width:100,overflow:"scroll"}).append(h("<div/>").css({width:"100%",height:10}))).appendTo("body"),d=c.children(),e=d.children();b.barWidth=d[0].offsetWidth-d[0].clientWidth;b.bScrollOversize=100===e[0].offsetWidth&&100!==d[0].clientWidth;b.bScrollbarLeft=1!==Math.round(e.offset().left);b.bBounding=c[0].getBoundingClientRect().width?!0:!1;c.remove()}h.extend(a.oBrowser,m.__browser);a.oScroll.iBarWidth=m.__browser.barWidth}function gb(a,b,c,d,e,f){var g,j=!1;c!==k&&(g=c,j=!0);for(;d!==
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     e;)a.hasOwnProperty(d)&&(g=j?b(g,a[d],d,a):a[d],j=!0,d+=f);return g}function Da(a,b){var c=m.defaults.column,d=a.aoColumns.length,c=h.extend({},m.models.oColumn,c,{nTh:b?b:G.createElement("th"),sTitle:c.sTitle?c.sTitle:b?b.innerHTML:"",aDataSort:c.aDataSort?c.aDataSort:[d],mData:c.mData?c.mData:d,idx:d});a.aoColumns.push(c);c=a.aoPreSearchCols;c[d]=h.extend({},m.models.oSearch,c[d]);ja(a,d,h(b).data())}function ja(a,b,c){var b=a.aoColumns[b],d=a.oClasses,e=h(b.nTh);if(!b.sWidthOrig){b.sWidthOrig=
    e.attr("width")||null;var f=(e.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);f&&(b.sWidthOrig=f[1])}c!==k&&null!==c&&(eb(c),I(m.defaults.column,c),c.mDataProp!==k&&!c.mData&&(c.mData=c.mDataProp),c.sType&&(b._sManualType=c.sType),c.className&&!c.sClass&&(c.sClass=c.className),c.sClass&&e.addClass(c.sClass),h.extend(b,c),F(b,c,"sWidth","sWidthOrig"),c.iDataSort!==k&&(b.aDataSort=[c.iDataSort]),F(b,c,"aDataSort"));var g=b.mData,j=Q(g),i=b.mRender?Q(b.mRender):null,c=function(a){return"string"===
    typeof a&&-1!==a.indexOf("@")};b._bAttrSrc=h.isPlainObject(g)&&(c(g.sort)||c(g.type)||c(g.filter));b._setter=null;b.fnGetData=function(a,b,c){var d=j(a,b,k,c);return i&&b?i(d,b,a,c):d};b.fnSetData=function(a,b,c){return R(g)(a,b,c)};"number"!==typeof g&&(a._rowReadObject=!0);a.oFeatures.bSort||(b.bSortable=!1,e.addClass(d.sSortableNone));a=-1!==h.inArray("asc",b.asSorting);c=-1!==h.inArray("desc",b.asSorting);!b.bSortable||!a&&!c?(b.sSortingClass=d.sSortableNone,b.sSortingClassJUI=""):a&&!c?(b.sSortingClass=
    d.sSortableAsc,b.sSortingClassJUI=d.sSortJUIAscAllowed):!a&&c?(b.sSortingClass=d.sSortableDesc,b.sSortingClassJUI=d.sSortJUIDescAllowed):(b.sSortingClass=d.sSortable,b.sSortingClassJUI=d.sSortJUI)}function Y(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Ea(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;(""!==b.sY||""!==b.sX)&&ka(a);r(a,null,"column-sizing",[a])}function Z(a,b){var c=la(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function $(a,b){var c=
    la(a,"bVisible"),c=h.inArray(b,c);return-1!==c?c:null}function aa(a){var b=0;h.each(a.aoColumns,function(a,d){d.bVisible&&"none"!==h(d.nTh).css("display")&&b++});return b}function la(a,b){var c=[];h.map(a.aoColumns,function(a,e){a[b]&&c.push(e)});return c}function Fa(a){var b=a.aoColumns,c=a.aoData,d=m.ext.type.detect,e,f,g,j,i,h,l,q,t;e=0;for(f=b.length;e<f;e++)if(l=b[e],t=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){g=0;for(j=d.length;g<j;g++){i=0;for(h=c.length;i<h;i++){t[i]===
k&&(t[i]=B(a,i,e,"type"));q=d[g](t[i],a);if(!q&&g!==d.length-1)break;if("html"===q)break}if(q){l.sType=q;break}}l.sType||(l.sType="string")}}function hb(a,b,c,d){var e,f,g,j,i,n,l=a.aoColumns;if(b)for(e=b.length-1;0<=e;e--){n=b[e];var q=n.targets!==k?n.targets:n.aTargets;h.isArray(q)||(q=[q]);f=0;for(g=q.length;f<g;f++)if("number"===typeof q[f]&&0<=q[f]){for(;l.length<=q[f];)Da(a);d(q[f],n)}else if("number"===typeof q[f]&&0>q[f])d(l.length+q[f],n);else if("string"===typeof q[f]){j=0;for(i=l.length;j<
i;j++)("_all"==q[f]||h(l[j].nTh).hasClass(q[f]))&&d(j,n)}}if(c){e=0;for(a=c.length;e<a;e++)d(e,c[e])}}function M(a,b,c,d){var e=a.aoData.length,f=h.extend(!0,{},m.models.oRow,{src:c?"dom":"data",idx:e});f._aData=b;a.aoData.push(f);for(var g=a.aoColumns,j=0,i=g.length;j<i;j++)g[j].sType=null;a.aiDisplayMaster.push(e);b=a.rowIdFn(b);b!==k&&(a.aIds[b]=f);(c||!a.oFeatures.bDeferRender)&&Ga(a,e,c,d);return e}function ma(a,b){var c;b instanceof h||(b=h(b));return b.map(function(b,e){c=Ha(a,e);return M(a,
    c.data,e,c.cells)})}function B(a,b,c,d){var e=a.iDraw,f=a.aoColumns[c],g=a.aoData[b]._aData,j=f.sDefaultContent,i=f.fnGetData(g,d,{settings:a,row:b,col:c});if(i===k)return a.iDrawError!=e&&null===j&&(J(a,0,"Requested unknown parameter "+("function"==typeof f.mData?"{function}":"'"+f.mData+"'")+" for row "+b+", column "+c,4),a.iDrawError=e),j;if((i===g||null===i)&&null!==j&&d!==k)i=j;else if("function"===typeof i)return i.call(g);return null===i&&"display"==d?"":i}function ib(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,
    d,{settings:a,row:b,col:c})}function Ia(a){return h.map(a.match(/(\\.|[^\.])+/g)||[""],function(a){return a.replace(/\\\./g,".")})}function Q(a){if(h.isPlainObject(a)){var b={};h.each(a,function(a,c){c&&(b[a]=Q(c))});return function(a,c,f,g){var j=b[c]||b._;return j!==k?j(a,c,f,g):a}}if(null===a)return function(a){return a};if("function"===typeof a)return function(b,c,f,g){return a(b,c,f,g)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var c=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       b,f){var g,j;if(""!==f){j=Ia(f);for(var i=0,n=j.length;i<n;i++){f=j[i].match(ba);g=j[i].match(U);if(f){j[i]=j[i].replace(ba,"");""!==j[i]&&(a=a[j[i]]);g=[];j.splice(0,i+1);j=j.join(".");if(h.isArray(a)){i=0;for(n=a.length;i<n;i++)g.push(c(a[i],b,j))}a=f[0].substring(1,f[0].length-1);a=""===a?g:g.join(a);break}else if(g){j[i]=j[i].replace(U,"");a=a[j[i]]();continue}if(null===a||a[j[i]]===k)return k;a=a[j[i]]}}return a};return function(b,e){return c(b,e,a)}}return function(b){return b[a]}}function R(a){if(h.isPlainObject(a))return R(a._);
    if(null===a)return function(){};if("function"===typeof a)return function(b,d,e){a(b,"set",d,e)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var b=function(a,d,e){var e=Ia(e),f;f=e[e.length-1];for(var g,j,i=0,n=e.length-1;i<n;i++){g=e[i].match(ba);j=e[i].match(U);if(g){e[i]=e[i].replace(ba,"");a[e[i]]=[];f=e.slice();f.splice(0,i+1);g=f.join(".");if(h.isArray(d)){j=0;for(n=d.length;j<n;j++)f={},b(f,d[j],g),a[e[i]].push(f)}else a[e[i]]=d;return}j&&(e[i]=e[i].replace(U,
        ""),a=a[e[i]](d));if(null===a[e[i]]||a[e[i]]===k)a[e[i]]={};a=a[e[i]]}if(f.match(U))a[f.replace(U,"")](d);else a[f.replace(ba,"")]=d};return function(c,d){return b(c,d,a)}}return function(b,d){b[a]=d}}function Ja(a){return D(a.aoData,"_aData")}function na(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0;a.aIds={}}function oa(a,b,c){for(var d=-1,e=0,f=a.length;e<f;e++)a[e]==b?d=e:a[e]>b&&a[e]--; -1!=d&&c===k&&a.splice(d,1)}function ca(a,b,c,d){var e=a.aoData[b],f,g=function(c,d){for(;c.childNodes.length;)c.removeChild(c.firstChild);
    c.innerHTML=B(a,b,d,"display")};if("dom"===c||(!c||"auto"===c)&&"dom"===e.src)e._aData=Ha(a,e,d,d===k?k:e._aData).data;else{var j=e.anCells;if(j)if(d!==k)g(j[d],d);else{c=0;for(f=j.length;c<f;c++)g(j[c],c)}}e._aSortData=null;e._aFilterData=null;g=a.aoColumns;if(d!==k)g[d].sType=null;else{c=0;for(f=g.length;c<f;c++)g[c].sType=null;Ka(a,e)}}function Ha(a,b,c,d){var e=[],f=b.firstChild,g,j,i=0,n,l=a.aoColumns,q=a._rowReadObject,d=d!==k?d:q?{}:[],t=function(a,b){if("string"===typeof a){var c=a.indexOf("@");
    -1!==c&&(c=a.substring(c+1),R(a)(d,b.getAttribute(c)))}},m=function(a){if(c===k||c===i)j=l[i],n=h.trim(a.innerHTML),j&&j._bAttrSrc?(R(j.mData._)(d,n),t(j.mData.sort,a),t(j.mData.type,a),t(j.mData.filter,a)):q?(j._setter||(j._setter=R(j.mData)),j._setter(d,n)):d[i]=n;i++};if(f)for(;f;){g=f.nodeName.toUpperCase();if("TD"==g||"TH"==g)m(f),e.push(f);f=f.nextSibling}else{e=b.anCells;f=0;for(g=e.length;f<g;f++)m(e[f])}if(b=b.firstChild?b:b.nTr)(b=b.getAttribute("id"))&&R(a.rowId)(d,b);return{data:d,cells:e}}
    function Ga(a,b,c,d){var e=a.aoData[b],f=e._aData,g=[],j,i,n,l,q;if(null===e.nTr){j=c||G.createElement("tr");e.nTr=j;e.anCells=g;j._DT_RowIndex=b;Ka(a,e);l=0;for(q=a.aoColumns.length;l<q;l++){n=a.aoColumns[l];i=c?d[l]:G.createElement(n.sCellType);i._DT_CellIndex={row:b,column:l};g.push(i);if((!c||n.mRender||n.mData!==l)&&(!h.isPlainObject(n.mData)||n.mData._!==l+".display"))i.innerHTML=B(a,b,l,"display");n.sClass&&(i.className+=" "+n.sClass);n.bVisible&&!c?j.appendChild(i):!n.bVisible&&c&&i.parentNode.removeChild(i);
        n.fnCreatedCell&&n.fnCreatedCell.call(a.oInstance,i,B(a,b,l),f,b,l)}r(a,"aoRowCreatedCallback",null,[j,f,b])}e.nTr.setAttribute("role","row")}function Ka(a,b){var c=b.nTr,d=b._aData;if(c){var e=a.rowIdFn(d);e&&(c.id=e);d.DT_RowClass&&(e=d.DT_RowClass.split(" "),b.__rowc=b.__rowc?qa(b.__rowc.concat(e)):e,h(c).removeClass(b.__rowc.join(" ")).addClass(d.DT_RowClass));d.DT_RowAttr&&h(c).attr(d.DT_RowAttr);d.DT_RowData&&h(c).data(d.DT_RowData)}}function jb(a){var b,c,d,e,f,g=a.nTHead,j=a.nTFoot,i=0===
        h("th, td",g).length,n=a.oClasses,l=a.aoColumns;i&&(e=h("<tr/>").appendTo(g));b=0;for(c=l.length;b<c;b++)f=l[b],d=h(f.nTh).addClass(f.sClass),i&&d.appendTo(e),a.oFeatures.bSort&&(d.addClass(f.sSortingClass),!1!==f.bSortable&&(d.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),La(a,f.nTh,b))),f.sTitle!=d[0].innerHTML&&d.html(f.sTitle),Ma(a,"header")(a,d,f,n);i&&da(a.aoHeader,g);h(g).find(">tr").attr("role","row");h(g).find(">tr>th, >tr>td").addClass(n.sHeaderTH);h(j).find(">tr>th, >tr>td").addClass(n.sFooterTH);
        if(null!==j){a=a.aoFooter[0];b=0;for(c=a.length;b<c;b++)f=l[b],f.nTf=a[b].cell,f.sClass&&h(f.nTf).addClass(f.sClass)}}function ea(a,b,c){var d,e,f,g=[],j=[],i=a.aoColumns.length,n;if(b){c===k&&(c=!1);d=0;for(e=b.length;d<e;d++){g[d]=b[d].slice();g[d].nTr=b[d].nTr;for(f=i-1;0<=f;f--)!a.aoColumns[f].bVisible&&!c&&g[d].splice(f,1);j.push([])}d=0;for(e=g.length;d<e;d++){if(a=g[d].nTr)for(;f=a.firstChild;)a.removeChild(f);f=0;for(b=g[d].length;f<b;f++)if(n=i=1,j[d][f]===k){a.appendChild(g[d][f].cell);
        for(j[d][f]=1;g[d+i]!==k&&g[d][f].cell==g[d+i][f].cell;)j[d+i][f]=1,i++;for(;g[d][f+n]!==k&&g[d][f].cell==g[d][f+n].cell;){for(c=0;c<i;c++)j[d+c][f+n]=1;n++}h(g[d][f].cell).attr("rowspan",i).attr("colspan",n)}}}}function N(a){var b=r(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==h.inArray(!1,b))C(a,!1);else{var b=[],c=0,d=a.asStripeClasses,e=d.length,f=a.oLanguage,g=a.iInitDisplayStart,j="ssp"==y(a),i=a.aiDisplay;a.bDrawing=!0;g!==k&&-1!==g&&(a._iDisplayStart=j?g:g>=a.fnRecordsDisplay()?0:g,a.iInitDisplayStart=
        -1);var g=a._iDisplayStart,n=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,C(a,!1);else if(j){if(!a.bDestroying&&!kb(a))return}else a.iDraw++;if(0!==i.length){f=j?a.aoData.length:n;for(j=j?0:g;j<f;j++){var l=i[j],q=a.aoData[l];null===q.nTr&&Ga(a,l);l=q.nTr;if(0!==e){var t=d[c%e];q._sRowStripe!=t&&(h(l).removeClass(q._sRowStripe).addClass(t),q._sRowStripe=t)}r(a,"aoRowCallback",null,[l,q._aData,c,j]);b.push(l);c++}}else c=f.sZeroRecords,1==a.iDraw&&"ajax"==y(a)?c=f.sLoadingRecords:
        f.sEmptyTable&&0===a.fnRecordsTotal()&&(c=f.sEmptyTable),b[0]=h("<tr/>",{"class":e?d[0]:""}).append(h("<td />",{valign:"top",colSpan:aa(a),"class":a.oClasses.sRowEmpty}).html(c))[0];r(a,"aoHeaderCallback","header",[h(a.nTHead).children("tr")[0],Ja(a),g,n,i]);r(a,"aoFooterCallback","footer",[h(a.nTFoot).children("tr")[0],Ja(a),g,n,i]);d=h(a.nTBody);d.children().detach();d.append(h(b));r(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function S(a,b){var c=a.oFeatures,d=c.bFilter;
        c.bSort&&lb(a);d?fa(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;N(a);a._drawHold=!1}function mb(a){var b=a.oClasses,c=h(a.nTable),c=h("<div/>").insertBefore(c),d=a.oFeatures,e=h("<div/>",{id:a.sTableId+"_wrapper","class":b.sWrapper+(a.nTFoot?"":" "+b.sNoFooter)});a.nHolding=c[0];a.nTableWrapper=e[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var f=a.sDom.split(""),g,j,i,n,l,q,k=0;k<f.length;k++){g=null;j=f[k];if("<"==j){i=h("<div/>")[0];
        n=f[k+1];if("'"==n||'"'==n){l="";for(q=2;f[k+q]!=n;)l+=f[k+q],q++;"H"==l?l=b.sJUIHeader:"F"==l&&(l=b.sJUIFooter);-1!=l.indexOf(".")?(n=l.split("."),i.id=n[0].substr(1,n[0].length-1),i.className=n[1]):"#"==l.charAt(0)?i.id=l.substr(1,l.length-1):i.className=l;k+=q}e.append(i);e=h(i)}else if(">"==j)e=e.parent();else if("l"==j&&d.bPaginate&&d.bLengthChange)g=nb(a);else if("f"==j&&d.bFilter)g=ob(a);else if("r"==j&&d.bProcessing)g=pb(a);else if("t"==j)g=qb(a);else if("i"==j&&d.bInfo)g=rb(a);else if("p"==
        j&&d.bPaginate)g=sb(a);else if(0!==m.ext.feature.length){i=m.ext.feature;q=0;for(n=i.length;q<n;q++)if(j==i[q].cFeature){g=i[q].fnInit(a);break}}g&&(i=a.aanFeatures,i[j]||(i[j]=[]),i[j].push(g),e.append(g))}c.replaceWith(e);a.nHolding=null}function da(a,b){var c=h(b).children("tr"),d,e,f,g,j,i,n,l,q,k;a.splice(0,a.length);f=0;for(i=c.length;f<i;f++)a.push([]);f=0;for(i=c.length;f<i;f++){d=c[f];for(e=d.firstChild;e;){if("TD"==e.nodeName.toUpperCase()||"TH"==e.nodeName.toUpperCase()){l=1*e.getAttribute("colspan");
        q=1*e.getAttribute("rowspan");l=!l||0===l||1===l?1:l;q=!q||0===q||1===q?1:q;g=0;for(j=a[f];j[g];)g++;n=g;k=1===l?!0:!1;for(j=0;j<l;j++)for(g=0;g<q;g++)a[f+g][n+j]={cell:e,unique:k},a[f+g].nTr=d}e=e.nextSibling}}}function ra(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],da(c,b)));for(var b=0,e=c.length;b<e;b++)for(var f=0,g=c[b].length;f<g;f++)if(c[b][f].unique&&(!d[f]||!a.bSortCellsTop))d[f]=c[b][f].cell;return d}function sa(a,b,c){r(a,"aoServerParams","serverParams",[b]);if(b&&h.isArray(b)){var d={},
        e=/(.*?)\[\]$/;h.each(b,function(a,b){var c=b.name.match(e);c?(c=c[0],d[c]||(d[c]=[]),d[c].push(b.value)):d[b.name]=b.value});b=d}var f,g=a.ajax,j=a.oInstance,i=function(b){r(a,null,"xhr",[a,b,a.jqXHR]);c(b)};if(h.isPlainObject(g)&&g.data){f=g.data;var n=h.isFunction(f)?f(b,a):f,b=h.isFunction(f)&&n?n:h.extend(!0,b,n);delete g.data}n={data:b,success:function(b){var c=b.error||b.sError;c&&J(a,0,c);a.json=b;i(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(b,c){var d=r(a,null,"xhr",
        [a,null,a.jqXHR]);-1===h.inArray(!0,d)&&("parsererror"==c?J(a,0,"Invalid JSON response",1):4===b.readyState&&J(a,0,"Ajax error",7));C(a,!1)}};a.oAjaxData=b;r(a,null,"preXhr",[a,b]);a.fnServerData?a.fnServerData.call(j,a.sAjaxSource,h.map(b,function(a,b){return{name:b,value:a}}),i,a):a.sAjaxSource||"string"===typeof g?a.jqXHR=h.ajax(h.extend(n,{url:g||a.sAjaxSource})):h.isFunction(g)?a.jqXHR=g.call(j,b,i,a):(a.jqXHR=h.ajax(h.extend(n,g)),g.data=f)}function kb(a){return a.bAjaxDataGet?(a.iDraw++,C(a,
        !0),sa(a,tb(a),function(b){ub(a,b)}),!1):!0}function tb(a){var b=a.aoColumns,c=b.length,d=a.oFeatures,e=a.oPreviousSearch,f=a.aoPreSearchCols,g,j=[],i,n,l,k=V(a);g=a._iDisplayStart;i=!1!==d.bPaginate?a._iDisplayLength:-1;var t=function(a,b){j.push({name:a,value:b})};t("sEcho",a.iDraw);t("iColumns",c);t("sColumns",D(b,"sName").join(","));t("iDisplayStart",g);t("iDisplayLength",i);var pa={draw:a.iDraw,columns:[],order:[],start:g,length:i,search:{value:e.sSearch,regex:e.bRegex}};for(g=0;g<c;g++)n=b[g],
        l=f[g],i="function"==typeof n.mData?"function":n.mData,pa.columns.push({data:i,name:n.sName,searchable:n.bSearchable,orderable:n.bSortable,search:{value:l.sSearch,regex:l.bRegex}}),t("mDataProp_"+g,i),d.bFilter&&(t("sSearch_"+g,l.sSearch),t("bRegex_"+g,l.bRegex),t("bSearchable_"+g,n.bSearchable)),d.bSort&&t("bSortable_"+g,n.bSortable);d.bFilter&&(t("sSearch",e.sSearch),t("bRegex",e.bRegex));d.bSort&&(h.each(k,function(a,b){pa.order.push({column:b.col,dir:b.dir});t("iSortCol_"+a,b.col);t("sSortDir_"+
        a,b.dir)}),t("iSortingCols",k.length));b=m.ext.legacy.ajax;return null===b?a.sAjaxSource?j:pa:b?j:pa}function ub(a,b){var c=ta(a,b),d=b.sEcho!==k?b.sEcho:b.draw,e=b.iTotalRecords!==k?b.iTotalRecords:b.recordsTotal,f=b.iTotalDisplayRecords!==k?b.iTotalDisplayRecords:b.recordsFiltered;if(d){if(1*d<a.iDraw)return;a.iDraw=1*d}na(a);a._iRecordsTotal=parseInt(e,10);a._iRecordsDisplay=parseInt(f,10);d=0;for(e=c.length;d<e;d++)M(a,c[d]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;N(a);a._bInitComplete||
    ua(a,b);a.bAjaxDataGet=!0;C(a,!1)}function ta(a,b){var c=h.isPlainObject(a.ajax)&&a.ajax.dataSrc!==k?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===c?b.aaData||b[c]:""!==c?Q(c)(b):b}function ob(a){var b=a.oClasses,c=a.sTableId,d=a.oLanguage,e=a.oPreviousSearch,f=a.aanFeatures,g='<input type="search" class="'+b.sFilterInput+'"/>',j=d.sSearch,j=j.match(/_INPUT_/)?j.replace("_INPUT_",g):j+g,b=h("<div/>",{id:!f.f?c+"_filter":null,"class":b.sFilter}).append(h("<label/>").append(j)),f=function(){var b=!this.value?
        "":this.value;b!=e.sSearch&&(fa(a,{sSearch:b,bRegex:e.bRegex,bSmart:e.bSmart,bCaseInsensitive:e.bCaseInsensitive}),a._iDisplayStart=0,N(a))},g=null!==a.searchDelay?a.searchDelay:"ssp"===y(a)?400:0,i=h("input",b).val(e.sSearch).attr("placeholder",d.sSearchPlaceholder).on("keyup.DT search.DT input.DT paste.DT cut.DT",g?Na(f,g):f).on("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",c);h(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{i[0]!==G.activeElement&&i.val(e.sSearch)}catch(d){}});
        return b[0]}function fa(a,b,c){var d=a.oPreviousSearch,e=a.aoPreSearchCols,f=function(a){d.sSearch=a.sSearch;d.bRegex=a.bRegex;d.bSmart=a.bSmart;d.bCaseInsensitive=a.bCaseInsensitive};Fa(a);if("ssp"!=y(a)){vb(a,b.sSearch,c,b.bEscapeRegex!==k?!b.bEscapeRegex:b.bRegex,b.bSmart,b.bCaseInsensitive);f(b);for(b=0;b<e.length;b++)wb(a,e[b].sSearch,b,e[b].bEscapeRegex!==k?!e[b].bEscapeRegex:e[b].bRegex,e[b].bSmart,e[b].bCaseInsensitive);xb(a)}else f(b);a.bFiltered=!0;r(a,null,"search",[a])}function xb(a){for(var b=
        m.ext.search,c=a.aiDisplay,d,e,f=0,g=b.length;f<g;f++){for(var j=[],i=0,n=c.length;i<n;i++)e=c[i],d=a.aoData[e],b[f](a,d._aFilterData,e,d._aData,i)&&j.push(e);c.length=0;h.merge(c,j)}}function wb(a,b,c,d,e,f){if(""!==b){for(var g=[],j=a.aiDisplay,d=Oa(b,d,e,f),e=0;e<j.length;e++)b=a.aoData[j[e]]._aFilterData[c],d.test(b)&&g.push(j[e]);a.aiDisplay=g}}function vb(a,b,c,d,e,f){var d=Oa(b,d,e,f),f=a.oPreviousSearch.sSearch,g=a.aiDisplayMaster,j,e=[];0!==m.ext.search.length&&(c=!0);j=yb(a);if(0>=b.length)a.aiDisplay=
        g.slice();else{if(j||c||f.length>b.length||0!==b.indexOf(f)||a.bSorted)a.aiDisplay=g.slice();b=a.aiDisplay;for(c=0;c<b.length;c++)d.test(a.aoData[b[c]]._sFilterRow)&&e.push(b[c]);a.aiDisplay=e}}function Oa(a,b,c,d){a=b?a:Pa(a);c&&(a="^(?=.*?"+h.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(a){if('"'===a.charAt(0))var b=a.match(/^"(.*)"$/),a=b?b[1]:a;return a.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(a,d?"i":"")}function yb(a){var b=a.aoColumns,c,d,e,f,g,j,i,h,l=m.ext.type.search;c=!1;
        d=0;for(f=a.aoData.length;d<f;d++)if(h=a.aoData[d],!h._aFilterData){j=[];e=0;for(g=b.length;e<g;e++)c=b[e],c.bSearchable?(i=B(a,d,e,"filter"),l[c.sType]&&(i=l[c.sType](i)),null===i&&(i=""),"string"!==typeof i&&i.toString&&(i=i.toString())):i="",i.indexOf&&-1!==i.indexOf("&")&&(va.innerHTML=i,i=Wb?va.textContent:va.innerText),i.replace&&(i=i.replace(/[\r\n]/g,"")),j.push(i);h._aFilterData=j;h._sFilterRow=j.join("  ");c=!0}return c}function zb(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,
        caseInsensitive:a.bCaseInsensitive}}function Ab(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function rb(a){var b=a.sTableId,c=a.aanFeatures.i,d=h("<div/>",{"class":a.oClasses.sInfo,id:!c?b+"_info":null});c||(a.aoDrawCallback.push({fn:Bb,sName:"information"}),d.attr("role","status").attr("aria-live","polite"),h(a.nTable).attr("aria-describedby",b+"_info"));return d[0]}function Bb(a){var b=a.aanFeatures.i;if(0!==b.length){var c=a.oLanguage,d=a._iDisplayStart+
        1,e=a.fnDisplayEnd(),f=a.fnRecordsTotal(),g=a.fnRecordsDisplay(),j=g?c.sInfo:c.sInfoEmpty;g!==f&&(j+=" "+c.sInfoFiltered);j+=c.sInfoPostFix;j=Cb(a,j);c=c.fnInfoCallback;null!==c&&(j=c.call(a.oInstance,a,d,e,f,g,j));h(b).html(j)}}function Cb(a,b){var c=a.fnFormatNumber,d=a._iDisplayStart+1,e=a._iDisplayLength,f=a.fnRecordsDisplay(),g=-1===e;return b.replace(/_START_/g,c.call(a,d)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,
        f)).replace(/_PAGE_/g,c.call(a,g?1:Math.ceil(d/e))).replace(/_PAGES_/g,c.call(a,g?1:Math.ceil(f/e)))}function ga(a){var b,c,d=a.iInitDisplayStart,e=a.aoColumns,f;c=a.oFeatures;var g=a.bDeferLoading;if(a.bInitialised){mb(a);jb(a);ea(a,a.aoHeader);ea(a,a.aoFooter);C(a,!0);c.bAutoWidth&&Ea(a);b=0;for(c=e.length;b<c;b++)f=e[b],f.sWidth&&(f.nTh.style.width=v(f.sWidth));r(a,null,"preInit",[a]);S(a);e=y(a);if("ssp"!=e||g)"ajax"==e?sa(a,[],function(c){var f=ta(a,c);for(b=0;b<f.length;b++)M(a,f[b]);a.iInitDisplayStart=
        d;S(a);C(a,!1);ua(a,c)},a):(C(a,!1),ua(a))}else setTimeout(function(){ga(a)},200)}function ua(a,b){a._bInitComplete=!0;(b||a.oInit.aaData)&&Y(a);r(a,null,"plugin-init",[a,b]);r(a,"aoInitComplete","init",[a,b])}function Qa(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Ra(a);r(a,null,"length",[a,c])}function nb(a){for(var b=a.oClasses,c=a.sTableId,d=a.aLengthMenu,e=h.isArray(d[0]),f=e?d[0]:d,d=e?d[1]:d,e=h("<select/>",{name:c+"_length","aria-controls":c,"class":b.sLengthSelect}),g=0,j=f.length;g<j;g++)e[0][g]=
        new Option("number"===typeof d[g]?a.fnFormatNumber(d[g]):d[g],f[g]);var i=h("<div><label/></div>").addClass(b.sLength);a.aanFeatures.l||(i[0].id=c+"_length");i.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",e[0].outerHTML));h("select",i).val(a._iDisplayLength).on("change.DT",function(){Qa(a,h(this).val());N(a)});h(a.nTable).on("length.dt.DT",function(b,c,d){a===c&&h("select",i).val(d)});return i[0]}function sb(a){var b=a.sPaginationType,c=m.ext.pager[b],d="function"===typeof c,e=function(a){N(a)},
        b=h("<div/>").addClass(a.oClasses.sPaging+b)[0],f=a.aanFeatures;d||c.fnInit(a,b,e);f.p||(b.id=a.sTableId+"_paginate",a.aoDrawCallback.push({fn:function(a){if(d){var b=a._iDisplayStart,i=a._iDisplayLength,h=a.fnRecordsDisplay(),l=-1===i,b=l?0:Math.ceil(b/i),i=l?1:Math.ceil(h/i),h=c(b,i),k,l=0;for(k=f.p.length;l<k;l++)Ma(a,"pageButton")(a,f.p[l],l,h,b,i)}else c.fnUpdate(a,e)},sName:"pagination"}));return b}function Sa(a,b,c){var d=a._iDisplayStart,e=a._iDisplayLength,f=a.fnRecordsDisplay();0===f||-1===
    e?d=0:"number"===typeof b?(d=b*e,d>f&&(d=0)):"first"==b?d=0:"previous"==b?(d=0<=e?d-e:0,0>d&&(d=0)):"next"==b?d+e<f&&(d+=e):"last"==b?d=Math.floor((f-1)/e)*e:J(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==d;a._iDisplayStart=d;b&&(r(a,null,"page",[a]),c&&N(a));return b}function pb(a){return h("<div/>",{id:!a.aanFeatures.r?a.sTableId+"_processing":null,"class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function C(a,b){a.oFeatures.bProcessing&&h(a.aanFeatures.r).css("display",
        b?"block":"none");r(a,null,"processing",[a,b])}function qb(a){var b=h(a.nTable);b.attr("role","grid");var c=a.oScroll;if(""===c.sX&&""===c.sY)return a.nTable;var d=c.sX,e=c.sY,f=a.oClasses,g=b.children("caption"),j=g.length?g[0]._captionSide:null,i=h(b[0].cloneNode(!1)),n=h(b[0].cloneNode(!1)),l=b.children("tfoot");l.length||(l=null);i=h("<div/>",{"class":f.sScrollWrapper}).append(h("<div/>",{"class":f.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:d?!d?null:v(d):"100%"}).append(h("<div/>",
        {"class":f.sScrollHeadInner}).css({"box-sizing":"content-box",width:c.sXInner||"100%"}).append(i.removeAttr("id").css("margin-left",0).append("top"===j?g:null).append(b.children("thead"))))).append(h("<div/>",{"class":f.sScrollBody}).css({position:"relative",overflow:"auto",width:!d?null:v(d)}).append(b));l&&i.append(h("<div/>",{"class":f.sScrollFoot}).css({overflow:"hidden",border:0,width:d?!d?null:v(d):"100%"}).append(h("<div/>",{"class":f.sScrollFootInner}).append(n.removeAttr("id").css("margin-left",
        0).append("bottom"===j?g:null).append(b.children("tfoot")))));var b=i.children(),k=b[0],f=b[1],t=l?b[2]:null;if(d)h(f).on("scroll.DT",function(){var a=this.scrollLeft;k.scrollLeft=a;l&&(t.scrollLeft=a)});h(f).css(e&&c.bCollapse?"max-height":"height",e);a.nScrollHead=k;a.nScrollBody=f;a.nScrollFoot=t;a.aoDrawCallback.push({fn:ka,sName:"scrolling"});return i[0]}function ka(a){var b=a.oScroll,c=b.sX,d=b.sXInner,e=b.sY,b=b.iBarWidth,f=h(a.nScrollHead),g=f[0].style,j=f.children("div"),i=j[0].style,n=j.children("table"),
        j=a.nScrollBody,l=h(j),q=j.style,t=h(a.nScrollFoot).children("div"),m=t.children("table"),o=h(a.nTHead),p=h(a.nTable),s=p[0],r=s.style,u=a.nTFoot?h(a.nTFoot):null,x=a.oBrowser,T=x.bScrollOversize,Xb=D(a.aoColumns,"nTh"),O,K,P,w,Ta=[],y=[],z=[],A=[],B,C=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};K=j.scrollHeight>j.clientHeight;if(a.scrollBarVis!==K&&a.scrollBarVis!==k)a.scrollBarVis=K,Y(a);else{a.scrollBarVis=K;p.children("thead, tfoot").remove();
        u&&(P=u.clone().prependTo(p),O=u.find("tr"),P=P.find("tr"));w=o.clone().prependTo(p);o=o.find("tr");K=w.find("tr");w.find("th, td").removeAttr("tabindex");c||(q.width="100%",f[0].style.width="100%");h.each(ra(a,w),function(b,c){B=Z(a,b);c.style.width=a.aoColumns[B].sWidth});u&&H(function(a){a.style.width=""},P);f=p.outerWidth();if(""===c){r.width="100%";if(T&&(p.find("tbody").height()>j.offsetHeight||"scroll"==l.css("overflow-y")))r.width=v(p.outerWidth()-b);f=p.outerWidth()}else""!==d&&(r.width=
            v(d),f=p.outerWidth());H(C,K);H(function(a){z.push(a.innerHTML);Ta.push(v(h(a).css("width")))},K);H(function(a,b){if(h.inArray(a,Xb)!==-1)a.style.width=Ta[b]},o);h(K).height(0);u&&(H(C,P),H(function(a){A.push(a.innerHTML);y.push(v(h(a).css("width")))},P),H(function(a,b){a.style.width=y[b]},O),h(P).height(0));H(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+z[b]+"</div>";a.style.width=Ta[b]},K);u&&H(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+
            A[b]+"</div>";a.style.width=y[b]},P);if(p.outerWidth()<f){O=j.scrollHeight>j.offsetHeight||"scroll"==l.css("overflow-y")?f+b:f;if(T&&(j.scrollHeight>j.offsetHeight||"scroll"==l.css("overflow-y")))r.width=v(O-b);(""===c||""!==d)&&J(a,1,"Possible column misalignment",6)}else O="100%";q.width=v(O);g.width=v(O);u&&(a.nScrollFoot.style.width=v(O));!e&&T&&(q.height=v(s.offsetHeight+b));c=p.outerWidth();n[0].style.width=v(c);i.width=v(c);d=p.height()>j.clientHeight||"scroll"==l.css("overflow-y");e="padding"+
            (x.bScrollbarLeft?"Left":"Right");i[e]=d?b+"px":"0px";u&&(m[0].style.width=v(c),t[0].style.width=v(c),t[0].style[e]=d?b+"px":"0px");p.children("colgroup").insertBefore(p.children("thead"));l.scroll();if((a.bSorted||a.bFiltered)&&!a._drawHold)j.scrollTop=0}}function H(a,b,c){for(var d=0,e=0,f=b.length,g,j;e<f;){g=b[e].firstChild;for(j=c?c[e].firstChild:null;g;)1===g.nodeType&&(c?a(g,j,d):a(g,d),d++),g=g.nextSibling,j=c?j.nextSibling:null;e++}}function Ea(a){var b=a.nTable,c=a.aoColumns,d=a.oScroll,
        e=d.sY,f=d.sX,g=d.sXInner,j=c.length,i=la(a,"bVisible"),n=h("th",a.nTHead),l=b.getAttribute("width"),k=b.parentNode,t=!1,m,o,p=a.oBrowser,d=p.bScrollOversize;(m=b.style.width)&&-1!==m.indexOf("%")&&(l=m);for(m=0;m<i.length;m++)o=c[i[m]],null!==o.sWidth&&(o.sWidth=Db(o.sWidthOrig,k),t=!0);if(d||!t&&!f&&!e&&j==aa(a)&&j==n.length)for(m=0;m<j;m++)i=Z(a,m),null!==i&&(c[i].sWidth=v(n.eq(m).width()));else{j=h(b).clone().css("visibility","hidden").removeAttr("id");j.find("tbody tr").remove();var s=h("<tr/>").appendTo(j.find("tbody"));
        j.find("thead, tfoot").remove();j.append(h(a.nTHead).clone()).append(h(a.nTFoot).clone());j.find("tfoot th, tfoot td").css("width","");n=ra(a,j.find("thead")[0]);for(m=0;m<i.length;m++)o=c[i[m]],n[m].style.width=null!==o.sWidthOrig&&""!==o.sWidthOrig?v(o.sWidthOrig):"",o.sWidthOrig&&f&&h(n[m]).append(h("<div/>").css({width:o.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(m=0;m<i.length;m++)t=i[m],o=c[t],h(Eb(a,t)).clone(!1).append(o.sContentPadding).appendTo(s);h("[name]",
            j).removeAttr("name");o=h("<div/>").css(f||e?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(j).appendTo(k);f&&g?j.width(g):f?(j.css("width","auto"),j.removeAttr("width"),j.width()<k.clientWidth&&l&&j.width(k.clientWidth)):e?j.width(k.clientWidth):l&&j.width(l);for(m=e=0;m<i.length;m++)k=h(n[m]),g=k.outerWidth()-k.width(),k=p.bBounding?Math.ceil(n[m].getBoundingClientRect().width):k.outerWidth(),e+=k,c[i[m]].sWidth=v(k-g);b.style.width=v(e);o.remove()}l&&(b.style.width=
        v(l));if((l||f)&&!a._reszEvt)b=function(){h(E).on("resize.DT-"+a.sInstance,Na(function(){Y(a)}))},d?setTimeout(b,1E3):b(),a._reszEvt=!0}function Db(a,b){if(!a)return 0;var c=h("<div/>").css("width",v(a)).appendTo(b||G.body),d=c[0].offsetWidth;c.remove();return d}function Eb(a,b){var c=Fb(a,b);if(0>c)return null;var d=a.aoData[c];return!d.nTr?h("<td/>").html(B(a,c,b,"display"))[0]:d.anCells[b]}function Fb(a,b){for(var c,d=-1,e=-1,f=0,g=a.aoData.length;f<g;f++)c=B(a,f,b,"display")+"",c=c.replace(Yb,
        ""),c=c.replace(/&nbsp;/g," "),c.length>d&&(d=c.length,e=f);return e}function v(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function V(a){var b,c,d=[],e=a.aoColumns,f,g,j,i;b=a.aaSortingFixed;c=h.isPlainObject(b);var n=[];f=function(a){a.length&&!h.isArray(a[0])?n.push(a):h.merge(n,a)};h.isArray(b)&&f(b);c&&b.pre&&f(b.pre);f(a.aaSorting);c&&b.post&&f(b.post);for(a=0;a<n.length;a++){i=n[a][0];f=e[i].aDataSort;b=0;for(c=f.length;b<c;b++)g=f[b],j=e[g].sType||
        "string",n[a]._idx===k&&(n[a]._idx=h.inArray(n[a][1],e[g].asSorting)),d.push({src:i,col:g,dir:n[a][1],index:n[a]._idx,type:j,formatter:m.ext.type.order[j+"-pre"]})}return d}function lb(a){var b,c,d=[],e=m.ext.type.order,f=a.aoData,g=0,j,i=a.aiDisplayMaster,h;Fa(a);h=V(a);b=0;for(c=h.length;b<c;b++)j=h[b],j.formatter&&g++,Gb(a,j.col);if("ssp"!=y(a)&&0!==h.length){b=0;for(c=i.length;b<c;b++)d[i[b]]=b;g===h.length?i.sort(function(a,b){var c,e,g,j,i=h.length,k=f[a]._aSortData,m=f[b]._aSortData;for(g=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0;g<i;g++)if(j=h[g],c=k[j.col],e=m[j.col],c=c<e?-1:c>e?1:0,0!==c)return"asc"===j.dir?c:-c;c=d[a];e=d[b];return c<e?-1:c>e?1:0}):i.sort(function(a,b){var c,g,j,i,k=h.length,m=f[a]._aSortData,o=f[b]._aSortData;for(j=0;j<k;j++)if(i=h[j],c=m[i.col],g=o[i.col],i=e[i.type+"-"+i.dir]||e["string-"+i.dir],c=i(c,g),0!==c)return c;c=d[a];g=d[b];return c<g?-1:c>g?1:0})}a.bSorted=!0}function Hb(a){for(var b,c,d=a.aoColumns,e=V(a),a=a.oLanguage.oAria,f=0,g=d.length;f<g;f++){c=d[f];var j=c.asSorting;b=c.sTitle.replace(/<.*?>/g,
        "");var i=c.nTh;i.removeAttribute("aria-sort");c.bSortable&&(0<e.length&&e[0].col==f?(i.setAttribute("aria-sort","asc"==e[0].dir?"ascending":"descending"),c=j[e[0].index+1]||j[0]):c=j[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);i.setAttribute("aria-label",b)}}function Ua(a,b,c,d){var e=a.aaSorting,f=a.aoColumns[b].asSorting,g=function(a,b){var c=a._idx;c===k&&(c=h.inArray(a[1],f));return c+1<f.length?c+1:b?null:0};"number"===typeof e[0]&&(e=a.aaSorting=[e]);c&&a.oFeatures.bSortMulti?(c=h.inArray(b,
        D(e,"0")),-1!==c?(b=g(e[c],!0),null===b&&1===e.length&&(b=0),null===b?e.splice(c,1):(e[c][1]=f[b],e[c]._idx=b)):(e.push([b,f[0],0]),e[e.length-1]._idx=0)):e.length&&e[0][0]==b?(b=g(e[0]),e.length=1,e[0][1]=f[b],e[0]._idx=b):(e.length=0,e.push([b,f[0]]),e[0]._idx=0);S(a);"function"==typeof d&&d(a)}function La(a,b,c,d){var e=a.aoColumns[c];Va(b,{},function(b){!1!==e.bSortable&&(a.oFeatures.bProcessing?(C(a,!0),setTimeout(function(){Ua(a,c,b.shiftKey,d);"ssp"!==y(a)&&C(a,!1)},0)):Ua(a,c,b.shiftKey,d))})}
    function wa(a){var b=a.aLastSort,c=a.oClasses.sSortColumn,d=V(a),e=a.oFeatures,f,g;if(e.bSort&&e.bSortClasses){e=0;for(f=b.length;e<f;e++)g=b[e].src,h(D(a.aoData,"anCells",g)).removeClass(c+(2>e?e+1:3));e=0;for(f=d.length;e<f;e++)g=d[e].src,h(D(a.aoData,"anCells",g)).addClass(c+(2>e?e+1:3))}a.aLastSort=d}function Gb(a,b){var c=a.aoColumns[b],d=m.ext.order[c.sSortDataType],e;d&&(e=d.call(a.oInstance,a,b,$(a,b)));for(var f,g=m.ext.type.order[c.sType+"-pre"],j=0,i=a.aoData.length;j<i;j++)if(c=a.aoData[j],
        c._aSortData||(c._aSortData=[]),!c._aSortData[b]||d)f=d?e[j]:B(a,j,b,"sort"),c._aSortData[b]=g?g(f):f}function xa(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var b={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:h.extend(!0,[],a.aaSorting),search:zb(a.oPreviousSearch),columns:h.map(a.aoColumns,function(b,d){return{visible:b.bVisible,search:zb(a.aoPreSearchCols[d])}})};r(a,"aoStateSaveParams","stateSaveParams",[a,b]);a.oSavedState=b;a.fnStateSaveCallback.call(a.oInstance,a,
        b)}}function Ib(a,b,c){var d,e,f=a.aoColumns,b=function(b){if(b&&b.time){var g=r(a,"aoStateLoadParams","stateLoadParams",[a,b]);if(-1===h.inArray(!1,g)&&(g=a.iStateDuration,!(0<g&&b.time<+new Date-1E3*g)&&!(b.columns&&f.length!==b.columns.length))){a.oLoadedState=h.extend(!0,{},b);b.start!==k&&(a._iDisplayStart=b.start,a.iInitDisplayStart=b.start);b.length!==k&&(a._iDisplayLength=b.length);b.order!==k&&(a.aaSorting=[],h.each(b.order,function(b,c){a.aaSorting.push(c[0]>=f.length?[0,c[1]]:c)}));b.search!==
    k&&h.extend(a.oPreviousSearch,Ab(b.search));if(b.columns){d=0;for(e=b.columns.length;d<e;d++)g=b.columns[d],g.visible!==k&&(f[d].bVisible=g.visible),g.search!==k&&h.extend(a.aoPreSearchCols[d],Ab(g.search))}r(a,"aoStateLoaded","stateLoaded",[a,b])}}c()};if(a.oFeatures.bStateSave){var g=a.fnStateLoadCallback.call(a.oInstance,a,b);g!==k&&b(g)}else c()}function ya(a){var b=m.settings,a=h.inArray(a,D(b,"nTable"));return-1!==a?b[a]:null}function J(a,b,c,d){c="DataTables warning: "+(a?"table id="+a.sTableId+
        " - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(b)E.console&&console.log&&console.log(c);else if(b=m.ext,b=b.sErrMode||b.errMode,a&&r(a,null,"error",[a,d,c]),"alert"==b)alert(c);else{if("throw"==b)throw Error(c);"function"==typeof b&&b(a,d,c)}}function F(a,b,c,d){h.isArray(c)?h.each(c,function(c,d){h.isArray(d)?F(a,b,d[0],d[1]):F(a,b,d)}):(d===k&&(d=c),b[c]!==k&&(a[d]=b[c]))}function Jb(a,b,c){var d,e;for(e in b)b.hasOwnProperty(e)&&(d=b[e],
        h.isPlainObject(d)?(h.isPlainObject(a[e])||(a[e]={}),h.extend(!0,a[e],d)):a[e]=c&&"data"!==e&&"aaData"!==e&&h.isArray(d)?d.slice():d);return a}function Va(a,b,c){h(a).on("click.DT",b,function(b){a.blur();c(b)}).on("keypress.DT",b,function(a){13===a.which&&(a.preventDefault(),c(a))}).on("selectstart.DT",function(){return!1})}function z(a,b,c,d){c&&a[b].push({fn:c,sName:d})}function r(a,b,c,d){var e=[];b&&(e=h.map(a[b].slice().reverse(),function(b){return b.fn.apply(a.oInstance,d)}));null!==c&&(b=h.Event(c+
        ".dt"),h(a.nTable).trigger(b,d),e.push(b.result));return e}function Ra(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),d=a._iDisplayLength;b>=c&&(b=c-d);b-=b%d;if(-1===d||0>b)b=0;a._iDisplayStart=b}function Ma(a,b){var c=a.renderer,d=m.ext.renderer[b];return h.isPlainObject(c)&&c[b]?d[c[b]]||d._:"string"===typeof c?d[c]||d._:d._}function y(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function ha(a,b){var c=[],c=Kb.numbers_length,d=Math.floor(c/2);b<=c?c=W(0,b):a<=d?(c=W(0,
        c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-d?c=W(b-(c-2),b):(c=W(a-d+2,a+d-1),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function cb(a){h.each({num:function(b){return za(b,a)},"num-fmt":function(b){return za(b,a,Wa)},"html-num":function(b){return za(b,a,Aa)},"html-num-fmt":function(b){return za(b,a,Aa,Wa)}},function(b,c){x.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(x.type.search[b+a]=x.type.search.html)})}function Lb(a){return function(){var b=
        [ya(this[m.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return m.ext.internal[a].apply(this,b)}}var m=function(a){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new s(ya(this[x.iApiIndex])):new s(this)};this.fnAddData=function(a,b){var c=this.api(!0),d=h.isArray(a)&&(h.isArray(a[0])||h.isPlainObject(a[0]))?c.rows.add(a):c.row.add(a);(b===k||b)&&c.draw();return d.flatten().toArray()};this.fnAdjustColumnSizing=
        function(a){var b=this.api(!0).columns.adjust(),c=b.settings()[0],d=c.oScroll;a===k||a?b.draw(!1):(""!==d.sX||""!==d.sY)&&ka(c)};this.fnClearTable=function(a){var b=this.api(!0).clear();(a===k||a)&&b.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,b,c){var d=this.api(!0),a=d.rows(a),e=a.settings()[0],h=e.aoData[a[0][0]];a.remove();b&&b.call(this,e,h);(c===k||c)&&d.draw();return h};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(a)};
        this.fnFilter=function(a,b,c,d,e,h){e=this.api(!0);null===b||b===k?e.search(a,c,d,h):e.column(b).search(a,c,d,h);e.draw()};this.fnGetData=function(a,b){var c=this.api(!0);if(a!==k){var d=a.nodeName?a.nodeName.toLowerCase():"";return b!==k||"td"==d||"th"==d?c.cell(a,b).data():c.row(a).data()||null}return c.data().toArray()};this.fnGetNodes=function(a){var b=this.api(!0);return a!==k?b.row(a).node():b.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();
            return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(a,b){var c=this.api(!0).page(a);(b===k||b)&&c.draw(!1)};this.fnSetColumnVis=function(a,b,c){a=this.api(!0).column(a).visible(b);(c===k||c)&&a.columns.adjust().draw()};this.fnSettings=function(){return ya(this[x.iApiIndex])};
        this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,b,c,d,e){var h=this.api(!0);c===k||null===c?h.row(b).data(a):h.cell(b,c).data(a);(e===k||e)&&h.columns.adjust();(d===k||d)&&h.draw();return 0};this.fnVersionCheck=x.fnVersionCheck;var b=this,c=a===k,d=this.length;c&&(a={});this.oApi=this.internal=x.internal;for(var e in m.ext.internal)e&&(this[e]=Lb(e));this.each(function(){var e={},g=1<d?Jb(e,a,!0):
            a,j=0,i,e=this.getAttribute("id"),n=!1,l=m.defaults,q=h(this);if("table"!=this.nodeName.toLowerCase())J(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{db(l);eb(l.column);I(l,l,!0);I(l.column,l.column,!0);I(l,h.extend(g,q.data()));var t=m.settings,j=0;for(i=t.length;j<i;j++){var o=t[j];if(o.nTable==this||o.nTHead.parentNode==this||o.nTFoot&&o.nTFoot.parentNode==this){var s=g.bRetrieve!==k?g.bRetrieve:l.bRetrieve;if(c||s)return o.oInstance;if(g.bDestroy!==k?g.bDestroy:l.bDestroy){o.oInstance.fnDestroy();
            break}else{J(o,0,"Cannot reinitialise DataTable",3);return}}if(o.sTableId==this.id){t.splice(j,1);break}}if(null===e||""===e)this.id=e="DataTables_Table_"+m.ext._unique++;var p=h.extend(!0,{},m.models.oSettings,{sDestroyWidth:q[0].style.width,sInstance:e,sTableId:e});p.nTable=this;p.oApi=b.internal;p.oInit=g;t.push(p);p.oInstance=1===b.length?b:q.dataTable();db(g);g.oLanguage&&Ca(g.oLanguage);g.aLengthMenu&&!g.iDisplayLength&&(g.iDisplayLength=h.isArray(g.aLengthMenu[0])?g.aLengthMenu[0][0]:g.aLengthMenu[0]);
            g=Jb(h.extend(!0,{},l),g);F(p.oFeatures,g,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));F(p,g,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],
                ["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"]]);F(p.oScroll,g,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);F(p.oLanguage,g,"fnInfoCallback");z(p,"aoDrawCallback",g.fnDrawCallback,"user");z(p,"aoServerParams",g.fnServerParams,"user");z(p,"aoStateSaveParams",g.fnStateSaveParams,"user");z(p,"aoStateLoadParams",g.fnStateLoadParams,"user");z(p,"aoStateLoaded",g.fnStateLoaded,"user");z(p,"aoRowCallback",
                g.fnRowCallback,"user");z(p,"aoRowCreatedCallback",g.fnCreatedRow,"user");z(p,"aoHeaderCallback",g.fnHeaderCallback,"user");z(p,"aoFooterCallback",g.fnFooterCallback,"user");z(p,"aoInitComplete",g.fnInitComplete,"user");z(p,"aoPreDrawCallback",g.fnPreDrawCallback,"user");p.rowIdFn=Q(g.rowId);fb(p);var u=p.oClasses;h.extend(u,m.ext.classes,g.oClasses);q.addClass(u.sTable);p.iInitDisplayStart===k&&(p.iInitDisplayStart=g.iDisplayStart,p._iDisplayStart=g.iDisplayStart);null!==g.iDeferLoading&&(p.bDeferLoading=
                !0,e=h.isArray(g.iDeferLoading),p._iRecordsDisplay=e?g.iDeferLoading[0]:g.iDeferLoading,p._iRecordsTotal=e?g.iDeferLoading[1]:g.iDeferLoading);var v=p.oLanguage;h.extend(!0,v,g.oLanguage);v.sUrl&&(h.ajax({dataType:"json",url:v.sUrl,success:function(a){Ca(a);I(l.oLanguage,a);h.extend(true,v,a);ga(p)},error:function(){ga(p)}}),n=!0);null===g.asStripeClasses&&(p.asStripeClasses=[u.sStripeOdd,u.sStripeEven]);var e=p.asStripeClasses,x=q.children("tbody").find("tr").eq(0);-1!==h.inArray(!0,h.map(e,function(a){return x.hasClass(a)}))&&
            (h("tbody tr",this).removeClass(e.join(" ")),p.asDestroyStripes=e.slice());e=[];t=this.getElementsByTagName("thead");0!==t.length&&(da(p.aoHeader,t[0]),e=ra(p));if(null===g.aoColumns){t=[];j=0;for(i=e.length;j<i;j++)t.push(null)}else t=g.aoColumns;j=0;for(i=t.length;j<i;j++)Da(p,e?e[j]:null);hb(p,g.aoColumnDefs,t,function(a,b){ja(p,a,b)});if(x.length){var w=function(a,b){return a.getAttribute("data-"+b)!==null?b:null};h(x[0]).children("th, td").each(function(a,b){var c=p.aoColumns[a];if(c.mData===
                a){var d=w(b,"sort")||w(b,"order"),e=w(b,"filter")||w(b,"search");if(d!==null||e!==null){c.mData={_:a+".display",sort:d!==null?a+".@data-"+d:k,type:d!==null?a+".@data-"+d:k,filter:e!==null?a+".@data-"+e:k};ja(p,a)}}})}var T=p.oFeatures,e=function(){if(g.aaSorting===k){var a=p.aaSorting;j=0;for(i=a.length;j<i;j++)a[j][1]=p.aoColumns[j].asSorting[0]}wa(p);T.bSort&&z(p,"aoDrawCallback",function(){if(p.bSorted){var a=V(p),b={};h.each(a,function(a,c){b[c.src]=c.dir});r(p,null,"order",[p,a,b]);Hb(p)}});
                z(p,"aoDrawCallback",function(){(p.bSorted||y(p)==="ssp"||T.bDeferRender)&&wa(p)},"sc");var a=q.children("caption").each(function(){this._captionSide=h(this).css("caption-side")}),b=q.children("thead");b.length===0&&(b=h("<thead/>").appendTo(q));p.nTHead=b[0];b=q.children("tbody");b.length===0&&(b=h("<tbody/>").appendTo(q));p.nTBody=b[0];b=q.children("tfoot");if(b.length===0&&a.length>0&&(p.oScroll.sX!==""||p.oScroll.sY!==""))b=h("<tfoot/>").appendTo(q);if(b.length===0||b.children().length===0)q.addClass(u.sNoFooter);
                else if(b.length>0){p.nTFoot=b[0];da(p.aoFooter,p.nTFoot)}if(g.aaData)for(j=0;j<g.aaData.length;j++)M(p,g.aaData[j]);else(p.bDeferLoading||y(p)=="dom")&&ma(p,h(p.nTBody).children("tr"));p.aiDisplay=p.aiDisplayMaster.slice();p.bInitialised=true;n===false&&ga(p)};g.bStateSave?(T.bStateSave=!0,z(p,"aoDrawCallback",xa,"state_save"),Ib(p,g,e)):e()}});b=null;return this},x,s,o,u,Xa={},Mb=/[\r\n]/g,Aa=/<.*?>/g,Zb=/^\d{2,4}[\.\/\-]\d{1,2}[\.\/\-]\d{1,2}([T ]{1}\d{1,2}[:\.]\d{2}([\.:]\d{2})?)?$/,$b=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)",
        "g"),Wa=/[',$£€¥%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,L=function(a){return!a||!0===a||"-"===a?!0:!1},Nb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Ob=function(a,b){Xa[b]||(Xa[b]=RegExp(Pa(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(Xa[b],"."):a},Ya=function(a,b,c){var d="string"===typeof a;if(L(a))return!0;b&&d&&(a=Ob(a,b));c&&d&&(a=a.replace(Wa,""));return!isNaN(parseFloat(a))&&isFinite(a)},Pb=function(a,b,c){return L(a)?!0:!(L(a)||"string"===
        typeof a)?null:Ya(a.replace(Aa,""),b,c)?!0:null},D=function(a,b,c){var d=[],e=0,f=a.length;if(c!==k)for(;e<f;e++)a[e]&&a[e][b]&&d.push(a[e][b][c]);else for(;e<f;e++)a[e]&&d.push(a[e][b]);return d},ia=function(a,b,c,d){var e=[],f=0,g=b.length;if(d!==k)for(;f<g;f++)a[b[f]][c]&&e.push(a[b[f]][c][d]);else for(;f<g;f++)e.push(a[b[f]][c]);return e},W=function(a,b){var c=[],d;b===k?(b=0,d=a):(d=b,b=a);for(var e=b;e<d;e++)c.push(e);return c},Qb=function(a){for(var b=[],c=0,d=a.length;c<d;c++)a[c]&&b.push(a[c]);
        return b},qa=function(a){var b;a:{if(!(2>a.length)){b=a.slice().sort();for(var c=b[0],d=1,e=b.length;d<e;d++){if(b[d]===c){b=!1;break a}c=b[d]}}b=!0}if(b)return a.slice();b=[];var e=a.length,f,g=0,d=0;a:for(;d<e;d++){c=a[d];for(f=0;f<g;f++)if(b[f]===c)continue a;b.push(c);g++}return b};m.util={throttle:function(a,b){var c=b!==k?b:200,d,e;return function(){var b=this,g=+new Date,j=arguments;d&&g<d+c?(clearTimeout(e),e=setTimeout(function(){d=k;a.apply(b,j)},c)):(d=g,a.apply(b,j))}},escapeRegex:function(a){return a.replace($b,
        "\\$1")}};var A=function(a,b,c){a[b]!==k&&(a[c]=a[b])},ba=/\[.*?\]$/,U=/\(\)$/,Pa=m.util.escapeRegex,va=h("<div>")[0],Wb=va.textContent!==k,Yb=/<.*?>/g,Na=m.util.throttle,Rb=[],w=Array.prototype,ac=function(a){var b,c,d=m.settings,e=h.map(d,function(a){return a.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return b=h.inArray(a,e),-1!==b?[d[b]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?c=h(a):a instanceof
        h&&(c=a)}else return[];if(c)return c.map(function(){b=h.inArray(this,e);return-1!==b?d[b]:null}).toArray()};s=function(a,b){if(!(this instanceof s))return new s(a,b);var c=[],d=function(a){(a=ac(a))&&(c=c.concat(a))};if(h.isArray(a))for(var e=0,f=a.length;e<f;e++)d(a[e]);else d(a);this.context=qa(c);b&&h.merge(this,b);this.selector={rows:null,cols:null,opts:null};s.extend(this,this,Rb)};m.Api=s;h.extend(s.prototype,{any:function(){return 0!==this.count()},concat:w.concat,context:[],count:function(){return this.flatten().length},
        each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new s(b[a],this[a]):null},filter:function(a){var b=[];if(w.filter)b=w.filter.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new s(this.context,b)},flatten:function(){var a=[];return new s(this.context,a.concat.apply(a,this.toArray()))},join:w.join,indexOf:w.indexOf||function(a,b){for(var c=b||0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       d=this.length;c<d;c++)if(this[c]===a)return c;return-1},iterator:function(a,b,c,d){var e=[],f,g,j,h,n,l=this.context,m,o,u=this.selector;"string"===typeof a&&(d=c,c=b,b=a,a=!1);g=0;for(j=l.length;g<j;g++){var r=new s(l[g]);if("table"===b)f=c.call(r,l[g],g),f!==k&&e.push(f);else if("columns"===b||"rows"===b)f=c.call(r,l[g],this[g],g),f!==k&&e.push(f);else if("column"===b||"column-rows"===b||"row"===b||"cell"===b){o=this[g];"column-rows"===b&&(m=Ba(l[g],u.opts));h=0;for(n=o.length;h<n;h++)f=o[h],f=
            "cell"===b?c.call(r,l[g],f.row,f.column,g,h):c.call(r,l[g],f,g,h,m),f!==k&&e.push(f)}}return e.length||d?(a=new s(l,a?e.concat.apply([],e):e),b=a.selector,b.rows=u.rows,b.cols=u.cols,b.opts=u.opts,a):this},lastIndexOf:w.lastIndexOf||function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(w.map)b=w.map.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)b.push(a.call(this,this[c],c));return new s(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},
        pop:w.pop,push:w.push,reduce:w.reduce||function(a,b){return gb(this,a,b,0,this.length,1)},reduceRight:w.reduceRight||function(a,b){return gb(this,a,b,this.length-1,-1,-1)},reverse:w.reverse,selector:null,shift:w.shift,slice:function(){return new s(this.context,this)},sort:w.sort,splice:w.splice,toArray:function(){return w.slice.call(this)},to$:function(){return h(this)},toJQuery:function(){return h(this)},unique:function(){return new s(this.context,qa(this))},unshift:w.unshift});s.extend=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b,c){if(c.length&&b&&(b instanceof s||b.__dt_wrapper)){var d,e,f,g=function(a,b,c){return function(){var d=b.apply(a,arguments);s.extend(d,d,c.methodExt);return d}};d=0;for(e=c.length;d<e;d++)f=c[d],b[f.name]="function"===typeof f.val?g(a,f.val,f):h.isPlainObject(f.val)?{}:f.val,b[f.name].__dt_wrapper=!0,s.extend(a,b[f.name],f.propExt)}};s.register=o=function(a,b){if(h.isArray(a))for(var c=0,d=a.length;c<d;c++)s.register(a[c],b);else for(var e=a.split("."),f=Rb,g,j,c=0,d=e.length;c<d;c++){g=(j=-1!==
        e[c].indexOf("()"))?e[c].replace("()",""):e[c];var i;a:{i=0;for(var n=f.length;i<n;i++)if(f[i].name===g){i=f[i];break a}i=null}i||(i={name:g,val:{},methodExt:[],propExt:[]},f.push(i));c===d-1?i.val=b:f=j?i.methodExt:i.propExt}};s.registerPlural=u=function(a,b,c){s.register(a,c);s.register(b,function(){var a=c.apply(this,arguments);return a===this?this:a instanceof s?a.length?h.isArray(a[0])?new s(a.context,a[0]):a[0]:k:a})};o("tables()",function(a){var b;if(a){b=s;var c=this.context;if("number"===
        typeof a)a=[c[a]];else var d=h.map(c,function(a){return a.nTable}),a=h(d).filter(a).map(function(){var a=h.inArray(this,d);return c[a]}).toArray();b=new b(a)}else b=this;return b});o("table()",function(a){var a=this.tables(a),b=a.context;return b.length?new s(b[0]):a});u("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});u("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});u("tables().header()",
        "table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});u("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});u("tables().containers()","table().container()",function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});o("draw()",function(a){return this.iterator("table",function(b){"page"===a?N(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),S(b,!1===a))})});o("page()",function(a){return a===
    k?this.page.info().page:this.iterator("table",function(b){Sa(b,a)})});o("page.info()",function(){if(0===this.context.length)return k;var a=this.context[0],b=a._iDisplayStart,c=a.oFeatures.bPaginate?a._iDisplayLength:-1,d=a.fnRecordsDisplay(),e=-1===c;return{page:e?0:Math.floor(b/c),pages:e?1:Math.ceil(d/c),start:b,end:a.fnDisplayEnd(),length:c,recordsTotal:a.fnRecordsTotal(),recordsDisplay:d,serverSide:"ssp"===y(a)}});o("page.len()",function(a){return a===k?0!==this.context.length?this.context[0]._iDisplayLength:
        k:this.iterator("table",function(b){Qa(b,a)})});var Sb=function(a,b,c){if(c){var d=new s(a);d.one("draw",function(){c(d.ajax.json())})}if("ssp"==y(a))S(a,b);else{C(a,!0);var e=a.jqXHR;e&&4!==e.readyState&&e.abort();sa(a,[],function(c){na(a);for(var c=ta(a,c),d=0,e=c.length;d<e;d++)M(a,c[d]);S(a,b);C(a,!1)})}};o("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});o("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});o("ajax.reload()",function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               b){return this.iterator("table",function(c){Sb(c,!1===b,a)})});o("ajax.url()",function(a){var b=this.context;if(a===k){if(0===b.length)return k;b=b[0];return b.ajax?h.isPlainObject(b.ajax)?b.ajax.url:b.ajax:b.sAjaxSource}return this.iterator("table",function(b){h.isPlainObject(b.ajax)?b.ajax.url=a:b.ajax=a})});o("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Sb(c,!1===b,a)})});var Za=function(a,b,c,d,e){var f=[],g,j,i,n,l,m;i=typeof b;if(!b||"string"===i||"function"===
        i||b.length===k)b=[b];i=0;for(n=b.length;i<n;i++){j=b[i]&&b[i].split&&!b[i].match(/[\[\(:]/)?b[i].split(","):[b[i]];l=0;for(m=j.length;l<m;l++)(g=c("string"===typeof j[l]?h.trim(j[l]):j[l]))&&g.length&&(f=f.concat(g))}a=x.selector[a];if(a.length){i=0;for(n=a.length;i<n;i++)f=a[i](d,e,f)}return qa(f)},$a=function(a){a||(a={});a.filter&&a.search===k&&(a.search=a.filter);return h.extend({search:"none",order:"current",page:"all"},a)},ab=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=
        a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Ba=function(a,b){var c,d,e,f=[],g=a.aiDisplay;c=a.aiDisplayMaster;var j=b.search;d=b.order;e=b.page;if("ssp"==y(a))return"removed"===j?[]:W(0,c.length);if("current"==e){c=a._iDisplayStart;for(d=a.fnDisplayEnd();c<d;c++)f.push(g[c])}else if("current"==d||"applied"==d)f="none"==j?c.slice():"applied"==j?g.slice():h.map(c,function(a){return-1===h.inArray(a,g)?a:null});else if("index"==d||"original"==d){c=0;for(d=a.aoData.length;c<
    d;c++)"none"==j?f.push(c):(e=h.inArray(c,g),(-1===e&&"removed"==j||0<=e&&"applied"==j)&&f.push(c))}return f};o("rows()",function(a,b){a===k?a="":h.isPlainObject(a)&&(b=a,a="");var b=$a(b),c=this.iterator("table",function(c){var e=b,f;return Za("row",a,function(a){var b=Nb(a);if(b!==null&&!e)return[b];f||(f=Ba(c,e));if(b!==null&&h.inArray(b,f)!==-1)return[b];if(a===null||a===k||a==="")return f;if(typeof a==="function")return h.map(f,function(b){var e=c.aoData[b];return a(b,e._aData,e.nTr)?b:null});
        b=Qb(ia(c.aoData,f,"nTr"));if(a.nodeName){if(a._DT_RowIndex!==k)return[a._DT_RowIndex];if(a._DT_CellIndex)return[a._DT_CellIndex.row];b=h(a).closest("*[data-dt-row]");return b.length?[b.data("dt-row")]:[]}if(typeof a==="string"&&a.charAt(0)==="#"){var i=c.aIds[a.replace(/^#/,"")];if(i!==k)return[i.idx]}return h(b).filter(a).map(function(){return this._DT_RowIndex}).toArray()},c,e)},1);c.selector.rows=a;c.selector.opts=b;return c});o("rows().nodes()",function(){return this.iterator("row",function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             b){return a.aoData[b].nTr||k},1)});o("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return ia(a.aoData,b,"_aData")},1)});u("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var d=b.aoData[c];return"search"===a?d._aFilterData:d._aSortData},1)});u("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){ca(b,c,a)})});u("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  b){return b},1)});u("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,d=0,e=c.length;d<e;d++)for(var f=0,g=this[d].length;f<g;f++){var h=c[d].rowIdFn(c[d].aoData[this[d][f]]._aData);b.push((!0===a?"#":"")+h)}return new s(c,b)});u("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,c,d){var e=b.aoData,f=e[c],g,h,i,n,l;e.splice(c,1);g=0;for(h=e.length;g<h;g++)if(i=e[g],l=i.anCells,null!==i.nTr&&(i.nTr._DT_RowIndex=g),null!==l){i=0;for(n=l.length;i<
    n;i++)l[i]._DT_CellIndex.row=g}oa(b.aiDisplayMaster,c);oa(b.aiDisplay,c);oa(a[d],c,!1);0<b._iRecordsDisplay&&b._iRecordsDisplay--;Ra(b);c=b.rowIdFn(f._aData);c!==k&&delete b.aIds[c]});this.iterator("table",function(a){for(var c=0,d=a.aoData.length;c<d;c++)a.aoData[c].idx=c});return this});o("rows.add()",function(a){var b=this.iterator("table",function(b){var c,f,g,h=[];f=0;for(g=a.length;f<g;f++)c=a[f],c.nodeName&&"TR"===c.nodeName.toUpperCase()?h.push(ma(b,c)[0]):h.push(M(b,c));return h},1),c=this.rows(-1);
        c.pop();h.merge(c,b);return c});o("row()",function(a,b){return ab(this.rows(a,b))});o("row().data()",function(a){var b=this.context;if(a===k)return b.length&&this.length?b[0].aoData[this[0]]._aData:k;b[0].aoData[this[0]]._aData=a;ca(b[0],this[0],"data");return this});o("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});o("row.add()",function(a){a instanceof h&&a.length&&(a=a[0]);var b=this.iterator("table",function(b){return a.nodeName&&
    "TR"===a.nodeName.toUpperCase()?ma(b,a)[0]:M(b,a)});return this.row(b[0])});var bb=function(a,b){var c=a.context;if(c.length&&(c=c[0].aoData[b!==k?b:a[0]])&&c._details)c._details.remove(),c._detailsShow=k,c._details=k},Tb=function(a,b){var c=a.context;if(c.length&&a.length){var d=c[0].aoData[a[0]];if(d._details){(d._detailsShow=b)?d._details.insertAfter(d.nTr):d._details.detach();var e=c[0],f=new s(e),g=e.aoData;f.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<D(g,
        "_details").length&&(f.on("draw.dt.DT_details",function(a,b){e===b&&f.rows({page:"current"}).eq(0).each(function(a){a=g[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),f.on("column-visibility.dt.DT_details",function(a,b){if(e===b)for(var c,d=aa(b),f=0,h=g.length;f<h;f++)c=g[f],c._details&&c._details.children("td[colspan]").attr("colspan",d)}),f.on("destroy.dt.DT_details",function(a,b){if(e===b)for(var c=0,d=g.length;c<d;c++)g[c]._details&&bb(f,c)}))}}};o("row().child()",function(a,b){var c=this.context;
        if(a===k)return c.length&&this.length?c[0].aoData[this[0]]._details:k;if(!0===a)this.child.show();else if(!1===a)bb(this);else if(c.length&&this.length){var d=c[0],c=c[0].aoData[this[0]],e=[],f=function(a,b){if(h.isArray(a)||a instanceof h)for(var c=0,k=a.length;c<k;c++)f(a[c],b);else a.nodeName&&"tr"===a.nodeName.toLowerCase()?e.push(a):(c=h("<tr><td/></tr>").addClass(b),h("td",c).addClass(b).html(a)[0].colSpan=aa(d),e.push(c[0]))};f(a,b);c._details&&c._details.detach();c._details=h(e);c._detailsShow&&
        c._details.insertAfter(c.nTr)}return this});o(["row().child.show()","row().child().show()"],function(){Tb(this,!0);return this});o(["row().child.hide()","row().child().hide()"],function(){Tb(this,!1);return this});o(["row().child.remove()","row().child().remove()"],function(){bb(this);return this});o("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var bc=/^([^:]+):(name|visIdx|visible)$/,Ub=function(a,b,c,d,e){for(var c=
        [],d=0,f=e.length;d<f;d++)c.push(B(a,e[d],b));return c};o("columns()",function(a,b){a===k?a="":h.isPlainObject(a)&&(b=a,a="");var b=$a(b),c=this.iterator("table",function(c){var e=a,f=b,g=c.aoColumns,j=D(g,"sName"),i=D(g,"nTh");return Za("column",e,function(a){var b=Nb(a);if(a==="")return W(g.length);if(b!==null)return[b>=0?b:g.length+b];if(typeof a==="function"){var e=Ba(c,f);return h.map(g,function(b,f){return a(f,Ub(c,f,0,0,e),i[f])?f:null})}var k=typeof a==="string"?a.match(bc):"";if(k)switch(k[2]){case "visIdx":case "visible":b=
        parseInt(k[1],10);if(b<0){var m=h.map(g,function(a,b){return a.bVisible?b:null});return[m[m.length+b]]}return[Z(c,b)];case "name":return h.map(j,function(a,b){return a===k[1]?b:null});default:return[]}if(a.nodeName&&a._DT_CellIndex)return[a._DT_CellIndex.column];b=h(i).filter(a).map(function(){return h.inArray(this,i)}).toArray();if(b.length||!a.nodeName)return b;b=h(a).closest("*[data-dt-column]");return b.length?[b.data("dt-column")]:[]},c,f)},1);c.selector.cols=a;c.selector.opts=b;return c});u("columns().header()",
        "column().header()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});u("columns().footer()","column().footer()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});u("columns().data()","column().data()",function(){return this.iterator("column-rows",Ub,1)});u("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});u("columns().cache()","column().cache()",
        function(a){return this.iterator("column-rows",function(b,c,d,e,f){return ia(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});u("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,d,e){return ia(a.aoData,e,"anCells",b)},1)});u("columns().visible()","column().visible()",function(a,b){var c=this.iterator("column",function(b,c){if(a===k)return b.aoColumns[c].bVisible;var f=b.aoColumns,g=f[c],j=b.aoData,i,n,l;if(a!==k&&g.bVisible!==a){if(a){var m=
        h.inArray(!0,D(f,"bVisible"),c+1);i=0;for(n=j.length;i<n;i++)l=j[i].nTr,f=j[i].anCells,l&&l.insertBefore(f[c],f[m]||null)}else h(D(b.aoData,"anCells",c)).detach();g.bVisible=a;ea(b,b.aoHeader);ea(b,b.aoFooter);xa(b)}});a!==k&&(this.iterator("column",function(c,e){r(c,null,"column-visibility",[c,e,a,b])}),(b===k||b)&&this.columns.adjust());return c});u("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?$(b,c):c},1)});o("columns.adjust()",
        function(){return this.iterator("table",function(a){Y(a)},1)});o("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return Z(c,b);if("fromData"===a||"toVisible"===a)return $(c,b)}});o("column()",function(a,b){return ab(this.columns(a,b))});o("cells()",function(a,b,c){h.isPlainObject(a)&&(a.row===k?(c=a,a=null):(c=b,b=null));h.isPlainObject(b)&&(c=b,b=null);if(null===b||b===k)return this.iterator("table",function(b){var d=a,e=$a(c),f=
        b.aoData,g=Ba(b,e),j=Qb(ia(f,g,"anCells")),i=h([].concat.apply([],j)),l,n=b.aoColumns.length,m,o,u,s,r,v;return Za("cell",d,function(a){var c=typeof a==="function";if(a===null||a===k||c){m=[];o=0;for(u=g.length;o<u;o++){l=g[o];for(s=0;s<n;s++){r={row:l,column:s};if(c){v=f[l];a(r,B(b,l,s),v.anCells?v.anCells[s]:null)&&m.push(r)}else m.push(r)}}return m}if(h.isPlainObject(a))return[a];c=i.filter(a).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray();if(c.length||
        !a.nodeName)return c;v=h(a).closest("*[data-dt-row]");return v.length?[{row:v.data("dt-row"),column:v.data("dt-column")}]:[]},b,e)});var d=this.columns(b,c),e=this.rows(a,c),f,g,j,i,n,l=this.iterator("table",function(a,b){f=[];g=0;for(j=e[b].length;g<j;g++){i=0;for(n=d[b].length;i<n;i++)f.push({row:e[b][g],column:d[b][i]})}return f},1);h.extend(l.selector,{cols:b,rows:a,opts:c});return l});u("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(a,b,c){return(a=a.aoData[b])&&
    a.anCells?a.anCells[c]:k},1)});o("cells().data()",function(){return this.iterator("cell",function(a,b,c){return B(a,b,c)},1)});u("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,d){return b.aoData[c][a][d]},1)});u("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return B(b,c,d,a)},1)});u("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b,c){return{row:b,column:c,columnVisible:$(a,c)}},1)});u("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){ca(b,c,a,d)})});o("cell()",function(a,b,c){return ab(this.cells(a,b,c))});o("cell().data()",function(a){var b=this.context,c=this[0];if(a===k)return b.length&&c.length?B(b[0],c[0].row,c[0].column):k;ib(b[0],c[0].row,c[0].column,a);ca(b[0],c[0].row,"data",c[0].column);return this});o("order()",function(a,b){var c=this.context;if(a===k)return 0!==
    c.length?c[0].aaSorting:k;"number"===typeof a?a=[[a,b]]:a.length&&!h.isArray(a[0])&&(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});o("order.listener()",function(a,b,c){return this.iterator("table",function(d){La(d,a,b,c)})});o("order.fixed()",function(a){if(!a){var b=this.context,b=b.length?b[0].aaSortingFixed:k;return h.isArray(b)?{pre:b}:b}return this.iterator("table",function(b){b.aaSortingFixed=h.extend(!0,{},a)})});o(["columns().order()",
        "column().order()"],function(a){var b=this;return this.iterator("table",function(c,d){var e=[];h.each(b[d],function(b,c){e.push([c,a])});c.aaSorting=e})});o("search()",function(a,b,c,d){var e=this.context;return a===k?0!==e.length?e[0].oPreviousSearch.sSearch:k:this.iterator("table",function(e){e.oFeatures.bFilter&&fa(e,h.extend({},e.oPreviousSearch,{sSearch:a+"",bRegex:null===b?!1:b,bSmart:null===c?!0:c,bCaseInsensitive:null===d?!0:d}),1)})});u("columns().search()","column().search()",function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            b,c,d){return this.iterator("column",function(e,f){var g=e.aoPreSearchCols;if(a===k)return g[f].sSearch;e.oFeatures.bFilter&&(h.extend(g[f],{sSearch:a+"",bRegex:null===b?!1:b,bSmart:null===c?!0:c,bCaseInsensitive:null===d?!0:d}),fa(e,e.oPreviousSearch,1))})});o("state()",function(){return this.context.length?this.context[0].oSavedState:null});o("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});o("state.loaded()",function(){return this.context.length?
        this.context[0].oLoadedState:null});o("state.save()",function(){return this.iterator("table",function(a){xa(a)})});m.versionCheck=m.fnVersionCheck=function(a){for(var b=m.version.split("."),a=a.split("."),c,d,e=0,f=a.length;e<f;e++)if(c=parseInt(b[e],10)||0,d=parseInt(a[e],10)||0,c!==d)return c>d;return!0};m.isDataTable=m.fnIsDataTable=function(a){var b=h(a).get(0),c=!1;if(a instanceof m.Api)return!0;h.each(m.settings,function(a,e){var f=e.nScrollHead?h("table",e.nScrollHead)[0]:null,g=e.nScrollFoot?
        h("table",e.nScrollFoot)[0]:null;if(e.nTable===b||f===b||g===b)c=!0});return c};m.tables=m.fnTables=function(a){var b=!1;h.isPlainObject(a)&&(b=a.api,a=a.visible);var c=h.map(m.settings,function(b){if(!a||a&&h(b.nTable).is(":visible"))return b.nTable});return b?new s(c):c};m.camelToHungarian=I;o("$()",function(a,b){var c=this.rows(b).nodes(),c=h(c);return h([].concat(c.filter(a).toArray(),c.find(a).toArray()))});h.each(["on","one","off"],function(a,b){o(b+"()",function(){var a=Array.prototype.slice.call(arguments);
        a[0]=h.map(a[0].split(/\s/),function(a){return!a.match(/\.dt\b/)?a+".dt":a}).join(" ");var d=h(this.tables().nodes());d[b].apply(d,a);return this})});o("clear()",function(){return this.iterator("table",function(a){na(a)})});o("settings()",function(){return new s(this.context,this.context)});o("init()",function(){var a=this.context;return a.length?a[0].oInit:null});o("data()",function(){return this.iterator("table",function(a){return D(a.aoData,"_aData")}).flatten()});o("destroy()",function(a){a=a||
        !1;return this.iterator("table",function(b){var c=b.nTableWrapper.parentNode,d=b.oClasses,e=b.nTable,f=b.nTBody,g=b.nTHead,j=b.nTFoot,i=h(e),f=h(f),k=h(b.nTableWrapper),l=h.map(b.aoData,function(a){return a.nTr}),o;b.bDestroying=!0;r(b,"aoDestroyCallback","destroy",[b]);a||(new s(b)).columns().visible(!0);k.off(".DT").find(":not(tbody *)").off(".DT");h(E).off(".DT-"+b.sInstance);e!=g.parentNode&&(i.children("thead").detach(),i.append(g));j&&e!=j.parentNode&&(i.children("tfoot").detach(),i.append(j));
        b.aaSorting=[];b.aaSortingFixed=[];wa(b);h(l).removeClass(b.asStripeClasses.join(" "));h("th, td",g).removeClass(d.sSortable+" "+d.sSortableAsc+" "+d.sSortableDesc+" "+d.sSortableNone);f.children().detach();f.append(l);g=a?"remove":"detach";i[g]();k[g]();!a&&c&&(c.insertBefore(e,b.nTableReinsertBefore),i.css("width",b.sDestroyWidth).removeClass(d.sTable),(o=b.asDestroyStripes.length)&&f.children().each(function(a){h(this).addClass(b.asDestroyStripes[a%o])}));c=h.inArray(b,m.settings);-1!==c&&m.settings.splice(c,
            1)})});h.each(["column","row","cell"],function(a,b){o(b+"s().every()",function(a){var d=this.selector.opts,e=this;return this.iterator(b,function(f,g,h,i,n){a.call(e[b](g,"cell"===b?h:d,"cell"===b?d:k),g,h,i,n)})})});o("i18n()",function(a,b,c){var d=this.context[0],a=Q(a)(d.oLanguage);a===k&&(a=b);c!==k&&h.isPlainObject(a)&&(a=a[c]!==k?a[c]:a._);return a.replace("%d",c)});m.version="1.10.16";m.settings=[];m.models={};m.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};m.models.oRow=
        {nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};m.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,
        sWidthOrig:null};m.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,
        this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+
        "_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",
        sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:h.extend({},m.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};
    X(m.defaults);m.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};X(m.defaults.column);m.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,
        bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],
        aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:k,oAjaxData:k,fnServerData:null,
        aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==y(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==y(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,
            b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,e=this.oFeatures,f=e.bPaginate;return e.bServerSide?!1===f||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!f||c>d||-1===a?d:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};m.ext=x={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},
        order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:m.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:m.version};h.extend(x,{afnFiltering:x.search,aTypes:x.type.detect,ofnSearch:x.type.search,oSort:x.type.order,afnSortData:x.order,aoFeatures:x.feature,oApi:x.internal,oStdClasses:x.classes,oPagination:x.pager});h.extend(m.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",
        sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",
        sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Kb=m.ext.pager;h.extend(Kb,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[ha(a,
        b)]},simple_numbers:function(a,b){return["previous",ha(a,b),"next"]},full_numbers:function(a,b){return["first","previous",ha(a,b),"next","last"]},first_last_numbers:function(a,b){return["first",ha(a,b),"last"]},_numbers:ha,numbers_length:7});h.extend(!0,m.ext.renderer,{pageButton:{_:function(a,b,c,d,e,f){var g=a.oClasses,j=a.oLanguage.oPaginate,i=a.oLanguage.oAria.paginate||{},n,l,m=0,o=function(b,d){var k,s,u,r,v=function(b){Sa(a,b.data.action,true)};k=0;for(s=d.length;k<s;k++){r=d[k];if(h.isArray(r)){u=
        h("<"+(r.DT_el||"div")+"/>").appendTo(b);o(u,r)}else{n=null;l="";switch(r){case "ellipsis":b.append('<span class="ellipsis">&#x2026;</span>');break;case "first":n=j.sFirst;l=r+(e>0?"":" "+g.sPageButtonDisabled);break;case "previous":n=j.sPrevious;l=r+(e>0?"":" "+g.sPageButtonDisabled);break;case "next":n=j.sNext;l=r+(e<f-1?"":" "+g.sPageButtonDisabled);break;case "last":n=j.sLast;l=r+(e<f-1?"":" "+g.sPageButtonDisabled);break;default:n=r+1;l=e===r?g.sPageButtonActive:""}if(n!==null){u=h("<a>",{"class":g.sPageButton+
    " "+l,"aria-controls":a.sTableId,"aria-label":i[r],"data-dt-idx":m,tabindex:a.iTabIndex,id:c===0&&typeof r==="string"?a.sTableId+"_"+r:null}).html(n).appendTo(b);Va(u,{action:r},v);m++}}}},s;try{s=h(b).find(G.activeElement).data("dt-idx")}catch(u){}o(h(b).empty(),d);s!==k&&h(b).find("[data-dt-idx="+s+"]").focus()}}});h.extend(m.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c)?"num"+c:null},function(a){if(a&&!(a instanceof Date)&&!Zb.test(a))return null;var b=Date.parse(a);
        return null!==b&&!isNaN(b)||L(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Pb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Pb(a,c,!0)?"html-num-fmt"+c:null},function(a){return L(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);h.extend(m.ext.type.search,{html:function(a){return L(a)?a:"string"===typeof a?a.replace(Mb," ").replace(Aa,""):""},string:function(a){return L(a)?
        a:"string"===typeof a?a.replace(Mb," "):a}});var za=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Ob(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};h.extend(x.type.order,{"date-pre":function(a){return Date.parse(a)||-Infinity},"html-pre":function(a){return L(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return L(a)?"":"string"===typeof a?a.toLowerCase():!a.toString?"":a.toString()},"string-asc":function(a,b){return a<
    b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});cb("");h.extend(!0,m.ext.renderer,{header:{_:function(a,b,c,d){h(a.nTable).on("order.dt.DT",function(e,f,g,h){if(a===f){e=c.idx;b.removeClass(c.sSortingClass+" "+d.sSortAsc+" "+d.sSortDesc).addClass(h[e]=="asc"?d.sSortAsc:h[e]=="desc"?d.sSortDesc:c.sSortingClass)}})},jqueryui:function(a,b,c,d){h("<div/>").addClass(d.sSortJUIWrapper).append(b.contents()).append(h("<span/>").addClass(d.sSortIcon+" "+c.sSortingClassJUI)).appendTo(b);
        h(a.nTable).on("order.dt.DT",function(e,f,g,h){if(a===f){e=c.idx;b.removeClass(d.sSortAsc+" "+d.sSortDesc).addClass(h[e]=="asc"?d.sSortAsc:h[e]=="desc"?d.sSortDesc:c.sSortingClass);b.find("span."+d.sSortIcon).removeClass(d.sSortJUIAsc+" "+d.sSortJUIDesc+" "+d.sSortJUI+" "+d.sSortJUIAscAllowed+" "+d.sSortJUIDescAllowed).addClass(h[e]=="asc"?d.sSortJUIAsc:h[e]=="desc"?d.sSortJUIDesc:c.sSortingClassJUI)}})}}});var Vb=function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
        "&quot;"):a};m.render={number:function(a,b,c,d,e){return{display:function(f){if("number"!==typeof f&&"string"!==typeof f)return f;var g=0>f?"-":"",h=parseFloat(f);if(isNaN(h))return Vb(f);h=h.toFixed(c);f=Math.abs(h);h=parseInt(f,10);f=c?b+(f-h).toFixed(c).substring(2):"";return g+(d||"")+h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f+(e||"")}}},text:function(){return{display:Vb}}};h.extend(m.ext.internal,{_fnExternApiFunc:Lb,_fnBuildAjax:sa,_fnAjaxUpdate:kb,_fnAjaxParameters:tb,_fnAjaxUpdateDraw:ub,
        _fnAjaxDataSrc:ta,_fnAddColumn:Da,_fnColumnOptions:ja,_fnAdjustColumnSizing:Y,_fnVisibleToColumnIndex:Z,_fnColumnIndexToVisible:$,_fnVisbleColumns:aa,_fnGetColumns:la,_fnColumnTypes:Fa,_fnApplyColumnDefs:hb,_fnHungarianMap:X,_fnCamelToHungarian:I,_fnLanguageCompat:Ca,_fnBrowserDetect:fb,_fnAddData:M,_fnAddTr:ma,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==k?b._DT_RowIndex:null},_fnNodeToColumnIndex:function(a,b,c){return h.inArray(c,a.aoData[b].anCells)},_fnGetCellData:B,_fnSetCellData:ib,
        _fnSplitObjNotation:Ia,_fnGetObjectDataFn:Q,_fnSetObjectDataFn:R,_fnGetDataMaster:Ja,_fnClearTable:na,_fnDeleteIndex:oa,_fnInvalidate:ca,_fnGetRowElements:Ha,_fnCreateTr:Ga,_fnBuildHead:jb,_fnDrawHead:ea,_fnDraw:N,_fnReDraw:S,_fnAddOptionsHtml:mb,_fnDetectHeader:da,_fnGetUniqueThs:ra,_fnFeatureHtmlFilter:ob,_fnFilterComplete:fa,_fnFilterCustom:xb,_fnFilterColumn:wb,_fnFilter:vb,_fnFilterCreateSearch:Oa,_fnEscapeRegex:Pa,_fnFilterData:yb,_fnFeatureHtmlInfo:rb,_fnUpdateInfo:Bb,_fnInfoMacros:Cb,_fnInitialise:ga,
        _fnInitComplete:ua,_fnLengthChange:Qa,_fnFeatureHtmlLength:nb,_fnFeatureHtmlPaginate:sb,_fnPageChange:Sa,_fnFeatureHtmlProcessing:pb,_fnProcessingDisplay:C,_fnFeatureHtmlTable:qb,_fnScrollDraw:ka,_fnApplyToChildren:H,_fnCalculateColumnWidths:Ea,_fnThrottle:Na,_fnConvertToWidth:Db,_fnGetWidestNode:Eb,_fnGetMaxLenString:Fb,_fnStringToCss:v,_fnSortFlatten:V,_fnSort:lb,_fnSortAria:Hb,_fnSortListener:Ua,_fnSortAttachListener:La,_fnSortingClasses:wa,_fnSortData:Gb,_fnSaveState:xa,_fnLoadState:Ib,_fnSettingsFromNode:ya,
        _fnLog:J,_fnMap:F,_fnBindAction:Va,_fnCallbackReg:z,_fnCallbackFire:r,_fnLengthOverflow:Ra,_fnRenderer:Ma,_fnDataSource:y,_fnRowAttributes:Ka,_fnCalculateEnd:function(){}});h.fn.dataTable=m;m.$=h;h.fn.dataTableSettings=m.settings;h.fn.dataTableExt=m.ext;h.fn.DataTable=function(a){return h(this).dataTable(a).api()};h.each(m,function(a,b){h.fn.DataTable[a]=b});return h.fn.dataTable});
/*! FixedColumns 3.2.3-dev
 * ©2010-2016 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     FixedColumns
 * @description Freeze columns in place on a scrolling DataTable
 * @version     3.2.3-dev
 * @file        dataTables.fixedColumns.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2016 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
(function( factory ){
    if ( typeof define === 'function' && define.amd ) {
        // AMD
        define( ['jquery', 'datatables.net'], function ( $ ) {
            return factory( $, window, document );
        } );
    }
    else if ( typeof exports === 'object' ) {
        // CommonJS
        module.exports = function (root, $) {
            if ( ! root ) {
                root = window;
            }

            if ( ! $ || ! $.fn.dataTable ) {
                $ = require('datatables.net')(root, $).$;
            }

            return factory( $, root, root.document );
        };
    }
    else {
        // Browser
        factory( jQuery, window, document );
    }
}(function( $, window, document, undefined ) {
    'use strict';
    var DataTable = $.fn.dataTable;
    var _firefoxScroll;

    /**
     * When making use of DataTables' x-axis scrolling feature, you may wish to
     * fix the left most column in place. This plug-in for DataTables provides
     * exactly this option (note for non-scrolling tables, please use the
     * FixedHeader plug-in, which can fix headers and footers). Key
     * features include:
     *
     * * Freezes the left or right most columns to the side of the table
     * * Option to freeze two or more columns
     * * Full integration with DataTables' scrolling options
     * * Speed - FixedColumns is fast in its operation
     *
     *  @class
     *  @constructor
     *  @global
     *  @param {object} dt DataTables instance. With DataTables 1.10 this can also
     *    be a jQuery collection, a jQuery selector, DataTables API instance or
     *    settings object.
     *  @param {object} [init={}] Configuration object for FixedColumns. Options are
     *    defined by {@link FixedColumns.defaults}
     *
     *  @requires jQuery 1.7+
     *  @requires DataTables 1.8.0+
     *
     *  @example
     *      var table = $('#example').dataTable( {
 *        "scrollX": "100%"
 *      } );
     *      new $.fn.dataTable.fixedColumns( table );
     */
    var FixedColumns = function ( dt, init ) {
        var that = this;

        /* Sanity check - you just know it will happen */
        if ( ! ( this instanceof FixedColumns ) ) {
            alert( "FixedColumns warning: FixedColumns must be initialised with the 'new' keyword." );
            return;
        }

        if ( init === undefined || init === true ) {
            init = {};
        }

        // Use the DataTables Hungarian notation mapping method, if it exists to
        // provide forwards compatibility for camel case variables
        var camelToHungarian = $.fn.dataTable.camelToHungarian;
        if ( camelToHungarian ) {
            camelToHungarian( FixedColumns.defaults, FixedColumns.defaults, true );
            camelToHungarian( FixedColumns.defaults, init );
        }

        // v1.10 allows the settings object to be got form a number of sources
        var dtSettings = new $.fn.dataTable.Api( dt ).settings()[0];

        /**
         * Settings object which contains customisable information for FixedColumns instance
         * @namespace
         * @extends FixedColumns.defaults
         * @private
         */
        this.s = {
            /**
             * DataTables settings objects
             *  @type     object
             *  @default  Obtained from DataTables instance
             */
            "dt": dtSettings,

            /**
             * Number of columns in the DataTable - stored for quick access
             *  @type     int
             *  @default  Obtained from DataTables instance
             */
            "iTableColumns": dtSettings.aoColumns.length,

            /**
             * Original outer widths of the columns as rendered by DataTables - used to calculate
             * the FixedColumns grid bounding box
             *  @type     array.<int>
             *  @default  []
             */
            "aiOuterWidths": [],

            /**
             * Original inner widths of the columns as rendered by DataTables - used to apply widths
             * to the columns
             *  @type     array.<int>
             *  @default  []
             */
            "aiInnerWidths": [],


            /**
             * Is the document layout right-to-left
             * @type boolean
             */
            rtl: $(dtSettings.nTable).css('direction') === 'rtl'
        };


        /**
         * DOM elements used by the class instance
         * @namespace
         * @private
         *
         */
        this.dom = {
            /**
             * DataTables scrolling element
             *  @type     node
             *  @default  null
             */
            "scroller": null,

            /**
             * DataTables header table
             *  @type     node
             *  @default  null
             */
            "header": null,

            /**
             * DataTables body table
             *  @type     node
             *  @default  null
             */
            "body": null,

            /**
             * DataTables footer table
             *  @type     node
             *  @default  null
             */
            "footer": null,

            /**
             * Display grid elements
             * @namespace
             */
            "grid": {
                /**
                 * Grid wrapper. This is the container element for the 3x3 grid
                 *  @type     node
                 *  @default  null
                 */
                "wrapper": null,

                /**
                 * DataTables scrolling element. This element is the DataTables
                 * component in the display grid (making up the main table - i.e.
                 * not the fixed columns).
                 *  @type     node
                 *  @default  null
                 */
                "dt": null,

                /**
                 * Left fixed column grid components
                 * @namespace
                 */
                "left": {
                    "wrapper": null,
                    "head": null,
                    "body": null,
                    "foot": null
                },

                /**
                 * Right fixed column grid components
                 * @namespace
                 */
                "right": {
                    "wrapper": null,
                    "head": null,
                    "body": null,
                    "foot": null
                }
            },

            /**
             * Cloned table nodes
             * @namespace
             */
            "clone": {
                /**
                 * Left column cloned table nodes
                 * @namespace
                 */
                "left": {
                    /**
                     * Cloned header table
                     *  @type     node
                     *  @default  null
                     */
                    "header": null,

                    /**
                     * Cloned body table
                     *  @type     node
                     *  @default  null
                     */
                    "body": null,

                    /**
                     * Cloned footer table
                     *  @type     node
                     *  @default  null
                     */
                    "footer": null
                },

                /**
                 * Right column cloned table nodes
                 * @namespace
                 */
                "right": {
                    /**
                     * Cloned header table
                     *  @type     node
                     *  @default  null
                     */
                    "header": null,

                    /**
                     * Cloned body table
                     *  @type     node
                     *  @default  null
                     */
                    "body": null,

                    /**
                     * Cloned footer table
                     *  @type     node
                     *  @default  null
                     */
                    "footer": null
                }
            }
        };

        if ( dtSettings._oFixedColumns ) {
            throw 'FixedColumns already initialised on this table';
        }

        /* Attach the instance to the DataTables instance so it can be accessed easily */
        dtSettings._oFixedColumns = this;

        /* Let's do it */
        if ( ! dtSettings._bInitComplete )
        {
            dtSettings.oApi._fnCallbackReg( dtSettings, 'aoInitComplete', function () {
                that._fnConstruct( init );
            }, 'FixedColumns' );
        }
        else
        {
            this._fnConstruct( init );
        }
    };



    $.extend( FixedColumns.prototype , {
        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Public methods
         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

        /**
         * Update the fixed columns - including headers and footers. Note that FixedColumns will
         * automatically update the display whenever the host DataTable redraws.
         *  @returns {void}
         *  @example
         *      var table = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      var fc = new $.fn.dataTable.fixedColumns( table );
         *
         *      // at some later point when the table has been manipulated....
         *      fc.fnUpdate();
         */
        "fnUpdate": function ()
        {
            this._fnDraw( true );
        },


        /**
         * Recalculate the resizes of the 3x3 grid that FixedColumns uses for display of the table.
         * This is useful if you update the width of the table container. Note that FixedColumns will
         * perform this function automatically when the window.resize event is fired.
         *  @returns {void}
         *  @example
         *      var table = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      var fc = new $.fn.dataTable.fixedColumns( table );
         *
         *      // Resize the table container and then have FixedColumns adjust its layout....
         *      $('#content').width( 1200 );
         *      fc.fnRedrawLayout();
         */
        "fnRedrawLayout": function ()
        {
            this._fnColCalc();
            this._fnGridLayout();
            this.fnUpdate();
        },


        /**
         * Mark a row such that it's height should be recalculated when using 'semiauto' row
         * height matching. This function will have no effect when 'none' or 'auto' row height
         * matching is used.
         *  @param   {Node} nTr TR element that should have it's height recalculated
         *  @returns {void}
         *  @example
         *      var table = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      var fc = new $.fn.dataTable.fixedColumns( table );
         *
         *      // manipulate the table - mark the row as needing an update then update the table
         *      // this allows the redraw performed by DataTables fnUpdate to recalculate the row
         *      // height
         *      fc.fnRecalculateHeight();
         *      table.fnUpdate( $('#example tbody tr:eq(0)')[0], ["insert date", 1, 2, 3 ... ]);
         */
        "fnRecalculateHeight": function ( nTr )
        {
            delete nTr._DTTC_iHeight;
            nTr.style.height = 'auto';
        },


        /**
         * Set the height of a given row - provides cross browser compatibility
         *  @param   {Node} nTarget TR element that should have it's height recalculated
         *  @param   {int} iHeight Height in pixels to set
         *  @returns {void}
         *  @example
         *      var table = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      var fc = new $.fn.dataTable.fixedColumns( table );
         *
         *      // You may want to do this after manipulating a row in the fixed column
         *      fc.fnSetRowHeight( $('#example tbody tr:eq(0)')[0], 50 );
         */
        "fnSetRowHeight": function ( nTarget, iHeight )
        {
            nTarget.style.height = iHeight+"px";
        },


        /**
         * Get data index information about a row or cell in the table body.
         * This function is functionally identical to fnGetPosition in DataTables,
         * taking the same parameter (TH, TD or TR node) and returning exactly the
         * the same information (data index information). THe difference between
         * the two is that this method takes into account the fixed columns in the
         * table, so you can pass in nodes from the master table, or the cloned
         * tables and get the index position for the data in the main table.
         *  @param {node} node TR, TH or TD element to get the information about
         *  @returns {int} If nNode is given as a TR, then a single index is
         *    returned, or if given as a cell, an array of [row index, column index
         *    (visible), column index (all)] is given.
         */
        "fnGetPosition": function ( node )
        {
            var idx;
            var inst = this.s.dt.oInstance;

            if ( ! $(node).parents('.DTFC_Cloned').length )
            {
                // Not in a cloned table
                return inst.fnGetPosition( node );
            }
            else
            {
                // Its in the cloned table, so need to look up position
                if ( node.nodeName.toLowerCase() === 'tr' ) {
                    idx = $(node).index();
                    return inst.fnGetPosition( $('tr', this.s.dt.nTBody)[ idx ] );
                }
                else
                {
                    var colIdx = $(node).index();
                    idx = $(node.parentNode).index();
                    var row = inst.fnGetPosition( $('tr', this.s.dt.nTBody)[ idx ] );

                    return [
                        row,
                        colIdx,
                        inst.oApi._fnVisibleToColumnIndex( this.s.dt, colIdx )
                    ];
                }
            }
        },



        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Private methods (they are of course public in JS, but recommended as private)
         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

        /**
         * Initialisation for FixedColumns
         *  @param   {Object} oInit User settings for initialisation
         *  @returns {void}
         *  @private
         */
        "_fnConstruct": function ( oInit )
        {
            var i, iLen, iWidth,
                that = this;

            /* Sanity checking */
            if ( typeof this.s.dt.oInstance.fnVersionCheck != 'function' ||
                this.s.dt.oInstance.fnVersionCheck( '1.8.0' ) !== true )
            {
                alert( "FixedColumns "+FixedColumns.VERSION+" required DataTables 1.8.0 or later. "+
                    "Please upgrade your DataTables installation" );
                return;
            }

            if ( this.s.dt.oScroll.sX === "" )
            {
                this.s.dt.oInstance.oApi._fnLog( this.s.dt, 1, "FixedColumns is not needed (no "+
                    "x-scrolling in DataTables enabled), so no action will be taken. Use 'FixedHeader' for "+
                    "column fixing when scrolling is not enabled" );
                return;
            }

            /* Apply the settings from the user / defaults */
            this.s = $.extend( true, this.s, FixedColumns.defaults, oInit );

            /* Set up the DOM as we need it and cache nodes */
            var classes = this.s.dt.oClasses;
            this.dom.grid.dt = $(this.s.dt.nTable).parents('div.'+classes.sScrollWrapper)[0];
            this.dom.scroller = $('div.'+classes.sScrollBody, this.dom.grid.dt )[0];

            /* Set up the DOM that we want for the fixed column layout grid */
            this._fnColCalc();
            this._fnGridSetup();

            /* Event handlers */
            var mouseController;
            var mouseDown = false;

            // When the mouse is down (drag scroll) the mouse controller cannot
            // change, as the browser keeps the original element as the scrolling one
            $(this.s.dt.nTableWrapper).on( 'mousedown.DTFC', function () {
                mouseDown = true;

                $(document).one( 'mouseup', function () {
                    mouseDown = false;
                } );
            } );

            // When the body is scrolled - scroll the left and right columns
            $(this.dom.scroller)
                .on( 'mouseover.DTFC touchstart.DTFC', function () {
                    if ( ! mouseDown ) {
                        mouseController = 'main';
                    }
                } )
                .on( 'scroll.DTFC', function (e) {
                    if ( ! mouseController && e.originalEvent ) {
                        mouseController = 'main';
                    }

                    if ( mouseController === 'main' ) {
                        if ( that.s.iLeftColumns > 0 ) {
                            that.dom.grid.left.liner.scrollTop = that.dom.scroller.scrollTop;
                        }
                        if ( that.s.iRightColumns > 0 ) {
                            that.dom.grid.right.liner.scrollTop = that.dom.scroller.scrollTop;
                        }
                    }
                } );

            var wheelType = 'onwheel' in document.createElement('div') ?
                'wheel.DTFC' :
                'mousewheel.DTFC';

            if ( that.s.iLeftColumns > 0 ) {
                // When scrolling the left column, scroll the body and right column
                $(that.dom.grid.left.liner)
                    .on( 'mouseover.DTFC touchstart.DTFC', function () {
                        if ( ! mouseDown ) {
                            mouseController = 'left';
                        }
                    } )
                    .on( 'scroll.DTFC', function ( e ) {
                        if ( ! mouseController && e.originalEvent ) {
                            mouseController = 'left';
                        }

                        if ( mouseController === 'left' ) {
                            that.dom.scroller.scrollTop = that.dom.grid.left.liner.scrollTop;
                            if ( that.s.iRightColumns > 0 ) {
                                that.dom.grid.right.liner.scrollTop = that.dom.grid.left.liner.scrollTop;
                            }
                        }
                    } )
                    .on( wheelType, function(e) {
                        // Pass horizontal scrolling through
                        var xDelta = e.type === 'wheel' ?
                            -e.originalEvent.deltaX :
                            e.originalEvent.wheelDeltaX;
                        that.dom.scroller.scrollLeft -= xDelta;
                    } );
            }

            if ( that.s.iRightColumns > 0 ) {
                // When scrolling the right column, scroll the body and the left column
                $(that.dom.grid.right.liner)
                    .on( 'mouseover.DTFC touchstart.DTFC', function () {
                        if ( ! mouseDown ) {
                            mouseController = 'right';
                        }
                    } )
                    .on( 'scroll.DTFC', function ( e ) {
                        if ( ! mouseController && e.originalEvent ) {
                            mouseController = 'right';
                        }

                        if ( mouseController === 'right' ) {
                            that.dom.scroller.scrollTop = that.dom.grid.right.liner.scrollTop;
                            if ( that.s.iLeftColumns > 0 ) {
                                that.dom.grid.left.liner.scrollTop = that.dom.grid.right.liner.scrollTop;
                            }
                        }
                    } )
                    .on( wheelType, function(e) {
                        // Pass horizontal scrolling through
                        var xDelta = e.type === 'wheel' ?
                            -e.originalEvent.deltaX :
                            e.originalEvent.wheelDeltaX;
                        that.dom.scroller.scrollLeft -= xDelta;
                    } );
            }

            $(window).on( 'resize.DTFC', function () {
                that._fnGridLayout.call( that );
            } );

            var bFirstDraw = true;
            var jqTable = $(this.s.dt.nTable);

            jqTable
                .on( 'draw.dt.DTFC', function () {
                    that._fnColCalc();
                    that._fnDraw.call( that, bFirstDraw );
                    bFirstDraw = false;
                } )
                .on( 'column-sizing.dt.DTFC', function () {
                    that._fnColCalc();
                    that._fnGridLayout( that );
                } )
                .on( 'column-visibility.dt.DTFC', function ( e, settings, column, vis, recalc ) {
                    if ( recalc === undefined || recalc ) {
                        that._fnColCalc();
                        that._fnGridLayout( that );
                        that._fnDraw( true );
                    }
                } )
                .on( 'select.dt.DTFC deselect.dt.DTFC', function ( e, dt, type, indexes ) {
                    if ( e.namespace === 'dt' ) {
                        that._fnDraw( false );
                    }
                } )
                .on( 'destroy.dt.DTFC', function () {
                    jqTable.off( '.DTFC' );

                    $(that.dom.scroller).off( '.DTFC' );
                    $(window).off( '.DTFC' );
                    $(that.s.dt.nTableWrapper).off( '.DTFC' );

                    $(that.dom.grid.left.liner).off( '.DTFC '+wheelType );
                    $(that.dom.grid.left.wrapper).remove();

                    $(that.dom.grid.right.liner).off( '.DTFC '+wheelType );
                    $(that.dom.grid.right.wrapper).remove();
                } );

            /* Get things right to start with - note that due to adjusting the columns, there must be
             * another redraw of the main table. It doesn't need to be a full redraw however.
             */
            this._fnGridLayout();
            this.s.dt.oInstance.fnDraw(false);
        },


        /**
         * Calculate the column widths for the grid layout
         *  @returns {void}
         *  @private
         */
        "_fnColCalc": function ()
        {
            var that = this;
            var iLeftWidth = 0;
            var iRightWidth = 0;

            this.s.aiInnerWidths = [];
            this.s.aiOuterWidths = [];

            $.each( this.s.dt.aoColumns, function (i, col) {
                var th = $(col.nTh);
                var border;

                if ( ! th.filter(':visible').length ) {
                    that.s.aiInnerWidths.push( 0 );
                    that.s.aiOuterWidths.push( 0 );
                }
                else
                {
                    // Inner width is used to assign widths to cells
                    // Outer width is used to calculate the container
                    var iWidth = th.outerWidth();

                    // When working with the left most-cell, need to add on the
                    // table's border to the outerWidth, since we need to take
                    // account of it, but it isn't in any cell
                    if ( that.s.aiOuterWidths.length === 0 ) {
                        border = $(that.s.dt.nTable).css('border-left-width');
                        iWidth += typeof border === 'string' ? 1 : parseInt( border, 10 );
                    }

                    // Likewise with the final column on the right
                    if ( that.s.aiOuterWidths.length === that.s.dt.aoColumns.length-1 ) {
                        border = $(that.s.dt.nTable).css('border-right-width');
                        iWidth += typeof border === 'string' ? 1 : parseInt( border, 10 );
                    }

                    that.s.aiOuterWidths.push( iWidth );
                    that.s.aiInnerWidths.push( th.width() );

                    if ( i < that.s.iLeftColumns )
                    {
                        iLeftWidth += iWidth;
                    }

                    if ( that.s.iTableColumns-that.s.iRightColumns <= i )
                    {
                        iRightWidth += iWidth;
                    }
                }
            } );

            this.s.iLeftWidth = iLeftWidth;
            this.s.iRightWidth = iRightWidth;
        },


        /**
         * Set up the DOM for the fixed column. The way the layout works is to create a 1x3 grid
         * for the left column, the DataTable (for which we just reuse the scrolling element DataTable
         * puts into the DOM) and the right column. In each of he two fixed column elements there is a
         * grouping wrapper element and then a head, body and footer wrapper. In each of these we then
         * place the cloned header, body or footer tables. This effectively gives as 3x3 grid structure.
         *  @returns {void}
         *  @private
         */
        "_fnGridSetup": function ()
        {
            var that = this;
            var oOverflow = this._fnDTOverflow();
            var block;

            this.dom.body = this.s.dt.nTable;
            this.dom.header = this.s.dt.nTHead.parentNode;
            this.dom.header.parentNode.parentNode.style.position = "relative";

            var nSWrapper =
                $('<div class="DTFC_ScrollWrapper" style="position:relative; clear:both;">'+
                    '<div class="DTFC_LeftWrapper" style="position:absolute; top:0; left:0;">'+
                    '<div class="DTFC_LeftHeadWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div>'+
                    '<div class="DTFC_LeftBodyWrapper" style="position:relative; top:0; left:0; overflow:hidden;">'+
                    '<div class="DTFC_LeftBodyLiner" style="position:relative; top:0; left:0; overflow-y:scroll; overflow-x:hidden"></div>'+
                    '</div>'+
                    '<div class="DTFC_LeftFootWrapper" style="position:relative; top:0; left:0; overflow:hidden;"></div>'+
                    '</div>'+
                    '<div class="DTFC_RightWrapper" style="position:absolute; top:0; right:0;">'+
                    '<div class="DTFC_RightHeadWrapper" style="position:relative; top:0; left:0;">'+
                    '<div class="DTFC_RightHeadBlocker DTFC_Blocker" style="position:absolute; top:0; bottom:0;"></div>'+
                    '</div>'+
                    '<div class="DTFC_RightBodyWrapper" style="position:relative; top:0; left:0; overflow:hidden;">'+
                    '<div class="DTFC_RightBodyLiner" style="position:relative; top:0; left:0; overflow-y:scroll; overflow-x: hidden"></div>'+
                    '</div>'+
                    '<div class="DTFC_RightFootWrapper" style="position:relative; top:0; left:0;">'+
                    '<div class="DTFC_RightFootBlocker DTFC_Blocker" style="position:absolute; top:0; bottom:0;"></div>'+
                    '</div>'+
                    '</div>'+
                    '</div>')[0];
            var nLeft = nSWrapper.childNodes[0];
            var nRight = nSWrapper.childNodes[1];

            this.dom.grid.dt.parentNode.insertBefore( nSWrapper, this.dom.grid.dt );
            nSWrapper.appendChild( this.dom.grid.dt );

            this.dom.grid.wrapper = nSWrapper;

            if ( this.s.iLeftColumns > 0 )
            {
                this.dom.grid.left.wrapper = nLeft;
                this.dom.grid.left.head = nLeft.childNodes[0];
                this.dom.grid.left.body = nLeft.childNodes[1];
                this.dom.grid.left.liner = $('div.DTFC_LeftBodyLiner', nSWrapper)[0];

                nSWrapper.appendChild( nLeft );
            }

            if ( this.s.iRightColumns > 0 )
            {
                this.dom.grid.right.wrapper = nRight;
                this.dom.grid.right.head = nRight.childNodes[0];
                this.dom.grid.right.body = nRight.childNodes[1];
                this.dom.grid.right.liner = $('div.DTFC_RightBodyLiner', nSWrapper)[0];

                // nRight.style.right = oOverflow.bar+"px";
                var dataTableScrollPane = $($(this.dom.grid.dt)[0])
                var rightPosi = dataTableScrollPane.width() -
                    dataTableScrollPane.children('.dataTables_scrollBody').children('table').width();

                if (rightPosi < 0)
                    rightPosi = 0;

                nRight.style.right = rightPosi + "px";

                block = $('div.DTFC_RightHeadBlocker', nSWrapper)[0];
                block.style.width = oOverflow.bar+"px";
                // block.style.right = -oOverflow.bar+"px";

                block.style.right = rightPosi +"px";

                this.dom.grid.right.headBlock = block;

                block = $('div.DTFC_RightFootBlocker', nSWrapper)[0];
                block.style.width = oOverflow.bar+"px";
                // block.style.right = -oOverflow.bar+"px";
                block.style.right = rightPosi+"px";
                this.dom.grid.right.footBlock = block;

                nSWrapper.appendChild( nRight );
            }

            if ( this.s.dt.nTFoot )
            {
                this.dom.footer = this.s.dt.nTFoot.parentNode;
                if ( this.s.iLeftColumns > 0 )
                {
                    this.dom.grid.left.foot = nLeft.childNodes[2];
                }
                if ( this.s.iRightColumns > 0 )
                {
                    this.dom.grid.right.foot = nRight.childNodes[2];
                }
            }

            // RTL support - swap the position of the left and right columns (#48)
            if ( this.s.rtl ) {
                $('div.DTFC_RightHeadBlocker', nSWrapper).css( {
                    left: -oOverflow.bar+'px',
                    right: ''
                } );
            }
        },


        /**
         * Style and position the grid used for the FixedColumns layout
         *  @returns {void}
         *  @private
         */
        "_fnGridLayout": function ()
        {
            var that = this;
            var oGrid = this.dom.grid;
            var iWidth = $(oGrid.wrapper).width();
            var iBodyHeight = $(this.s.dt.nTable.parentNode).outerHeight();
            var iFullHeight = $(this.s.dt.nTable.parentNode.parentNode).outerHeight();
            var oOverflow = this._fnDTOverflow();
            var iLeftWidth = this.s.iLeftWidth;
            var iRightWidth = this.s.iRightWidth;
            var rtl = $(this.dom.body).css('direction') === 'rtl';
            var wrapper;
            var scrollbarAdjust = function ( node, width ) {
                if ( ! oOverflow.bar ) {
                    // If there is no scrollbar (Macs) we need to hide the auto scrollbar
                    node.style.width = (width+20)+"px";
                    node.style.paddingRight = "20px";
                    node.style.boxSizing = "border-box";
                }
                else if ( that._firefoxScrollError() ) {
                    // See the above function for why this is required
                    if ( $(node).height() > 34 ) {
                        node.style.width = (width+oOverflow.bar)+"px";
                    }
                }
                else {
                    // Otherwise just overflow by the scrollbar
                    node.style.width = (width+oOverflow.bar)+"px";
                }
            };

            // When x scrolling - don't paint the fixed columns over the x scrollbar
            if ( oOverflow.x )
            {
                iBodyHeight -= oOverflow.bar;
            }

            oGrid.wrapper.style.height = iFullHeight+"px";

            if ( this.s.iLeftColumns > 0 )
            {
                wrapper = oGrid.left.wrapper;
                wrapper.style.width = iLeftWidth+'px';
                wrapper.style.height = '1px';

                // Swap the position of the left and right columns for rtl (#48)
                // This is always up against the edge, scrollbar on the far side
                if ( rtl ) {
                    wrapper.style.left = '';
                    wrapper.style.right = 0;
                }
                else {
                    wrapper.style.left = 0;
                    wrapper.style.right = '';
                }

                oGrid.left.body.style.height = iBodyHeight+"px";
                if ( oGrid.left.foot ) {
                    oGrid.left.foot.style.top = (oOverflow.x ? oOverflow.bar : 0)+"px"; // shift footer for scrollbar
                }

                scrollbarAdjust( oGrid.left.liner, iLeftWidth );
                oGrid.left.liner.style.height = iBodyHeight+"px";
            }

            if ( this.s.iRightColumns > 0 )
            {
                wrapper = oGrid.right.wrapper;
                wrapper.style.width = iRightWidth+'px';
                wrapper.style.height = '1px';

                var dataTableScrollPane = $($(oGrid.dt)[0])
                var rightPosi = dataTableScrollPane.width() -
                    dataTableScrollPane.children('.dataTables_scrollBody').children('table').width();

                if (rightPosi < 0)
                    rightPosi = 0;

                // Need to take account of the vertical scrollbar
                if ( this.s.rtl ) {
                    wrapper.style.left = oOverflow.y ? oOverflow.bar+'px' : 0;
                    wrapper.style.right = '';
                }
                else {
                    wrapper.style.left = '';
                    // wrapper.style.right = oOverflow.y ? oOverflow.bar+'px' : 0;

                    wrapper.style.right = rightPosi + "px";
                }

                oGrid.right.body.style.height = iBodyHeight+"px";
                if ( oGrid.right.foot ) {
                    oGrid.right.foot.style.top = (oOverflow.x ? oOverflow.bar : 0)+"px";
                }

                scrollbarAdjust( oGrid.right.liner, iRightWidth );
                oGrid.right.liner.style.height = iBodyHeight+"px";

                oGrid.right.headBlock.style.display = oOverflow.y ? 'block' : 'none';
                oGrid.right.footBlock.style.display = oOverflow.y ? 'block' : 'none';
            }
        },


        /**
         * Get information about the DataTable's scrolling state - specifically if the table is scrolling
         * on either the x or y axis, and also the scrollbar width.
         *  @returns {object} Information about the DataTables scrolling state with the properties:
         *    'x', 'y' and 'bar'
         *  @private
         */
        "_fnDTOverflow": function ()
        {
            var nTable = this.s.dt.nTable;
            var nTableScrollBody = nTable.parentNode;
            var out = {
                "x": false,
                "y": false,
                "bar": this.s.dt.oScroll.iBarWidth
            };

            if ( nTable.offsetWidth > nTableScrollBody.clientWidth )
            {
                out.x = true;
            }

            if ( nTable.offsetHeight > nTableScrollBody.clientHeight )
            {
                out.y = true;
            }

            return out;
        },


        /**
         * Clone and position the fixed columns
         *  @returns {void}
         *  @param   {Boolean} bAll Indicate if the header and footer should be updated as well (true)
         *  @private
         */
        "_fnDraw": function ( bAll )
        {
            this._fnGridLayout();
            this._fnCloneLeft( bAll );
            this._fnCloneRight( bAll );

            /* Draw callback function */
            if ( this.s.fnDrawCallback !== null )
            {
                this.s.fnDrawCallback.call( this, this.dom.clone.left, this.dom.clone.right );
            }

            /* Event triggering */
            $(this).trigger( 'draw.dtfc', {
                "leftClone": this.dom.clone.left,
                "rightClone": this.dom.clone.right
            } );
        },


        /**
         * Clone the right columns
         *  @returns {void}
         *  @param   {Boolean} bAll Indicate if the header and footer should be updated as well (true)
         *  @private
         */
        "_fnCloneRight": function ( bAll )
        {
            if ( this.s.iRightColumns <= 0 ) {
                return;
            }

            var that = this,
                i, jq,
                aiColumns = [];

            for ( i=this.s.iTableColumns-this.s.iRightColumns ; i<this.s.iTableColumns ; i++ ) {
                if ( this.s.dt.aoColumns[i].bVisible ) {
                    aiColumns.push( i );
                }
            }

            this._fnClone( this.dom.clone.right, this.dom.grid.right, aiColumns, bAll );
        },


        /**
         * Clone the left columns
         *  @returns {void}
         *  @param   {Boolean} bAll Indicate if the header and footer should be updated as well (true)
         *  @private
         */
        "_fnCloneLeft": function ( bAll )
        {
            if ( this.s.iLeftColumns <= 0 ) {
                return;
            }

            var that = this,
                i, jq,
                aiColumns = [];

            for ( i=0 ; i<this.s.iLeftColumns ; i++ ) {
                if ( this.s.dt.aoColumns[i].bVisible ) {
                    aiColumns.push( i );
                }
            }

            this._fnClone( this.dom.clone.left, this.dom.grid.left, aiColumns, bAll );
        },


        /**
         * Make a copy of the layout object for a header or footer element from DataTables. Note that
         * this method will clone the nodes in the layout object.
         *  @returns {Array} Copy of the layout array
         *  @param   {Object} aoOriginal Layout array from DataTables (aoHeader or aoFooter)
         *  @param   {Object} aiColumns Columns to copy
         *  @param   {boolean} events Copy cell events or not
         *  @private
         */
        "_fnCopyLayout": function ( aoOriginal, aiColumns, events )
        {
            var aReturn = [];
            var aClones = [];
            var aCloned = [];

            for ( var i=0, iLen=aoOriginal.length ; i<iLen ; i++ )
            {
                var aRow = [];
                aRow.nTr = $(aoOriginal[i].nTr).clone(events, false)[0];

                for ( var j=0, jLen=this.s.iTableColumns ; j<jLen ; j++ )
                {
                    if ( $.inArray( j, aiColumns ) === -1 )
                    {
                        continue;
                    }

                    var iCloned = $.inArray( aoOriginal[i][j].cell, aCloned );
                    if ( iCloned === -1 )
                    {
                        var nClone = $(aoOriginal[i][j].cell).clone(events, false)[0];
                        aClones.push( nClone );
                        aCloned.push( aoOriginal[i][j].cell );

                        aRow.push( {
                            "cell": nClone,
                            "unique": aoOriginal[i][j].unique
                        } );
                    }
                    else
                    {
                        aRow.push( {
                            "cell": aClones[ iCloned ],
                            "unique": aoOriginal[i][j].unique
                        } );
                    }
                }

                aReturn.push( aRow );
            }

            return aReturn;
        },


        /**
         * Clone the DataTable nodes and place them in the DOM (sized correctly)
         *  @returns {void}
         *  @param   {Object} oClone Object containing the header, footer and body cloned DOM elements
         *  @param   {Object} oGrid Grid object containing the display grid elements for the cloned
         *                    column (left or right)
         *  @param   {Array} aiColumns Column indexes which should be operated on from the DataTable
         *  @param   {Boolean} bAll Indicate if the header and footer should be updated as well (true)
         *  @private
         */
        "_fnClone": function ( oClone, oGrid, aiColumns, bAll )
        {
            var that = this,
                i, iLen, j, jLen, jq, nTarget, iColumn, nClone, iIndex, aoCloneLayout,
                jqCloneThead, aoFixedHeader,
                dt = this.s.dt;

            /*
             * Header
             */
            if ( bAll )
            {
                $(oClone.header).remove();

                oClone.header = $(this.dom.header).clone(true, false)[0];
                oClone.header.className += " DTFC_Cloned";
                oClone.header.style.width = "100%";
                oGrid.head.appendChild( oClone.header );

                /* Copy the DataTables layout cache for the header for our floating column */
                aoCloneLayout = this._fnCopyLayout( dt.aoHeader, aiColumns, true );
                jqCloneThead = $('>thead', oClone.header);
                jqCloneThead.empty();

                /* Add the created cloned TR elements to the table */
                for ( i=0, iLen=aoCloneLayout.length ; i<iLen ; i++ )
                {
                    jqCloneThead[0].appendChild( aoCloneLayout[i].nTr );
                }

                /* Use the handy _fnDrawHead function in DataTables to do the rowspan/colspan
                 * calculations for us
                 */
                dt.oApi._fnDrawHead( dt, aoCloneLayout, true );
            }
            else
            {
                /* To ensure that we copy cell classes exactly, regardless of colspan, multiple rows
                 * etc, we make a copy of the header from the DataTable again, but don't insert the
                 * cloned cells, just copy the classes across. To get the matching layout for the
                 * fixed component, we use the DataTables _fnDetectHeader method, allowing 1:1 mapping
                 */
                aoCloneLayout = this._fnCopyLayout( dt.aoHeader, aiColumns, false );
                aoFixedHeader=[];

                dt.oApi._fnDetectHeader( aoFixedHeader, $('>thead', oClone.header)[0] );

                for ( i=0, iLen=aoCloneLayout.length ; i<iLen ; i++ )
                {
                    for ( j=0, jLen=aoCloneLayout[i].length ; j<jLen ; j++ )
                    {
                        aoFixedHeader[i][j].cell.className = aoCloneLayout[i][j].cell.className;

                        // If jQuery UI theming is used we need to copy those elements as well
                        $('span.DataTables_sort_icon', aoFixedHeader[i][j].cell).each( function () {
                            this.className = $('span.DataTables_sort_icon', aoCloneLayout[i][j].cell)[0].className;
                        } );
                    }
                }
            }
            this._fnEqualiseHeights( 'thead', this.dom.header, oClone.header );

            /*
             * Body
             */
            if ( this.s.sHeightMatch == 'auto' )
            {
                /* Remove any heights which have been applied already and let the browser figure it out */
                $('>tbody>tr', that.dom.body).css('height', 'auto');
            }

            if ( oClone.body !== null )
            {
                $(oClone.body).remove();
                oClone.body = null;
            }

            oClone.body = $(this.dom.body).clone(true)[0];
            oClone.body.className += " DTFC_Cloned";
            oClone.body.style.paddingBottom = dt.oScroll.iBarWidth+"px";
            oClone.body.style.marginBottom = (dt.oScroll.iBarWidth*2)+"px"; /* For IE */
            if ( oClone.body.getAttribute('id') !== null )
            {
                oClone.body.removeAttribute('id');
            }

            $('>thead>tr', oClone.body).empty();
            $('>tfoot', oClone.body).remove();

            var nBody = $('tbody', oClone.body)[0];
            $(nBody).empty();
            if ( dt.aiDisplay.length > 0 )
            {
                /* Copy the DataTables' header elements to force the column width in exactly the
                 * same way that DataTables does it - have the header element, apply the width and
                 * colapse it down
                 */
                var nInnerThead = $('>thead>tr', oClone.body)[0];
                for ( iIndex=0 ; iIndex<aiColumns.length ; iIndex++ )
                {
                    iColumn = aiColumns[iIndex];

                    nClone = $(dt.aoColumns[iColumn].nTh).clone(true)[0];
                    nClone.innerHTML = "";

                    var oStyle = nClone.style;
                    oStyle.paddingTop = "0";
                    oStyle.paddingBottom = "0";
                    oStyle.borderTopWidth = "0";
                    oStyle.borderBottomWidth = "0";
                    oStyle.height = 0;
                    oStyle.width = that.s.aiInnerWidths[iColumn]+"px";

                    nInnerThead.appendChild( nClone );
                }

                /* Add in the tbody elements, cloning form the master table */
                $('>tbody>tr', that.dom.body).each( function (z) {
                    var i = that.s.dt.oFeatures.bServerSide===false ?
                        that.s.dt.aiDisplay[ that.s.dt._iDisplayStart+z ] : z;

                    var aTds;

                    if (i >= that.s.dt.aoData.length || _.isUndefined(that.s.dt.aoData[ i ].anCells))
                        aTds = that.s.dt.aoData[ i - 1 ].anCells;
                        // aTds = $(this).children('td, th');
                    else
                        aTds = that.s.dt.aoData[ i ].anCells;

                    var n = this.cloneNode(false);
                    n.removeAttribute('id');
                    n.setAttribute( 'data-dt-row', i );

                    for ( iIndex=0 ; iIndex<aiColumns.length ; iIndex++ )
                    {
                        iColumn = aiColumns[iIndex];

                        if ( aTds.length > 0 )
                        {
                            nClone = $( aTds[iColumn] ).clone(true, true)[0];
                            nClone.setAttribute( 'data-dt-row', i );
                            nClone.setAttribute( 'data-dt-column', dt.oApi._fnVisibleToColumnIndex( dt, iColumn ) );
                            n.appendChild( nClone );
                        }
                    }
                    nBody.appendChild( n );
                } );
            }
            else
            {
                $('>tbody>tr', that.dom.body).each( function (z) {
                    nClone = this.cloneNode(true);
                    nClone.className += ' DTFC_NoData';
                    $('td', nClone).html('');
                    nBody.appendChild( nClone );
                } );
            }

            oClone.body.style.width = "100%";
            oClone.body.style.margin = "0";
            oClone.body.style.padding = "0";

            // Interop with Scroller - need to use a height forcing element in the
            // scrolling area in the same way that Scroller does in the body scroll.
            if ( dt.oScroller !== undefined )
            {
                var scrollerForcer = dt.oScroller.dom.force;

                if ( ! oGrid.forcer ) {
                    oGrid.forcer = scrollerForcer.cloneNode( true );
                    oGrid.liner.appendChild( oGrid.forcer );
                }
                else {
                    oGrid.forcer.style.height = scrollerForcer.style.height;
                }
            }

            oGrid.liner.appendChild( oClone.body );

            this._fnEqualiseHeights( 'tbody', that.dom.body, oClone.body );

            /*
             * Footer
             */
            if ( dt.nTFoot !== null )
            {
                if ( bAll )
                {
                    if ( oClone.footer !== null )
                    {
                        oClone.footer.parentNode.removeChild( oClone.footer );
                    }
                    oClone.footer = $(this.dom.footer).clone(true, true)[0];
                    oClone.footer.className += " DTFC_Cloned";
                    oClone.footer.style.width = "100%";
                    oGrid.foot.appendChild( oClone.footer );

                    /* Copy the footer just like we do for the header */
                    aoCloneLayout = this._fnCopyLayout( dt.aoFooter, aiColumns, true );
                    var jqCloneTfoot = $('>tfoot', oClone.footer);
                    jqCloneTfoot.empty();

                    for ( i=0, iLen=aoCloneLayout.length ; i<iLen ; i++ )
                    {
                        jqCloneTfoot[0].appendChild( aoCloneLayout[i].nTr );
                    }
                    dt.oApi._fnDrawHead( dt, aoCloneLayout, true );
                }
                else
                {
                    aoCloneLayout = this._fnCopyLayout( dt.aoFooter, aiColumns, false );
                    var aoCurrFooter=[];

                    dt.oApi._fnDetectHeader( aoCurrFooter, $('>tfoot', oClone.footer)[0] );

                    for ( i=0, iLen=aoCloneLayout.length ; i<iLen ; i++ )
                    {
                        for ( j=0, jLen=aoCloneLayout[i].length ; j<jLen ; j++ )
                        {
                            aoCurrFooter[i][j].cell.className = aoCloneLayout[i][j].cell.className;
                        }
                    }
                }
                this._fnEqualiseHeights( 'tfoot', this.dom.footer, oClone.footer );
            }

            /* Equalise the column widths between the header footer and body - body get's priority */
            var anUnique = dt.oApi._fnGetUniqueThs( dt, $('>thead', oClone.header)[0] );
            $(anUnique).each( function (i) {
                iColumn = aiColumns[i];
                this.style.width = that.s.aiInnerWidths[iColumn]+"px";
            } );

            if ( that.s.dt.nTFoot !== null )
            {
                anUnique = dt.oApi._fnGetUniqueThs( dt, $('>tfoot', oClone.footer)[0] );
                $(anUnique).each( function (i) {
                    iColumn = aiColumns[i];
                    this.style.width = that.s.aiInnerWidths[iColumn]+"px";
                } );
            }
        },


        /**
         * From a given table node (THEAD etc), get a list of TR direct child elements
         *  @param   {Node} nIn Table element to search for TR elements (THEAD, TBODY or TFOOT element)
         *  @returns {Array} List of TR elements found
         *  @private
         */
        "_fnGetTrNodes": function ( nIn )
        {
            var aOut = [];
            for ( var i=0, iLen=nIn.childNodes.length ; i<iLen ; i++ )
            {
                if ( nIn.childNodes[i].nodeName.toUpperCase() == "TR" )
                {
                    aOut.push( nIn.childNodes[i] );
                }
            }
            return aOut;
        },


        /**
         * Equalise the heights of the rows in a given table node in a cross browser way
         *  @returns {void}
         *  @param   {String} nodeName Node type - thead, tbody or tfoot
         *  @param   {Node} original Original node to take the heights from
         *  @param   {Node} clone Copy the heights to
         *  @private
         */
        "_fnEqualiseHeights": function ( nodeName, original, clone )
        {
            if ( this.s.sHeightMatch == 'none' && nodeName !== 'thead' && nodeName !== 'tfoot' )
            {
                return;
            }

            var that = this,
                i, iLen, iHeight, iHeight2, iHeightOriginal, iHeightClone,
                rootOriginal = original.getElementsByTagName(nodeName)[0],
                rootClone    = clone.getElementsByTagName(nodeName)[0],
                jqBoxHack    = $('>'+nodeName+'>tr:eq(0)', original).children(':first'),
                iBoxHack     = jqBoxHack.outerHeight() - jqBoxHack.height(),
                anOriginal   = this._fnGetTrNodes( rootOriginal ),
                anClone      = this._fnGetTrNodes( rootClone ),
                heights      = [];

            for ( i=0, iLen=anClone.length ; i<iLen ; i++ )
            {
                iHeightOriginal = anOriginal[i].offsetHeight;
                iHeightClone = anClone[i].offsetHeight;
                iHeight = iHeightClone > iHeightOriginal ? iHeightClone : iHeightOriginal;

                if ( this.s.sHeightMatch == 'semiauto' )
                {
                    anOriginal[i]._DTTC_iHeight = iHeight;
                }

                heights.push( iHeight );
            }

            for ( i=0, iLen=anClone.length ; i<iLen ; i++ )
            {
                anClone[i].style.height = heights[i]+"px";
                anOriginal[i].style.height = heights[i]+"px";
            }
        },

        /**
         * Determine if the UA suffers from Firefox's overflow:scroll scrollbars
         * not being shown bug.
         *
         * Firefox doesn't draw scrollbars, even if it is told to using
         * overflow:scroll, if the div is less than 34px height. See bugs 292284 and
         * 781885. Using UA detection here since this is particularly hard to detect
         * using objects - its a straight up rendering error in Firefox.
         *
         * @return {boolean} True if Firefox error is present, false otherwise
         */
        _firefoxScrollError: function () {
            if ( _firefoxScroll === undefined ) {
                var test = $('<div/>')
                    .css( {
                        position: 'absolute',
                        top: 0,
                        left: 0,
                        height: 10,
                        width: 50,
                        overflow: 'scroll'
                    } )
                    .appendTo( 'body' );

                // Make sure this doesn't apply on Macs with 0 width scrollbars
                _firefoxScroll = (
                    test[0].clientWidth === test[0].offsetWidth && this._fnDTOverflow().bar !== 0
                );

                test.remove();
            }

            return _firefoxScroll;
        }
    } );



    /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     * Statics
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

    /**
     * FixedColumns default settings for initialisation
     *  @name FixedColumns.defaults
     *  @namespace
     *  @static
     */
    FixedColumns.defaults = /** @lends FixedColumns.defaults */{
        /**
         * Number of left hand columns to fix in position
         *  @type     int
         *  @default  1
         *  @static
         *  @example
         *      var  = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      new $.fn.dataTable.fixedColumns( table, {
	 *          "leftColumns": 2
	 *      } );
         */
        "iLeftColumns": 1,

        /**
         * Number of right hand columns to fix in position
         *  @type     int
         *  @default  0
         *  @static
         *  @example
         *      var table = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      new $.fn.dataTable.fixedColumns( table, {
	 *          "rightColumns": 1
	 *      } );
         */
        "iRightColumns": 0,

        /**
         * Draw callback function which is called when FixedColumns has redrawn the fixed assets
         *  @type     function(object, object):void
         *  @default  null
         *  @static
         *  @example
         *      var table = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      new $.fn.dataTable.fixedColumns( table, {
	 *          "drawCallback": function () {
	 *	            alert( "FixedColumns redraw" );
	 *	        }
	 *      } );
         */
        "fnDrawCallback": null,

        /**
         * Height matching algorthim to use. This can be "none" which will result in no height
         * matching being applied by FixedColumns (height matching could be forced by CSS in this
         * case), "semiauto" whereby the height calculation will be performed once, and the result
         * cached to be used again (fnRecalculateHeight can be used to force recalculation), or
         * "auto" when height matching is performed on every draw (slowest but must accurate)
         *  @type     string
         *  @default  semiauto
         *  @static
         *  @example
         *      var table = $('#example').dataTable( {
	 *          "scrollX": "100%"
	 *      } );
         *      new $.fn.dataTable.fixedColumns( table, {
	 *          "heightMatch": "auto"
	 *      } );
         */
        "sHeightMatch": "semiauto"
    };




    /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     * Constants
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

    /**
     * FixedColumns version
     *  @name      FixedColumns.version
     *  @type      String
     *  @default   See code
     *  @static
     */
    FixedColumns.version = "3.2.3-dev";



    /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     * DataTables API integration
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

    DataTable.Api.register( 'fixedColumns()', function () {
        return this;
    } );

    DataTable.Api.register( 'fixedColumns().update()', function () {
        return this.iterator( 'table', function ( ctx ) {
            if ( ctx._oFixedColumns ) {
                ctx._oFixedColumns.fnUpdate();
            }
        } );
    } );

    DataTable.Api.register( 'fixedColumns().relayout()', function () {
        return this.iterator( 'table', function ( ctx ) {
            if ( ctx._oFixedColumns ) {
                ctx._oFixedColumns.fnRedrawLayout();
            }
        } );
    } );

    DataTable.Api.register( 'rows().recalcHeight()', function () {
        return this.iterator( 'row', function ( ctx, idx ) {
            if ( ctx._oFixedColumns ) {
                ctx._oFixedColumns.fnRecalculateHeight( this.row(idx).node() );
            }
        } );
    } );

    DataTable.Api.register( 'fixedColumns().rowIndex()', function ( row ) {
        row = $(row);

        return row.parents('.DTFC_Cloned').length ?
            this.rows( { page: 'current' } ).indexes()[ row.index() ] :
            this.row( row ).index();
    } );

    DataTable.Api.register( 'fixedColumns().cellIndex()', function ( cell ) {
        cell = $(cell);

        if ( cell.parents('.DTFC_Cloned').length ) {
            var rowClonedIdx = cell.parent().index();
            var rowIdx = this.rows( { page: 'current' } ).indexes()[ rowClonedIdx ];
            var columnIdx;

            if ( cell.parents('.DTFC_LeftWrapper').length ) {
                columnIdx = cell.index();
            }
            else {
                var columns = this.columns().flatten().length;
                columnIdx = columns - this.context[0]._oFixedColumns.s.iRightColumns + cell.index();
            }

            return {
                row: rowIdx,
                column: this.column.index( 'toData', columnIdx ),
                columnVisible: columnIdx
            };
        }
        else {
            return this.cell( cell ).index();
        }
    } );




    /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     * Initialisation
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

// Attach a listener to the document which listens for DataTables initialisation
// events so we can automatically initialise
    $(document).on( 'init.dt.fixedColumns', function (e, settings) {
        if ( e.namespace !== 'dt' ) {
            return;
        }

        var init = settings.oInit.fixedColumns;
        var defaults = DataTable.defaults.fixedColumns;

        if ( init || defaults ) {
            var opts = $.extend( {}, init, defaults );

            if ( init !== false ) {
                new FixedColumns( settings, opts );
            }
        }
    } );



// Make FixedColumns accessible from the DataTables instance
    $.fn.dataTable.FixedColumns = FixedColumns;
    $.fn.DataTable.FixedColumns = FixedColumns;

    return FixedColumns;
}));
/*!
 DataTables Bootstrap 3 integration
 ©2011-2015 SpryMedia Ltd - datatables.net/license
*/
(function(b){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(a){return b(a,window,document)}):"object"===typeof exports?module.exports=function(a,d){a||(a=window);if(!d||!d.fn.dataTable)d=require("datatables.net")(a,d).$;return b(d,a,a.document)}:b(jQuery,window,document)})(function(b,a,d,m){var f=b.fn.dataTable;b.extend(!0,f.defaults,{dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",renderer:"bootstrap"});b.extend(f.ext.classes,
{sWrapper:"dataTables_wrapper form-inline dt-bootstrap",sFilterInput:"form-control input-sm",sLengthSelect:"form-control input-sm",sProcessing:"dataTables_processing panel panel-default"});f.ext.renderer.pageButton.bootstrap=function(a,h,r,s,j,n){var o=new f.Api(a),t=a.oClasses,k=a.oLanguage.oPaginate,u=a.oLanguage.oAria.paginate||{},e,g,p=0,q=function(d,f){var l,h,i,c,m=function(a){a.preventDefault();!b(a.currentTarget).hasClass("disabled")&&o.page()!=a.data.action&&o.page(a.data.action).draw("page")};
l=0;for(h=f.length;l<h;l++)if(c=f[l],b.isArray(c))q(d,c);else{g=e="";switch(c){case "ellipsis":e="&#x2026;";g="disabled";break;case "first":e=k.sFirst;g=c+(0<j?"":" disabled");break;case "previous":e=k.sPrevious;g=c+(0<j?"":" disabled");break;case "next":e=k.sNext;g=c+(j<n-1?"":" disabled");break;case "last":e=k.sLast;g=c+(j<n-1?"":" disabled");break;default:e=c+1,g=j===c?"active":""}e&&(i=b("<li>",{"class":t.sPageButton+" "+g,id:0===r&&"string"===typeof c?a.sTableId+"_"+c:null}).append(b("<a>",{href:"#",
"aria-controls":a.sTableId,"aria-label":u[c],"data-dt-idx":p,tabindex:a.iTabIndex}).html(e)).appendTo(d),a.oApi._fnBindAction(i,{action:c},m),p++)}},i;try{i=b(h).find(d.activeElement).data("dt-idx")}catch(v){}q(b(h).empty().html('<ul class="pagination"/>').children("ul"),s);i!==m&&b(h).find("[data-dt-idx="+i+"]").focus()};return f});

(function(b){"function"===typeof define&&define.amd?define(["jquery","moment","datatables"],b):b(jQuery,moment)})(function(b,d){b.fn.dataTable.moment=function(c,e){var f=b.fn.dataTable.ext.type;f.detect.unshift(function(a){a&&a.replace&&(a=a.replace(/<.*?>/g,""));return""===a||null===a?"moment-"+c:d(a,c,e,!0).isValid()?"moment-"+c:null});f.order["moment-"+c+"-pre"]=function(a){a&&a.replace&&(a=a.replace(/<.*?>/g,""));return""===a||null===a?-Infinity:parseInt(d(a,c,e,!0).format("x"),10)}}});
//= require_self
//= require _grid-utils
//= require _grid-ui

// var pvui = pvui || {};

var pvui = pvui || {};
pvui.grid = pvui.grid || {};

pvui.grid.utils= function () {
    var wrapperContainer = $("#wrapper");
    var hasMultipleList = $("#commonListDataElements").data("has-multiple-list");

    var appendDropdownOutsideContainer = function (container, dropdownCls) {
        var actionDropdownMenu;
        $(container).on('show.bs.dropdown',dropdownCls, function(e) {
            actionDropdownMenu = $(e.currentTarget).find('.dropdown-menu');
            $('body').append(actionDropdownMenu.detach());
            var currTarget = $(e.currentTarget),
                eOffset = currTarget.offset(),
                rtOffset = ($(window).width() - (eOffset.left + currTarget.outerWidth())),
                dropdownHeight = parseInt(actionDropdownMenu.outerHeight()),
                eOffsetTop = eOffset.top,
                targetOuterHeight = parseInt(currTarget.outerHeight());
            actionDropdownMenu.css({
                'display': 'block',
                'top': setDropdownPositionTop(currTarget,dropdownHeight,targetOuterHeight, eOffsetTop)? eOffsetTop - dropdownHeight : eOffsetTop + targetOuterHeight,
                'right': rtOffset
            });
        });

        $(container).on('hidden.bs.dropdown',dropdownCls, function (e) {
            $(e.currentTarget).append(actionDropdownMenu.detach());
            actionDropdownMenu.hide();
        });

        var setDropdownPositionTop = function (target, dropdownHeight, targetOuterHeight, topOffset) {
            var screenHeight = $(window).height(),
                currentTargetHeight = targetOuterHeight+ dropdownHeight,
                totalHeight = parseInt(currentTargetHeight + topOffset);
            return (screenHeight < totalHeight);
        }
    };

    var htmlOverflowYHidden = function(){
        if (!hasMultipleList) {
            document.getElementsByTagName('html')[0].classList.add('overflow-y-hidden'); // '0' to assign the first (and only `HTML` tag)
        }
    };

    var gridWidgetTableHeight = function (container) {
        return container.find(".dataTables_scrollBody table").outerHeight();
    };

    var updateFixedColHeight = function (container) {
        var dataScrollableBody = container.find("div.dataTables_scrollBody"),
            dataScrollFixedCol = container.find("div.DTFC_LeftBodyWrapper, div.DTFC_LeftBodyLiner");
        setTimeout(function () {
            $(dataScrollFixedCol).height(getGridHeight(container));
        }, 10);
        pvui.grid.manageUIWrapper.updatePerfectScrollbar(container);
    };

    var getGridHeight = function (container) {
        if (!hasMultipleList) {
            var containerTopSearch = container.find(".pv-topsrc-container"),
                isTopSrcVisible = containerTopSearch.is(":visible"),
                containerTopSearchHeight = $(containerTopSearch).outerHeight(),
                pageContainerHeight = $(window).height()-265; // 265 is height of topheader + bottom fixed section
            return isTopSrcVisible? pageContainerHeight-containerTopSearchHeight: pageContainerHeight;
        } else {
            return gridWidgetTableHeight(container);// Fixed Widget Height
        }
    };

    var setGridHeight = function (container) {
        if (!hasMultipleList) {
            var dataScrollableBody = container.find("div.dataTables_scrollBody");
            $(dataScrollableBody).css({"height":getGridHeight(container), "max-height":getGridHeight(container)});
        }
        updateFixedColHeight(container);// Fixed Widget Height
    };

    var updateGridOnResize = function (container) {
        $(window).resize(function () {
            setGridHeight(container);
        });
    };

    var manageListingUI = function () {
        var hideSettingPanel = function () {
            wrapperContainer.removeClass('right-bar-enabled');
            $(".rightpanel-backdrop").remove();
        };
        var showSettingPanel = function () {
            wrapperContainer.addClass('right-bar-enabled');
        };
        return{
            hideSettingPanel:hideSettingPanel,
            showSettingPanel: showSettingPanel
        }
    }();
    return{
        appendDropdownOutsideContainer:appendDropdownOutsideContainer,
        htmlOverflowYHidden:htmlOverflowYHidden,
        getGridHeight:getGridHeight,
        setGridHeight:setGridHeight,
        updateGridOnResize:updateGridOnResize,
        manageListingUI:manageListingUI
    }
}();
var pvui = pvui || {};
pvui.grid = pvui.grid || {};
var itemDragged = false;
pvui.grid.manageUIWrapper = function () {
    var psGrid;
    var preventScrollingEmptyGrid = function (container, scrollableSection) {
        if(container.find(".dataTables_empty").length){
            scrollableSection.css({"overflow-y":"hidden"});
        } else {
            scrollableSection.css({"overflow-y":"auto"});
        }
    },
    disableTableScrolling = function (scrollableSection, scrollableFixedCol) {
        scrollableSection.css({"overflow":"hidden"});
        scrollableFixedCol.css({"overflow-y":"hidden"});
    },
    enableTableScrolling = function (scrollableSection, scrollableFixedCol) {
        scrollableSection.css({"overflow":"auto"});
        scrollableFixedCol.css({"overflow-y":"scroll"});
    },
    isSecondaryView = function (container, gridRow) {
        var idx = $(gridRow).index();
        return container.find(".dataTables_scrollBody>table>tbody>tr:nth-child("+idx+")").hasClass("details");
    },
    allTargetedRows = function (container, gridRow) {
        var idx = $(gridRow).index() + 1,
            allRows,
            tableScrollBody = ".dataTables_scrollBody>table>tbody",
            tableFixedLeft = ".DTFC_LeftBodyLiner>table>tbody",
            hasSecondaryAndVisible = container.find(tableScrollBody+">tr:nth-child("+idx+")").hasClass("details"),
            isThisSecondaryView = isSecondaryView(container, gridRow);
        if(isThisSecondaryView) {
            var idxPrimary= $(gridRow).index();
            allRows = tableScrollBody+">tr:nth-child("+idx+"),"+
                tableFixedLeft+">tr:nth-child("+idx + "),"+
                tableScrollBody+">tr:nth-child("+idxPrimary +"),"+
                tableFixedLeft+">tr:nth-child("+idxPrimary+")";
            return allRows;
        }  else if(hasSecondaryAndVisible) {
            var idxSecondary= $(gridRow).index()+2;
            allRows = tableScrollBody+">tr:nth-child("+idx+"),"+
                tableFixedLeft+">tr:nth-child("+idx + "),"+
                tableScrollBody+">tr:nth-child("+idxSecondary+"),"+
                tableFixedLeft+">tr:nth-child("+idxSecondary+")";
            return allRows;
        } else{
            allRows= tableScrollBody+">tr:nth-child("+idx+"),"+
                tableFixedLeft+">tr:nth-child("+idx + ")";
            return allRows;
        }
    },
    checkRowAndCell = function (container, gridRow) {
        var idx = $(gridRow).index() + 1,
            currActionBtnRow = container.find(".dataTables_scrollBody>table>tbody>tr:nth-child("+ idx +")"),
            actionCol = currActionBtnRow.find(".pv-table-action"),
            actionCell = currActionBtnRow.find(".pv-table-action>.td-box"),
            allFixedCurrRow = allTargetedRows(container, gridRow),
            currRow = container.find(allFixedCurrRow);
        return {row:currRow,cell:actionCell,col:actionCol};
    },
    setGridActionButtonPosition = function (row) {
        var currParentContainer = $(row).closest(".DTFC_ScrollWrapper").find(".dataTables_scrollBody"),
            gridContainerWidth = currParentContainer.outerWidth(),
            gridScrolled = currParentContainer.scrollLeft(),
            leftOffset = gridContainerWidth+gridScrolled;
        return leftOffset;
    },
    handleRowMouseOverEvent = function (container) {
        var gridRow = ".dataTables_scrollBody>table>tbody>tr, .DTFC_LeftBodyLiner>table>tbody>tr",
            containerGrid = container.find(".dataTables_scrollBody"),
            containerSize = containerGrid.outerWidth(),
            containerScrollableWidth = containerGrid.get(0).scrollWidth,
            clonedCTA;
        container.off("mouseenter mouseleave").on("mouseenter", gridRow, function () {
            var target = checkRowAndCell(container, $(this));
            if(containerSize < containerScrollableWidth){
                var positionCTA = setGridActionButtonPosition($(this)) - target.cell.outerWidth();
                clonedCTA = target.cell.detach();
                clonedCTA.addClass("pv-list-action-cta").css({left:positionCTA+"px"});
                target.col.after(clonedCTA);
                target.row.addClass("curr-record");
            } else{
                target.row.addClass("curr-record");
            }
        }).on("mouseleave", gridRow, function () {
            var target = checkRowAndCell(container, $(this));
            if(containerSize < containerScrollableWidth){
                clonedCTA.removeClass("pv-list-action-cta");
                clonedCTA.attr("style", "");
                target.col.append(clonedCTA);
                target.row.removeClass("curr-record");
            } else{
                target.row.removeClass("curr-record");
            }
        });
    },
    handleDragDropEvent = function (container) {
        itemDragged = false;
        container.find(".ui-sortable").sortable({
            update: function () {
                itemDragged = true;
                psGrid.update();
            }
        });
    },
    handleGridHorizontalScroll = function (container) {
            container.find(".dataTables_scrollBody").on("scroll, touchmove",function () {
                var that = $(this);
                var isGridScrollable = that.outerWidth() < that.get(0).scrollWidth;
                var secodaryViewRow = that.find(".footable-row-detail-inner");
                var scrolledLeft = that.get(0).scrollLeft;
                if(isGridScrollable && scrolledLeft > 0){
                    secodaryViewRow.css("margin-left",scrolledLeft+"px");
                    var cta = container.find(".dataTables_scrollBody .pv-list-action-cta");
                    var ctaCloseTD = cta.prev();
                    cta.detach().removeClass("pv-list-action-cta").appendTo(ctaCloseTD);
                } else{
                    secodaryViewRow.css("margin-left","0px");
                }
            });
        },
    bindIconHoverEvents = function (container) {
        container.find(".reportStateMessage").webuiPopover({
            trigger:"hover",
            width:400,
            content:$(this).data("content")
        });
    },
    setPerfectScrollbar = function (container) {
        psGrid = new PerfectScrollbar(container.find('.dataTables_scrollBody')[0]);
        var psSettingPanel = new PerfectScrollbar(".side-bar.right-bar");
    },
    updatePerfectScrollbar = function (container) {
        var scrollContainer = container.find('.dataTables_scrollBody')[0];
        if(psGrid){
            psGrid.update();
        }
        $(scrollContainer).scroll();
    },
    setMoreOption = function (container) {
        container.find('.pvjs_outer-more-box').each( function () {
            // console.log($(this));
            var ele = $(this)
            var innerContainer = ele.find(".pvjs_inner-more-box");
            var moreData = ele.attr("data-more");
            var dataName = ele.attr("data-name");
            var moreOption = '<a type="link" class="cl-ic-more"><i class="fa fa-ellipsis-h more-option"  data-moredata="' + moreData + '" data-item="' + dataName + '"> </i> </a>';
            if(innerContainer.innerHeight() > ele.innerHeight()){
                innerContainer.append(moreOption);
            }
        });
    },
    scrollTopGrid = function (container) {
        var scrollContainer = container.find('.dataTables_scrollBody');
        scrollContainer.scrollTop(0);
    },
    initializePopover = function (container) {
        _.each(container.find('.more-option'), function (ele) {
            var moreData = pvi.util.removeHTMLTags($(ele).data('moredata'));
            $(ele).webuiPopover({
                html: true,
                trigger: 'hover',
                content: function () {
                    if(_.isEmpty(moreData)) {
                        moreData = "";
                    }
                    var theData = _.filter(moreData.split(','), function (it) {
                        return !_.isEmpty(it.trim());
                    });
                    var v = "";
                    var theDataLength = theData.length;
                    for (var i = 0; i < theDataLength; i++) {
                        if (theData[i])
                            v = v + "<a>" + theData[i] + "</a>";
                        if (i < theDataLength - 1) {
                            v = v + ",<br>";
                        }
                    }
                    return v;
                }
            });
        });
    },
    setMoreDataOption = function (containerId) {
        _.each($("#"+containerId).find(".pvjs_outer-more-box"), function (ele) {
            var innerContainer = $(ele).find(".pvjs_inner-more-box");
            var moreData = innerContainer.html();
            var moreOption = '<a type="link" class="cl-ic-more" title="See All"><i class="fa fa-ellipsis-h more-option"> </i><span class="hide">'+moreData+'</span> </a>';
            if(innerContainer.innerHeight() > $(ele).innerHeight()){
                innerContainer.append(moreOption);
            }
        });
    },

    bindMoreContentPopover = function (containerId) {
        _.each($("#"+containerId).find('.more-option'), function (ele) {
            $(ele).webuiPopover('destroy').webuiPopover({
                trigger: 'hover',
                content: function () {
                    return $(ele).next('span').html();
                }
            });
        });
    },
    closeSettingPanel = function (callback, target) {
        var checkAndHide = function () {
            if (itemDragged) {
                callback();
            } else{
                pvui.grid.utils.manageListingUI.hideSettingPanel();
            }
        };
        if(target) {
            target.click(function () {
                checkAndHide();
            });
        } else {
            $(document).on("click", ".rightpanel-backdrop", function () {
                checkAndHide();
            });
        }

    },
    toggleGridFilter = function (container,options) {
        if(container.find('.list-filter').is(':visible')) {
            container.find('.list-filter').hide();
            container.find('.filter-head').find('.select2-container').hide();
        } else {
            container.find('.list-filter').show();
            container.find('.select2-container').show();
            container.find('.date-time-filter').attr("placeholder", options?options.dateFormat:'');
        }
    };

    return {
        preventScrollingEmptyGrid:preventScrollingEmptyGrid,
        disableTableScrolling: disableTableScrolling,
        enableTableScrolling: enableTableScrolling,
        handleRowMouseOverEvent: handleRowMouseOverEvent,
        handleGridHorizontalScroll: handleGridHorizontalScroll,
        bindIconHoverEvents: bindIconHoverEvents,
        setPerfectScrollbar:setPerfectScrollbar,
        updatePerfectScrollbar:updatePerfectScrollbar,
        setGridActionButtonPosition: setGridActionButtonPosition,
        setMoreOption: setMoreOption,
        handleDragDropEvent: handleDragDropEvent,
        scrollTopGrid:scrollTopGrid,
        initializePopover: initializePopover,
        setMoreDataOption:setMoreDataOption,
        bindMoreContentPopover:bindMoreContentPopover,
        closeSettingPanel:closeSettingPanel,
        toggleGridFilter: toggleGridFilter
    }
}();
//= require vendorUi/datatables/jquery.dataTables.min
//= require vendorUi/datatables/dataTables.fixedColumns.min
//= require vendorUi/datatables/dataTables.bootstrap.min
//= require vendorUi/datatables/datetime-moment
//= require component/grid/pvui-grid
//= require_self
/*! ColReorder 1.3.3
 * ©2010-2015 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     ColReorder
 * @description Provide the ability to reorder columns in a DataTable
 * @version     1.3.3
 * @file        dataTables.colReorder.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2014 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
(function( factory ){
    if ( typeof define === 'function' && define.amd ) {
        // AMD
        define( ['jquery', 'datatables.net'], function ( $ ) {
            return factory( $, window, document );
        } );
    }
    else if ( typeof exports === 'object' ) {
        // CommonJS
        module.exports = function (root, $) {
            if ( ! root ) {
                root = window;
            }

            if ( ! $ || ! $.fn.dataTable ) {
                $ = require('datatables.net')(root, $).$;
            }

            return factory( $, root, root.document );
        };
    }
    else {
        // Browser
        factory( jQuery, window, document );
    }
}(function( $, window, document, undefined ) {
    'use strict';
    var DataTable = $.fn.dataTable;


    /**
     * Switch the key value pairing of an index array to be value key (i.e. the old value is now the
     * key). For example consider [ 2, 0, 1 ] this would be returned as [ 1, 2, 0 ].
     *  @method  fnInvertKeyValues
     *  @param   array aIn Array to switch around
     *  @returns array
     */
    function fnInvertKeyValues( aIn )
    {
        var aRet=[];
        for ( var i=0, iLen=aIn.length ; i<iLen ; i++ )
        {
            aRet[ aIn[i] ] = i;
        }
        return aRet;
    }


    /**
     * Modify an array by switching the position of two elements
     *  @method  fnArraySwitch
     *  @param   array aArray Array to consider, will be modified by reference (i.e. no return)
     *  @param   int iFrom From point
     *  @param   int iTo Insert point
     *  @returns void
     */
    function fnArraySwitch( aArray, iFrom, iTo )
    {
        var mStore = aArray.splice( iFrom, 1 )[0];
        aArray.splice( iTo, 0, mStore );
    }


    /**
     * Switch the positions of nodes in a parent node (note this is specifically designed for
     * table rows). Note this function considers all element nodes under the parent!
     *  @method  fnDomSwitch
     *  @param   string sTag Tag to consider
     *  @param   int iFrom Element to move
     *  @param   int Point to element the element to (before this point), can be null for append
     *  @returns void
     */
    function fnDomSwitch( nParent, iFrom, iTo )
    {
        var anTags = [];
        for ( var i=0, iLen=nParent.childNodes.length ; i<iLen ; i++ )
        {
            if ( nParent.childNodes[i].nodeType == 1 )
            {
                anTags.push( nParent.childNodes[i] );
            }
        }
        var nStore = anTags[ iFrom ];

        if ( iTo !== null )
        {
            nParent.insertBefore( nStore, anTags[iTo] );
        }
        else
        {
            nParent.appendChild( nStore );
        }
    }


    /**
     * Plug-in for DataTables which will reorder the internal column structure by taking the column
     * from one position (iFrom) and insert it into a given point (iTo).
     *  @method  $.fn.dataTableExt.oApi.fnColReorder
     *  @param   object oSettings DataTables settings object - automatically added by DataTables!
     *  @param   int iFrom Take the column to be repositioned from this point
     *  @param   int iTo and insert it into this point
     *  @param   bool drop Indicate if the reorder is the final one (i.e. a drop)
     *    not a live reorder
     *  @param   bool invalidateRows speeds up processing if false passed
     *  @returns void
     */
    $.fn.dataTableExt.oApi.fnColReorder = function ( oSettings, iFrom, iTo, drop, invalidateRows )
    {
        var i, iLen, j, jLen, jen, iCols=oSettings.aoColumns.length, nTrs, oCol;
        var attrMap = function ( obj, prop, mapping ) {
            if ( ! obj[ prop ] || typeof obj[ prop ] === 'function' ) {
                return;
            }

            var a = obj[ prop ].split('.');
            var num = a.shift();

            if ( isNaN( num*1 ) ) {
                return;
            }

            obj[ prop ] = mapping[ num*1 ]+'.'+a.join('.');
        };

        /* Sanity check in the input */
        if ( iFrom == iTo )
        {
            /* Pointless reorder */
            return;
        }

        if ( iFrom < 0 || iFrom >= iCols )
        {
            this.oApi._fnLog( oSettings, 1, "ColReorder 'from' index is out of bounds: "+iFrom );
            return;
        }

        if ( iTo < 0 || iTo >= iCols )
        {
            this.oApi._fnLog( oSettings, 1, "ColReorder 'to' index is out of bounds: "+iTo );
            return;
        }

        /*
         * Calculate the new column array index, so we have a mapping between the old and new
         */
        var aiMapping = [];
        for ( i=0, iLen=iCols ; i<iLen ; i++ )
        {
            aiMapping[i] = i;
        }
        fnArraySwitch( aiMapping, iFrom, iTo );
        var aiInvertMapping = fnInvertKeyValues( aiMapping );


        /*
         * Convert all internal indexing to the new column order indexes
         */
        /* Sorting */
        for ( i=0, iLen=oSettings.aaSorting.length ; i<iLen ; i++ )
        {
            oSettings.aaSorting[i][0] = aiInvertMapping[ oSettings.aaSorting[i][0] ];
        }

        /* Fixed sorting */
        if ( oSettings.aaSortingFixed !== null )
        {
            for ( i=0, iLen=oSettings.aaSortingFixed.length ; i<iLen ; i++ )
            {
                oSettings.aaSortingFixed[i][0] = aiInvertMapping[ oSettings.aaSortingFixed[i][0] ];
            }
        }

        /* Data column sorting (the column which the sort for a given column should take place on) */
        for ( i=0, iLen=iCols ; i<iLen ; i++ )
        {
            oCol = oSettings.aoColumns[i];
            for ( j=0, jLen=oCol.aDataSort.length ; j<jLen ; j++ )
            {
                oCol.aDataSort[j] = aiInvertMapping[ oCol.aDataSort[j] ];
            }

            // Update the column indexes
            oCol.idx = aiInvertMapping[ oCol.idx ];
        }

        // Update 1.10 optimised sort class removal variable
        $.each( oSettings.aLastSort, function (i, val) {
            oSettings.aLastSort[i].src = aiInvertMapping[ val.src ];
        } );

        /* Update the Get and Set functions for each column */
        for ( i=0, iLen=iCols ; i<iLen ; i++ )
        {
            oCol = oSettings.aoColumns[i];

            if ( typeof oCol.mData == 'number' ) {
                oCol.mData = aiInvertMapping[ oCol.mData ];
            }
            else if ( $.isPlainObject( oCol.mData ) ) {
                // HTML5 data sourced
                attrMap( oCol.mData, '_',      aiInvertMapping );
                attrMap( oCol.mData, 'filter', aiInvertMapping );
                attrMap( oCol.mData, 'sort',   aiInvertMapping );
                attrMap( oCol.mData, 'type',   aiInvertMapping );
            }
        }

        /*
         * Move the DOM elements
         */
        if ( oSettings.aoColumns[iFrom].bVisible )
        {
            /* Calculate the current visible index and the point to insert the node before. The insert
             * before needs to take into account that there might not be an element to insert before,
             * in which case it will be null, and an appendChild should be used
             */
            var iVisibleIndex = this.oApi._fnColumnIndexToVisible( oSettings, iFrom );
            var iInsertBeforeIndex = null;

            i = iTo < iFrom ? iTo : iTo + 1;
            while ( iInsertBeforeIndex === null && i < iCols )
            {
                iInsertBeforeIndex = this.oApi._fnColumnIndexToVisible( oSettings, i );
                i++;
            }

            /* Header */
            nTrs = oSettings.nTHead.getElementsByTagName('tr');
            for ( i=0, iLen=nTrs.length ; i<iLen ; i++ )
            {
                fnDomSwitch( nTrs[i], iVisibleIndex, iInsertBeforeIndex );
            }

            /* Footer */
            if ( oSettings.nTFoot !== null )
            {
                nTrs = oSettings.nTFoot.getElementsByTagName('tr');
                for ( i=0, iLen=nTrs.length ; i<iLen ; i++ )
                {
                    fnDomSwitch( nTrs[i], iVisibleIndex, iInsertBeforeIndex );
                }
            }

            /* Body */
            for ( i=0, iLen=oSettings.aoData.length ; i<iLen ; i++ )
            {
                if ( oSettings.aoData[i].nTr !== null )
                {
                    fnDomSwitch( oSettings.aoData[i].nTr, iVisibleIndex, iInsertBeforeIndex );
                }
            }
        }

        /*
         * Move the internal array elements
         */
        /* Columns */
        fnArraySwitch( oSettings.aoColumns, iFrom, iTo );

        // regenerate the get / set functions
        for ( i=0, iLen=iCols ; i<iLen ; i++ ) {
            oSettings.oApi._fnColumnOptions( oSettings, i, {} );
        }

        /* Search columns */
        fnArraySwitch( oSettings.aoPreSearchCols, iFrom, iTo );

        /* Array array - internal data anodes cache */
        for ( i=0, iLen=oSettings.aoData.length ; i<iLen ; i++ )
        {
            var data = oSettings.aoData[i];
            var cells = data.anCells;

            if ( cells ) {
                fnArraySwitch( cells, iFrom, iTo );

                // Longer term, should this be moved into the DataTables' invalidate
                // methods?
                for ( j=0, jen=cells.length ; j<jen ; j++ ) {
                    if ( cells[j] && cells[j]._DT_CellIndex ) {
                        cells[j]._DT_CellIndex.column = j;
                    }
                }
            }

            // For DOM sourced data, the invalidate will reread the cell into
            // the data array, but for data sources as an array, they need to
            // be flipped
            if ( data.src !== 'dom' && $.isArray( data._aData ) ) {
                fnArraySwitch( data._aData, iFrom, iTo );
            }
        }

        /* Reposition the header elements in the header layout array */
        for ( i=0, iLen=oSettings.aoHeader.length ; i<iLen ; i++ )
        {
            fnArraySwitch( oSettings.aoHeader[i], iFrom, iTo );
        }

        if ( oSettings.aoFooter !== null )
        {
            for ( i=0, iLen=oSettings.aoFooter.length ; i<iLen ; i++ )
            {
                fnArraySwitch( oSettings.aoFooter[i], iFrom, iTo );
            }
        }

        if ( invalidateRows || invalidateRows === undefined )
        {
            $.fn.dataTable.Api( oSettings ).rows().invalidate();
        }

        /*
         * Update DataTables' event handlers
         */

        /* Sort listener */
        for ( i=0, iLen=iCols ; i<iLen ; i++ )
        {
            $(oSettings.aoColumns[i].nTh).off('click.DT');
            this.oApi._fnSortAttachListener( oSettings, oSettings.aoColumns[i].nTh, i );
        }


        /* Fire an event so other plug-ins can update */
        $(oSettings.oInstance).trigger( 'column-reorder.dt', [ oSettings, {
            from: iFrom,
            to: iTo,
            mapping: aiInvertMapping,
            drop: drop,

            // Old style parameters for compatibility
            iFrom: iFrom,
            iTo: iTo,
            aiInvertMapping: aiInvertMapping
        } ] );
    };

    /**
     * ColReorder provides column visibility control for DataTables
     * @class ColReorder
     * @constructor
     * @param {object} dt DataTables settings object
     * @param {object} opts ColReorder options
     */
    var ColReorder = function( dt, opts )
    {
        var settings = new $.fn.dataTable.Api( dt ).settings()[0];

        // Ensure that we can't initialise on the same table twice
        if ( settings._colReorder ) {
            return settings._colReorder;
        }

        // Allow the options to be a boolean for defaults
        if ( opts === true ) {
            opts = {};
        }

        // Convert from camelCase to Hungarian, just as DataTables does
        var camelToHungarian = $.fn.dataTable.camelToHungarian;
        if ( camelToHungarian ) {
            camelToHungarian( ColReorder.defaults, ColReorder.defaults, true );
            camelToHungarian( ColReorder.defaults, opts || {} );
        }


        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Public class variables
         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

        /**
         * @namespace Settings object which contains customisable information for ColReorder instance
         */
        this.s = {
            /**
             * DataTables settings object
             *  @property dt
             *  @type     Object
             *  @default  null
             */
            "dt": null,

            /**
             * Initialisation object used for this instance
             *  @property init
             *  @type     object
             *  @default  {}
             */
            "init": $.extend( true, {}, ColReorder.defaults, opts ),

            /**
             * Number of columns to fix (not allow to be reordered)
             *  @property fixed
             *  @type     int
             *  @default  0
             */
            "fixed": 0,

            /**
             * Number of columns to fix counting from right (not allow to be reordered)
             *  @property fixedRight
             *  @type     int
             *  @default  0
             */
            "fixedRight": 0,

            /**
             * Callback function for once the reorder has been done
             *  @property reorderCallback
             *  @type     function
             *  @default  null
             */
            "reorderCallback": null,

            /**
             * @namespace Information used for the mouse drag
             */
            "mouse": {
                "startX": -1,
                "startY": -1,
                "offsetX": -1,
                "offsetY": -1,
                "target": -1,
                "targetIndex": -1,
                "fromIndex": -1
            },

            /**
             * Information which is used for positioning the insert cusor and knowing where to do the
             * insert. Array of objects with the properties:
             *   x: x-axis position
             *   to: insert point
             *  @property aoTargets
             *  @type     array
             *  @default  []
             */
            "aoTargets": []
        };


        /**
         * @namespace Common and useful DOM elements for the class instance
         */
        this.dom = {
            /**
             * Dragging element (the one the mouse is moving)
             *  @property drag
             *  @type     element
             *  @default  null
             */
            "drag": null,

            /**
             * The insert cursor
             *  @property pointer
             *  @type     element
             *  @default  null
             */
            "pointer": null
        };


        /* Constructor logic */
        this.s.dt = settings;
        this.s.dt._colReorder = this;
        this._fnConstruct();

        return this;
    };



    $.extend( ColReorder.prototype, {
        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Public methods
         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

        /**
         * Reset the column ordering to the original ordering that was detected on
         * start up.
         *  @return {this} Returns `this` for chaining.
         *
         *  @example
         *    // DataTables initialisation with ColReorder
         *    var table = $('#example').dataTable( {
	 *        "sDom": 'Rlfrtip'
	 *    } );
         *
         *    // Add click event to a button to reset the ordering
         *    $('#resetOrdering').click( function (e) {
	 *        e.preventDefault();
	 *        $.fn.dataTable.ColReorder( table ).fnReset();
	 *    } );
         */
        "fnReset": function ()
        {
            this._fnOrderColumns( this.fnOrder() );

            return this;
        },

        /**
         * `Deprecated` - Get the current order of the columns, as an array.
         *  @return {array} Array of column identifiers
         *  @deprecated `fnOrder` should be used in preference to this method.
         *      `fnOrder` acts as a getter/setter.
         */
        "fnGetCurrentOrder": function ()
        {
            return this.fnOrder();
        },

        /**
         * Get the current order of the columns, as an array. Note that the values
         * given in the array are unique identifiers for each column. Currently
         * these are the original ordering of the columns that was detected on
         * start up, but this could potentially change in future.
         *  @return {array} Array of column identifiers
         *
         *  @example
         *    // Get column ordering for the table
         *    var order = $.fn.dataTable.ColReorder( dataTable ).fnOrder();
         *//**
         * Set the order of the columns, from the positions identified in the
         * ordering array given. Note that ColReorder takes a brute force approach
         * to reordering, so it is possible multiple reordering events will occur
         * before the final order is settled upon.
         *  @param {array} [set] Array of column identifiers in the new order. Note
         *    that every column must be included, uniquely, in this array.
         *  @return {this} Returns `this` for chaining.
         *
         *  @example
         *    // Swap the first and second columns
         *    $.fn.dataTable.ColReorder( dataTable ).fnOrder( [1, 0, 2, 3, 4] );
         *
         *  @example
         *    // Move the first column to the end for the table `#example`
         *    var curr = $.fn.dataTable.ColReorder( '#example' ).fnOrder();
         *    var first = curr.shift();
         *    curr.push( first );
         *    $.fn.dataTable.ColReorder( '#example' ).fnOrder( curr );
         *
         *  @example
         *    // Reverse the table's order
         *    $.fn.dataTable.ColReorder( '#example' ).fnOrder(
         *      $.fn.dataTable.ColReorder( '#example' ).fnOrder().reverse()
         *    );
         */
        "fnOrder": function ( set, original )
        {
            var a = [], i, ien, j, jen;
            var columns = this.s.dt.aoColumns;

            if ( set === undefined ){
                for ( i=0, ien=columns.length ; i<ien ; i++ ) {
                    a.push( columns[i]._ColReorder_iOrigCol );
                }

                return a;
            }

            // The order given is based on the original indexes, rather than the
            // existing ones, so we need to translate from the original to current
            // before then doing the order
            if ( original ) {
                var order = this.fnOrder();

                for ( i=0, ien=set.length ; i<ien ; i++ ) {
                    a.push( $.inArray( set[i], order ) );
                }

                set = a;
            }

            this._fnOrderColumns( fnInvertKeyValues( set ) );

            return this;
        },


        /**
         * Convert from the original column index, to the original
         *
         * @param  {int|array} idx Index(es) to convert
         * @param  {string} dir Transpose direction - `fromOriginal` / `toCurrent`
         *   or `'toOriginal` / `fromCurrent`
         * @return {int|array}     Converted values
         */
        fnTranspose: function ( idx, dir )
        {
            if ( ! dir ) {
                dir = 'toCurrent';
            }

            var order = this.fnOrder();
            var columns = this.s.dt.aoColumns;

            if ( dir === 'toCurrent' ) {
                // Given an original index, want the current
                return ! $.isArray( idx ) ?
                    $.inArray( idx, order ) :
                    $.map( idx, function ( index ) {
                        return $.inArray( index, order );
                    } );
            }
            else {
                // Given a current index, want the original
                return ! $.isArray( idx ) ?
                    columns[idx]._ColReorder_iOrigCol :
                    $.map( idx, function ( index ) {
                        return columns[index]._ColReorder_iOrigCol;
                    } );
            }
        },


        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Private methods (they are of course public in JS, but recommended as private)
         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

        /**
         * Constructor logic
         *  @method  _fnConstruct
         *  @returns void
         *  @private
         */
        "_fnConstruct": function ()
        {
            var that = this;
            var iLen = this.s.dt.aoColumns.length;
            var table = this.s.dt.nTable;
            var i;

            /* Columns discounted from reordering - counting left to right */
            if ( this.s.init.iFixedColumns )
            {
                this.s.fixed = this.s.init.iFixedColumns;
            }

            if ( this.s.init.iFixedColumnsLeft )
            {
                this.s.fixed = this.s.init.iFixedColumnsLeft;
            }

            /* Columns discounted from reordering - counting right to left */
            this.s.fixedRight = this.s.init.iFixedColumnsRight ?
                this.s.init.iFixedColumnsRight :
                0;

            /* Drop callback initialisation option */
            if ( this.s.init.fnReorderCallback )
            {
                this.s.reorderCallback = this.s.init.fnReorderCallback;
            }

            /* Add event handlers for the drag and drop, and also mark the original column order */
            for ( i = 0; i < iLen; i++ )
            {
                if ( i > this.s.fixed-1 && i < iLen - this.s.fixedRight )
                {
                    this._fnMouseListener( i, this.s.dt.aoColumns[i].nTh );
                }

                /* Mark the original column order for later reference */
                this.s.dt.aoColumns[i]._ColReorder_iOrigCol = i;
            }

            /* State saving */
            this.s.dt.oApi._fnCallbackReg( this.s.dt, 'aoStateSaveParams', function (oS, oData) {
                that._fnStateSave.call( that, oData );
            }, "ColReorder_State" );

            /* An initial column order has been specified */
            var aiOrder = null;
            if ( this.s.init.aiOrder )
            {
                aiOrder = this.s.init.aiOrder.slice();
            }

            /* State loading, overrides the column order given */
            if ( this.s.dt.oLoadedState && typeof this.s.dt.oLoadedState.ColReorder != 'undefined' &&
                this.s.dt.oLoadedState.ColReorder.length == this.s.dt.aoColumns.length )
            {
                aiOrder = this.s.dt.oLoadedState.ColReorder;
            }

            /* If we have an order to apply - do so */
            if ( aiOrder )
            {
                /* We might be called during or after the DataTables initialisation. If before, then we need
                 * to wait until the draw is done, if after, then do what we need to do right away
                 */
                if ( !that.s.dt._bInitComplete )
                {
                    var bDone = false;
                    $(table).on( 'draw.dt.colReorder', function () {
                        if ( !that.s.dt._bInitComplete && !bDone )
                        {
                            bDone = true;
                            var resort = fnInvertKeyValues( aiOrder );
                            that._fnOrderColumns.call( that, resort );
                        }
                    } );
                }
                else
                {
                    var resort = fnInvertKeyValues( aiOrder );
                    that._fnOrderColumns.call( that, resort );
                }
            }
            else {
                this._fnSetColumnIndexes();
            }

            // Destroy clean up
            $(table).on( 'destroy.dt.colReorder', function () {
                $(table).off( 'destroy.dt.colReorder draw.dt.colReorder' );
                $(that.s.dt.nTHead).find( '*' ).off( '.ColReorder' );

                $.each( that.s.dt.aoColumns, function (i, column) {
                    $(column.nTh).removeAttr('data-column-index');
                } );

                that.s.dt._colReorder = null;
                that.s = null;
            } );
        },


        /**
         * Set the column order from an array
         *  @method  _fnOrderColumns
         *  @param   array a An array of integers which dictate the column order that should be applied
         *  @returns void
         *  @private
         */
        "_fnOrderColumns": function ( a )
        {
            var changed = false;

            if ( a.length != this.s.dt.aoColumns.length )
            {
                this.s.dt.oInstance.oApi._fnLog( this.s.dt, 1, "ColReorder - array reorder does not "+
                    "match known number of columns. Skipping." );
                return;
            }

            for ( var i=0, iLen=a.length ; i<iLen ; i++ )
            {
                var currIndex = $.inArray( i, a );
                if ( i != currIndex )
                {
                    /* Reorder our switching array */
                    fnArraySwitch( a, currIndex, i );

                    /* Do the column reorder in the table */
                    this.s.dt.oInstance.fnColReorder( currIndex, i, true, false );

                    changed = true;
                }
            }

            $.fn.dataTable.Api( this.s.dt ).rows().invalidate();

            this._fnSetColumnIndexes();

            // Has anything actually changed? If not, then nothing else to do
            if ( ! changed ) {
                return;
            }

            /* When scrolling we need to recalculate the column sizes to allow for the shift */
            if ( this.s.dt.oScroll.sX !== "" || this.s.dt.oScroll.sY !== "" )
            {
                this.s.dt.oInstance.fnAdjustColumnSizing( false );
            }

            /* Save the state */
            this.s.dt.oInstance.oApi._fnSaveState( this.s.dt );

            if ( this.s.reorderCallback !== null )
            {
                this.s.reorderCallback.call( this );
            }
        },


        /**
         * Because we change the indexes of columns in the table, relative to their starting point
         * we need to reorder the state columns to what they are at the starting point so we can
         * then rearrange them again on state load!
         *  @method  _fnStateSave
         *  @param   object oState DataTables state
         *  @returns string JSON encoded cookie string for DataTables
         *  @private
         */
        "_fnStateSave": function ( oState )
        {
            var i, iLen, aCopy, iOrigColumn;
            var oSettings = this.s.dt;
            var columns = oSettings.aoColumns;

            oState.ColReorder = [];

            /* Sorting */
            if ( oState.aaSorting ) {
                // 1.10.0-
                for ( i=0 ; i<oState.aaSorting.length ; i++ ) {
                    oState.aaSorting[i][0] = columns[ oState.aaSorting[i][0] ]._ColReorder_iOrigCol;
                }

                var aSearchCopy = $.extend( true, [], oState.aoSearchCols );

                for ( i=0, iLen=columns.length ; i<iLen ; i++ )
                {
                    iOrigColumn = columns[i]._ColReorder_iOrigCol;

                    /* Column filter */
                    oState.aoSearchCols[ iOrigColumn ] = aSearchCopy[i];

                    /* Visibility */
                    oState.abVisCols[ iOrigColumn ] = columns[i].bVisible;

                    /* Column reordering */
                    oState.ColReorder.push( iOrigColumn );
                }
            }
            else if ( oState.order ) {
                // 1.10.1+
                for ( i=0 ; i<oState.order.length ; i++ ) {
                    oState.order[i][0] = columns[ oState.order[i][0] ]._ColReorder_iOrigCol;
                }

                var stateColumnsCopy = $.extend( true, [], oState.columns );

                for ( i=0, iLen=columns.length ; i<iLen ; i++ )
                {
                    iOrigColumn = columns[i]._ColReorder_iOrigCol;

                    /* Columns */
                    oState.columns[ iOrigColumn ] = stateColumnsCopy[i];

                    /* Column reordering */
                    oState.ColReorder.push( iOrigColumn );
                }
            }
        },


        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Mouse drop and drag
         */

        /**
         * Add a mouse down listener to a particluar TH element
         *  @method  _fnMouseListener
         *  @param   int i Column index
         *  @param   element nTh TH element clicked on
         *  @returns void
         *  @private
         */
        "_fnMouseListener": function ( i, nTh )
        {
            /*
            var that = this;
            $(nTh)
                .on( 'mousedown.ColReorder', function (e) {
                    e.preventDefault();
                    that._fnMouseDown.call( that, e, nTh );
                } )
                .on( 'touchstart.ColReorder', function (e) {
                    that._fnMouseDown.call( that, e, nTh );
                } );
                */
        },


        /**
         * Mouse down on a TH element in the table header
         *  @method  _fnMouseDown
         *  @param   event e Mouse event
         *  @param   element nTh TH element to be dragged
         *  @returns void
         *  @private
         */
        "_fnMouseDown": function ( e, nTh )
        {
            var that = this;

            /* Store information about the mouse position */
            var target = $(e.target).closest('th, td');
            var offset = target.offset();
            var idx = parseInt( $(nTh).attr('data-column-index'), 10 );

            if ( idx === undefined ) {
                return;
            }

            this.s.mouse.startX = this._fnCursorPosition( e, 'pageX' );
            this.s.mouse.startY = this._fnCursorPosition( e, 'pageY' );
            this.s.mouse.offsetX = this._fnCursorPosition( e, 'pageX' ) - offset.left;
            this.s.mouse.offsetY = this._fnCursorPosition( e, 'pageY' ) - offset.top;
            this.s.mouse.target = this.s.dt.aoColumns[ idx ].nTh;//target[0];
            this.s.mouse.targetIndex = idx;
            this.s.mouse.fromIndex = idx;

            this._fnRegions();

            /* Add event handlers to the document */
            $(document)
                .on( 'mousemove.ColReorder touchmove.ColReorder', function (e) {
                    that._fnMouseMove.call( that, e );
                } )
                .on( 'mouseup.ColReorder touchend.ColReorder', function (e) {
                    that._fnMouseUp.call( that, e );
                } );
        },


        /**
         * Deal with a mouse move event while dragging a node
         *  @method  _fnMouseMove
         *  @param   event e Mouse event
         *  @returns void
         *  @private
         */
        "_fnMouseMove": function ( e )
        {
            var that = this;

            if ( this.dom.drag === null )
            {
                /* Only create the drag element if the mouse has moved a specific distance from the start
                 * point - this allows the user to make small mouse movements when sorting and not have a
                 * possibly confusing drag element showing up
                 */
                if ( Math.pow(
                        Math.pow(this._fnCursorPosition( e, 'pageX') - this.s.mouse.startX, 2) +
                        Math.pow(this._fnCursorPosition( e, 'pageY') - this.s.mouse.startY, 2), 0.5 ) < 5 )
                {
                    return;
                }
                this._fnCreateDragNode();
            }

            /* Position the element - we respect where in the element the click occured */
            this.dom.drag.css( {
                left: this._fnCursorPosition( e, 'pageX' ) - this.s.mouse.offsetX,
                top: this._fnCursorPosition( e, 'pageY' ) - this.s.mouse.offsetY
            } );

            /* Based on the current mouse position, calculate where the insert should go */
            var bSet = false;
            var lastToIndex = this.s.mouse.toIndex;

            for ( var i=1, iLen=this.s.aoTargets.length ; i<iLen ; i++ )
            {
                if ( this._fnCursorPosition(e, 'pageX') < this.s.aoTargets[i-1].x + ((this.s.aoTargets[i].x-this.s.aoTargets[i-1].x)/2) )
                {
                    this.dom.pointer.css( 'left', this.s.aoTargets[i-1].x );
                    this.s.mouse.toIndex = this.s.aoTargets[i-1].to;
                    bSet = true;
                    break;
                }
            }

            // The insert element wasn't positioned in the array (less than
            // operator), so we put it at the end
            if ( !bSet )
            {
                this.dom.pointer.css( 'left', this.s.aoTargets[this.s.aoTargets.length-1].x );
                this.s.mouse.toIndex = this.s.aoTargets[this.s.aoTargets.length-1].to;
            }

            // Perform reordering if realtime updating is on and the column has moved
            if ( this.s.init.bRealtime && lastToIndex !== this.s.mouse.toIndex ) {
                this.s.dt.oInstance.fnColReorder( this.s.mouse.fromIndex, this.s.mouse.toIndex, false );
                this.s.mouse.fromIndex = this.s.mouse.toIndex;
                this._fnRegions();
            }
        },


        /**
         * Finish off the mouse drag and insert the column where needed
         *  @method  _fnMouseUp
         *  @param   event e Mouse event
         *  @returns void
         *  @private
         */
        "_fnMouseUp": function ( e )
        {
            var that = this;

            $(document).off( '.ColReorder' );

            if ( this.dom.drag !== null )
            {
                /* Remove the guide elements */
                this.dom.drag.remove();
                this.dom.pointer.remove();
                this.dom.drag = null;
                this.dom.pointer = null;

                /* Actually do the reorder */
                this.s.dt.oInstance.fnColReorder( this.s.mouse.fromIndex, this.s.mouse.toIndex, true );
                this._fnSetColumnIndexes();

                /* When scrolling we need to recalculate the column sizes to allow for the shift */
                if ( this.s.dt.oScroll.sX !== "" || this.s.dt.oScroll.sY !== "" )
                {
                    this.s.dt.oInstance.fnAdjustColumnSizing( false );
                }

                /* Save the state */
                this.s.dt.oInstance.oApi._fnSaveState( this.s.dt );

                if ( this.s.reorderCallback !== null )
                {
                    this.s.reorderCallback.call( this );
                }
            }
        },


        /**
         * Calculate a cached array with the points of the column inserts, and the
         * 'to' points
         *  @method  _fnRegions
         *  @returns void
         *  @private
         */
        "_fnRegions": function ()
        {
            var aoColumns = this.s.dt.aoColumns;

            this.s.aoTargets.splice( 0, this.s.aoTargets.length );

            this.s.aoTargets.push( {
                "x":  $(this.s.dt.nTable).offset().left,
                "to": 0
            } );

            var iToPoint = 0;
            var total = this.s.aoTargets[0].x;

            for ( var i=0, iLen=aoColumns.length ; i<iLen ; i++ )
            {
                /* For the column / header in question, we want it's position to remain the same if the
                 * position is just to it's immediate left or right, so we only increment the counter for
                 * other columns
                 */
                if ( i != this.s.mouse.fromIndex )
                {
                    iToPoint++;
                }

                if ( aoColumns[i].bVisible && aoColumns[i].nTh.style.display !=='none' )
                {
                    total += $(aoColumns[i].nTh).outerWidth();

                    this.s.aoTargets.push( {
                        "x":  total,
                        "to": iToPoint
                    } );
                }
            }

            /* Disallow columns for being reordered by drag and drop, counting right to left */
            if ( this.s.fixedRight !== 0 )
            {
                this.s.aoTargets.splice( this.s.aoTargets.length - this.s.fixedRight );
            }

            /* Disallow columns for being reordered by drag and drop, counting left to right */
            if ( this.s.fixed !== 0 )
            {
                this.s.aoTargets.splice( 0, this.s.fixed );
            }
        },


        /**
         * Copy the TH element that is being drags so the user has the idea that they are actually
         * moving it around the page.
         *  @method  _fnCreateDragNode
         *  @returns void
         *  @private
         */
        "_fnCreateDragNode": function ()
        {
            var scrolling = this.s.dt.oScroll.sX !== "" || this.s.dt.oScroll.sY !== "";

            var origCell = this.s.dt.aoColumns[ this.s.mouse.targetIndex ].nTh;
            var origTr = origCell.parentNode;
            var origThead = origTr.parentNode;
            var origTable = origThead.parentNode;
            var cloneCell = $(origCell).clone();

            // This is a slightly odd combination of jQuery and DOM, but it is the
            // fastest and least resource intensive way I could think of cloning
            // the table with just a single header cell in it.
            this.dom.drag = $(origTable.cloneNode(false))
                .addClass( 'DTCR_clonedTable' )
                .append(
                    $(origThead.cloneNode(false)).append(
                        $(origTr.cloneNode(false)).append(
                            cloneCell[0]
                        )
                    )
                )
                .css( {
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    width: $(origCell).outerWidth(),
                    height: $(origCell).outerHeight()
                } )
                .appendTo( 'body' );

            this.dom.pointer = $('<div></div>')
                .addClass( 'DTCR_pointer' )
                .css( {
                    position: 'absolute',
                    top: scrolling ?
                        $('div.dataTables_scroll', this.s.dt.nTableWrapper).offset().top :
                        $(this.s.dt.nTable).offset().top,
                    height : scrolling ?
                        $('div.dataTables_scroll', this.s.dt.nTableWrapper).height() :
                        $(this.s.dt.nTable).height()
                } )
                .appendTo( 'body' );
        },


        /**
         * Add a data attribute to the column headers, so we know the index of
         * the row to be reordered. This allows fast detection of the index, and
         * for this plug-in to work with FixedHeader which clones the nodes.
         *  @private
         */
        "_fnSetColumnIndexes": function ()
        {
            $.each( this.s.dt.aoColumns, function (i, column) {
                $(column.nTh).attr('data-column-index', i);
            } );
        },


        /**
         * Get cursor position regardless of mouse or touch input
         * @param  {Event}  e    jQuery Event
         * @param  {string} prop Property to get
         * @return {number}      Value
         */
        _fnCursorPosition: function ( e, prop ) {
            if ( e.type.indexOf('touch') !== -1 ) {
                return e.originalEvent.touches[0][ prop ];
            }
            return e[ prop ];
        }
    } );





    /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     * Static parameters
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */


    /**
     * ColReorder default settings for initialisation
     *  @namespace
     *  @static
     */
    ColReorder.defaults = {
        /**
         * Predefined ordering for the columns that will be applied automatically
         * on initialisation. If not specified then the order that the columns are
         * found to be in the HTML is the order used.
         *  @type array
         *  @default null
         *  @static
         */
        aiOrder: null,

        /**
         * Redraw the table's column ordering as the end user draws the column
         * (`true`) or wait until the mouse is released (`false` - default). Note
         * that this will perform a redraw on each reordering, which involves an
         * Ajax request each time if you are using server-side processing in
         * DataTables.
         *  @type boolean
         *  @default false
         *  @static
         */
        bRealtime: true,

        /**
         * Indicate how many columns should be fixed in position (counting from the
         * left). This will typically be 1 if used, but can be as high as you like.
         *  @type int
         *  @default 0
         *  @static
         */
        iFixedColumnsLeft: 0,

        /**
         * As `iFixedColumnsRight` but counting from the right.
         *  @type int
         *  @default 0
         *  @static
         */
        iFixedColumnsRight: 0,

        /**
         * Callback function that is fired when columns are reordered. The `column-
         * reorder` event is preferred over this callback
         *  @type function():void
         *  @default null
         *  @static
         */
        fnReorderCallback: null
    };



    /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     * Constants
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

    /**
     * ColReorder version
     *  @constant  version
     *  @type      String
     *  @default   As code
     */
    ColReorder.version = "1.3.3";



    /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     * DataTables interfaces
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

// Expose
    $.fn.dataTable.ColReorder = ColReorder;
    $.fn.DataTable.ColReorder = ColReorder;


// Register a new feature with DataTables
    if ( typeof $.fn.dataTable == "function" &&
        typeof $.fn.dataTableExt.fnVersionCheck == "function" &&
        $.fn.dataTableExt.fnVersionCheck('1.10.8') )
    {
        $.fn.dataTableExt.aoFeatures.push( {
            "fnInit": function( settings ) {
                var table = settings.oInstance;

                if ( ! settings._colReorder ) {
                    var dtInit = settings.oInit;
                    var opts = dtInit.colReorder || dtInit.oColReorder || {};

                    new ColReorder( settings, opts );
                }
                else {
                    table.oApi._fnLog( settings, 1, "ColReorder attempted to initialise twice. Ignoring second" );
                }

                return null; /* No node for DataTables to insert */
            },
            "cFeature": "R",
            "sFeature": "ColReorder"
        } );
    }
    else {
        alert( "Warning: ColReorder requires DataTables 1.10.8 or greater - www.datatables.net/download");
    }


// Attach a listener to the document which listens for DataTables initialisation
// events so we can automatically initialise
    $(document).on( 'preInit.dt.colReorder', function (e, settings) {
        if ( e.namespace !== 'dt' ) {
            return;
        }

        var init = settings.oInit.colReorder;
        var defaults = DataTable.defaults.colReorder;

        if ( init || defaults ) {
            var opts = $.extend( {}, init, defaults );

            if ( init !== false ) {
                new ColReorder( settings, opts  );
            }
        }
    } );


// API augmentation
    $.fn.dataTable.Api.register( 'colReorder.reset()', function () {
        return this.iterator( 'table', function ( ctx ) {
            ctx._colReorder.fnReset();
        } );
    } );

    $.fn.dataTable.Api.register( 'colReorder.order()', function ( set, original ) {
        if ( set ) {
            return this.iterator( 'table', function ( ctx ) {
                ctx._colReorder.fnOrder( set, original );
            } );
        }

        return this.context.length ?
            this.context[0]._colReorder.fnOrder() :
            null;
    } );

    $.fn.dataTable.Api.register( 'colReorder.transpose()', function ( idx, dir ) {
        return this.context.length && this.context[0]._colReorder ?
            this.context[0]._colReorder.fnTranspose( idx, dir ) :
            idx;
    } );


    return ColReorder;
}));
/*!
   Copyright 2017-2019 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
 RowGroup 1.1.1
 ©2017-2019 SpryMedia Ltd - datatables.net/license
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,c){a instanceof String&&(a=String(a));for(var e=a.length,f=0;f<e;f++){var h=a[f];if(d.call(c,h,f,a))return{i:f,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,c,e){if(d){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in c||(c[f]={});c=c[f]}a=a[a.length-1];e=c[a];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
(function(a){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(d){return a(d,window,document)}):"object"===typeof exports?module.exports=function(d,c){d||(d=window);c&&c.fn.dataTable||(c=require("datatables.net")(d,c).$);return a(c,d,d.document)}:a(jQuery,window,document)})(function(a,d,c,e){var f=a.fn.dataTable,h=function(b,g){if(!f.versionCheck||!f.versionCheck("1.10.8"))throw"RowGroup requires DataTables 1.10.8 or newer";this.c=a.extend(!0,{},f.defaults.rowGroup,
h.defaults,g);this.s={dt:new f.Api(b)};this.dom={};b=this.s.dt.settings()[0];if(g=b.rowGroup)return g;b.rowGroup=this;this._constructor()};a.extend(h.prototype,{dataSrc:function(b){if(b===e)return this.c.dataSrc;var g=this.s.dt;this.c.dataSrc=b;a(g.table().node()).triggerHandler("rowgroup-datasrc.dt",[g,b]);return this},disable:function(){this.c.enable=!1;return this},enable:function(b){if(!1===b)return this.disable();this.c.enable=!0;return this},_constructor:function(){var b=this,a=this.s.dt;a.on("draw.dtrg",
function(){b.c.enable&&b._draw()});a.on("column-visibility.dt.dtrg responsive-resize.dt.dtrg",function(){b._adjustColspan()});a.on("destroy",function(){a.off(".dtrg")});a.on("responsive-resize.dt",function(){b._adjustColspan()})},_adjustColspan:function(){a("tr."+this.c.className,this.s.dt.table().body()).find("td").attr("colspan",this._colspan())},_colspan:function(){return this.s.dt.columns().visible().reduce(function(b,a){return b+a},0)},_draw:function(){var b=this._group(0,this.s.dt.rows({page:"current"}).indexes());
this._groupDisplay(0,b)},_group:function(b,g){for(var c=a.isArray(this.c.dataSrc)?this.c.dataSrc:[this.c.dataSrc],d=f.ext.oApi._fnGetObjectDataFn(c[b]),h=this.s.dt,l,n,m=[],k=0,p=g.length;k<p;k++){var q=g[k];l=h.row(q).data();l=d(l);if(null===l||l===e)l=this.c.emptyDataGroup;if(n===e||l!==n)m.push({dataPoint:l,rows:[]}),n=l;m[m.length-1].rows.push(q)}if(c[b+1]!==e)for(k=0,p=m.length;k<p;k++)m[k].children=this._group(b+1,m[k].rows);return m},_groupDisplay:function(b,a){for(var c=this.s.dt,g,d=0,f=
a.length;d<f;d++){var e=a[d],h=e.dataPoint,k=e.rows;this.c.startRender&&(g=this.c.startRender.call(this,c.rows(k),h,b),(g=this._rowWrap(g,this.c.startClassName,b))&&g.insertBefore(c.row(k[0]).node()));this.c.endRender&&(g=this.c.endRender.call(this,c.rows(k),h,b),(g=this._rowWrap(g,this.c.endClassName,b))&&g.insertAfter(c.row(k[k.length-1]).node()));e.children&&this._groupDisplay(b+1,e.children)}},_rowWrap:function(b,g,c){if(null===b||""===b)b=this.c.emptyDataGroup;return b===e||null===b?null:("object"===
typeof b&&b.nodeName&&"tr"===b.nodeName.toLowerCase()?a(b):b instanceof a&&b.length&&"tr"===b[0].nodeName.toLowerCase()?b:a("<tr/>").append(a("<td/>").attr("colspan",this._colspan()).append(b))).addClass(this.c.className).addClass(g).addClass("dtrg-level-"+c)}});h.defaults={className:"dtrg-group",dataSrc:0,emptyDataGroup:"No group",enable:!0,endClassName:"dtrg-end",endRender:null,startClassName:"dtrg-start",startRender:function(b,a){return a}};h.version="1.1.1";a.fn.dataTable.RowGroup=h;a.fn.DataTable.RowGroup=
h;f.Api.register("rowGroup()",function(){return this});f.Api.register("rowGroup().disable()",function(){return this.iterator("table",function(a){a.rowGroup&&a.rowGroup.enable(!1)})});f.Api.register("rowGroup().enable()",function(a){return this.iterator("table",function(b){b.rowGroup&&b.rowGroup.enable(a===e?!0:a)})});f.Api.register("rowGroup().dataSrc()",function(a){return a===e?this.context[0].rowGroup.dataSrc():this.iterator("table",function(b){b.rowGroup&&b.rowGroup.dataSrc(a)})});a(c).on("preInit.dt.dtrg",
function(b,c,d){"dt"===b.namespace&&(b=c.oInit.rowGroup,d=f.defaults.rowGroup,b||d)&&(d=a.extend({},d,b),!1!==b&&new h(c,d))});return h});

var FormState = function (formObj, key) {
    var inputs = 'input, textarea, select';
    var excluded = 'input[type="file"], input[type="hidden"], input[type="submit"], input[type="reset"]';
    var persistingKey = '.persisting';
    var formElement;
    var storageKey;
    var sortElementsBasedOnEvents = function (el1, el2) {
        var $eventsA = $._data(el1, "events");
        var $eventsB = $._data(el2, "events");
        var eventsACount = (typeof $eventsA !== "undefined") ? Object.keys($eventsA).length : 0;
        var eventsBCount = (typeof $eventsB !== "undefined") ? Object.keys($eventsB).length : 0;
        if (eventsACount === eventsBCount) return 0;
        return eventsACount > eventsBCount ? 1 : -1;
    };

    this.getState = function () {
        var items = {};
        $(formElement).find(inputs).each(function () {
            var elem = $(this);
            if (elem.is(excluded) || isFieldHidden(elem, formElement)) {
                return;
            }
            var path = getPath(elem);
            items[path] = getVal(elem);
        });
        return JSON.stringify(items);
    };

    var findFieldParent = function(field, form) {
        var id = field.parent().attr('data-id');
        if (!_.isUndefined(id)) {
            return form.find('#' + id);
        }
        return null;
    };

    var isFieldHidden = function(field, form) {
        var parent = findFieldParent(field, form);
        if (parent) {
            return parent.hasClass('hide');
        }
        return false;
    };

    this.loadVisibilityState = function() {
        var data = sessionStorage.getItem(storageKey);
        if (data) {
            var items = JSON.parse(data);
            $(formElement).find(inputs).each(function() {
                try {
                    var elem = $(this);
                    if (elem.is(excluded)) {
                        return;
                    }
                    var path = getPath(elem);
                    var parent = findFieldParent(elem, formElement);
                    if (path && parent) {
                        if (!items.hasOwnProperty(path)) {
                            if (!parent.hasClass('hide')) {
                                formElement.find("." + parent.attr('id')).addClass('hide');
                            }
                        } else {
                            if (parent.hasClass('hide')) {
                                formElement.find("." + parent.attr('id')).removeClass('hide');
                            }
                        }
                    }
                } catch (err) {
                    console.log("Error while loading form state", err);
                }
            });
        }
    };

    this.saveState = function () {
        sessionStorage.setItem(storageKey, this.getState());
    };

    this.clearState = function () {
        sessionStorage.removeItem(storageKey);
    };

    this.clearSelectively = function () {
        var storedValue = sessionStorage.getItem(storageKey);
        if (storedValue) {
            var data = JSON.parse(storedValue);
            $.each(data, function (name, value) {
                if (name.indexOf(persistingKey) === -1) {
                    data[name] = '';
                }
            });
            sessionStorage.setItem(storageKey, JSON.stringify(data));
        }
    };

    this.loadState = function (pageType) {
        var data = sessionStorage.getItem(storageKey);
        this.loadStateFrom(data,pageType);
    };

    this.loadStateFrom = function (data ,pageType) {
        if ('undefined' === typeof data || !data) {
            return;
        }
        var items = JSON.parse(data);
        $(formElement).find(inputs).sort(sortElementsBasedOnEvents).each(function () {
            if ($(this).is(excluded)) {
                return;
            }
            setVal($(this), items, pageType)
        });
    };

    this.construct = function (formObj, key) {
        formElement = formObj;
        storageKey = key;
        return this;
    };

    var getPath = function (elem) {
        if ('undefined' === typeof elem) {
            return elem;
        }
        if (elem.length !== 1) {
            return false;
        }
        var path = ''
            , fullPath = elem.is('input[type=checkbox]')
            , node = elem
            , permanent = !!elem.data('is-permanent');

        while (node.length) {
            var realNode = node[0]
                , name = realNode.nodeName;

            if (!name) {
                break;
            }

            name = name.toLowerCase();

            var parent = node.parent()
                , siblings = parent.children(name);

            // don't need to pollute path with select, fieldsets, divs and other noisy elements,
            // exept for checkboxes that need exact path, cuz have same name and sometimes same eq()!
            if (!$(realNode).is('form, input, select, textarea') && !fullPath) {
                node = parent;
                continue;
            }

            // set input type as name + name attr if exists
            name += $(realNode).attr('name') ? '.' + $(realNode).attr('name') : '';

            // if has sibilings, get eq(), exept for radio buttons
            if (siblings.length > 1 && !$(realNode).is('input[type=radio]')) {
                name += ':eq(' + siblings.index(realNode) + ')';
            }
            path = name + ( path ? '>' + path : '' );
            // break once we came up to form:eq(x), no need to go further
            if ('form' === realNode.nodeName.toLowerCase()) {
                break;
            }
            node = parent;
        }
        if (permanent) {
            path = path + persistingKey
        }
        return path;
    };

    var getVal = function (elem) {
        return !elem.is('input[type=checkbox]') ? elem.val() : ( elem.prop('checked') ? 'checked' : 'unchecked' );
    };

    var setVal = function (elem, items, pageType) {
        if (!items) {
            return;
        }
        var path = getPath(elem);
        var storedValue = items[path];

        if ('undefined' !== typeof storedValue) {
            if (typeof storedValue == 'boolean' && storedValue === false) {
                return;
            }
            // input[type=checkbox] and input[type=radio] have a special checked / unchecked behavior
            if (elem.is('input[type=radio], input[type=checkbox]')) {

                // for checkboxes and radios
                if ('checked' === storedValue || elem.val() === storedValue) {
                    return elem.prop('checked', true);

                    // only needed for checkboxes
                } else if ('unchecked' === storedValue) {
                    elem.prop('checked', false);
                }

                return;
            }
            var currentValue = elem.val();
            if (currentValue === storedValue) {
                return;
            }
            // for input[type=text], select and textarea, just set val()
            if (pageType === pvi_forms.duplicate_search) {
                if (path.includes(persistingKey)) {
                    elem.val(storedValue);
                } else {
                    return;
                }
            } else {
                elem.val(storedValue);
            }

            // trigger an input event given the value has been changed
            if (elem.is('input')) {
                elem.trigger('input');
            } else if (elem.is('select')) {
                elem.trigger('change');
            }
            // trigger custom user function when data is retrieved
        }
    };
    return this.construct(formObj, key);
};
var pvi = pvi || {};

pvi.rdl = pvi.rdl || {};

pvi.rdl.manageReportDistribution = function() {
    var rdModal = $("#reportDestinationModal");
    var rdTable = $('#reportDistTable');
    var reportLogTable = null;
    var rdTableBody = rdTable.find('tbody');
    var e2bDetailDiv = rdModal.find(".e2bXMLDetail");
    var backRdLogDBtn = rdModal.find(".back-to-rd-listing");
    var listCloseBtn = rdModal.find(".rd-listing-close-btn");
    var rdLogHeader = rdModal.find('h4.rdLog');
    var respRDLXml = [];

    var showE2BAckXMLDetail = function (xmlData, fileName, showE2B) {
        if (showE2B) {
            rdModal.find('h4.e2bXml').removeClass('hide').find('.e2bFileName').text(" (" + fileName + ")");
        } else {
            rdModal.find('h4.ackXml').removeClass('hide').find('.ackFileName').text(" (" + fileName + ")");
        }
        rdTable.add(rdLogHeader).add(listCloseBtn).addClass("hide");
        backRdLogDBtn.add(e2bDetailDiv).removeClass("hide");
        e2bDetailDiv.find('.xmlContent').text(vkbeautify.xml(xmlData));
    };

    var hideE2BAckXMLDetail = function () {
        $('.e2bXml,.ackXml').add(backRdLogDBtn).add(e2bDetailDiv).addClass('hide');
        rdLogHeader.add(rdTable).add(listCloseBtn).removeClass("hide");
        e2bDetailDiv.find('.xmlContent').text('');
    };

    var populateDataInTable = function(data) {
        data = _.isUndefined(data) ? [] : data;
        respRDLXml = data;
        var currGroup = 0;
        var group1Value = null;

        reportLogTable = $(rdTable).DataTable({
            destroy: true,
            paging: false,
            searching: false,
            info: false,
            data: data,
            order: [
                [1, 'asc'],
                [2, 'asc']
            ],
            orderFixed: [
                [1, 'asc'],
                [2, 'asc']
            ],
            columns: [
                {
                    data: 'idx',
                    render: function (data) {
                        return pvi.util.encodeToHTML(data);
                    }
                },
                {
                    data: 'destinationName',
                    className: "col-rd-destination-name",
                    render: function (data) {
                        return pvi.util.encodeToHTML(data);
                    }
                },
                {
                    data: 'type',
                    className: "col-rd-type",
                    render: function (data) {
                        return pvi.util.encodeToHTML(data);
                    }
                },
                {
                    data: 'fromState',
                    className: "col-rd-from-state",
                    render: function (data) {
                        return pvi.util.encodeToHTML(data);
                    }
                },
                {
                    data: 'toState',
                    className: "col-rd-to-state",
                    render: function (data) {
                        return pvi.util.encodeToHTML(data);
                    }
                },
                {
                    data: 'timeStamp',
                    className: "col-rd-time-stamp",
                    render: function (data) {
                        return pvi.util.encodeToHTML(data);
                    }
                },
                {
                    data: 'icsrId',
                    className: "col-rd-icsr-id",
                    render: function (data) {
                        return pvi.util.encodeToHTML(data);
                    }
                }
            ],
            columnDefs: [
                {
                    targets: [1, 2],
                    visible: false,
                    orderable: true
                },
                {
                    targets: [0, 3, 4, 5, 6],
                    orderable: false
                }
            ],
            rowGroup: {
                dataSrc: ['destinationName', 'type'],
                startRender: function(rows, group) {
                    if (currGroup === 0) {
                        group1Value = group;
                        currGroup++;
                    } else {
                        currGroup = 0;
                        return '<h5><b>' + group1Value + '</b></h5>'
                    }
                }
            },
            createdRow: function(tr, row, index) {
                var showAttachments = false;
                var showE2BOrAck = '';
                var rowData = '';
                if (row.toStateId === pvi_icsr_state.GENERATED) {
                    if (row.type === pvi_icsr_type.PDF) {
                        showE2BOrAck = getMessage("icsr_type_pdf");
                    } else if (row.type === pvi_icsr_type.E2B_EXT) {
                        showE2BOrAck = getMessage("icsr_type_e2b");
                    } else {
                        showE2BOrAck = getMessage("icsr_type_e2b_r3");
                    }
                    // showE2BOrAck = (row.type === pvi_icsr_type.PDF ? getMessage("icsr_type_pdf") : getMessage("icsr_type_e2b"));
                    showAttachments = (row.type === pvi_icsr_type.PDF);
                } else if (_.contains([pvi_icsr_state.POSITIVE_ACK, pvi_icsr_state.NEGATIVE_ACK], row.toStateId)) {
                    showE2BOrAck = "Ack";
                } else if (row.toStateId === pvi_icsr_state.TRANSMITTED && row.type === pvi_icsr_type.E2B_R3_EXT) {
                    showE2BOrAck = "HL7";
                }
                var showOrHideMsgIcon = (!_.isEmpty(row.reportMessage) && _.contains([pvi_icsr_state.POSITIVE_ACK, pvi_icsr_state.NEGATIVE_ACK], row.toStateId)) ? '' : 'hide';
                if (showAttachments) {
                    rowData += createPdfAttachments(row.icsrId, row.files, showE2BOrAck);
                } else {
                    rowData += '<button type="button" data-index="'+index+'" class="showAckXML btn btn-xs btn-inverse waves-light dropdown-toggle noActionAllowed not-clickable ' + showE2BOrAck + '">' + showE2BOrAck + '</button>';
                }
                $('td:eq(0)', tr).addClass('snum');
                $('td:eq(2)', tr).html(row.toState + '<a href="#" class="pv-ic-viewquery rdl-ic-showmsg ' + showOrHideMsgIcon + '">\n<span class="fa fa-info-circle m-l-5"></span>\n</a>');
                $('td:eq(4)', tr).html(rowData);
            }
        });
        hideE2BAckXMLDetail();
        rdModal.modal("show");
    };

    var createPdfAttachments = function (icsrId, files, label) {
        var single_button = '<a class="btn btn-xs btn-inverse waves-light" href="' + pvi_urls.icsrPdfDownload + '?id=' + icsrId + '&type=icsr">' + label + '</a>';
        if (files.length === 0){
            return single_button;
        }
        var button = '<div class="dropdown">' +
            ' <div class="btn-group" role="group">' +
            single_button +
            '<button class="btn btn-xs btn-inverse waves-light dropdown-toggle" id="dropdownAttachments" type="button" data-toggle="dropdown" aria-haspopup="true" ><span class="md md-menu-down"></span></button>' +
            '<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownAttachments" >';
        for (var i = 0; i < files.length; i++) {
            button += '<li><a href="' + pvi_urls.icsrPdfDownload + '?id=' + files[i].id + '&type=attachment">' + files[i].name + '</a></li>'
        }
        button += '</ul></div>';
        return button;
    };

    var bindReportDistributionEvents = function () {
        //modal on click event
        $(document).off('click','a.reportState').on('click','a.reportState', function (e) {
            e.preventDefault();
            var id = $(this).attr('data-id');
            var url = pvi_urls.report_distribution_log_url + id;
            $.ajax({
                type: 'GET',
                url: url,
                success: function (data) {
                    populateDataInTable(JSON.parse(data).data);
                },
                error: function (error) {
                    rdTableBody.text(error.message);
                    rdModal.modal("show");
                }
            });
        });

        //error message event binding
        $(document).off("click", "a.rdl-ic-showmsg").on("click", "a.rdl-ic-showmsg", function (e) {
            e.preventDefault();
            var tr = $(this).closest('tr');
            var row = reportLogTable.row(tr);
            if (row.child.isShown()) {
                row.child.hide();
                tr.removeClass('shown');
            } else {
                row.child( '<p>' + row.data().reportMessage + '</p>').show();
                tr.addClass('shown');
            }
        });

        //show E2B ACK xml details event binding
        $(document).off("click", ".showAckXML").on("click", ".showAckXML", function (e) {
            e.preventDefault();
            var element = $(this);
            var index = element.attr('data-index');
            if (element.hasClass(pvi_icsr_type.E2B_EXT) || element.hasClass(pvi_icsr_type.E2B_R3_EXT)) {
                showE2BAckXMLDetail(respRDLXml[index].icsrXml, respRDLXml[index].icsrFileName, true);
            } else if(element.hasClass(pvi_icsr_type.HL7_EXT)) {
                showE2BAckXMLDetail(respRDLXml[index].r3IcsrXml, respRDLXml[index].icsrFileName, true);
            } else if (element.hasClass(pvi_icsr_type.E2B_ACK)) {
                showE2BAckXMLDetail(respRDLXml[index].ackXml, respRDLXml[index].ackFileName, false);
            }
        });

        //hide E2B ACK xml details event binding
        $(document).off("click", ".back-to-rd-listing").on("click", ".back-to-rd-listing", function () {
            hideE2BAckXMLDetail();
        });

        //modal close event
        rdModal.off('hide.bs.modal').on('hide.bs.modal', function () {
            hideE2BAckXMLDetail();
        });

    };

    var init = function () {
        bindReportDistributionEvents();
    };

    return {
        init: init
    }
}();
var allCaseListTables = [];

var followUpFromList = function (params) {
    $.ajax({
        url: params.url,
        type: 'POST',
        data: {
            data: JSON.stringify({
                initialCaseId: params.initialCaseId,
                followUpCaseId: params.followUpCaseId,
                safetyCaseNum: params.safetyCaseNum
            })
        },
        beforeSend: function () {
            pvui.common.showPVLoader();
        },
        success: function (data) {
            var resp = $.parseJSON(data);
            if (resp.status === pvi_constants.status_fail) {
                pvui.common.hidePVLoader();
                $('#messageBox').removeClass('hide');
                $('#errorMessage').text(resp.message);
            }
            else {
                $("#pviModalFollowUp").modal("hide");
                pvi.util.gotoURL(pvi_urls.show_case_url + resp['case-id']+pvi_urls.case_entry_default_template_suffix);
            }
        }
    });
};

var pvi = pvi || {};
pvi.list = pvi.list || {};

pvi.list.commonFunctions = function () {

    var setColumnVisibility = function(columnConfigs, dataTable){
        _.each(columnConfigs, function (configObj) {
            var name = configObj.name;
            var col = dataTable.columns(name + ":name");
            var isVisible = (configObj.containerView === 1);
            col.visible(isVisible, false);
        });
    };

    var populateErrorInErrorContainer = function (messageList, targetContainer) {
        $("#messageAlertContainer").remove();
        var errorMessageList = "";
        var messageListLength = messageList.length;
        for (var cnt = 0; cnt < messageListLength; cnt++) {
            errorMessageList += "<li>" + messageList[cnt] + "</li>";
        }
        var errorDiv = '<div class="alert alert-dismissible forceLineWrap alert-danger" role="alert" id="messageAlertContainer"></div>';
        $("#" + targetContainer).find(".dataTableList").before(errorDiv);
        $("#messageAlertContainer").html("<ul id='errorList'>"+errorMessageList+"</ul>");
    };

    return {
        setColumnVisibility: setColumnVisibility,
        populateErrorInErrorContainer: populateErrorInErrorContainer
    };

}();

pvi.list.dataGrid = function (containerId, tableId, columnsBarId, searchFormName, options) {
    var container = $("#" + containerId);
    var dataTable = container.find("#" + tableId);
    var dataTableOptions = function () {
        return options ? options : {};
    }();
    var initialized = false;
    var pageStart = 0;
    var caseListTable;
    var caseListTableRef = {caseListTable: {}};
    var initOrder = false;
    var pageTypeId = container.find("input[name='pageTypeId']").val();
    var isOnDuplicateSearchPage = (typeof duplicateSearchPageId !== 'undefined') && (pageTypeId === duplicateSearchPageId.toString());
    var actionVisible = container.find("input[name='actionVisible']").val();
    var isLoadedViaBack = pvi.util.isFromBackButtonPage();
    dataTableOptions.loadData = !!container.find("input[name='loadData']").data('value') || isLoadedViaBack;
    var dataElements = container.find("#list-data-elements");
    var pageLength = dataElements.data('page-length');
    var columnsBar = container.find('#' + columnsBarId);
    var columnSize;
    var focusOnFixedCol = false;
    var fixedFilterColName = "intakeCaseNumber";
    var isDashboardPage = $('#isDashboardPage').length > 0;
    var scrollableSection = container.find(".dataTables_scrollBody");
    var scrollableFixedCol = container.find(".DTFC_LeftBodyLiner");
    var columnConfigs = [];

    var getStorageKey = function (primaryKey) {
        return searchFormName + ':' + primaryKey;
    };

    var searchFormState = new FormState($('form[name="' + searchFormName + '"]'), browserStorage.utils.appUserStorageKey + getStorageKey('FORM_STATE'));

    var buildIncludeExcludeValues = function () {
        var statesList = _.reduce(container.find('input[caseState]'), function (memo, checkbox) {
            var checked = checkbox.checked;
            if (checked) {
                memo.push(container.find(checkbox).attr('value').toLowerCase())
            }
            return memo;
        }, []);
        if (statesList && statesList.length > 0) {
            return statesList.join();
        } else {
            if (container.find('div.report-distribution input').is(":checked")) {
                return ""
            } else
                return "xxxxx-crazy"; //Return something crazy
        }
    };

    // Handle source database
    var getSourceDatabases = function () {
        var sources = [];
        container.find('.pv-source-database').each(function () {
            if ($(this).is(":checked")) {
                sources.push($(this).val());
            }
        });
        return sources;
    };

    /**
     * For FU/DS, method should use the user selection, for intake case or case list, method will return default intake db
     * @returns {Array}
     */
    var getSourceDatabasesOrDefault = function () {
        var DEFAULT_SOURCE_DB = 1;
        var sources = getSourceDatabases();
        if (sources.length < 1) sources.push(DEFAULT_SOURCE_DB);
        return sources;
    };

    var dateRangeQuery= function(startDate, endDate){
        return JSON.stringify({"gte" : startDate , "lte" :  endDate });
    };

    var buildLastXSearchCondition = function (x_factor, unit) {
        var range = buildLastXSearchConditionJson(x_factor, unit);
        return  dateRangeQuery(range.startTime, range.endTime);
    };

    function buildLastXDateRangeJson(subUnit, unit, x_factor) {
        var today = moment().tz(corporateTimezone);
        var lastX = today.subtract(subUnit, unit);
        var xMonthAgao = lastX.clone().subtract(x_factor - 1, unit);
        var startTime = xMonthAgao.clone().startOf(unit).utc().format();
        var endTime = lastX.clone().endOf(unit).utc().format();

        return dateRangeQuery(startTime, endTime);
    }

    var buildLastXSearchConditionJson = function (x_factor, unit) {
        var subUnit = 1;
        if (isIncludeTodayInSearchCriteria === "true" || isIncludeTodayInSearchCriteria === true) {
            subUnit = 0;
        }
        return buildLastXDateRangeJson(subUnit, unit, x_factor);
    };

    var getDefaultDateRange = function(){
        var criteria = buildLastXSearchConditionJson(defaultDateRangeValue, 'day');
        criteria.range = 'LAST_X_DAYS';
        criteria.x = defaultDateRangeValue;
        return JSON.stringify(criteria);
    };

    var createDateRangeValue = function (range, x_factor) {
        var value = null;
        switch (range) {
            case 'TODAY':
                var filterDateClone = moment().tz(corporateTimezone).clone();
                var startOfToday = filterDateClone.startOf('day').utc().format();
                var endOfToday = filterDateClone.endOf('day').utc().format();
                value = dateRangeQuery(startOfToday, endOfToday);
                break;
            case 'YESTERDAY':
                value = buildLastXDateRangeJson(1, 'day',1);
                break;
            case 'LAST_WEEK':
                value = buildLastXSearchConditionJson(1, 'week');
                break;
            case 'LAST_MONTH':
                value = buildLastXSearchConditionJson(1, 'month');
                break;
            case 'LAST_YEAR':
                value = buildLastXSearchConditionJson(1, 'year');
                break;
            case 'LAST_X_DAYS':
                value = isDigit(x_factor) ? buildLastXSearchConditionJson(x_factor, 'day') : value;
                break;
            case 'LAST_X_WEEKS':
                value = isDigit(x_factor) ? buildLastXSearchConditionJson(x_factor, 'week') : value;
                break;
            case 'LAST_X_MONTHS':
                value = isDigit(x_factor) ? buildLastXSearchConditionJson(x_factor, 'month') : value;
                break;
            case 'LAST_X_YEARS':
                value = isDigit(x_factor) ? buildLastXSearchConditionJson(x_factor, 'year') : value;
                break;
            default:
                value = null;
        }
        return value;
    };

    var isDigit = function (x_factor) {
        var reg = /^\d+$/;
        return reg.test(x_factor);
    };

    var buildSimpleSearchCriteria = function () {
        var searchCriteria = {};
        var simpleSearchField = container.find('#simpleSearchField');
        var isSimpleSearchFieldVisible = simpleSearchField.hasClass('visible');
        if (isSimpleSearchFieldVisible) {
            searchCriteria['simpleSearch'] = simpleSearchField.val();
        }
        buildSimpleSearchOtherProperties(searchCriteria, !isSimpleSearchFieldVisible);

        var type = container.find('#date-range-type').val();
        var range = container.find('#pviListDateRange').val();

        if ((_.indexOf(oneClickTypes, range) > -1) || (_.indexOf(twoClickTypes, range) > -1)) {
            var x_factor = container.find('#range-factor-field').val();
            var dateRange = createDateRangeValue(range, x_factor);
            if (!dateRange) {
                swal("", getMessage("correct_date_range"));
                return null;
            }

            dateRange.range = range;
            dateRange.x = x_factor;
            searchCriteria[type] = dateRange;
        } else if (range === 'CUSTOM') {
            var dateRangeSearchValue = getDateRangeSearchValue();
            if (dateRangeSearchValue) {
                searchCriteria[type] = dateRangeSearchValue;
            } else
                return null;
        }
        return searchCriteria;
    };

    var buildSimpleSearchOtherProperties = function (searchCriteria, isSectionVisible) {

        if (isSectionVisible) {
            _.each(container.find("input[data-search-field]:visible"), function (input) {
                input = $(input);
                var value = input.val();
                if (!_.isEmpty(value)) {
                    var inputSearchFieldData = input.data("search-field");
                    searchCriteria[inputSearchFieldData] = input.hasClass('generateDateRange') ? pvi.util.generateDateRange(value) : value;
                }
            });

            _.each(container.find("select[data-search-field]:visible"), function (input) {
                input = $(input);
                var value = pvi.util.getSelectedValueFromSelect2(input);
                if (!_.isEmpty(value)) {
                    searchCriteria[input.data("search-field")] = value;
                }
            });
        }

        searchCriteria['caseStateId'] = buildIncludeExcludeValues();

        var listDataContainerDiv = container.find("#list-data-elements");
        var isOrOperation = listDataContainerDiv.data("is-or-operation");
        var sortWhileSearch = listDataContainerDiv.data("sort-while-search");
        var countSearchCriteria = listDataContainerDiv.data("count-search-criteria");
        searchCriteria['config'] = '{"isOrOperation": "' + isOrOperation + '", "sortWhileSearch": "' + sortWhileSearch + '", "countSearchCriteria": "' + countSearchCriteria + '"}';

        if (listDataContainerDiv.data("only-latest-valid-version") === true) {
            searchCriteria['isLatestValidVersion'] = true;
        }

        if (container.find('div.report-distribution input').is(":checked")) {
            searchCriteria['reportDistributionThreshold'] = true;
        }
        // Handle source database
        searchCriteria['sourceDbId'] = getSourceDatabasesOrDefault().join(",");
    };

    var getDateRangeSearchValue = function () {
        var rangeStart = container.find('#datepicker-rangeStartDate').val();
        var rangeEnd = container.find('#datepicker-rangeEndDate').val();

        if (!(rangeStart || rangeEnd)) {
            pvi.util.showInfo(getMessage("enter_start_end_date"));
            return null;
        }

        if (!rangeStart) {
            swal("", getMessage("enter_start_date"));
            return null;
        }

        if (!rangeEnd) {
            swal("", getMessage("enter_end_date"));
            return null;
        }

        if (!pvi.util.isValidDate(rangeStart)) {
            swal("", getMessage("correct_start_date"));
            return null;
        }

        if (!pvi.util.isValidDate(rangeEnd)) {
            swal("", getMessage("correct_end_date"));
            return null;
        }
        var supportedDateTimeFormat = pvi.util.supportedDateTimeFormat;

        var search_start = moment(rangeStart, supportedDateTimeFormat).tz(corporateTimezone, true).startOf('day').utc();
        var search_end = moment(rangeEnd, supportedDateTimeFormat).tz(corporateTimezone, true).endOf('day').utc();
        var value = null;
        if ((rangeStart && rangeEnd) && (search_end.isAfter(search_start))) {
            value = dateRangeQuery(search_start.format(), search_end.format());

        } else {
            if (!(rangeStart && rangeEnd)) {
                swal("", getMessage("enter_start_end_date"));
            } else {
                swal("", getMessage("start_end_constraint"));
            }
        }
        return value;
    };

    var oneClickTypes = ['TODAY', 'YESTERDAY', 'LAST_WEEK', 'LAST_MONTH', 'LAST_YEAR'];
    var twoClickTypes = ['LAST_X_DAYS', 'LAST_X_WEEKS', 'LAST_X_MONTHS', 'LAST_X_YEARS'];

    var showWarning = function (title, text, cancelBtnText, confirmBtnText, callBack) {
        var options = {
            title: title,
            text: text,
            type: "warning",
            confirmButtonColor: "#DD6B55",
            confirmButtonText: confirmBtnText,
            closeOnConfirm: true
        };
        if(cancelBtnText){
            options.showCancelButton = true;
            options.cancelButtonText = cancelBtnText;
        }
        swal(options, function () {
                callBack();
            });
    };

    var assignedToUserOptions;

    var bindDropdownFilters = function () {
        assignedToUserOptions = getUserList();
        assignedToUserOptions.splice(0,0,{id:'-1',text: getMessage("select_blank_option")});
        container.find('#assignee-filter').select2({
            data: assignedToUserOptions,
            placeholder: getMessage("select_default_text"),
            allowClear: true
        });
        var assignedUsername = caseListTableRef.caseListTable.column('assignedToUsername:name').search();
        if (assignedUsername === undefined || assignedUsername === loginUser){
            container.find('#assignee-filter').val(loginUser).trigger("change.select2");
        }
    };

    var getUserList = function () {
        var userList = pvi.util.fetchUsersReferenceData();
        _.each(userList ,function (obj) {
            obj.id = obj.text;
        });
        return userList;
    };

    var init = function () {

        var noActionAllowedButton = function () {
            container.find('.pv-list-table').on('click', 'button.noActionAllowed', function (e) {
                e.preventDefault();
                swal("", getMessage('no_action_state') + container.find(this).attr("data-case-state") + " State", "");
                return false;
            });
        };

        var noBulkActionAllowedButton = function () {
            container.find('.grid-top-head').on('click', 'button.noBulkActionAllowed', function (e) {
                e.preventDefault();
                swal("", getMessage('no_bulk_action_state'), "");
                return false;
            });
        };

        var bulkActionCallback = function (params,targetContainer) {
            $.ajax({
                url: pvi_urls.bulk_change_case_state,
                type: 'POST',
                data: {
                    data: JSON.stringify({
                        ids: params.ids,
                        toStateId: params.toStateId,
                        actionPerformed: params.action
                    })
                },
                beforeSend: function () {
                    pvui.common.showPVLoader();
                },
                success: function (data) {
                    var resp =JSON.parse(data);
                    if (parseInt(resp.status) === 422){
                        pvi.list.commonFunctions.populateErrorInErrorContainer(resp.text.errors,targetContainer);
                        caseListTable.ajax.reload();
                        pvui.common.hidePVLoader();
                    }else {
                        setTimeout(function () {
                            caseListTable.ajax.reload();
                            pvui.common.hidePVLoader();
                            pvi.util.showFloatingNotification.successMessage(resp.message);
                        }, 1000);
                    }
                }
            });
        };

        var bulkActionCallbackWithJustification = function (params, content) {

            var password = $("#justificationPassword").val();

            pvi.util.showSpinDlg(function () {
                $.ajax({
                    url: pvi_urls.bulk_change_case_state,
                    async: false,
                    type: 'POST',
                    data: {
                        data: JSON.stringify({
                            ids: params.ids,
                            toStateId: params.toStateId,
                            comments: content.comments,
                            actionPerformed: params.actionPerformed,
                            timestamp: content.timestamp,
                            username: usernameToSavePreference,
                            password: password
                        })
                    },
                    success: function (data) {
                        pvui.common.hidePVLoader();
                        var resp = JSON.parse(data);
                        if(_.has(resp, "caseStateChanged") && !resp.caseStateChanged) {
                            pvi.util.handleCaseStateChangeRejection(resp);
                        } else {
                            setTimeout(function () {
                                $("#pv-justification-modal").modal("hide");
                                caseListTable.ajax.reload();
                                pvi.util.showFloatingNotification.successMessage(resp.message);
                            }, 1000);
                        }
                    }
                });
            });
        };

        var initializeBulkAction = function () {
            container.find('.grid-top-head').on('click', 'ul.bulk-action-list>li.bulk-action', function (e) {
                var ids = _.collect(_.filter(container.find('.list-row-checkbox:checked')), function (item) {
                    return $(item).attr('data-id');
                });

                var vendorIds = [];
                var productIds = [];
                var countryIds = [];
                var studyIds = [];
                var assignToIds = [];
                var isClinicalTrial = [];
                _.each(container.find('.list-row-checkbox:checked'), function (item) {
                    var rowData = $(item).data();
                    if(rowData.vendorId)
                        vendorIds.push(rowData.vendorId);
                    if (rowData.productids) {
                        if (isNaN(rowData.productids)) {
                            _.each(rowData.productids.split(","), function (val) {
                                if (!_.isUndefined(val) && val) {
                                    productIds.push(parseInt(val));
                                }
                            });
                        } else {
                            productIds.push(rowData.productids);
                        }
                    }
                    if(rowData.countryid)
                        countryIds.push(rowData.countryid);
                    if(rowData.studyid)
                        studyIds.push(rowData.studyid);
                    if (rowData.assigntoid)
                        assignToIds.push(rowData.assigntoid);
                    isClinicalTrial.push(rowData.isclinicaltrial);
                });

                var actionTarget = $(this).find("a");
                var action = actionTarget.data("action");
                var targetContainer = actionTarget.data("container");
                switch (action) {
                    case activeStateId:
                        bulkActionCallback({toStateId: activeStateId, action: action, ids: ids},targetContainer);
                        break;
                    case rejectedStateId:
                        var params = {actionPerformed: action, toStateId: rejectedStateId, ids: ids};
                        pvi.util.justificationModule().showJustificationModal("mark_reject", params, bulkActionCallbackWithJustification);
                        break;
                    case finalStateId:
                        showWarning("", getMessage('submit_btn'), pvi_constants.cancel_btn_label, pvi_constants.success_btn_label, function () {
                            bulkActionCallback({toStateId: finalStateId, action: action, ids: ids},targetContainer);
                        });
                }

                if(actionTarget.parent().hasClass('assignAll')) {
                    var dataMap = {};
                    var assigneeList =  $("#assigneeUserList");
                    assigneeList.select2({dropdownParent: pvi.util.caseJustification.justificationModal});
                    dataMap.countryIds = _.unique(countryIds);
                    if (productIds.length > 0) {
                        dataMap.productIds = _.unique(productIds);
                    }
                    if (!_.isUndefined(studyIds) && studyIds) {
                        dataMap.studyIds = _.unique(studyIds);
                    }
                    dataMap.isClinicalTrial = _.unique(isClinicalTrial);

                    if(vendorIds) {
                        dataMap.vendorIds = _.unique(vendorIds);
                    }
                    if (assignToIds) {
                        dataMap.assignToIds = _.unique(assignToIds);
                    }

                    $.ajax({
                        url: pvi_urls.case_assignee_user_list_url,
                        data: {data:JSON.stringify(dataMap)},
                        type: 'POST',
                        async: true,
                        success: function(data) {
                           assigneeList.html('').append(new Option(getMessage("select_default_text"), 0, true, true));
                           data = JSON.parse(data);
                           _.each(data, function(obj){
                               assigneeList.append(new Option(obj.username, obj.id, false, false));
                           });
                         pvi.util.manageUserAssign.userCaseAssignmentLogic(e, assigneeList, assigneeList, actionTarget, null, ids, $("#assigneeUserList :selected").val(), targetContainer);
                        }
                    });
                }
            });
        };

        var initFilterButton = function () {

            container.find('#filter-button').click(function (e) {
                e.preventDefault();
                if(!assignedToUserOptions){
                    bindDropdownFilters();
                }
                pvui.grid.manageUIWrapper.toggleGridFilter(container, {dateFormat:((pvi.util.getDateFormats.listDateFormat).toUpperCase())});
                container.find("thead.filter-head").toggleClass("pv-filter-active");
            });

            container.find(".btn-select-all-checklist input").click(function () {
                container.find(".pv-include-cases-list input").prop('checked', $(this).prop("checked"));
            });

            container.find(".pv-include-cases-list input").on("change", function () {
                container.find(".btn-select-all-checklist input").prop("checked", checkIsSelectedAll());
            });

            var checkIsSelectedAll = function () {
                var checkedLength = container.find(".pv-include-cases-list input[caseState]:checked").length,
                    totalCheckBoxes = container.find(".pv-include-cases-list input[caseState]").length;
                return (checkedLength === totalCheckBoxes);
            };

            container.find("#range-factor-field").keydown(function (e) {
                var keysCollection = [46, 8, 9, 27, 13, 110, 190];
                // Allow: backspace, delete, tab, escape, enter and .
                if (keysCollection.indexOf(e.keyCode) !== -1 ||
                    // Allow: Ctrl/cmd+A
                    (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                    // Allow: Ctrl/cmd+C
                    (e.keyCode === 67 && (e.ctrlKey === true || e.metaKey === true)) ||
                    // Allow: Ctrl/cmd+X
                    (e.keyCode === 88 && (e.ctrlKey === true || e.metaKey === true)) ||
                    // Allow: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    // let it happen, don't do anything
                    return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });

            container.find('#range-factor-field').keypress(function (event) {
                return (event.which !== 13);  // returning false will prevent the event from bubbling up.
            });

            container.find('#simpleSearchField').keyup(function (e) {
                if (e.keyCode === 13) {
                    var searchCriteria = buildSimpleSearchCriteria();
                    if(searchCriteria)
                        doSimpleSearch(JSON.stringify(searchCriteria));
                    return false;
                }
            });

            container.find('#pviListDateRange>option[value=' + defaultDateRangeKey + ']').prop('selected', true);  //this value is picked up from list.gsp (defaultDateRangeKey)
            container.find('#pviListDateRange').trigger('change');
            container.find('#range-factor-field').val(defaultDateRangeValue); //this value is picked up from list.gsp (defaultDateRangeValue)
        };

        var doSimpleSearch = function (value) {
            var column = caseListTable.column('simpleSearch:name');
            if (dataElements.data("save-form-state")) {
                if (value) {
                    searchFormState.saveState();
                    pvi.user.state.saveState(searchFormState.getState(), searchFormName, pvi_page_section_name.form_section);
                } else {
                    searchFormState.clearState();
                }
            }
            column.search((value ? value : null));
            dataTableOptions.loadData = true;
            initialized = true;
            drawTable();
        };

        var drawTable = function(paging){
            if(dataTableOptions.loadData) {
                isDashboardPage ? pvui.common.pvWidgetLoader.hideLoader(container) : pvui.common.hidePVLoader();
            }
            if(_.isUndefined(paging)){
                caseListTable.draw();
            } else {
                caseListTable.draw(paging);
                if(!dataTableOptions.loadData) {
                    pvui.common.hidePVLoader();
                }
            }
        };

        container.on('list.data.table.clear.rows',function () {
            dataTableOptions.loadData = false;
            drawTable();
            dataTableOptions.loadData = true;
        });

        var initDisplayLength = function () {
            container.find('.inp-display-record').change(function () {
                var displayLength = container.find('.inp-display-record').val();
                caseListTable.page.len(displayLength);
                drawTable(false);
            });
        };

        var handle_include = function () {

            var showRangeFactor = function () {
                container.find('#range-factor-field-container').removeClass('hide');
                hideCustomRangeFactor();
                return container.find('#range-factor-field').val();
            };

            var hideRangeFactor = function () {
                container.find('#range-factor-field-container').addClass('hide').find('input').val('');
            };

            var showCustomRangeFactor = function () {
                hideRangeFactor();
                container.find('#pviListCustomDaterange').removeClass('hide').find("input").val('');
            };

            var hideCustomRangeFactor = function () {
                container.find('#pviListCustomDaterange').addClass('hide');
            };

            var type = container.find('#date-range-type').val();
            var range = container.find('#pviListDateRange').val();

            hideRangeFactor();
            hideCustomRangeFactor();

            if (oneClickTypes.indexOf(range) > -1) {
                hideRangeFactor();
                hideCustomRangeFactor();
            } else if (twoClickTypes.indexOf(range) > -1) {
                showRangeFactor();
                hideCustomRangeFactor();
            } else if (range === 'CUSTOM') {
                hideRangeFactor();
                showCustomRangeFactor();
            }
        };

        var initAllCasesButton = function () {
            container.find('.allCasesButton').click(function () {
                var column = caseListTable.column('assignedToUsername:name');
                column.search('');
                $(column.header()).find('#assignee-filter').val('').trigger('change.select2');
                highlightTab();
                drawTable();
            });
        };

        container.find('#date-range-type, #pviListDateRange').on('change', handle_include);

        var isAnyCaseChecked = function () {
            return (container.find('div.pv-include-cases-list input:checkbox:checked').length > 0);
        };

        container.find('.pv-source-database').on('change', function (e) {
            if (!$(this).is(":checked")) {
                if (getSourceDatabases().length < 1) {
                    swal("", getMessage("source_db_warning_msg"));
                    this.checked = !this.checked;
                }
            }
        });

        // Handling search here
        var handleSearch = function () {
            if(isAnyCaseChecked()){
                var searchCriteria = buildSimpleSearchCriteria();
                if (!_.isEmpty(searchCriteria)) {
                    doSimpleSearch(JSON.stringify(searchCriteria));
                }
            } else {
                showWarning("", getMessage('select_a_case'), "", pvi_constants.success_btn_label, function () {
                    swal.close();
                });
            }
        };

        var handleListExport = function () {
            $.ajax({
                type: 'POST',
                url: pvi_urls.list_export_url + pageTypeId,
                data: caseListTable.ajax.params(),
                beforeSend: function () {
                    pvui.common.showPVLoader();
                },
                success: function (response) {
                    var exportLink = document.createElement('a');
                    exportLink.href = pvi_urls.list_export_report_download_url + response.filename;
                    document.body.appendChild(exportLink);
                    exportLink.click();
                    pvui.common.hidePVLoader();
                }
            });
        };

        container.find('.search-button').click(handleSearch);
        container.find('#export-excel-button').click(handleListExport);

        container.find('#pviCaseSearchIcon').click(function (e) {
            e.preventDefault();
            container.find('#pviCaseSrcSec').toggleClass('hide');
            $("body").toggleClass("top-search-enabled");
            pvui.grid.utils.setGridHeight(container);
        });

        var initMyCasesButton = function () {
            container.find('.myCasesButton').click(function () {
                var column = caseListTable.column('assignedToUsername:name');
                column.search(loginUser);
                $(column.header()).find('#assignee-filter').val(loginUser).trigger("change.select2");
                highlightTab();
                drawTable();
            })
        };

        var saveColumns = function () {

            var buildColumnConfigList = function () {
                var order = 0;
                var secondOrder = 0;
                _.each(columnConfigs, function (ele) {
                    ele.listOrder = 9999;
                });

                _.each(listColumns(pvi_list_columns_view.primaryCols), function (ele) {
                    ele.listOrder = order++;
                });

                _.each(listColumns(pvi_list_columns_view.secondaryCols), function (ele) {
                    ele.listOrder = secondOrder++;
                });

                return columnConfigs;
            };

            var colList = buildColumnConfigList();
            colReorderCaseList();
            drawTable(true);
            bindListFilterEventListeners();

            $.ajax({
                url: createURL(pvi_urls.case_list_update_columns_url),
                method: 'POST',
                data: JSON.stringify(colList),
                dataType: 'json',
                beforeSend:function(){
                    pvui.common.showPVLoader();
                },
                success:function(){
                    pvui.common.hidePVLoader();
                }
            });

            itemDragged = false;
        };

        var initDraggablePanel = function () {

            var build_column_list = function (parentComp, containerNumber, defaultValue) {
                var listOrder = 0;

                var setSeq = function (eleName) {
                    var obj = _.find(defaultValue, function (n) {
                        return n.name === eleName;
                    });
                    return obj.seq;
                };

                return _.reduce(parentComp.children("a.list-group-item"), function (memo, ele) {
                    ele = $(ele);
                    var label = ele.html();
                    var name = ele.attr('data-field');
                    var obj = {};
                    obj.label = label;
                    obj.name = name;
                    obj.containerView = containerNumber;
                    obj.seq = setSeq(name);
                    obj.listOrder = listOrder++;
                    memo.push(obj);
                    return memo;
                }, []);
            };

            container.find('#config-view-bt').click(function () {
                pvui.grid.utils.manageListingUI.showSettingPanel();
            });

            var hideField = function(){
                container.find('.list-filter').show();
                container.find('.select2-container').show();
                pvui.grid.manageUIWrapper.toggleGridFilter(container, {dateFormat:((pvi.util.getDateFormats.listDateFormat).toUpperCase())});
            };

            var processList = function () {
                hideField();
                var tmpConfigs = build_column_list(container.find('.list-group-primary'), 1, columnConfigs);
                tmpConfigs = tmpConfigs.concat(build_column_list(container.find('.list-group-secondary'), 2, columnConfigs));
                tmpConfigs = tmpConfigs.concat(build_column_list(container.find('.list-group-optional'), 3, columnConfigs));
                columnConfigs = tmpConfigs;
                pvi.list.commonFunctions.setColumnVisibility(columnConfigs, caseListTable);
                saveColumns();
                setCaseGridSecondaryStyle();
            };

            container.find("#btnSaveListConfig").unbind('click').on('click',function (e) {
                e.preventDefault();
                if (itemDragged) {
                    pvui.common.showPVLoader();
                    setTimeout(function() {
                        processList();
                        pvui.grid.utils.manageListingUI.hideSettingPanel();
                    }, 0);
                } else {
                    pvui.grid.utils.manageListingUI.hideSettingPanel();
                }
            });

            container.find(".display-config-field, .display-config-field2, .display-config-field3").sortable({
                connectWith: ".short-field"
            }).disableSelection();

            var initial = [];

            container.find('.display-config-field, .display-config-field2, .display-config-field3').each(function (index, anchor) {
                initial.push(anchor.innerHTML);
            });

            var showWarningOnArrangingFields = function () {
                showWarning(getMessage("close_btn_warning_title"), getMessage("close_btn"), "No", "Yes", function () {
                    container.find('.display-config-field, .display-config-field2, .display-config-field3').each(function (index, anchor) {
                        anchor.innerHTML = initial[index];
                    });
                    itemDragged = false;
                    pvui.grid.utils.manageListingUI.hideSettingPanel();
                });
            };

            columnsBar.on("click", (function (event) {
                event.stopPropagation();
            }));

            pvui.grid.manageUIWrapper.closeSettingPanel(showWarningOnArrangingFields, container.find("#btnCloseListConfig"));
            pvui.grid.manageUIWrapper.closeSettingPanel(showWarningOnArrangingFields);

        };

        initFilterButton();
        if(!isDashboardPage) {
            pvi.util.bindDatePickers();
        }
        pvi.util.select2Fields();
        init_case_list();

        var bindListFilterEventListeners = function () {
            caseListTable.columns().every(function () {
                var that = this;
                var filterDelay = parseInt(getConfig('typeAhead.listFilterDelay'));
                container.find($(that.header())).on('input change','.list-filter', $.debounce(filterDelay, function (evt) {
                    var target = $(evt.target);
                    var filterName = target.attr('data-field');
                    var searchValue = target.val();
                    if (target.hasClass('date-time-filter')) {
                        searchValue = pvi.util.generateDateRange(searchValue, filterName);
                    }
                    dataTable.DataTable().column(filterName + ":name").search(searchValue);
                    drawTable();
                    if(filterName === fixedFilterColName){
                        focusOnFixedCol = true;
                    }
                }));

                container.find($(that.header())).on('click', '.list-filter, .dropdown-list-filter', function (e) {
                    e.stopPropagation();
                });

                container.find($(that.header())).on('keypress', '.list-filter', function (e) {
                    if(e.keyCode === 13){
                        e.stopPropagation();
                    }
                });
            });
        };

        bindListFilterEventListeners();
        initAllCasesButton();
        initMyCasesButton();
        initDraggablePanel();
        initDisplayLength();
        initializeBulkAction();
        noActionAllowedButton();
        noBulkActionAllowedButton();
        colReorderCaseList();
        initialized = (isOnDuplicateSearchPage && !dataTableOptions.caseIdAvailable) ? false : true;
        drawTable(false);
        pvui.grid.utils.htmlOverflowYHidden();
    };

    var secondaryColumnsExist = function () {
        return _.find(columnConfigs, function (col) {
            return col.containerView === 2;
        });
    };

    var setCaseGridSecondaryStyle = function () {
        if(secondaryColumnsExist()){
            dataTable.removeClass('no-secondary');
        }
        else {
            dataTable.addClass('no-secondary');
        }
    };

    var listColumns = function (containerViewObj, sort) {
        var listColumns = _.filter(columnConfigs, function (ele) {
            return ele.containerView === containerViewObj.cId;
        });
        if (sort) {
            listColumns = listColumns.sort(function(a,b) {
                var varA = a[containerViewObj.sortByProp];
                var varB = b[containerViewObj.sortByProp];
                if (typeof varA === 'string' || varA instanceof String) {
                    return varA.localeCompare(varB, undefined, {sensitivity: 'base' });
                } else if (typeof varA === 'number') {
                    return varA - varB;
                }
            });
        }
        return listColumns;
    };

    var manageBulkAction = (function () {

        var getFirstSelectedStateForBulkOps = function () {
            return container.find(".list-row-checkbox:checked").eq(0).data("case-state");
        };

        var isSameStateSelected = function (initialState) {
            var isSameState = true;
            container.find(".list-row-checkbox:checked").each(function () {
                if ($(this).data("case-state") !== initialState) {
                    isSameState = false;
                    return false;
                }
            });
            return isSameState;
        };

        var showHideBulkActionButton = function (show) {
            var bulkActionBtn = container.find(".btn-caselist-action-all");
            bulkActionBtn.removeClass("noBulkActionAllowed");
            var selectedState = show ? getFirstSelectedStateForBulkOps(): false;
            var isSameState = show ? isSameStateSelected(selectedState): false;

            if(show) {
                bulkActionBtn.removeClass("hide");
                var params = {tmplName: 'bulkAction', pageId: pageTypeId, dataObj: {caseStateId: selectedState,containerId: containerId}};
                var templateString = pvi.util.manageActionViews().initBulk(params);
                if (templateString === '') {
                    bulkActionBtn.addClass("noBulkActionAllowed");
                }
                var bulkActionContainer = container.find("#bulkActionContainer");
                bulkActionContainer.find("ul").remove();
                bulkActionContainer.html(bulkActionContainer.html() + templateString);

            }
            if (show && !isSameState) {
               container.find(".bulk-action-list").find("li.bulk-action:not(.assignAll)").addClass("hide");
            }else if(!show) {
                bulkActionBtn.addClass("hide");
            }
        };

        var init = function (showBtn) {
            showHideBulkActionButton(showBtn);
        };

        return {
            init: init
        }

    })();

    var uncheckSelectAllCheckbox = function () {
        container.find('.pv-caselist-checkall').prop('checked', false);
    };

    var reInitButtonsAfterRedraw = function () {
        container.on('change', '#bulk-select-bt', function (event) {
            event.stopPropagation();
            var isMultipleChecked = $(this).is(':checked');
            container.find('.list-row-checkbox').prop('checked', isMultipleChecked);
            manageBulkAction.init(isMultipleChecked);
            return false;
        });
    };

    var init_case_list = function () {
        var listDataContainerDiv = container.find("#list-data-elements");
        var orderByDefault = listDataContainerDiv.data("order-by-default");
        var paging = listDataContainerDiv.data("paging");
        var lengthChange = listDataContainerDiv.data('length-change');
        var showInfo = listDataContainerDiv.data('show-info');
        var isWidget = listDataContainerDiv.data("is-widget");
        var clearCacheOnRefresh = listDataContainerDiv.data("clear-cache-on-refresh");

        var visible = function (name) {
            var v = _.find(columnConfigs, function (obj) {
                return (obj.name === name && obj.containerView === 1);
            });
            return ! _.isEmpty(v);
        };

        var renderValueLookup = function (data, encodeToHTML) {
            var res = "";
            if (data && data.value) {
                res = (typeof encodeToHTML !== "undefined" && !encodeToHTML) ? data.value: pvi.util.encodeToHTML(data.value);
            }
            return res;
        };

        var renderNameLookup = function (data, encodeToHTML) {
            var res = "";
            if (data && data.name) {
                res = (typeof encodeToHTML !== "undefined" && !encodeToHTML) ? data.name: pvi.util.encodeToHTML(data.name);
            }
            return res;
        };

        var renderLabelWithOptions = function (data) {
            var res = "";
            if (data) {
                var infoIcon = _.isEmpty(data.reportMessage) ? "" : "&nbsp <i class='fa fa-info-circle more-option reportStateMessage' data-content='" + "<p>" + defaultRender(data.reportMessage) + "</p>" + "'></i>";
                res = "<span class='lbl-elipsis lbl-elipsis-inline'><a href='javascript:void(0)' data-id=" + data.id + " class='reportState'>" + defaultRender(data.transmissionStatus) + "</a>" + infoIcon +'</span>';
            }
            return res;
        };

        var keyValuePair = {
            'class': 'attachmentRow',
            'data-filename': 'name',
            'data-storageid': 'id',
            'data-redact':'redact'
        };

        var appendLink = function (name, datas, fieldName, newPropertyName) {
            var dataLength = datas.length;
            for (var i = 0; i < dataLength; i++) {
                var newData = datas[i];
                var attributes = '';
                var anchorLink = '';
                for (prop in keyValuePair) {
                    var value = newData[keyValuePair[prop]];
                    if (_.contains(['class'], prop)) {
                        value = keyValuePair[prop];
                    }
                    if(prop === 'data-redact' && newData['isRedactExists'] === true){
                        value = true;
                    }
                    attributes += prop + "='" + value + "' ";
                }
                if(newData['isProtected'] === true) {
                    if (newData['isRedactExists'] === true) {
                        anchorLink = "<span class='pv-ic-redact ic-sm'><i class='md md-alpha-r-box-outline'></i> </span><a href='javascript:void(0)' " + attributes + ">" + newData[fieldName] + "</a>";
                        datas[i][newPropertyName] = anchorLink;
                    } else {
                        anchorLink = "<a href='javascript:void(0)' class='pii showUnauthorisedMessage'>" + newData[fieldName] + "</a>";
                        datas[i][newPropertyName] = anchorLink;
                    }
                }else{
                    anchorLink = "<a href='javascript:void(0)' " + attributes + ">" + newData[fieldName] + "</a>";
                    datas[i][newPropertyName] = anchorLink;
                }
            }
            return datas;
        };

        var renderWithMoreOptionsForString = function (name, datas) {
            var res = "";
            if (datas && datas.length > 0) {
                datas = datas.trim().replace(/, /g, ',').split(",");
                var moreData = [];
                var dataLength = datas.length;
                for (var i = 0; i < dataLength; i++) {
                    if (datas[i]) {
                        moreData.push (datas[i]);
                    }
                }
                moreData = moreData.join(", ");
                var htmlEncodedData = pvi.util.encodeToHTML(moreData);
                var quotesConvertedData = htmlEncodedData.replace(/"/g, "'");
                res = '<span class="one-row-elipsis pvjs_outer-more-box" data-name="'+name+'" data-more="'+
                    quotesConvertedData+'"><span class="pvjs_inner-more-box">' + htmlEncodedData + '</span></span>';
            }
            return res;
        };

        var renderWithMoreOptions = function (name, datas, fieldName, encodeToHTML) {
            var result = "";
            if (datas && datas.length > 0) {
                var moreData = [];
                var dataLength = datas.length;
                for (var i = 0; i < dataLength; i++) {
                    if(datas[i])
                        moreData.push (datas[i][fieldName]);
                }
                moreData = moreData.join(", ");
                var htmlEncodedData;
                var quotesConvertedData;
                if (typeof encodeToHTML !== "undefined" && !encodeToHTML) {
                    htmlEncodedData = moreData;
                    quotesConvertedData = moreData;
                } else {
                    htmlEncodedData = pvi.util.encodeToHTML(moreData);
                    quotesConvertedData = pvi.util.convertToSingleQuote(htmlEncodedData);
                }
                result = '<span class="one-row-elipsis pvjs_outer-more-box" data-name="'+ defaultRender(name, true) +'" data-more="'+
                    quotesConvertedData +'">' +'<span class="'+(fieldName === 'link' ? 'pvjs_inner-more-box disableHtmlEncode' : 'pvjs_inner-more-box')+'">'
                    + htmlEncodedData + '</span></span>';
            }
            return result;
        };

        var defaultRender = function (str, convertToSingleQuote) {
            var res = pvi.util.encodeToHTML(str);
            if (typeof  convertToSingleQuote !== "undefined" && convertToSingleQuote) {
                res = pvi.util.convertToSingleQuote(res);
            }
            return res;
        };

        var renderOnlyIfIntakeCase = function (sourceDbId, data, encodeToHTML) {
            var res = (typeof  encodeToHTML !== "undefined" && !encodeToHTML) ? data : defaultRender(data);
            return (sourceDbId === 1) ? (!_.isEmpty(res) ? res : '') : '';
        };

        var gridCols = [
            { //0
                data: "selected",
                render: function (data, type, row) {
                    var productIDs = row.products.map(function (a) {
                        if(a.id){
                            return a.id;
                        }
                    });
                    var intakeCaseNum =  (row.sourceDbId === pvi_constants.source_db_safety) ? '' : row.intakeCaseNumber ;
                    return '<div class="td-box"><input type="checkbox" name= "listRowCheckbox" class="list-row-checkbox" data-id=' + defaultRender(row.id,true) +
                        ' class="copy-select" data-intake-case-num="' + defaultRender(intakeCaseNum, true) + '"'+
                        'data-isClinicalTrial="' + (row.sourceType ? defaultRender(row.sourceType.isClinicalTrial, true) : (!!row.studyId)) + '" ' +
                        'data-safety-case-num="' + defaultRender(row.safetyCaseNumber, true) + '"' + ' data-case-state="' + defaultRender(row.caseStateId, true) + '"' + ' data-intake-case-version="' + defaultRender(row.version, true)
                        + '"'+' data-vendor-id="' + defaultRender(row.vendorId, true) +
                        '" data-countryId="' + (row.caseCountry?defaultRender(row.caseCountry.id, true):"") +  '" data-studyId="' + defaultRender(row.studyId, true) + '" data-assignToId="' + defaultRender(row.assignedTo, true) + '"'+ '" data-productIds="' + defaultRender(productIDs, true) + '"' + '></div>';
                },
                orderable: false,
                name: 'selected',
                className: "snum"
            },
            { //1
                data: 'intakeCaseNumber',
                name: 'intakeCaseNumber',
                orderable: true,
                visible: true,
                className: "col-intake-case",
                render: function (data, type, row) {
                    return '<a href="#" class="link-to-fce"'+' data-source-db ="'
                        + defaultRender(row.sourceDbId, true) +'"'+' data-id='
                        + defaultRender(row.id, true) + '>' + (data ? defaultRender(data) : '') + '</a>'
                }
            },
            { //2
                data: 'caseVersion',
                name: 'caseVersion',
                visible: visible('caseVersion'),
                className: "col-case-version",
                orderable: true,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //3
                data: 'firstReceiptDateString',
                name: 'firstReceiptDate',
                visible: visible('firstReceiptDate'),
                className: "col-first-rdate",
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //4
                data: 'reporterQualification',
                name: 'reporters.qualificationValue',
                visible: visible('reporters.qualificationValue'),
                className: "col-reporter-type",
                orderable: true,
                render: function (data, type, row) {
                    return (row.reporterQualification) ?  defaultRender(row.reporterQualification.value) : "";
                }
            },
            { //5
                data: 'events',
                name: 'events.eventName',
                visible: visible('events.eventName'),
                orderable: false,
                className: "col-case-events",
                render: function (data) {
                    return renderWithMoreOptions('events', data, 'eventName');
                }
            },
            { //6
                data: 'products',
                name: 'products.name',
                visible: visible('products.name'),
                orderable: false,
                className: "col-case-products",
                render: function (data) {
                    return renderWithMoreOptions('products', data, 'name');
                }
            },
            { //7
                data: 'caseSeriousness',
                name: 'caseSeriousness.category',
                visible: visible('caseSeriousness.category'),
                className: "col-case-ser",
                orderable: true,
                render: function (data) {
                    return data ? defaultRender(data) : "";
                }
            },
            { //8
                data: 'priority',
                name: 'priority.value',
                visible: visible('priority.value'),
                sWidth: "40px",
                orderable: true,
                className: "col-case-priority",
                render: function(data, type, row) {
                    var res = "";
                    if(row.sourceDbId === 1){
                        var value = renderValueLookup(data);
                        var prioritiesSelectView = pvi.util.manageCasePriority.getSelectView(row.id);
                        var pJustificationComments = row.priorityJustification ? row.priorityJustification : "";
                        var iconClasses = "more-option md md-information pv-priority-log allow-text" + (pJustificationComments ? "" : " hidden");
                        var infoIcon = '&nbsp <i id="priorityLog" class="'+ iconClasses + '" data-moredata="' + defaultRender(pJustificationComments, true) + '" data-id="'+defaultRender(row.id,true)+'"></i>';
                        if (!value) {
                            value = pvi_constants.case_no_priority_select;
                        }
                        var selectionClasses = pvi.util.manageCasePriority.getClasses(value);
                        res = "<span class='"+selectionClasses+"'><span class='more-option pv-ic-priority' data-priority-select-id='"+defaultRender(row.id, true)+"' data-target-event='click' data-content='" + prioritiesSelectView + "'>"+value+"</span>"+infoIcon+"</span>";
                    }
                    return res;
                }
            },
            { //9
                data: 'attachments',
                className: 'pv-col-attachment',
                name: 'attachments.name',
                visible: visible('attachments.name'),
                orderable: false,
                render: function (data) {
                    var res = "";
                    if (data && !_.isEmpty(data[0])) {
                        var newData = appendLink('attachments', data, 'name', 'link');
                        res = renderWithMoreOptions('attachments', newData, 'link', false);
                    }
                    return res;
                }
            },
            { //10
                data: 'dueDateString',
                name: 'dueDate',
                visible: visible('dueDate'),
                className: "col-due-date",
                render: function (data, type, row) {
                    var res = "";
                    if(row.sourceDbId === 1){
                        var popup = (row.dueDateJustification ? '<i class="fa fa-info-circle more-option m-l-5 allow-text" data-moredata="'+ defaultRender(row.dueDateJustification,true) + '"></i>' : "");
                        res = '<span class="flex-box">'+ '<span class="lbl-elipsis lbl-elipsis-inline">'+(row.dueDateString ? row.dueDateString : "") + '</span>'+ popup + '</span>';
                    }
                    return res;
                }
            },
            { //11
                data: 'isRelated',
                name: 'isRelated',
                className: "col-is-related",
                visible: visible('isRelated'),
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //12
                data: 'assignedToUsername',
                name: 'assignedToUsername',
                visible: visible('assignedToUsername'),
                className: "pv-col-editable col-assigned-to",
                render: function (data, type, row) {
                    var res = "";
                    if (row.sourceDbId === 1) {
                        var assignedUsername = pvi.util.manageUserAssign.assignedUserName(data);
                        var infoIcon = row.isAssignmentHistory ? "&nbsp <i id='assignedToLog' class='fa fa-info-circle pv-caseAssign-log ' data-id='"+defaultRender(row.id)+"'></i>" : "";
                        if (row.userRoles.length === 0) {
                            res = assignedUsername;
                        } else {
                            var productIDs = row.products.map(function (a) {
                                if(a.id){
                                    return a.id;
                                }
                            });
                            res = '<span class="assign-user-box"><a href="#" data-type="select2" data-countryId= "'
                                + defaultRender(row.caseCountry ? row.caseCountry.id:"", true) + '" ' +
                                'data-productIds="' + productIDs + '" ' +
                                'data-pk="' + defaultRender(row.id, true) + '" ' +
                                'data-assingeeId="' + defaultRender(row.assignedTo, true) + '" ' +
                                'data-isClinicalTrial="' + (row.sourceType ? defaultRender(row.sourceType.isClinicalTrial, true) : (!!row.studyId)) + '" ' +
                                'data-studyId="' + defaultRender(row.studyId, true) + '" ' +
                                'data-vendorId="' + defaultRender(row.vendorId, true) + '" ' +
                                'data-url="' + pvi_urls.case_assignee_user_list_url + '" data-value="ru" data-title="Select User" class="assignUser manageAssignUser lbl-elipsis lbl-elipsis-inline">' + defaultRender(assignedUsername) + '</a>' +
                                '<select class="form-control select2 hide displayUserList" disabled></select>'+infoIcon+'</span>';
                        }
                    }
                    return res;
                }
            },
            { //13
                data: 'safetyCaseNumber',
                name: 'safetyCaseNumber',
                className: "col-safety-cnumber",
                visible: visible('safetyCaseNumber'),
                render: function (data, type, row) {
                    var classes = (row.sourceDbId === pvi_constants.source_db_safety || row.safetyCaseExists) ? "safety-link-to-fce" : "safety-link-to-fce safety-link-not-exists" ;
                    return  '<a href="#" class= "'+ classes +'" data-source-db="'+ defaultRender(row.sourceDbId, true) + '" data-id=' + defaultRender(row.id, true) + '>' + (data ? defaultRender(data) : '') + '</a>';
                }
            },
            { //14
                data: 'reportType',
                name: 'reportType',
                className: "col-report-type",
                visible: false,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //15
                data: 'patientAge',
                name: 'patientAge',
                visible: visible('patientAge'),
                className: "col-patient-age",
                orderable: false,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //16
                data: 'gender',
                name: 'gender.value',
                visible: visible('gender.value'),
                className: "col-list-gender",
                orderable: true,
                render: function (data) {
                    return renderValueLookup(data);
                }
            },
            { //17
                data: 'destination',
                name: 'icsr.destination',
                className: "col-list-destination",
                visible: visible('icsr.destination'),
                render: function (data, type, row) {
                    return renderOnlyIfIntakeCase(row.sourceDbId, data);
                }
            },
            { //18
                data: 'reportDueDateString',
                name: 'icsr.dueDate',
                className: "col-report-duedate",
                visible: visible('icsr.dueDate'),
                render: function (data, type, row) {
                    return renderOnlyIfIntakeCase(row.sourceDbId, data);
                }
            },
            { //19
                data: 'reporterComments',
                name: 'reporterComments',
                visible: visible('reporterComments'),
                orderable: false,
                className: "col-reporter-comments",
                render: function (data) {
                    return '<span class="one-row-elipsis pvjs_outer-more-box" data-more="' + defaultRender(data, true) + '">'
                        + '<span class="pvjs_inner-more-box">' + defaultRender(data) + '</span>';
                }
            },
            { //20
                data: 'reporters',
                name: 'reporters.name',
                visible: visible('reporters.name'),
                className: "col-reporter-name",
                render: function (data) {
                    return renderWithMoreOptions('reporters', data, 'name');
                }
            },
            { //21
                data: 'senderType',
                name: 'senderType.value',
                visible: visible('senderType.value'),
                className: "col-sender-type",
                orderable: true,
                render: function (data, type, row) {
                    return renderOnlyIfIntakeCase(row.sourceDbId, renderValueLookup(data, false));
                }
            },
            { //22
                data: 'senderName',
                name: 'senderName',
                className: "col-sender-name",
                visible: visible('senderName'),
                render: function (data, type, row) {
                    return renderOnlyIfIntakeCase(row.sourceDbId, data);
                }
            },
            { //23
                data: 'eventCountry',
                name: 'eventCountry.name',
                visible: visible('eventCountry.name'),
                className: "col-event-country",
                render: function (data) {
                    return renderNameLookup(data);
                }
            },
            { //24
                data: 'reportVersion',
                name: 'icsr.reportVersion',
                className: "col-report-version",
                visible: visible('icsr.reportVersion'),
                render: function (data, type, row) {
                    return renderOnlyIfIntakeCase(row.sourceDbId, data);
                }
            },
            { //25
                data: 'icsr',
                name: 'icsr.transmissionStatus',
                visible: visible('icsr.transmissionStatus'),
                className: "pv-col-editable col-icsr-trans",
                render: function (data, type, row) {
                    if(row.sourceDbId === 1){
                        return renderLabelWithOptions(data);
                    }
                    else {
                        return ""
                    }
                }
            },
            { //26
                data: 'stateTimestampString',
                name: 'icsr.stateTimestamp',
                className: "col-state-timestamp",
                visible: visible('icsr.stateTimestamp'),
                render: function (data, type, row) {
                    return renderOnlyIfIntakeCase(row.sourceDbId, data);
                }
            },
            { //27
                data: 'reportMessage',
                name: 'icsr.reportMessage',
                visible: visible('icsr.reportMessage'),
                className: "col-report-message",
                orderable: false,
                render: function(data,type,row){
                    data = renderOnlyIfIntakeCase(row.sourceDbId, data);
                    return '<span class="one-row-elipsis pvjs_outer-more-box"><span class="pvjs_inner-more-box" data-type-string="true">' + data + '</span></span>'
                }
            },
            { //28
                data: 'eventName',
                name: 'eventName',
                className: "col-event-name",
                visible: visible('eventName'),
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //29
                data: 'eventStartDate',
                name: 'eventStartDate',
                className: "col-event-startdate",
                visible: visible('eventStartDate'),
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //30
                data: 'outcome',
                name: 'outcome.value',
                visible: visible('outcome.value'),
                className: "col-list-outcome",
                render: function (data) {
                    return renderValueLookup(data);
                }
            },
            { //31
                data: 'reporterCountry',
                name: 'reporters.countryName',
                visible: visible('reporters.countryName'),
                className: "col-reporter-country",
                orderable: true,
                render : function (data, type, row) {
                    return (row.reporterCountry) ?  defaultRender(row.reporterCountry.name) : "";
                }
            },
            { //32
                data: 'relatednessString',
                name: 'relatednessString',
                className: "col-relatedness-str",
                visible: visible('relatednessString'),
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //33
                data: 'sourceType',
                name: 'sourceType.type',
                visible: visible('sourceType.type'),
                className: "col-source-type",
                render: function (data) {
                    return (data && data.type) ? defaultRender(data.type) : "";
                }
            },
            { //34
                data: 'categories',
                name: 'categories.value',
                visible: visible('categories.value'),
                orderable: false,
                className: "col-list-categories",
                render: function (data, type, row) {
                    if (data && row.sourceDbId === 1) {
                       _.collect(data, function (ele) {
                            return  ele.value
                        }).join(", ");
                        return renderWithMoreOptions('categories', data, 'value');
                    } else {
                        return "";
                    }
                }
            },
            { //35
                mData: 'mostRecentReceiptDateString',
                name: 'mostRecentReceiptDate',
                sWidth: "40px",
                className: "col-most-rrdate",
                visible: visible('mostRecentReceiptDate'),
                render: function(data) {
                    return defaultRender(data);
                }

            },
            { //36
                data: 'productName',
                name: 'productName',
                visible: visible('productName'),
                className: "col-product-name",
                render : function (data) {
                    return defaultRender(data);
                }
            },
            { //37
                data: 'substances',
                name: 'substances.nameValue',
                visible: visible('substances.nameValue'),
                className: "col-list-substances",
                orderable: false,
                render: function (data) {
                    return renderWithMoreOptions('substances', data, 'nameValue');
                }
            },
            { //38
                data: 'studyNumber',
                name: 'studyNumber',
                className: "col-study-number",
                visible: visible('studyNumber'),
                render : function (data) {
                    return defaultRender(data);
                }

            },
            { // 39
                data: 'caseState',
                name: 'caseState',
                className: "col-case-state",
                visible: visible('caseState'),
                render: function (data, type, row) {
                    var res = "";
                     if(row.sourceDbId === 1) {
                         var comment = row.stateChangeComment;
                         comment = _.isUndefined(comment) || !comment ? '' : comment.replace(/'/g, "&#39;");
                         var infoIcon = !comment ? "" : "&nbsp <i class='fa fa-info-circle more-option allow-text stateChangeComment' data-content='"+ comment + "'></i>";
                         res = '<div>'+data+infoIcon+'</div>';
                     }
                     return res;
                }
            },
            { //40
                data: 'versionType',
                name: 'versionType.value',
                visible: false,
                className: "col-version-type",
                render: function (data) {
                    return renderValueLookup(data);
                }
            },
            { // 41
                data: 'receiptDateString',
                name: 'receiptDate',
                visible: visible('receiptDate'),
                className: "col-receipt-date",
                orderable: false,
                render : function (data) {
                    return defaultRender(data);
                }
            },
            { // 42
                data: 'onsetDate',
                name: 'onsetDate',
                visible: visible('onsetDate'),
                className: "col-onset-date",
                orderable: true,
                render : function (data) {
                    return defaultRender(data);
                }
            },
            {// 43
                data: 'submissionDate',
                name: 'submissionDate',
                className: "col-submission-date",
                visible: false,
                render : function (data) {
                    return defaultRender(data);
                }
            },
            {// 44
                data: 'dosageForm',
                name: 'dosageForm.value',
                visible: visible('dosageForm.value'),
                className: "col-dosage-form",
                render: function (data) {
                    return renderValueLookup(data);
                }
            },
            {// 45
                data: 'caseVersionType',
                name: 'caseVersionType',
                className: "col-case-vtype",
                visible: false,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {// 46
                data: 'icsrType',
                name: 'icsr.type',
                className: "col-icsr-type",
                visible: visible('icsr.type'),
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {// 47
                data: 'studyType',
                name: 'studyType.value',
                visible: visible('studyType.value'),
                className: "col-study-type",
                render: function (data) {
                    return renderValueLookup(data);
                }
            },
            {//48
                data: 'patientName',
                name: 'patientName',
                visible: visible('patientName'),
                className: "col-patient-name",
                render:function (data) {
                    return defaultRender(data);
                }
            },
            {//49
                data: 'seriousness',
                name: 'seriousnessString',
                visible: visible('seriousnessString'),
                className: "col-list-ser",
                orderable: false,
                render: function (data) {
                    return renderWithMoreOptions('seriousness', data, 'shortName');
                }
            },
            {//50
                data: 'caseCountry',
                name: 'caseCountry.name',
                visible: visible('caseCountry.name'),
                className: "col-case-country",
                render: function (data) {
                    return renderNameLookup(data);
                }
            },
            {//51
                data: 'allReferences',
                name: 'allReferences',
                visible: visible('allReferences'),
                orderable: false,
                className: "col-all-ref",
                render: function (data, type, row) {
                    if(row.sourceDbId === 1) {
                        return defaultRender(data);
                    }
                    else {
                       return renderWithMoreOptionsForString("allReferences",data);
                    }
                }
            },
            {//52
                data: 'patientId',
                name: 'patientId',
                className: "col-patient-id",
                visible: visible('patientId'),
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {//53
                data: 'dobString',
                name: 'dob',
                className: "col-list-dob",
                visible: visible('dob'),
                render: function(data) {
                    return defaultRender(data);
                }
            },
            {//54
                data: 'matchScore',
                name: 'matchScore',
                visible: visible('matchScore'),
                orderable: true,
                className: "matchScore col-match-score",
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {// 55
                data: 'simpleSearch',
                name: 'simpleSearch',
                visible: false,
                className: "col-simple-search",
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { // 56
                data: 'dateRangeSearch',
                name: 'dateRangeSearch',
                className: "col-daterange-search",
                visible: false,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {//57
                data: 'sourceDb',
                name: 'sourceDb',
                visible: visible('sourceDb'),
                className: "col-source-db",
                orderable: true,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {//58
                data: 'safetyWFState',
                name: 'safetyWFState',
                visible: visible('safetyWFState'),
                className: "col-safety-wfstate",
                orderable: true,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //59
                data: 'centralReceiptDateString',
                name: 'centralReceiptDate',
                visible: visible('centralReceiptDate'),
                className: "col-central-receipt-date",
                orderable: true,
                render: function(data) {
                    return defaultRender(data);
                }
            },
            { //60
                data: 'localSubmissionDateString',
                name: 'localSubmissionDate',
                visible: visible('localSubmissionDate'),
                className: "col-local-submission-date",
                orderable: true,
                render: function(data) {
                    return defaultRender(data);
                }
            },
            { //61
                data: 'localSubmissionDueDateString',
                name: 'localSubmissionDueDate',
                visible: visible('localSubmissionDueDate'),
                className: "col-local-submission-due-date",
                orderable: true,
                render: function(data) {
                   return defaultRender(data);
                }
            },
            { //62
                data: 'latestAssignmentComment',
                name: 'latestAssignmentComment',
                visible: visible('latestAssignmentComment'),
                orderable: false,
                className: "col-assignment-comments",
                render: function (data) {
                    var htmlEncodedData = "";
                    var quotesConvertedData = "";
                    if (data) {
                         htmlEncodedData = pvi.util.htmlEncode(data);
                         quotesConvertedData = pvi.util.convertToSingleQuote(htmlEncodedData);
                    }
                    return '<span class="one-row-elipsis pvjs_outer-more-box" data-more="' + quotesConvertedData + '">' +
                        '<span class="pvjs_inner-more-box">' + htmlEncodedData + '</span></span>'
                }
            },
            { //63
                data: 'vendor',
                name: 'vendor',
                visible: visible('vendor'),
                className: "col-case-vendor",
                orderable: true,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //64
                data: 'replacementRequired',
                name: 'replacementRequired',
                visible: visible('replacementRequired'),
                className: "col-replacement-required",
                orderable: true,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //65
                data: 'caseCreatedDate',
                name: 'caseCreatedDate',
                visible: visible('caseCreatedDate'),
                className: "col-case-date-created",
                orderable: true,
                render: function(data) {
                    return defaultRender(data);
                }
            },
            { //66
                data: 'reporters',
                name: 'reporters.organization',
                visible: visible('reporters.organization'),
                className: "col-case-reporter-organization",
                orderable: true,
                render : function (data) {
                    return renderWithMoreOptions('reporters', data, 'organization');
                }
            },
            { //67
                data: 'reporters',
                name: 'reporters.department',
                visible: visible('reporters.department'),
                className: "col-case-reporter-department",
                orderable: true,
                render : function (data) {
                    return renderWithMoreOptions('reporters', data, 'department');
                }
            },
            { //68
                data: 'reporters',
                name: 'reporters.address',
                visible: visible('reporters.address'),
                className: "col-case-reporter-address",
                orderable: true,
                render: function (data) {
                    return renderWithMoreOptions('reporters', data, 'address');
                }
            },
            { //69
                data: 'reporters',
                name: 'reporters.telephone',
                visible: visible('reporters.telephone'),
                className: "col-case-reporter-telephone",
                orderable: true,
                render : function (data) {
                    return renderWithMoreOptions('reporters', data, 'telephone');
                }
            },
            { //70
                data: 'reporters',
                name: 'reporters.faxNumber',
                visible: visible('reporters.faxNumber'),
                className: "col-case-reporter-fax",
                orderable: true,
                render : function (data) {
                    return renderWithMoreOptions('reporters', data, 'faxNumber');
                }
            },
            { //71
                data: 'reporters',
                name: 'reporters.email',
                visible: visible('reporters.email'),
                className: "col-case-reporter-email",
                orderable: true,
                render : function (data) {
                    return renderWithMoreOptions('reporters', data, 'email');
                }
            },
            { //72
                data: 'pqcCaseNumber',
                name: 'pqcCaseNumber',
                className: "col-pqc-cnumber",
                visible: visible('pqcCaseNumber'),
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {//73
                data: 'returnRequired',
                name: 'returnRequired',
                visible: visible('returnRequired'),
                className: "col-case-returnRequired",
                orderable: true,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            {//74
                data: 'refundRequested',
                name: 'refundRequested',
                visible: visible('refundRequested'),
                className: "col-case-refundRequested",
                orderable: true,
                render: function (data) {
                    return defaultRender(data);
                }
            },
            { //75
                data: 'reporters',
                name: 'reporters.contactTypes.value',
                visible: visible('reporters.contactTypes.value'),
                className: 'col-case-reporter-contact-types',
                orderable: false,
                render: function(data) {
                    if(data) {
                        data =  _.collect(data[0].contactTypes, function (ele) {
                            return defaultRender(ele.value);
                        }).join(", ");
                       return renderWithMoreOptionsForString('contactTypes', data);
                    }
                  }
            },
            { // 76
                data: 'action',
                orderable: false,
                className: "pv-table-action",
                render: function (data, type, row) {
                    row['isList'] = true;
                    row['containerId'] = containerId;
                    row['actionVisible'] = actionVisible;
                    return pvi.util.manageActionViews().init({
                        tmplName: 'viewAction',
                        pageId: pageTypeId,
                        dataObj: row
                    });
                }
            }
        ];

        var gridSearchCols = [
            null, //0
            null, //1
            null, //2
            null, //3
            null, //4
            null, //5
            null, //6
            null, //7
            null, //8
            null, //9
            null, //10
            null, //11
            { // 12
                search: loginUser
            },
            null, //13
            null, //14
            null, //15
            null, //16
            null, //17
            null, //18
            null, //19
            null, //20
            null, //21
            null, //22
            null, //23
            null, //24
            null, //25
            null, //26
            null, //27
            null, //28
            null, //29
            null, //30
            null, //31
            null, //32
            null, //33
            null, //34
            null, //35
            null, //36
            null, //37
            null, //38
            null, //39
            null, //40
            null, //41
            null, //42
            null, //43
            null, //44
            null, //45
            null, //46
            null, //47
            null, //48
            null, //49
            null, //50
            null, //51
            null, //52
            null, //53
            null, //54
            {     //55
                search: '{ "firstReceiptDate" : ' + getDefaultDateRange() + ', "caseStateId" : "' + buildIncludeExcludeValues() + '", "sourceDbId" : "' + getSourceDatabasesOrDefault().join(",") + '"}'
            },
            null, //56
            null, //57
            null, //58
            null, //59
            null, //60
            null, //61
            null, //62
            null, //63
            null, //64
            null, //65
            null, //66
            null, //67
            null, //68
            null, //69
            null, //70
            null, //71
            null, //72
            null, //73
            null, //74
            null //75 - Action/View
        ];

        columnSize = gridCols.length;
        var dataTableStorageKey = getStorageKey('DataTable');

        var setStudyAndPatientVisibility = function () {
            var clinicalTrials = pvi.referenceDataUtil.manageReferenceData.getListReferenceData("clinical-trials");
            var val = $("#duplicateSearchForm select[name='safetyData.sourceType.id']").val();
            var studyFields = $("input[name^='safetyData.study']").closest(".template-control");
            if(clinicalTrials) {
                if (clinicalTrials.indexOf(parseInt(val)) >= 0) {
                    studyFields.removeClass('hide');
                    $("#studyName").addClass('hide');
                    $('#patientPatientId').removeClass('hide').find('input').removeClass('hide');
                }
                else {
                    studyFields.addClass('hide');
                    $('#patientPatientId').addClass('hide').find('input').addClass('hide').val("");
                }
            }
        };

        var handleShowHideFieldForDupSearch = function () {
            /*todo refactor below code the remove hard dependency*/
            var dropdownIdList = [];
            _.each($("div.pv-head-config").find("input:checkbox"), function (item) {
                if(item.checked){
                    dropdownIdList.push($(item).data('id'));
                }
            });
            _.each($("#duplicateSearchForm").find(".template-control"), function (item) {
                item = $(item);
                var sectionId = item.attr("id");
                if(dropdownIdList.length > 0  && dropdownIdList.indexOf(sectionId) < 0 || dropdownIdList.length === 0){
                    item.addClass("hide");
                }
            });
            setStudyAndPatientVisibility();
        };

        var clearPageStateHistoryIfNeeded = function () {
            // loading here to show/hide fields
            searchFormState.loadVisibilityState();
            $("li.field-visible").each(function() {
                var li = $(this);
                if (!li.hasClass("click-disabled")) {
                    var checkbox = li.find(":checkbox")[0];
                    var id = li.data('id');
                    var isDuplicateFieldId = $(checkbox).data('class').indexOf(pvi_constants.duplicateFieldIdClass) > -1;
                    var elementSelector;
                    if (isDuplicateFieldId) {
                        elementSelector = pvi.util.includeDuplicateFields(id);
                    } else {
                        elementSelector = pvi.util.excludeDuplicateField(id);
                    }
                    checkbox.checked = !elementSelector.hasClass('hide');
                }
            });
            if (isOnDuplicateSearchPage) {
                handleShowHideFieldForDupSearch();
            }
            if (!isLoadedViaBack && clearCacheOnRefresh) {
                //clear completely only for dup search
                searchFormState.clearSelectively();
                manageSessionStorage.removeItem(dataTableStorageKey);
            }
            searchFormState.loadState(searchFormName);
        };

        var getDateValueFromRange = function (data, dateFormat) {
            if(!data){
                return '';
            }
            var json = JSON.parse(data);
            if (json && json.gte && dateFormat) {
                return moment.utc(json.gte).format(dateFormat);
            }
            return '';
        };

        var handleFixColumnFocus = function(){
            if(focusOnFixedCol) {
                var element = container.find("input[data-field='"+fixedFilterColName+"']:visible");
                element.focus();
                var value = element.val();
                element.val("").val(value);
                focusOnFixedCol = false;
            }
        };

        var updateGridUI = function () {
            pvui.grid.utils.setGridHeight(container);
            caseListTable.fixedColumns().update();
            handleFixColumnFocus();
        };

        container.on({
            'shown.bs.collapse' : function () {
                updateGridUI();
            },
            'hidden.bs.collapse' : function () {
                updateGridUI();
            }
        },'#accordion-searchcase');

        $(document).on('click', '.pdfView', function () {
            var pdfLinkHref = $(this).find('a').attr('href');
            window.location.href = pvi.util.updateUrlQueryStringParameter(pdfLinkHref, 'templateId', "");
        });

        var updateGridScrollbarOnSplitView = function () {
            $(document).on("change", "#eastPanelToggle", function () {
                pvui.grid.manageUIWrapper.updatePerfectScrollbar(container);
                updateGridUI();
            });
        };

        clearPageStateHistoryIfNeeded();

        dataTable.on('draw.dt', function () { //Needed before table initialization for enabling/disabling AssignedTo ColumnFilter.
                highlightTab();
            });

        var deferredDataSource = function(data) {
            return $.Deferred(function(d) {
                if (!initialized) {
                    d.resolve({
                        data: {
                            recordsTotal: 0,
                            myRecordsTotal: 0,
                            recordsFiltered: 0,
                            data: {}
                        }
                    });
                } else {
                    if (!paging) {
                        dataTableOptions.length = pageLength;
                    }
                    dataTableOptions.loadData = true;
                    _.extend(data, dataTableOptions);
                    $.ajax({
                        url: createURL(pvi_urls.case_list_data_url),
                        type: 'POST',
                        data: data,
                        beforeSend: function() {
                            if(isDashboardPage) {
                                pvui.common.pvWidgetLoader.showLoader(container);
                            } else{
                                pvui.common.showPVLoader();
                            }
                        },
                        success: function(json) {
                            d.resolve({
                                data: json
                            });
                        },
                        complete: function() {
                            dataTableOptions.loadData = false;
                            isDashboardPage ? pvui.common.pvWidgetLoader.hideLoader(container) : pvui.common.hidePVLoader();
                        }
                    });
                }
            });
        };

        caseListTable = dataTable.DataTable({
            ordering: true,
            searching: true,
            stateSave: true,
            stateDuration: -1,
            serverSide: true,
            processing: true,
            dom: 'rtip',
            scrollCollapse: true,
            renderer: "bootstrap",
            scrollX: true,
            fixedColumns: {
                leftColumns: 2
            },
            scrollY: pvui.grid.utils.getGridHeight(container),
            colReorder: {
                realtime: false
            },
            order: orderByDefault, //default sorting is by First Receipt date desc
            paging: paging,
            lengthChange: lengthChange,
            pageLength: pageLength ? pageLength : 25,
            displayStart: pageStart,
            info: showInfo,
            'pagingType': 'full_numbers_no_ellipses',
            fnInitComplete: updateGridScrollbarOnSplitView,
            lengthMenu: [25, 50, 100, 250],
            "stateLoadParams": function (settings, data) {
                searchFormState.loadState(searchFormName);
                if (data) {
                    var isFromBackButton = (isLoadedViaBack && !isWidget);
                    if (!isFromBackButton) {
                        data.start = 0;
                        if (orderByDefault) {
                            data.order = orderByDefault;
                        }
                    }
                    if (paging && data.length) {
                        container.find('.inp-display-record').val(data.length);
                    }
                    if (isWidget) {
                        data.length = pageLength ? pageLength : 5;
                        data.start = 0;
                    }
                    if (data.columns) {
                        dataTable.find("thead th").each(function () {
                            try {
                                var that = $(this);
                                var colIndex = that.data('idx');
                                if (!isFromBackButton) {
                                    var dataField = that.attr('data-field');
                                    if ((dataField !== 'simpleSearch')) {
                                        if(data.columns[colIndex].search === undefined) {
                                            data.columns[colIndex].search = {};
                                        }
                                        if(dataField === 'assignedToUsername' && (data.columns[colIndex].search.search === loginUser || data.columns[colIndex].search.search === undefined)) {
                                            data.columns[colIndex].search.search = loginUser;
                                        } else {
                                            data.columns[colIndex].search.search = '';
                                        }
                                    } else {
                                        var simpleSearchJson = JSON.parse(data.columns[colIndex].search.search);
                                        if (pageTypeId == "4") {
                                            simpleSearchJson = buildSimpleSearchCriteria()
                                        } else {
                                            _.each(['firstReceiptDate', 'mostRecentReceiptDate', 'submissionDate'], function (it) {
                                                if (simpleSearchJson[it]) {
                                                    var rangeJson = typeof simpleSearchJson[it] === "string"? JSON.parse(simpleSearchJson[it]):simpleSearchJson[it];
                                                    if (rangeJson.range) {
                                                        var range = createDateRangeValue(rangeJson.range, rangeJson.x);
                                                        rangeJson.gte = range.gte;
                                                        rangeJson.lte = range.lte;
                                                        simpleSearchJson[it] = JSON.stringify(rangeJson);
                                                    }
                                                }
                                            });
                                        }
                                        data.columns[colIndex].search.search = JSON.stringify(simpleSearchJson);
                                    }
                                }
                                var searchValue = data.columns[colIndex].search.search;
                                if (typeof searchValue === 'string' || searchValue instanceof String) {
                                    var inputField = that.find('input');
                                    if (inputField.hasClass('date-time-filter')) {
                                        inputField.val(getDateValueFromRange(searchValue, inputField.attr('data-precision')));
                                        return;
                                    }
                                    inputField.val(searchValue);
                                }
                            } catch (e) {
                                console.log(e);
                            }
                        });
                    }
                }
                return true;
            },
            "stateSaveCallback": function (settings, data) {
                if (isWidget) {
                    return;
                }
                try {
                    var value = JSON.stringify(data);
                    browserStorage.utils.addToStorage(dataTableStorageKey,value);
                    pvi.user.state.saveState(value, searchFormName, pvi_page_section_name.datatable_section);
                } catch (e) {
                    console.log(e);
                }
            },
            "stateLoadCallback": function (settings) {
                var storageData = browserStorage.utils.getFromStorage(dataTableStorageKey);
                if(_.isEmpty(storageData)) {
                    storageData = (pvi.user.state.loadState(searchFormName,pvi_page_section_name.datatable_section)).data.data;
                    dataTable.find("thead th[data-field='assignedToUsername'] select").val(loginUser).trigger("change.select2");
                }
                return (storageData ? JSON.parse(storageData) : null);
            },
            ajax: function(data, callback, settings) {
                deferredDataSource(data).done(function (_data) {
                    var dataJson = _data.data;
                    container.find('#my-cases-count').text(dataJson.myRecordsTotal);
                    var matchingRecordTotal = dataJson.matchingRecordsTotal === 0 ? dataJson.myRecordsTotal :  dataJson.matchingRecordsTotal;
                    var matchCaseCountText = matchingRecordTotal;
                    if (matchingRecordTotal && matchingRecordTotal > pageLength) {
                        matchCaseCountText = getMessage('more_than_matching_msg', {pageLen: pageLength});
                    }
                    container.find('#matching-cases-count').text(matchCaseCountText);
                    container.find('#all-cases-count').text(dataJson.recordsTotal);
                    callback(dataJson);
                });
            },
            columns: gridCols,
            searchCols: gridSearchCols
        });

        caseListTableRef.caseListTable = caseListTable;
        allCaseListTables.push(caseListTable);

        var highLightRows = function () {
            caseListTable.rows().every(function (rowIdx) {
                var row = caseListTable.row(rowIdx);
                var data = row.data();
                var node = row.node();
                if (data.passDue && !(_.contains([pvi_case_state_names.SUCCESSFUL, pvi_case_state_names.REJECTED], data.caseState))) {
                    $(node).addClass("pv-case-overdue");
                }
            });
        };

        var maskPIIFields = function(){
            dataTable.find("td").each(function(){
                var ele = $(this);
                if(ele.text() === PIIMaskPattern){
                    ele.addClass("pv-pii").text(PIIMaskString);
                }
            });
        };

        var handleActionDropdown = function (evt, action, caseId, templateId, intakeCaseNumber, caseState, targetContainer, intakeCaseVersion) {
            var justificationModal = $("#pv-justification-modal");

            var changeCaseStateWithJustification = function (targetState, params) {
                var password = $("#justificationPassword").val();
                pvi.util.showSpinDlg(function () {
                    $.ajax({
                        url: pvi_urls.case_state_change,
                        async: false,
                        type: 'POST',
                        data: {
                            data: JSON.stringify({
                                id: parseInt(caseId),
                                toStateId: targetState,
                                actionPerformed: action,
                                comments: params.comments,
                                timestamp: params.timestamp,
                                username: usernameToSavePreference,
                                password: password
                            })
                        },
                        success: function (data) {
                            pvui.common.hidePVLoader();
                            var resp = JSON.parse(data);
                            if (_.has(resp, "caseStateChanged") && !resp.caseStateChanged) {
                                pvi.util.handleCaseStateChangeRejection(resp);
                            } else {
                                setTimeout(function () {
                                    justificationModal.modal("hide");
                                    _.each(allCaseListTables, function(e) {
                                        e.ajax.reload();
                                    });
                                    pvi.util.showFloatingNotification.successMessage(resp.message);
                                }, 1000);
                            }
                        }
                    });
                });
            };

            var changeCaseState = function (targetState) {
                $.ajax({
                    url: pvi_urls.case_state_change,
                    type: 'POST',
                    data: {
                        data: JSON.stringify({
                            id: parseInt(caseId),
                            toStateId: targetState,
                            actionPerformed: action
                        })
                    },
                    beforeSend: function () {
                        pvui.common.showPVLoader();
                    },
                    success: function (data) {
                        var resp =JSON.parse(data);
                        if (resp.status == 422) {
                            pvi.list.commonFunctions.populateErrorInErrorContainer(resp.text.errors,targetContainer);
                            caseListTable.ajax.reload();
                            pvui.common.hidePVLoader();
                        }
                        else {
                        setTimeout(function () {
                            _.each(allCaseListTables, function(e) {
                                e.ajax.reload();
                            });
                            pvui.common.hidePVLoader();
                            pvi.util.showFloatingNotification.successMessage(resp.message);
                        }, 1000);
                        }
                    }
                });
            };

            var target = $(evt.target);
            if(target.parent('li:first').hasClass('task')){
                var callBack = function () {
                    var caseCountryId = target.data("case-country-id");
                    var vendorId = target.data("vendor-Id");
                    taskAction.commonMethod.addTask(caseId, intakeCaseNumber, intakeCaseVersion, null, caseCountryId, vendorId);
                };
                pvi.util.checkEditLock(caseId, callBack);
                return false;
            }
            else if(target.parent('li:first').hasClass('followUpQuery')){
                var callBack = function () {
                    followUpQuery.commonMethod.addFollowUpQuery(caseId, intakeCaseNumber, intakeCaseVersion);
                    pvi.util.getCaseData(caseId);
                };
                pvi.util.checkEditLock(caseId, callBack);
                return false;
            }
            else if (target.parent('li:first').hasClass('duplicateSearch')) {
                var gotoDupSearch = function () {
                    pvi.util.gotoURL(pvi_urls.duplicate_search_url + target.data('case-id'));
                };
                pvi.util.checkEditLock(caseId, gotoDupSearch);
                return;
            }
            switch (action) {
                case activeStateId:
                    if ($(target).parent().hasClass('followUp')) {
                        var acceptFollowUp = function() {
                            var params = {
                                url: pvi_urls.follow_up_url,
                                followUpCaseId: caseId
                            };
                            pvi.util.showFollowUpModal.init(params, followUpFromList, true);
                        };
                        pvi.util.checkEditLock(caseId, acceptFollowUp);
                    }
                    else {
                        pvi.util.checkEditLock(caseId, changeCaseState, activeStateId);
                    }
                    break;
                case finalStateId:
                    var submitHandler = function (finalStateId) {
                        showWarning("", getMessage('submit_btn'), pvi_constants.cancel_btn_label, pvi_constants.success_btn_label, function () {
                            changeCaseState(finalStateId);
                        });
                    };
                    pvi.util.checkEditLock(caseId, submitHandler,finalStateId);
                    break;
                case rejectedStateId:
                    var rejectCase = function(rejectedStateId){
                        pvi.util.justificationModule().showJustificationModal("mark_reject", rejectedStateId, changeCaseStateWithJustification);
                    };
                    pvi.util.checkEditLock(caseId, rejectCase, rejectedStateId);
                    break;
                case closedStateId:
                    var closeCase = function(closedStateId){
                        pvi.util.justificationModule().showJustificationModal("mark_closed", closedStateId, changeCaseStateWithJustification);
                    };
                    pvi.util.checkEditLock(caseId, closeCase, closedStateId);
                    break;
                case 'fullCaseView':
                    window.location.href = fceUrl + "/" + caseId;
                    break;
                case 'caseEntry':
                    window.location.href = caseEntryUrl + "?templateId=" + templateId + "&id=" + caseId;
                    break;
                case 'case':
                    var params;
                    if (templateId === pvi_constants.ack) {
                        params = generateParams(pvi_urls.xml_report_url, pvi_constants.ack, caseId);
                        pvi.util.getXMLReport(params);
                    } else if (templateId === pvi_constants.e2b) {
                        params = [];
                        params['xmlType'] = pvi_constants.e2b;
                        params = generateParams(pvi_urls.xml_report_url, pvi_constants.e2b, caseId);
                        pvi.util.getXMLReport(params);
                    } else if (templateId === pvi_constants.fu_diff_view) {
                        params = generateParams(pvi_urls.validate_fu_diff_view_url, pvi_constants.fu_diff_view, caseId);
                        pvi.util.validateFuDiffView(params);
                    }
                    break;
            }
            return true;
        };

        var generateParams = function (url, xmlType, caseId) {
            return {
                'url': url,
                'xmlType': xmlType,
                'caseId': caseId
            };
        };

        setCaseGridSecondaryStyle();

        var manageSecondaryView = (function () {

            var getDataKey = function (name) {
                if (name) {
                    if (name.indexOf('.') !== -1) {
                        return name.split('.');
                    } else if (name.endsWith('Low')) {
                        return [name.substring(0, name.indexOf('Low'))];
                    } else if (name.endsWith('WithOrder')) {
                        return [name.substring(0, name.indexOf('WithOrder'))];
                    } else
                        return [name] === null ? "" : [name];
                }
            };

            // This is the function to build the secondary view
            var buildSecondaryViewForColumn = function (columnName, label, data) {
                var specialFields = {"seriousnessString": "seriousness.shortName","dueDate" : "dueDateString","caseSeriousness.category":"caseSeriousness","localSubmissionDueDate":"localSubmissionDueDateString","centralReceiptDate":"centralReceiptDateString","localSubmissionDate":"localSubmissionDateString", "dob": "dobString", "reporters.qualificationValue": "reporterQualification.value", "reporters.countryName":"reporterCountry.name"};
                //date format pattern to be compatible with IE
                var dateFormatPattern = /(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;
                if(specialFields[columnName]){
                    columnName = specialFields[columnName];
                }
                var hideFieldDataForSafetyCases = ["caseState", "assignedToUsername", "icsr.reportVersion", "icsr.reportMessage", "icsr.destination", "categories.value", "icsr.stateTimestamp", "senderType.value", "icsr.type", "icsr.dueDate", "attachments.name", "senderName", "dueDateString", "icsr.transmissionStatus"];
                if(data.sourceDbId === 2 && hideFieldDataForSafetyCases.indexOf(columnName) >=0){
                    return '';
                }
                var dataKey = getDataKey(columnName);
                var theValue = "";
                // if this is a lookup
                if (dataKey.length > 1) {
                    var firstKey = dataKey[0];
                    var secondKey = getDataKey(dataKey[1]);
                    var firstValue = data[firstKey];
                    if (firstValue) {
                        if (_.isArray(firstValue)) {
                            theValue = firstValue.map(function(ele) {
                                var val = ele[secondKey];
                                if (_.isArray(val)) {
                                   if (dataKey[2]) {
                                     return _.collect(val, function (ele) {
                                        return ele[dataKey[2]];
                                     }).join(", ");
                                   }
                                   return val.join(', ');
                                }
                                return val;
                            }).join(", ");
                        } else {
                            theValue = firstValue[secondKey];
                        }
                    } else {
                        theValue = "";
                    }
                } else {
                    theValue = data[dataKey];
                }
                if (_.isNull(theValue) || _.isUndefined(theValue) || _.isNaN(theValue) || theValue === " "){
                    theValue = "";
                }
                if(dateFormatPattern.test(theValue)){
                    theValue = moment(theValue).format((pvi.util.getDateFormats.listDateFormat).toUpperCase());
                }

                var footableColClass = theValue.length < 50 ? "footable-row-detail-col-md" : "footable-row-detail-col-lg";
                pvui.grid.utils.setGridHeight(container); //To Fix Dashboard Widget Dynamic Height Issues
                $(".pv-action-dropdown").hide(); //This is to fix issue for opened dropdown not being closed clicking on row
                if (!_.isEmpty(theValue) && theValue === PIIMaskPattern){
                    return '<div class="footable-row-detail-col ' + footableColClass + '">' +
                        '<div class="footable-row-detail-name">' + label + ' </div>' +
                        '<div class="footable-row-detail-value pv-pii">' + PIIMaskString + '</div></div>';
                } else if(!_.isEmpty(theValue)){
                    return '<div class="footable-row-detail-col ' + footableColClass + '">' +
                        '<div class="footable-row-detail-name">' + label + ' </div>' +
                        '<div class="footable-row-detail-value">' + pvi.util.encodeToHTML(theValue) + '</div></div>';
                } else {
                    return '';
                }
            };

            var generateSecondaryViewHTML = function (rowData) {
                if (rowData) {
                    var tableWrapperWidth = container.find(".DTFC_ScrollWrapper").width() - 15;
                    var gridScrolledLeft = container.find(".dataTables_scrollBody").get(0).scrollLeft;
                    var isAnyDataAvailable = false;
                    // rowData is the original data object for the row
                    var buildSecondaryView = buildSecondaryViewForColumn;
                    var ele = '<div class="footable-row-detail-inner" style="width:' + tableWrapperWidth + 'px; margin-left:'+gridScrolledLeft +'px">';
                    var colData = _.reduce(listColumns(pvi_list_columns_view.secondaryCols, true), function (memo, ele) {
                        var colData = buildSecondaryView(ele.name, ele.label, rowData);
                        if (colData.length > 0) {
                            isAnyDataAvailable = true;
                        }
                        return memo + colData + "\n";
                    }, "");
                    colData = ele +'<div class="footable-row-detail-row">'+ colData;
                    if (isAnyDataAvailable) {
                        return colData + '</div></div>';
                    } else {
                        return ele +'<div class="text-center">' + getMessage('no_data_secondary_view') + '</div></div>';
                    }
                } else {
                    return "";
                }
            };

            var hideSecondaryView = function (tr, row) {
                tr.removeClass('details');
                row.child.hide();
                var fixedColumnRow = container.find('.DTFC_Cloned tbody tr[data-dt-row=' + row.index() + '][class*="padding"]');
                fixedColumnRow.remove();
                pvui.grid.manageUIWrapper.updatePerfectScrollbar(container);
            };

            var showSecondaryView = function (tr, row) {
                var idx = row.index();
                var secondaryViewHTML = generateSecondaryViewHTML(row.data());
                tr.addClass('details');
                var secondaryPanel = row.child(secondaryViewHTML);
                var p = secondaryPanel.show();
                var tdHeight = tr.next().addClass('pv-caselist-secodary-view').find(".footable-row-detail-inner").height();
                tr.next().find("td").css({"height": tdHeight + "px"});
                var rowHeight = $(p.child()).height();
                var fixedColumnRow = container.find('.DTFC_Cloned tbody tr[data-dt-row=' + idx + ']');
                fixedColumnRow.after("<tr class='padding' data-dt-row='" + idx + "' style='height:" + rowHeight + "px'><td colspan='2'></td></tr>");
                pvui.grid.manageUIWrapper.updatePerfectScrollbar(container);
            };

            var init = function (event) {
                var target = event.target;
                var trIdx = $(target).closest("tr").index()+1;
                var tr = container.find(".dataTables_scrollBody>table>tbody>tr:nth-child("+trIdx+")");
                var row = caseListTable.row(tr);
                if (row.child.isShown()) {
                    hideSecondaryView(tr, row);
                } else if(secondaryColumnsExist()) {
                    showSecondaryView(tr, row);
                }
            };

            return {
                init: init
            };
        })();

        var initializePopover = function () {
            _.each(container.find('.more-option'), function (ele) {
                ele = $(ele);
                var moreDataContainer = ele.closest(".pvjs_inner-more-box");
                var moreData;
                if (moreDataContainer.hasClass('disableHtmlEncode')) {
                    moreData = ele.data('moredata');
                } else {
                    moreData = pvi.util.encodeToHTML(ele.data('moredata'));
                }
                var isIconView = ele.data('iconview-popover');
                var currVal = isIconView? ele.text(): '';
                var targetEvent = ele.data('target-event');
                var bindEvent = targetEvent ? targetEvent : 'hover';
                ele.webuiPopover({
                    html: !ele.hasClass('allow-text'),
                    trigger: bindEvent,
                    content: function () {
                        if(_.isEmpty(moreData)) {
                            moreData = "";
                        }
                        var theData = _.filter(moreData.split(','), function (it) {
                            return !_.isEmpty(it.trim());
                        });
                        var v = "";
                        var listContainer = '';
                        if(!(_.isEmpty(theData)) && !moreDataContainer.data("type-string")){
                            if(isIconView){
                                listContainer = $("<ul class='icon-list'/>");
                                var userId = $(ele).data('pk');
                                for (var i = 0; i < theData.length; i++) {
                                    var activeClass = (theData[i] === currVal) ? "active": "";
                                    v = $("<li><a data-pk='"+userId+"' class='"+ activeClass +" pop-ic"+ theData[i] + "'>" + theData[i] + "</a></li>");
                                    v.appendTo(listContainer);
                                }
                            } else {
                                listContainer = $("<ul class='text-list'/>");
                                for (var j = 0; j < theData.length; j++) {
                                    if (theData[j]){
                                        v = $("<li>" + theData[j] + "</li>");
                                    }
                                    v.appendTo(listContainer);
                                }
                            }
                        } else {
                            listContainer = moreDataContainer.text();
                        }
                        return listContainer;
                    }
                });
            });
        };

        caseListTable.on('click','.showUnauthorisedMessage',function () {
            pvi.util.showInfo(getMessage("pii_attachment_warning"));
        });

        $(document).on('click', '.webui-popover-content .showUnauthorisedMessage', function () {pvi.util.showInfo(getMessage("pii_attachment_warning"))});

        caseListTable.on('click', '.list-row-checkbox', function (event) {
            var target = $(event.target);
            var isChecked = target.is(":checked");
            if (!isChecked) {
                uncheckSelectAllCheckbox();
            }
            if(isChecked && isOnDuplicateSearchPage){
                $("input:checkbox[name='" + target.prop("name") + "']").prop("checked", false);
                target.prop("checked", true);
            }
            var showBulkActionButton =  (container.find(".list-row-checkbox:checked").length > 1);
            manageBulkAction.init(showBulkActionButton);
        });

        caseListTable.on('click', '.link-to-fce', function (event) {
            event.preventDefault();
            var currentElement = $(this);
            var sourceDbId = currentElement.data("source-db");
            if(sourceDbId === pvi_constants.source_db_intake){
                pvi.util.gotoURL(pvi_urls.show_case_url + currentElement.attr('data-id') + pvi_urls.open_accordion);
            } else if(sourceDbId === pvi_constants.source_db_safety){
                //find id of latest valid version using intake case
                var params = {
                    sourceCaseNum: currentElement.text(),
                    sourceDbId: sourceDbId
                };
                pvi.util.fetchLinkedCasesDetails(params);
            }
        });

        caseListTable.on('click', '.safety-link-to-fce', function (event) {
            event.preventDefault();
            var currentElement = $(this);
            var sourceDbId = currentElement.data("source-db");
            if (currentElement.hasClass("safety-link-not-exists")) {
                swal("Warning", getMessage('safety_case_not_linked'));
            } else if(sourceDbId === pvi_constants.source_db_safety) {
                pvi.util.gotoURL(pvi_urls.show_case_url + currentElement.attr('data-id') + pvi_urls.open_accordion);
            } else if (sourceDbId === pvi_constants.source_db_intake) {
                //find safety case id using safety case num
                var params = {
                    sourceCaseNum: currentElement.text(),
                    sourceDbId: sourceDbId
                };
                pvi.util.fetchLinkedCasesDetails(params);
            }
        });

        caseListTable.on('click', '.not-clickable', function (event) {
            swal("warning", getMessage('no_action_state') + $(event.target).attr('data-case-state') + " State");
        });

        caseListTable.on('mouseenter', 'span.state-comment', function (event) {
            $(event.target).tooltip();
        });

        pvi.util.manageUserAssign.init(scrollableSection, scrollableFixedCol);
        pvi.util.manageCasePriority.init();
        caseListTable.on('click', 'tr td', function (e) {
            var targetElement = e.target.tagName;
            if(targetElement === "TD"){
                manageSecondaryView.init(e);
            }
        });

        // moved out action dropdown hyperlink click function
        $(document).on("click", ".pv-action-dropdown a", function (e) {
            e.preventDefault();
            if(e.handled !== true) {
                var target = $(e.target),
                    caseId = target.attr('data-case-id'),
                    intakeCaseNumber = target.attr('data-intake-case-num'),
                    intakeCaseVersion = target.attr('data-intake-case-version'),
                    action = target.data('action'),
                    templateId = target.attr('data-templateId'),
                    caseState = target.data('case-state'),
                    targetContainer = target.data('container');
                handleActionDropdown(e, action, caseId, templateId, intakeCaseNumber, caseState,targetContainer, intakeCaseVersion);
                e.handled = true;
            }
        });

        caseListTable.on('draw.dtfc', function(){
            var inputs = container.find("div.DTFC_ScrollWrapper input[data-field="+fixedFilterColName+"]");
            if(inputs.length === 3){ //fixed cols creates three instances of the filter inputs instead of 2
                var value = $(inputs[2]).val();
                $(inputs[0]).val(value);
                $(inputs[1]).val(value);
            }
        });

        caseListTable.on('draw.dt', function () {
            highLightRows();
            hideCaseListActionAllButton();
            uncheckSelectAllCheckbox();
            colReorderCaseList();
            pvui.grid.manageUIWrapper.setPerfectScrollbar(container);
            pvui.grid.manageUIWrapper.handleDragDropEvent(container);
            updateGridUI();
            pvui.grid.utils.updateGridOnResize(container);
            pvui.common.hidePVLoader();
            pvui.grid.manageUIWrapper.preventScrollingEmptyGrid(container, scrollableSection);
            pvui.grid.manageUIWrapper.handleRowMouseOverEvent(container);
            pvui.grid.manageUIWrapper.bindIconHoverEvents(container);
            pvui.grid.manageUIWrapper.handleGridHorizontalScroll(container);
            maskPIIFields();
            pvui.grid.manageUIWrapper.setMoreOption(container);
            initializePopover();
        });
        return caseListTable;
    };

    var currentColOrder = [];

    var colReorderCaseList = function () {
        var newOrder = buildColumnOrder();
        if (!_.isEqual(currentColOrder, newOrder)) {
            caseListTable.colReorder.order(newOrder, true);
            currentColOrder = newOrder;
        }
    };

    var hideCaseListActionAllButton = function () {
        container.find(".btn-caselist-action-all").addClass("hide").attr("disabled", false);
        container.find(".grid-top-head .dropdown-menu").parent().removeClass('open');
    };

    var showConfigCols = function (cols) {
        var listOrder = 0;
        return _.reduce(cols, function (collection, col) {
            if (!_.has(col, 'listOrder')){
                col.listOrder = listOrder++;
            }
            collection = collection + '<a href="#" class="list-group-item" data-field="' + col.name + '">' + col.label + '</a>' + "\n";
            return collection;
        }, "");
    };

    var pre_load = function () {
        $.ajax({
            url: createURL(pvi_urls.case_list_columns_url),
            cache: false,
            success: function (data) {
                if (data && data.length > 0) {
                    columnConfigs = _.collect(data, function (item) {
                        var cfg = {};
                        cfg.name = item.name;
                        cfg.label = item.label;
                        cfg.seq = item.seq;
                        cfg.listOrder = item.listOrder;
                        cfg.containerView = item.containerView;
                        return cfg;
                    });
                }
                container.find('.list-group-primary').html(showConfigCols(listColumns(pvi_list_columns_view.primaryCols, true)));
                container.find('.list-group-secondary').html(showConfigCols(listColumns(pvi_list_columns_view.secondaryCols, true)));
                container.find('.list-group-optional').html(showConfigCols(listColumns(pvi_list_columns_view.optionalCols, true)));
                init();
            }
        });
    };

    var createURL = function (url) {
        if (!url.endsWith("/")) url = url + "/";
        return url + pageTypeId;
    };

    var buildColumnOrder = function () {

        var getPreDefOrder = function () {
            var currentHeader = dataTable.find('thead th');
            return _.collect(currentHeader, function (ele) {
                ele = $(ele);
                return {
                    idx: ele.data('idx'),
                    name: ele.attr('data-field')
                };
            });
        };

        var buildNewOrder = function () {
            var preDefOrder = getPreDefOrder();
            var newOrder = [];
            var sortedPrimaryCols = listColumns(pvi_list_columns_view.primaryCols, true);
            if (initOrder) {
                initOrder = false;
                _.each(sortedPrimaryCols, function (cfg) {
                    var found = _.find(preDefOrder, function (pd) {
                        return (cfg.name === pd.name);
                    });
                    if (found)
                        newOrder.push(found.idx);
                });
                return newOrder;
            } else {
                newOrder = _.collect(sortedPrimaryCols, function (colCfg) {
                    var found = _.find(preDefOrder, function (ele) {
                        return (colCfg.seq === ele.idx);
                    });
                    return found ? found.idx : 0;
                });
                return newOrder;
            }
        };

        var init = function () {
            var columns = _.range(0, columnSize);
            var newOrder = buildNewOrder();
            var restColumns = _.filter(columns, function (i) {
                return !_.contains(newOrder, i);
            });
            var finalOrder = newOrder.concat(restColumns);
            finalOrder = _.without(finalOrder, 0, 1, columnSize - 1);
            finalOrder.push(columnSize - 1);
            finalOrder.unshift(1);
            finalOrder.unshift(0);
            return finalOrder;
        };
        return init();
    };

    var resetProcessingMessage = function(){
        $.extend( $.fn.dataTable.defaults, {
            language: {
                "processing": ""
            }
        });
    };

    var initListPage = function () {
        resetProcessingMessage();
        pre_load();
        reInitButtonsAfterRedraw();
        pvui.grid.utils.appendDropdownOutsideContainer(container,'.td-box>.dropdown');
        pvi.rdl.manageReportDistribution.init();
        if($('#isDashboardPage').length < 1) {
            pvi.util.bindFileUploaderEvent();
        }
    };

    var highlightTab = function () {
        if (initialized) {
            var column = caseListTableRef.caseListTable.column('assignedToUsername:name');
            var assignedUsername = column.search();
            var tabClassName = "myCasesButton";
            if((typeof duplicateSearchPageId !== 'undefined') && (pageTypeId === duplicateSearchPageId.toString())){
                //if duplicate search then search for all cases and mark assignTo field read only
                container.find("#assignee-filter").prop('readonly', true);
                column.search('');
                $(column.header()).find('input.list-filter').val('');
            } else if (assignedUsername === undefined || assignedUsername === loginUser) {
                container.find("#assignee-filter").prop({'readonly': true, 'disabled': true});
            } else {
                container.find("#assignee-filter").prop({'readonly': false, 'disabled': false});
                tabClassName = "allCasesButton";
            }
            container.find('.myCasesButton, .allCasesButton').removeClass('btn-pointed');
            container.find("." + tabClassName).addClass('btn-pointed');
        }
    };

    initListPage();

};

$.fn.DataTable.ext.pager.full_numbers_no_ellipses = function (page, pages) {
    var numbers = [];
    $.fn.DataTable.ext.pager.numbers_length = 5;
    var buttons = $.fn.DataTable.ext.pager.numbers_length;
    var half = Math.floor(buttons / 2);
    var _range = function (len, start) {
        var end;
        if (typeof start === "undefined") {
            start = 0;
            end = len;
        } else {
            end = start;
            start = len;
        }
        var out = [];
        for (var i = start; i < end; i++) {
            out.push(i);
        }
        return out;
    };
    if (pages <= buttons) {
        numbers = _range(0, pages);
    } else if (page <= half) {
        numbers = _range(0, buttons);
    } else if (page >= pages - 1 - half) {
        numbers = _range(pages - buttons, pages);
    } else {
        numbers = _range(page - half, page + half + 1);
    }
    numbers.DT_el = 'span';
    return ['first', 'previous', numbers, 'next', 'last'];
};

/*
 * File:        speechRecogSearch.js
 * Description: This file is used for speech recognition in Search Cases input in case list screen
 * Author:      Gautam Malhotra, Parveen Soni RxLogix
 * Date:        31-July-2017
 * Usage:       To record user speech as text input for search criteria in case list screen
 * Copyright:   RxLogix Corporation
 * Version:     initial release 0.1
 * require:     jQuery
 *
 * Change Management:
 * Name                             version     Author                                                    Description
 * speechRecogSearch.js             0.1         Gautam Malhotra, Parveen Soni                             Initial Version
 *
 */

(function(){
    var final_transcript = '';
    var recognizing = false;
    var recognition;
    var micElement = $('#mic');
    try {
        if(!'webkitSpeechRecognition' in window){
            recognition= new (window.SpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
        }
        else {
            recognition = new webkitSpeechRecognition();
        }
    }
    catch (e) {
        recognition = {};
    }
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.onstart = function() {
        recognizing = true;
    };

    recognition.onerror = function(event) {
        console.log(event.error);
    };

    recognition.onend = function() {
        recognizing = false;
        $('.search-button').trigger('click');
    };

    recognition.onresult = function(event) {
        var interim_transcript = '';
        for (var i = event.resultIndex; i < event.results.length; ++i) {
            if (event.results[i].isFinal) {
                final_transcript += event.results[i][0].transcript;
                //add voice text to the search field
                document.getElementById("simpleSearchField").value = final_transcript;
            } else {
                interim_transcript += event.results[i][0].transcript;
            }
        }
        final_transcript = capitalize(final_transcript);
        final_span.innerHTML = linebreak(final_transcript);
        interim_span.innerHTML = linebreak(interim_transcript);

    };

    var two_line = /\n\n/g;
    var one_line = /\n/g;
    function linebreak(s) {
        return s.replace(two_line, '<p></p>').replace(one_line, '<br>');
    }

    function capitalize(s) {
        return s.replace(s.substr(0,1), function(m) { return m.toUpperCase(); });
    }

    micElement.click(function(event){
        event.preventDefault();
        if (recognizing) {
            recognition.stop();
            micElement.removeClass('fa-microphone');
            micElement.addClass('fa-microphone-slash');
            return;
        }
        micElement.removeClass('fa-microphone-slash');
        micElement.addClass('fa-microphone');
        final_transcript = '';
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.start();
        final_span.innerHTML = '';
        interim_span.innerHTML = '';
    });
})();

// This is a manifest file that'll be compiled into dashboard-manifest.js.
//
// Any JavaScript file within this directory can be referenced here using a relative path.
//
// You're free to add application-wide JavaScript to this file, but it's generally better
// to create separate JavaScript files as needed.
//
//= require vendorUi/gridstack/gridstack.min
//= require vendorUi/gridstack/gridstack.jQueryUI.min
//= require vendorUi/counterup/jquery.counterup.min
//= require app/dashboard/dashboard
//= require app/list/list-manifest
